<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="索引" href="../genindex.html" /><link rel="search" title="搜索" href="../search.html" /><link rel="copyright" title="版权所有" href="../copyright.html" /><link rel="next" title="MySQL 和 MariaDB" href="mysql.html" /><link rel="prev" title="Dialects" href="index.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.08.06 -->
        <title>PostgreSQL - SQLAlchemy 2.1 Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/changelog.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_paramlinks.css" />
    <link rel="stylesheet" type="text/css" href="../_static/docs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">SQLAlchemy 2.1 Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">SQLAlchemy 2.1 Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">概述</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorial/index.html">SQLAlchemy 统一教程</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of SQLAlchemy 统一教程</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/engine.html">建立连接 - Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/dbapi_transactions.html">使用事务和DBAPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/metadata.html">使用数据库元数据</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../tutorial/data.html">处理数据</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of 处理数据</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/data_insert.html">使用 INSERT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/data_select.html">使用 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/data_update.html">使用 UPDATE 和 DELETE 语句</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/orm_data_manipulation.html">使用 ORM 进行数据操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/orm_related_objects.html">使用 ORM 相关对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/further_reading.html">进一步阅读</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../orm/index.html">SQLAlchemy ORM</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of SQLAlchemy ORM</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../orm/quickstart.html">ORM 快速入门</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../orm/mapper_config.html">ORM 映射类配置</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of ORM 映射类配置</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../orm/mapping_styles.html">ORM 映射类概述</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../orm/declarative_mapping.html">使用声明式映射类</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of 使用声明式映射类</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../orm/declarative_styles.html">声明式映射风格</a></li>
<li class="toctree-l4"><a class="reference internal" href="../orm/declarative_tables.html">声明式的表配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="../orm/declarative_config.html">使用声明式映射器配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="../orm/declarative_mixins.html">使用 Mixins 组合映射层次结构</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../orm/dataclasses.html">与dataclass和attrs的集成</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/mapped_sql_expr.html">SQL 表达式作为映射属性</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/mapped_attributes.html">更改Attribute的行为</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/composites.html">复合列类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/inheritance.html">映射类继承层次结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/nonstandard_mappings.html">非传统映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/versioning.html">配置版本计数器</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/mapping_api.html">类映射 API</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../orm/scalar_mapping.html">映射 SQL 表达式</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of 映射 SQL 表达式</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../orm/mapping_columns.html">映射表格列</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../orm/relationships.html">关系配置</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of 关系配置</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../orm/basic_relationships.html">基本关系模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/self_referential.html">邻接表关系</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/join_conditions.html">配置关系连接方式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/large_collections.html">使用大型集合</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/collection_api.html">集合自定义和 API 详细信息</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/relationship_persistence.html">特殊关系的持久化模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/backref.html">使用旧版“backref”关系参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/relationship_api.html">关系 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../orm/queryguide/index.html">ORM 查询指南</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of ORM 查询指南</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/select.html">为 ORM 映射类编写 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/inheritance.html">为继承映射编写 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/dml.html">启用 ORM 的 INSERT、UPDATE 和 DELETE 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/columns.html">列加载选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/relationships.html">关系加载技术</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/api.html">用于查询的 ORM API 功能</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/query.html">旧式查询 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../orm/session.html">使用会话</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of 使用会话</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../orm/session_basics.html">会话基础知识</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/session_state_management.html">状态管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/cascades.html">级联</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/session_transaction.html">事务和连接管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/persistence_techniques.html">附加持久性技术</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/contextual.html">上下文/线程本地会话</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/session_events.html">使用事件跟踪查询、对象和会话更改</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/session_api.html">会话 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../orm/extending.html">事件和内部</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of 事件和内部</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../orm/events.html">ORM 事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/internals.html">ORM 内部</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/exceptions.html">ORM 异常</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../orm/extensions/index.html">ORM 扩展</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of ORM 扩展</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/asyncio.html">异步 I/O (asyncio)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/associationproxy.html">关联代理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/automap.html">自动映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/baked.html">烘焙查询</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/declarative/index.html">声明式扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/mutable.html">突变追踪</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/orderinglist.html">排序列表</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/horizontal_shard.html">水平分片</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/hybrid.html">混合属性</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/indexable.html">Indexable</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/instrumentation.html">替代类检测</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../orm/examples.html">核心和 ORM 示例</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../core/index.html">SQLAlchemy Core</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of SQLAlchemy Core</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/expression_api.html">SQL 语句和表达式 API</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of SQL 语句和表达式 API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/sqlelement.html">列元素和表达式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/operators.html">操作符参考</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/selectable.html">SELECT 和相关构造</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/dml.html">插入,更新,删除</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/functions.html">SQL 和 范型函数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/compiler.html">自定义 SQL 构造和编译扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/serializer.html">表达式序列化器扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/foundation.html">SQL 表达式语言基础构造</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/visitors.html">访问者和遍历实用程序</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/schema.html">Schema 定义语言</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of Schema 定义语言</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/metadata.html">使用元数据描述数据库</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/reflection.html">反映数据库对象</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/defaults.html">列 INSERT/UPDATE 默认值</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/constraints.html">定义约束和索引</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/ddl.html">自定义 DDL</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/types.html">SQL 数据类型对象</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of SQL 数据类型对象</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/type_basics.html">类型层次结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/custom_types.html">自定义类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/type_api.html">基本类型 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/engines_connections.html">Engine和Connection的使用</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of Engine和Connection的使用</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/engines.html">Engine 配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/connections.html">使用Engines和Connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/pooling.html">连接池</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/events.html">核心事件</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/api_basics.html">Core API 基础</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of Core API 基础</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/event.html">事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/inspection.html">运行时审查 API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/exceptions.html">Core 异常</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/internals.html">Core 内部</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Dialects</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of Dialects</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">PostgreSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="mysql.html">MySQL 和 MariaDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="sqlite.html">SQLite</a></li>
<li class="toctree-l2"><a class="reference internal" href="oracle.html">Oracle</a></li>
<li class="toctree-l2"><a class="reference internal" href="mssql.html">Microsoft SQL Server</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../faq/index.html">常见问题</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of 常见问题</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../faq/installation.html">安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/connections.html">连接 / 引擎</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/metadata_schema.html">元数据 / Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/sqlexpressions.html">SQL 表达式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/ormconfiguration.html">ORM 配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/performance.html">性能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/sessions.html">会话 / 查询</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/thirdparty.html">第三方包集成问题</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../errors.html">错误消息</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../changelog/index.html">变更和迁移</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of 变更和迁移</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_21.html">SQLAlchemy 2.1 有什么新功能？</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_21.html">2.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_20.html">2.0 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_14.html">1.4 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_13.html">1.3 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_12.html">1.2 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_11.html">1.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_10.html">1.0 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_09.html">0.9 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_08.html">0.8 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_07.html">0.7 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_06.html">0.6 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_05.html">0.5 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_04.html">0.4 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_03.html">0.3 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_02.html">0.2 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_01.html">0.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_20.html">SQLAlchemy 2.0 - Major Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/whatsnew_20.html">What’s New in SQLAlchemy 2.0?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_14.html">What’s New in SQLAlchemy 1.4?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_13.html">What’s New in SQLAlchemy 1.3?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_12.html">What’s New in SQLAlchemy 1.2?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_11.html">What’s New in SQLAlchemy 1.1?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_10.html">What’s New in SQLAlchemy 1.0?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_09.html">What’s New in SQLAlchemy 0.9?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_08.html">What’s New in SQLAlchemy 0.8?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_07.html">What’s New in SQLAlchemy 0.7?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_06.html">What’s New in SQLAlchemy 0.6?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_05.html">What’s new in SQLAlchemy 0.5?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_04.html">What’s new in SQLAlchemy 0.4?</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="postgresql">
<span id="postgresql-toplevel"></span><h1>PostgreSQL<a class="headerlink" href="#postgresql" title="Link to this heading">¶</a></h1>
<p>PostgreSQL</p>
<section id="dialect-postgresql">
<span id="module-sqlalchemy.dialects.postgresql.base"></span><p>Support for the PostgreSQL database.</p>
<p>The following table summarizes current support levels for database release versions.</p>
<p><div class="table-wrapper docutils container" id="id16">
<table class="docutils align-default" id="id16">
<caption><span class="caption-text"><strong>Supported PostgreSQL versions</strong></span><a class="headerlink" href="#id16" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Support type</p></th>
<th class="head"><p>Versions</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="index.html#term-Supported-version"><span class="xref std std-term">Supported version</span></a></p></td>
<td><p>9.6+</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="index.html#term-Best-effort"><span class="xref std std-term">Best effort</span></a></p></td>
<td><p>9+</p></td>
</tr>
</tbody>
</table>
</div>
</p>
<h2>DBAPI Support<a class="headerlink" href="#dialect-postgresql" title="Link to this heading">¶</a></h2>
<p>The following dialect/DBAPI options are available.  Please refer to individual DBAPI sections for connect information.<ul class="simple">
<li><p><a class="reference external" href="#module-sqlalchemy.dialects.postgresql.psycopg2">psycopg2</a></p></li>
<li><p><a class="reference external" href="#module-sqlalchemy.dialects.postgresql.psycopg">psycopg (a.k.a. psycopg 3)</a></p></li>
<li><p><a class="reference external" href="#module-sqlalchemy.dialects.postgresql.pg8000">pg8000</a></p></li>
<li><p><a class="reference external" href="#module-sqlalchemy.dialects.postgresql.asyncpg">asyncpg</a></p></li>
<li><p><a class="reference external" href="#module-sqlalchemy.dialects.postgresql.psycopg2cffi">psycopg2cffi</a></p></li>
</ul>
</p>
</section>
<section id="sequences-serial-identity">
<span id="postgresql-sequences"></span><h2>Sequences/SERIAL/IDENTITY<a class="headerlink" href="#sequences-serial-identity" title="Link to this heading">¶</a></h2>
<p>PostgreSQL supports sequences, and SQLAlchemy uses these as the default means
of creating new primary key values for integer-based primary key columns. When
creating tables, SQLAlchemy will issue the <code class="docutils literal notranslate"><span class="pre">SERIAL</span></code> datatype for
integer-based primary key columns, which generates a sequence and server side
default corresponding to the column.</p>
<p>To specify a specific named sequence to be used for primary key generation,
use the <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><code class="xref py py-func docutils literal notranslate"><span class="pre">Sequence()</span></code></a> construct:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;sometable&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span>
        <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">(</span><span class="s2">&quot;some_id_seq&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">),</span>
<span class="p">)</span></pre></div>
</div>
<p>When SQLAlchemy issues a single INSERT statement, to fulfill the contract of
having the “last insert identifier” available, a RETURNING clause is added to
the INSERT statement which specifies the primary key columns should be
returned after the statement completes. The RETURNING functionality only takes
place if PostgreSQL 8.2 or later is in use. As a fallback approach, the
sequence, whether specified explicitly or implicitly via <code class="docutils literal notranslate"><span class="pre">SERIAL</span></code>, is
executed independently beforehand, the returned value to be used in the
subsequent insert. Note that when an
<a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.insert" title="sqlalchemy.sql.expression.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a> construct is executed using
“executemany” semantics, the “last inserted identifier” functionality does not
apply; no RETURNING clause is emitted nor is the sequence pre-executed in this
case.</p>
<section id="postgresql-10-and-above-identity-columns">
<h3>PostgreSQL 10 and above IDENTITY columns<a class="headerlink" href="#postgresql-10-and-above-identity-columns" title="Link to this heading">¶</a></h3>
<p>PostgreSQL 10 and above have a new IDENTITY feature that supersedes the use
of SERIAL. The <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Identity" title="sqlalchemy.schema.Identity"><code class="xref py py-class docutils literal notranslate"><span class="pre">Identity</span></code></a> construct in a
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> can be used to control its behavior:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Computed</span>

<span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;data&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span>
        <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Identity</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">cycle</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">String</span><span class="p">),</span>
<span class="p">)</span></pre></div>
</div>
<p>The CREATE TABLE for the above <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> object would be:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">GENERATED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">IDENTITY</span><span class="w"> </span><span class="p">(</span><span class="k">START</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="k">CYCLE</span><span class="p">),</span>
<span class="w">    </span><span class="k">data</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">,</span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">在 1.4 版本发生变更: </span>Added <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Identity" title="sqlalchemy.schema.Identity"><code class="xref py py-class docutils literal notranslate"><span class="pre">Identity</span></code></a> construct
in a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> to specify the option of an autoincrementing
column.</p>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>Previous versions of SQLAlchemy did not have built-in support for rendering
of IDENTITY, and could use the following compilation hook to replace
occurrences of SERIAL with IDENTITY:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.schema</span><span class="w"> </span><span class="kn">import</span> <span class="n">CreateColumn</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.compiler</span><span class="w"> </span><span class="kn">import</span> <span class="n">compiles</span>


<span class="nd">@compiles</span><span class="p">(</span><span class="n">CreateColumn</span><span class="p">,</span> <span class="s2">&quot;postgresql&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">use_identity</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">visit_create_column</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;SERIAL&quot;</span><span class="p">,</span> <span class="s2">&quot;INT GENERATED BY DEFAULT AS IDENTITY&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span></pre></div>
</div>
<p>Using the above, a table such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">String</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>Will generate on the backing database as:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">GENERATED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">IDENTITY</span><span class="p">,</span>
<span class="w">    </span><span class="k">data</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">,</span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
</div>
</section>
</section>
<section id="server-side-cursors">
<span id="postgresql-ss-cursors"></span><h2>Server Side Cursors<a class="headerlink" href="#server-side-cursors" title="Link to this heading">¶</a></h2>
<p>Server-side cursor support is available for the psycopg2, asyncpg
dialects and may also be available in others.</p>
<p>Server side cursors are enabled on a per-statement basis by using the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a> connection execution
option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">stream_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="n">text</span><span class="p">(</span><span class="s2">&quot;select * from table&quot;</span><span class="p">)</span>
    <span class="p">)</span></pre></div>
</div>
<p>Note that some kinds of SQL statements may not be supported with
server side cursors; generally, only SQL statements that return rows should be
used with this option.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">自 1.4 版本弃用: </span>The dialect-level server_side_cursors flag is deprecated
and will be removed in a future release.  Please use the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.params.stream_results" title="sqlalchemy.engine.Connection"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.stream_results</span></code></a> execution option for
unbuffered cursor support.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/connections.html#engine-stream-results"><span class="std std-ref">使用服务器端游标（又称流结果）</span></a></p>
</div>
</section>
<section id="transaction-isolation-level">
<span id="postgresql-isolation-level"></span><h2>Transaction Isolation Level<a class="headerlink" href="#transaction-isolation-level" title="Link to this heading">¶</a></h2>
<p>Most SQLAlchemy dialects support setting of transaction isolation level
using the <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.isolation_level" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.isolation_level</span></code></a> parameter
at the <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a> level, and at the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>
level via the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.isolation_level" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.isolation_level</span></code></a>
parameter.</p>
<p>For PostgreSQL dialects, this feature works either by making use of the
DBAPI-specific features, such as psycopg2’s isolation level flags which will
embed the isolation level setting inline with the <code class="docutils literal notranslate"><span class="pre">&quot;BEGIN&quot;</span></code> statement, or for
DBAPIs with no direct support by emitting <code class="docutils literal notranslate"><span class="pre">SET</span> <span class="pre">SESSION</span> <span class="pre">CHARACTERISTICS</span> <span class="pre">AS</span>
<span class="pre">TRANSACTION</span> <span class="pre">ISOLATION</span> <span class="pre">LEVEL</span> <span class="pre">&lt;level&gt;</span></code> ahead of the <code class="docutils literal notranslate"><span class="pre">&quot;BEGIN&quot;</span></code> statement
emitted by the DBAPI.   For the special AUTOCOMMIT isolation level,
DBAPI-specific techniques are used which is typically an <code class="docutils literal notranslate"><span class="pre">.autocommit</span></code>
flag on the DBAPI connection object.</p>
<p>To set isolation level using <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+pg8000://scott:tiger@localhost/test&quot;</span><span class="p">,</span>
    <span class="n">isolation_level</span><span class="o">=</span><span class="s2">&quot;REPEATABLE READ&quot;</span><span class="p">,</span>
<span class="p">)</span></pre></div>
</div>
<p>To set using per-connection execution options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">isolation_level</span><span class="o">=</span><span class="s2">&quot;REPEATABLE READ&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">begin</span><span class="p">():</span>
        <span class="o">...</span>  <span class="c1"># work with transaction</span></pre></div>
</div>
<p>There are also more options for isolation level configurations, such as
“sub-engine” objects linked to a main <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> which each apply
different isolation level settings.  See the discussion at
<a class="reference internal" href="../core/connections.html#dbapi-autocommit"><span class="std std-ref">设置事务隔离级别（包括 DBAPI 自动提交）</span></a> for background.</p>
<p>Valid values for <code class="docutils literal notranslate"><span class="pre">isolation_level</span></code> on most PostgreSQL dialects include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">READ</span> <span class="pre">COMMITTED</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">READ</span> <span class="pre">UNCOMMITTED</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">REPEATABLE</span> <span class="pre">READ</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SERIALIZABLE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AUTOCOMMIT</span></code></p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/connections.html#dbapi-autocommit"><span class="std std-ref">设置事务隔离级别（包括 DBAPI 自动提交）</span></a></p>
<p><a class="reference internal" href="#postgresql-readonly-deferrable"><span class="std std-ref">Setting READ ONLY / DEFERRABLE</span></a></p>
<p><a class="reference internal" href="#psycopg2-isolation-level"><span class="std std-ref">Psycopg2 Transaction Isolation Level</span></a></p>
<p><a class="reference internal" href="#pg8000-isolation-level"><span class="std std-ref">pg8000 Transaction Isolation Level</span></a></p>
</div>
</section>
<section id="setting-read-only-deferrable">
<span id="postgresql-readonly-deferrable"></span><h2>Setting READ ONLY / DEFERRABLE<a class="headerlink" href="#setting-read-only-deferrable" title="Link to this heading">¶</a></h2>
<p>Most PostgreSQL dialects support setting the “READ ONLY” and “DEFERRABLE”
characteristics of the transaction, which is in addition to the isolation level
setting. These two attributes can be established either in conjunction with or
independently of the isolation level by passing the <code class="docutils literal notranslate"><span class="pre">postgresql_readonly</span></code> and
<code class="docutils literal notranslate"><span class="pre">postgresql_deferrable</span></code> flags with
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execution_options" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code></a>.  The example below illustrates
passing the <code class="docutils literal notranslate"><span class="pre">&quot;SERIALIZABLE&quot;</span></code> isolation level at the same time as setting
“READ ONLY” and “DEFERRABLE”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span>
        <span class="n">isolation_level</span><span class="o">=</span><span class="s2">&quot;SERIALIZABLE&quot;</span><span class="p">,</span>
        <span class="n">postgresql_readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">postgresql_deferrable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">begin</span><span class="p">():</span>
        <span class="o">...</span>  <span class="c1"># work with transaction</span></pre></div>
</div>
<p>Note that some DBAPIs such as asyncpg only support “readonly” with
SERIALIZABLE isolation.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4 版本加入: </span>added support for the <code class="docutils literal notranslate"><span class="pre">postgresql_readonly</span></code>
and <code class="docutils literal notranslate"><span class="pre">postgresql_deferrable</span></code> execution options.</p>
</div>
</section>
<section id="temporary-table-resource-reset-for-connection-pooling">
<span id="postgresql-reset-on-return"></span><h2>Temporary Table / Resource Reset for Connection Pooling<a class="headerlink" href="#temporary-table-resource-reset-for-connection-pooling" title="Link to this heading">¶</a></h2>
<p>The <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.QueuePool" title="sqlalchemy.pool.QueuePool"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueuePool</span></code></a> connection pool implementation used
by the SQLAlchemy <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> object includes
<a class="reference internal" href="../core/pooling.html#pool-reset-on-return"><span class="std std-ref">reset on return</span></a> behavior that will invoke
the DBAPI <code class="docutils literal notranslate"><span class="pre">.rollback()</span></code> method when connections are returned to the pool.
While this rollback will clear out the immediate state used by the previous
transaction, it does not cover a wider range of session-level state, including
temporary tables as well as other server state such as prepared statement
handles and statement caches.   The PostgreSQL database includes a variety
of commands which may be used to reset this state, including
<code class="docutils literal notranslate"><span class="pre">DISCARD</span></code>, <code class="docutils literal notranslate"><span class="pre">RESET</span></code>, <code class="docutils literal notranslate"><span class="pre">DEALLOCATE</span></code>, and <code class="docutils literal notranslate"><span class="pre">UNLISTEN</span></code>.</p>
<p>To install
one or more of these commands as the means of performing reset-on-return,
the <a class="reference internal" href="../core/events.html#sqlalchemy.events.PoolEvents.reset" title="sqlalchemy.events.PoolEvents.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolEvents.reset()</span></code></a> event hook may be used, as demonstrated
in the example below. The implementation
will end transactions in progress as well as discard temporary tables
using the <code class="docutils literal notranslate"><span class="pre">CLOSE</span></code>, <code class="docutils literal notranslate"><span class="pre">RESET</span></code> and <code class="docutils literal notranslate"><span class="pre">DISCARD</span></code> commands; see the PostgreSQL
documentation for background on what each of these statements do.</p>
<p>The <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.pool_reset_on_return" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.pool_reset_on_return</span></code></a> parameter
is set to <code class="docutils literal notranslate"><span class="pre">None</span></code> so that the custom scheme can replace the default behavior
completely.   The custom hook implementation calls <code class="docutils literal notranslate"><span class="pre">.rollback()</span></code> in any case,
as it’s usually important that the DBAPI’s own tracking of commit/rollback
will remain consistent with the state of the transaction:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>

<span class="n">postgresql_engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+pyscopg2://scott:tiger@hostname/dbname&quot;</span><span class="p">,</span>
    <span class="c1"># disable default reset-on-return scheme</span>
    <span class="n">pool_reset_on_return</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">postgresql_engine</span><span class="p">,</span> <span class="s2">&quot;reset&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_reset_postgresql</span><span class="p">(</span><span class="n">dbapi_connection</span><span class="p">,</span> <span class="n">connection_record</span><span class="p">,</span> <span class="n">reset_state</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">reset_state</span><span class="o">.</span><span class="n">terminate_only</span><span class="p">:</span>
        <span class="n">dbapi_connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;CLOSE ALL&quot;</span><span class="p">)</span>
        <span class="n">dbapi_connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;RESET ALL&quot;</span><span class="p">)</span>
        <span class="n">dbapi_connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DISCARD TEMP&quot;</span><span class="p">)</span>

    <span class="c1"># so that the DBAPI itself knows that the connection has been</span>
    <span class="c1"># reset</span>
    <span class="n">dbapi_connection</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span></pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">在 2.0.0b3 版本发生变更: </span>Added additional state arguments to
the <a class="reference internal" href="../core/events.html#sqlalchemy.events.PoolEvents.reset" title="sqlalchemy.events.PoolEvents.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolEvents.reset()</span></code></a> event and additionally ensured the event
is invoked for all “reset” occurrences, so that it’s appropriate
as a place for custom “reset” handlers.   Previous schemes which
use the <a class="reference internal" href="../core/events.html#sqlalchemy.events.PoolEvents.checkin" title="sqlalchemy.events.PoolEvents.checkin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PoolEvents.checkin()</span></code></a> handler remain usable as well.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/pooling.html#pool-reset-on-return"><span class="std std-ref">返回时重置</span></a> - in the <a class="reference internal" href="../core/pooling.html#pooling-toplevel"><span class="std std-ref">连接池</span></a> documentation</p>
</div>
</section>
<section id="setting-alternate-search-paths-on-connect">
<span id="postgresql-alternate-search-path"></span><h2>Setting Alternate Search Paths on Connect<a class="headerlink" href="#setting-alternate-search-paths-on-connect" title="Link to this heading">¶</a></h2>
<p>The PostgreSQL <code class="docutils literal notranslate"><span class="pre">search_path</span></code> variable refers to the list of schema names
that will be implicitly referenced when a particular table or other
object is referenced in a SQL statement.  As detailed in the next section
<a class="reference internal" href="#postgresql-schema-reflection"><span class="std std-ref">Remote-Schema Table Introspection and PostgreSQL search_path</span></a>, SQLAlchemy is generally organized around
the concept of keeping this variable at its default value of <code class="docutils literal notranslate"><span class="pre">public</span></code>,
however, in order to have it set to any arbitrary name or names when connections
are used automatically, the “SET SESSION search_path” command may be invoked
for all connections in a pool using the following event handler, as discussed
at <a class="reference internal" href="../core/metadata.html#schema-set-default-connections"><span class="std std-ref">为新连接设置默认架构</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_engine</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+psycopg2://scott:tiger@host/dbname&quot;</span><span class="p">)</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="s2">&quot;connect&quot;</span><span class="p">,</span> <span class="n">insert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">set_search_path</span><span class="p">(</span><span class="n">dbapi_connection</span><span class="p">,</span> <span class="n">connection_record</span><span class="p">):</span>
    <span class="n">existing_autocommit</span> <span class="o">=</span> <span class="n">dbapi_connection</span><span class="o">.</span><span class="n">autocommit</span>
    <span class="n">dbapi_connection</span><span class="o">.</span><span class="n">autocommit</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">dbapi_connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SET SESSION search_path=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">schema_name</span><span class="p">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">dbapi_connection</span><span class="o">.</span><span class="n">autocommit</span> <span class="o">=</span> <span class="n">existing_autocommit</span></pre></div>
</div>
<p>The reason the recipe is complicated by use of the <code class="docutils literal notranslate"><span class="pre">.autocommit</span></code> DBAPI
attribute is so that when the <code class="docutils literal notranslate"><span class="pre">SET</span> <span class="pre">SESSION</span> <span class="pre">search_path</span></code> directive is invoked,
it is invoked outside of the scope of any transaction and therefore will not
be reverted when the DBAPI connection has a rollback.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/metadata.html#schema-set-default-connections"><span class="std std-ref">为新连接设置默认架构</span></a> - in the <a class="reference internal" href="../core/metadata.html#metadata-toplevel"><span class="std std-ref">使用元数据描述数据库</span></a> documentation</p>
</div>
</section>
<section id="remote-schema-table-introspection-and-postgresql-search-path">
<span id="postgresql-schema-reflection"></span><h2>Remote-Schema Table Introspection and PostgreSQL search_path<a class="headerlink" href="#remote-schema-table-introspection-and-postgresql-search-path" title="Link to this heading">¶</a></h2>
<div class="admonition-section-best-practices-summarized admonition">
<p class="admonition-title">Section Best Practices Summarized</p>
<p>keep the <code class="docutils literal notranslate"><span class="pre">search_path</span></code> variable set to its default of <code class="docutils literal notranslate"><span class="pre">public</span></code>, without
any other schema names. Ensure the username used to connect <strong>does not</strong>
match remote schemas, or ensure the <code class="docutils literal notranslate"><span class="pre">&quot;$user&quot;</span></code> token is <strong>removed</strong> from
<code class="docutils literal notranslate"><span class="pre">search_path</span></code>.  For other schema names, name these explicitly
within <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> definitions. Alternatively, the
<code class="docutils literal notranslate"><span class="pre">postgresql_ignore_search_path</span></code> option will cause all reflected
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> objects to have a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.schema" title="sqlalchemy.schema.Table.schema"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Table.schema</span></code></a>
attribute set up.</p>
</div>
<p>The PostgreSQL dialect can reflect tables from any schema, as outlined in
<a class="reference internal" href="../core/reflection.html#metadata-reflection-schemas"><span class="std std-ref">反映来自其他架构的表</span></a>.</p>
<p>In all cases, the first thing SQLAlchemy does when reflecting tables is
to <strong>determine the default schema for the current database connection</strong>.
It does this using the PostgreSQL <code class="docutils literal notranslate"><span class="pre">current_schema()</span></code>
function, illustated below using a PostgreSQL client session (i.e. using
the <code class="docutils literal notranslate"><span class="pre">psql</span></code> tool):</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">=&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">current_schema</span><span class="p">();</span>
<span class="n">current_schema</span>
<span class="c1">----------------</span>
<span class="k">public</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span></pre></div>
</div>
<p>Above we see that on a plain install of PostgreSQL, the default schema name
is the name <code class="docutils literal notranslate"><span class="pre">public</span></code>.</p>
<p>However, if your database username <strong>matches the name of a schema</strong>, PostgreSQL’s
default is to then <strong>use that name as the default schema</strong>.  Below, we log in
using the username <code class="docutils literal notranslate"><span class="pre">scott</span></code>.  When we create a schema named <code class="docutils literal notranslate"><span class="pre">scott</span></code>, <strong>it
implicitly changes the default schema</strong>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">=&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">current_schema</span><span class="p">();</span>
<span class="n">current_schema</span>
<span class="c1">----------------</span>
<span class="k">public</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span>

<span class="n">test</span><span class="o">=&gt;</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">schema</span><span class="w"> </span><span class="n">scott</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span>
<span class="n">test</span><span class="o">=&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">current_schema</span><span class="p">();</span>
<span class="n">current_schema</span>
<span class="c1">----------------</span>
<span class="n">scott</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span></pre></div>
</div>
<p>The behavior of <code class="docutils literal notranslate"><span class="pre">current_schema()</span></code> is derived from the
<a class="reference external" href="https://www.postgresql.org/docs/current/static/ddl-schemas.html#DDL-SCHEMAS-PATH">PostgreSQL search path</a>
variable <code class="docutils literal notranslate"><span class="pre">search_path</span></code>, which in modern PostgreSQL versions defaults to this:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">=&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="n">search_path</span><span class="p">;</span>
<span class="n">search_path</span>
<span class="c1">-----------------</span>
<span class="ss">&quot;$user&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">public</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span></pre></div>
</div>
<p>Where above, the <code class="docutils literal notranslate"><span class="pre">&quot;$user&quot;</span></code> variable will inject the current username as the
default schema, if one exists.   Otherwise, <code class="docutils literal notranslate"><span class="pre">public</span></code> is used.</p>
<p>When a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> object is reflected, if it is present in the
schema indicated by the <code class="docutils literal notranslate"><span class="pre">current_schema()</span></code> function, <strong>the schema name assigned
to the “.schema” attribute of the Table is the Python “None” value</strong>.  Otherwise, the
“.schema” attribute will be assigned the string name of that schema.</p>
<p>With regards to tables which these <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>
objects refer to via foreign key constraint, a decision must be made as to how
the <code class="docutils literal notranslate"><span class="pre">.schema</span></code> is represented in those remote tables, in the case where that
remote schema name is also a member of the current <code class="docutils literal notranslate"><span class="pre">search_path</span></code>.</p>
<p>By default, the PostgreSQL dialect mimics the behavior encouraged by
PostgreSQL’s own <code class="docutils literal notranslate"><span class="pre">pg_get_constraintdef()</span></code> builtin procedure.  This function
returns a sample definition for a particular foreign key constraint,
omitting the referenced schema name from that definition when the name is
also in the PostgreSQL schema search path.  The interaction below
illustrates this behavior:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">=&gt;</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test_schema</span><span class="p">.</span><span class="n">referred</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span>
<span class="n">test</span><span class="o">=&gt;</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">referring</span><span class="p">(</span>
<span class="n">test</span><span class="p">(</span><span class="o">&gt;</span><span class="w">         </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="n">test</span><span class="p">(</span><span class="o">&gt;</span><span class="w">         </span><span class="n">referred_id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">test_schema</span><span class="p">.</span><span class="n">referred</span><span class="p">(</span><span class="n">id</span><span class="p">));</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span>
<span class="n">test</span><span class="o">=&gt;</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">search_path</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="n">test_schema</span><span class="p">;</span>
<span class="n">test</span><span class="o">=&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">pg_catalog</span><span class="p">.</span><span class="n">pg_get_constraintdef</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">oid</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span>
<span class="n">test</span><span class="o">-&gt;</span><span class="w"> </span><span class="n">pg_catalog</span><span class="p">.</span><span class="n">pg_class</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">pg_catalog</span><span class="p">.</span><span class="n">pg_namespace</span><span class="w"> </span><span class="n">n</span>
<span class="n">test</span><span class="o">-&gt;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">oid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">relnamespace</span>
<span class="n">test</span><span class="o">-&gt;</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">pg_catalog</span><span class="p">.</span><span class="n">pg_constraint</span><span class="w"> </span><span class="n">r</span><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">oid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">conrelid</span>
<span class="n">test</span><span class="o">-&gt;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">relname</span><span class="o">=</span><span class="s1">&#39;referring&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">contype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;f&#39;</span>
<span class="n">test</span><span class="o">-&gt;</span><span class="w"> </span><span class="p">;</span>
<span class="w">               </span><span class="n">pg_get_constraintdef</span>
<span class="c1">---------------------------------------------------</span>
<span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">referred_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">referred</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span></pre></div>
</div>
<p>Above, we created a table <code class="docutils literal notranslate"><span class="pre">referred</span></code> as a member of the remote schema
<code class="docutils literal notranslate"><span class="pre">test_schema</span></code>, however when we added <code class="docutils literal notranslate"><span class="pre">test_schema</span></code> to the
PG <code class="docutils literal notranslate"><span class="pre">search_path</span></code> and then asked <code class="docutils literal notranslate"><span class="pre">pg_get_constraintdef()</span></code> for the
<code class="docutils literal notranslate"><span class="pre">FOREIGN</span> <span class="pre">KEY</span></code> syntax, <code class="docutils literal notranslate"><span class="pre">test_schema</span></code> was not included in the output of
the function.</p>
<p>On the other hand, if we set the search path back to the typical default
of <code class="docutils literal notranslate"><span class="pre">public</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">=&gt;</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">search_path</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">public</span><span class="p">;</span>
<span class="k">SET</span></pre></div>
</div>
<p>The same query against <code class="docutils literal notranslate"><span class="pre">pg_get_constraintdef()</span></code> now returns the fully
schema-qualified name for us:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">=&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">pg_catalog</span><span class="p">.</span><span class="n">pg_get_constraintdef</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">oid</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span>
<span class="n">test</span><span class="o">-&gt;</span><span class="w"> </span><span class="n">pg_catalog</span><span class="p">.</span><span class="n">pg_class</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">pg_catalog</span><span class="p">.</span><span class="n">pg_namespace</span><span class="w"> </span><span class="n">n</span>
<span class="n">test</span><span class="o">-&gt;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">oid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">relnamespace</span>
<span class="n">test</span><span class="o">-&gt;</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">pg_catalog</span><span class="p">.</span><span class="n">pg_constraint</span><span class="w"> </span><span class="n">r</span><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">oid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">conrelid</span>
<span class="n">test</span><span class="o">-&gt;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">relname</span><span class="o">=</span><span class="s1">&#39;referring&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">contype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;f&#39;</span><span class="p">;</span>
<span class="w">                     </span><span class="n">pg_get_constraintdef</span>
<span class="c1">---------------------------------------------------------------</span>
<span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">referred_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">test_schema</span><span class="p">.</span><span class="n">referred</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span></pre></div>
</div>
<p>SQLAlchemy will by default use the return value of <code class="docutils literal notranslate"><span class="pre">pg_get_constraintdef()</span></code>
in order to determine the remote schema name.  That is, if our <code class="docutils literal notranslate"><span class="pre">search_path</span></code>
were set to include <code class="docutils literal notranslate"><span class="pre">test_schema</span></code>, and we invoked a table
reflection process as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">text</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+psycopg2://scott:tiger@localhost/test&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;SET search_path TO test_schema, public&quot;</span><span class="p">))</span>
<span class="gp">... </span>    <span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">referring</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;referring&quot;</span><span class="p">,</span> <span class="n">metadata_obj</span><span class="p">,</span> <span class="n">autoload_with</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
<span class="go">&lt;sqlalchemy.engine.result.CursorResult object at 0x101612ed0&gt;</span></pre></div>
</div>
<p>The above process would deliver to the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData.tables" title="sqlalchemy.schema.MetaData.tables"><code class="xref py py-attr docutils literal notranslate"><span class="pre">MetaData.tables</span></code></a>
collection
<code class="docutils literal notranslate"><span class="pre">referred</span></code> table named <strong>without</strong> the schema:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">metadata_obj</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s2">&quot;referred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">schema</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="go">True</span></pre></div>
</div>
<p>To alter the behavior of reflection such that the referred schema is
maintained regardless of the <code class="docutils literal notranslate"><span class="pre">search_path</span></code> setting, use the
<code class="docutils literal notranslate"><span class="pre">postgresql_ignore_search_path</span></code> option, which can be specified as a
dialect-specific argument to both <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> as well as
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData.reflect" title="sqlalchemy.schema.MetaData.reflect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MetaData.reflect()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;SET search_path TO test_schema, public&quot;</span><span class="p">))</span>
<span class="gp">... </span>    <span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">referring</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
<span class="gp">... </span>        <span class="s2">&quot;referring&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">metadata_obj</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">autoload_with</span><span class="o">=</span><span class="n">conn</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">postgresql_ignore_search_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="go">&lt;sqlalchemy.engine.result.CursorResult object at 0x1016126d0&gt;</span></pre></div>
</div>
<p>We will now have <code class="docutils literal notranslate"><span class="pre">test_schema.referred</span></code> stored as schema-qualified:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">metadata_obj</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s2">&quot;test_schema.referred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">schema</span>
<span class="go">&#39;test_schema&#39;</span></pre></div>
</div>
<aside class="sidebar">
<p class="sidebar-title">Best Practices for PostgreSQL Schema reflection</p>
<p>The description of PostgreSQL schema reflection behavior is complex, and
is the product of many years of dealing with widely varied use cases and
user preferences. But in fact, there’s no need to understand any of it if
you just stick to the simplest use pattern: leave the <code class="docutils literal notranslate"><span class="pre">search_path</span></code> set
to its default of <code class="docutils literal notranslate"><span class="pre">public</span></code> only, never refer to the name <code class="docutils literal notranslate"><span class="pre">public</span></code> as
an explicit schema name otherwise, and refer to all other schema names
explicitly when building up a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> object.  The options
described here are only for those users who can’t, or prefer not to, stay
within these guidelines.</p>
</aside>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/reflection.html#reflection-schema-qualified-interaction"><span class="std std-ref">架构限定反射与默认架构的交互</span></a> - discussion of the issue
from a backend-agnostic perspective</p>
<p><a class="reference external" href="https://www.postgresql.org/docs/current/static/ddl-schemas.html#DDL-SCHEMAS-PATH">The Schema Search Path</a>
- on the PostgreSQL website.</p>
</div>
</section>
<section id="insert-update-returning">
<h2>INSERT/UPDATE…RETURNING<a class="headerlink" href="#insert-update-returning" title="Link to this heading">¶</a></h2>
<p>The dialect supports PG 8.2’s <code class="docutils literal notranslate"><span class="pre">INSERT..RETURNING</span></code>, <code class="docutils literal notranslate"><span class="pre">UPDATE..RETURNING</span></code> and
<code class="docutils literal notranslate"><span class="pre">DELETE..RETURNING</span></code> syntaxes.   <code class="docutils literal notranslate"><span class="pre">INSERT..RETURNING</span></code> is used by default
for single-row INSERT statements in order to fetch newly generated
primary key identifiers.   To specify an explicit <code class="docutils literal notranslate"><span class="pre">RETURNING</span></code> clause,
use the <code class="xref py py-meth docutils literal notranslate"><span class="pre">_UpdateBase.returning()</span></code> method on a per-statement basis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># INSERT..RETURNING</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">table</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">returning</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">col1</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">col2</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>

<span class="c1"># UPDATE..RETURNING</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">table</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="o">.</span><span class="n">returning</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">col1</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">col2</span><span class="p">)</span>
    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;foo&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>

<span class="c1"># DELETE..RETURNING</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">table</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="o">.</span><span class="n">returning</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">col1</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">col2</span><span class="p">)</span>
    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;foo&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span></pre></div>
</div>
</section>
<section id="insert-on-conflict-upsert">
<span id="postgresql-insert-on-conflict"></span><h2>INSERT…ON CONFLICT (Upsert)<a class="headerlink" href="#insert-on-conflict-upsert" title="Link to this heading">¶</a></h2>
<p>Starting with version 9.5, PostgreSQL allows “upserts” (update or insert) of
rows into a table via the <code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">CONFLICT</span></code> clause of the <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> statement. A
candidate row will only be inserted if that row does not violate any unique
constraints.  In the case of a unique constraint violation, a secondary action
can occur which can be either “DO UPDATE”, indicating that the data in the
target row should be updated, or “DO NOTHING”, which indicates to silently skip
this row.</p>
<p>Conflicts are determined using existing unique constraints and indexes.  These
constraints may be identified either using their name as stated in DDL,
or they may be inferred by stating the columns and conditions that comprise
the indexes.</p>
<p>SQLAlchemy provides <code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">CONFLICT</span></code> support via the PostgreSQL-specific
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.insert" title="sqlalchemy.dialects.postgresql.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a> function, which provides
the generative methods <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update()</span></code></a>
and <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.on_conflict_do_nothing()</span></code></a>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">insert</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">insert_stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span>
<span class="go">...     id=&quot;some_existing_id&quot;, data=&quot;inserted value&quot;</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">do_nothing_stmt</span> <span class="o">=</span> <span class="n">insert_stmt</span><span class="o">.</span><span class="n">on_conflict_do_nothing</span><span class="p">(</span><span class="n">index_elements</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">do_nothing_stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">my_table</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span><span class="w"> </span><span class="n">CONFLICT</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">DO</span><span class="w"> </span><span class="k">NOTHING</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">do_update_stmt</span> <span class="o">=</span> <span class="n">insert_stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="go">...     constraint=&quot;pk_my_table&quot;, set_=dict(data=&quot;updated value&quot;)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">do_update_stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">my_table</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span><span class="w"> </span><span class="n">CONFLICT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">pk_my_table</span><span class="w"> </span><span class="k">DO</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span>
</div></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference external" href="https://www.postgresql.org/docs/current/static/sql-insert.html#SQL-ON-CONFLICT">INSERT .. ON CONFLICT</a>
- in the PostgreSQL documentation.</p>
</div>
<section id="specifying-the-target">
<h3>Specifying the Target<a class="headerlink" href="#specifying-the-target" title="Link to this heading">¶</a></h3>
<p>Both methods supply the “target” of the conflict using either the
named constraint or by column inference:</p>
<ul>
<li><p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.index_elements" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.index_elements</span></code></a> argument
specifies a sequence containing string column names, <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>
objects, and/or SQL expression elements, which would identify a unique
index:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">do_update_stmt</span> <span class="o">=</span> <span class="n">insert_stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="go">...     index_elements=[&quot;id&quot;], set_=dict(data=&quot;updated value&quot;)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">do_update_stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">my_table</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span><span class="w"> </span><span class="n">CONFLICT</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">DO</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">do_update_stmt</span> <span class="o">=</span> <span class="n">insert_stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="go">...     index_elements=[my_table.c.id], set_=dict(data=&quot;updated value&quot;)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">do_update_stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">my_table</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span><span class="w"> </span><span class="n">CONFLICT</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">DO</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span>
</div></pre></div>
</div>
</li>
<li><p>When using <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.index_elements" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.index_elements</span></code></a> to
infer an index, a partial index can be inferred by also specifying the
use the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.index_where" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.index_where</span></code></a> parameter:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">user_email</span><span class="o">=</span><span class="s2">&quot;a@b.com&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;inserted data&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="go">...     index_elements=[my_table.c.user_email],</span>
<span class="go">...     index_where=my_table.c.user_email.like(&quot;%@gmail.com&quot;),</span>
<span class="go">...     set_=dict(data=stmt.excluded.data),</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">my_table</span><span class="w"> </span><span class="p">(</span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="n">user_email</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">user_email</span><span class="p">)</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">CONFLICT</span><span class="w"> </span><span class="p">(</span><span class="n">user_email</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">user_email</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">user_email_1</span><span class="p">)</span><span class="n">s</span><span class="w"> </span><span class="k">DO</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">excluded</span><span class="p">.</span><span class="k">data</span>
</div></pre></div>
</div>
</li>
<li><p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.constraint" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.constraint</span></code></a> argument is
used to specify an index directly rather than inferring it.  This can be
the name of a UNIQUE constraint, a PRIMARY KEY constraint, or an INDEX:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">do_update_stmt</span> <span class="o">=</span> <span class="n">insert_stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="go">...     constraint=&quot;my_table_idx_1&quot;, set_=dict(data=&quot;updated value&quot;)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">do_update_stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">my_table</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span><span class="w"> </span><span class="n">CONFLICT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">my_table_idx_1</span><span class="w"> </span><span class="k">DO</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">do_update_stmt</span> <span class="o">=</span> <span class="n">insert_stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="go">...     constraint=&quot;my_table_pk&quot;, set_=dict(data=&quot;updated value&quot;)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">do_update_stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">my_table</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span><span class="w"> </span><span class="n">CONFLICT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">my_table_pk</span><span class="w"> </span><span class="k">DO</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span>
</div></pre></div>
</div>
</li>
<li><p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.constraint" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.constraint</span></code></a> argument may
also refer to a SQLAlchemy construct representing a constraint,
e.g. <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.UniqueConstraint" title="sqlalchemy.schema.UniqueConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">UniqueConstraint</span></code></a>, <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.PrimaryKeyConstraint" title="sqlalchemy.schema.PrimaryKeyConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">PrimaryKeyConstraint</span></code></a>,
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a>, or <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExcludeConstraint</span></code></a>.   In this use,
if the constraint has a name, it is used directly.  Otherwise, if the
constraint is unnamed, then inference will be used, where the expressions
and optional WHERE clause of the constraint will be spelled out in the
construct.  This use is especially convenient
to refer to the named or unnamed primary key of a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>
using the
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.primary_key" title="sqlalchemy.schema.Table.primary_key"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Table.primary_key</span></code></a> attribute:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">do_update_stmt</span> <span class="o">=</span> <span class="n">insert_stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="go">...     constraint=my_table.primary_key, set_=dict(data=&quot;updated value&quot;)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">do_update_stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">my_table</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span><span class="w"> </span><span class="n">CONFLICT</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">DO</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span>
</div></pre></div>
</div>
</li>
</ul>
</section>
<section id="the-set-clause">
<h3>The SET Clause<a class="headerlink" href="#the-set-clause" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">CONFLICT...DO</span> <span class="pre">UPDATE</span></code> is used to perform an update of the already
existing row, using any combination of new values as well as values
from the proposed insertion.   These values are specified using the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.set_" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.set_</span></code></a> parameter.  This
parameter accepts a dictionary which consists of direct values
for UPDATE:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="s2">&quot;some_id&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;inserted value&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">do_update_stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="go">...     index_elements=[&quot;id&quot;], set_=dict(data=&quot;updated value&quot;)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">do_update_stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">my_table</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span><span class="w"> </span><span class="n">CONFLICT</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">DO</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span>
</div></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update()</span></code>
method does <strong>not</strong> take into
account Python-side default UPDATE values or generation functions, e.g.
those specified using <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column.params.onupdate" title="sqlalchemy.schema.Column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Column.onupdate</span></code></a>.
These values will not be exercised for an ON CONFLICT style of UPDATE,
unless they are manually specified in the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.set_" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.set_</span></code></a> dictionary.</p>
</div>
</section>
<section id="updating-using-the-excluded-insert-values">
<h3>Updating using the Excluded INSERT Values<a class="headerlink" href="#updating-using-the-excluded-insert-values" title="Link to this heading">¶</a></h3>
<p>In order to refer to the proposed insertion row, the special alias
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.excluded" title="sqlalchemy.dialects.postgresql.Insert.excluded"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Insert.excluded</span></code></a> is available as an attribute on
the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert" title="sqlalchemy.dialects.postgresql.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> object; this object is a
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnCollection" title="sqlalchemy.sql.expression.ColumnCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnCollection</span></code></a>
which alias contains all columns of the target
table:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span>
<span class="go">...     id=&quot;some_id&quot;, data=&quot;inserted value&quot;, author=&quot;jlh&quot;</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">do_update_stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="go">...     index_elements=[&quot;id&quot;],</span>
<span class="go">...     set_=dict(data=&quot;updated value&quot;, author=stmt.excluded.author),</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">do_update_stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">my_table</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="n">author</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">author</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span><span class="w"> </span><span class="n">CONFLICT</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">DO</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">author</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">excluded</span><span class="p">.</span><span class="n">author</span>
</div></pre></div>
</div>
</section>
<section id="additional-where-criteria">
<h3>Additional WHERE Criteria<a class="headerlink" href="#additional-where-criteria" title="Link to this heading">¶</a></h3>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update()</span></code> method also accepts
a WHERE clause using the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.where" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.where</span></code></a>
parameter, which will limit those rows which receive an UPDATE:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span>
<span class="go">...     id=&quot;some_id&quot;, data=&quot;inserted value&quot;, author=&quot;jlh&quot;</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">on_update_stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="go">...     index_elements=[&quot;id&quot;],</span>
<span class="go">...     set_=dict(data=&quot;updated value&quot;, author=stmt.excluded.author),</span>
<span class="go">...     where=(my_table.c.status == 2),</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">on_update_stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">my_table</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="n">author</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">author</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span><span class="w"> </span><span class="n">CONFLICT</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">DO</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">author</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">excluded</span><span class="p">.</span><span class="n">author</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">my_table</span><span class="p">.</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">status_1</span><span class="p">)</span><span class="n">s</span>
</div></pre></div>
</div>
</section>
<section id="skipping-rows-with-do-nothing">
<h3>Skipping Rows with DO NOTHING<a class="headerlink" href="#skipping-rows-with-do-nothing" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">CONFLICT</span></code> may be used to skip inserting a row entirely
if any conflict with a unique or exclusion constraint occurs; below
this is illustrated using the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.on_conflict_do_nothing()</span></code></a> method:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="s2">&quot;some_id&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;inserted value&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">on_conflict_do_nothing</span><span class="p">(</span><span class="n">index_elements</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">my_table</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span><span class="w"> </span><span class="n">CONFLICT</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">DO</span><span class="w"> </span><span class="k">NOTHING</span>
</div></pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">DO</span> <span class="pre">NOTHING</span></code> is used without specifying any columns or constraint,
it has the effect of skipping the INSERT for any unique or exclusion
constraint violation which occurs:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="s2">&quot;some_id&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;inserted value&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">on_conflict_do_nothing</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">my_table</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span><span class="w"> </span><span class="n">CONFLICT</span><span class="w"> </span><span class="k">DO</span><span class="w"> </span><span class="k">NOTHING</span>
</div></pre></div>
</div>
</section>
</section>
<section id="full-text-search">
<span id="postgresql-match"></span><h2>Full Text Search<a class="headerlink" href="#full-text-search" title="Link to this heading">¶</a></h2>
<p>PostgreSQL’s full text search system is available through the use of the
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.func" title="sqlalchemy.sql.expression.func"><code class="xref py py-data docutils literal notranslate"><span class="pre">func</span></code></a> namespace, combined with the use of custom operators
via the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.Operators.bool_op" title="sqlalchemy.sql.expression.Operators.bool_op"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.bool_op()</span></code></a> method.    For simple cases with some
degree of cross-backend compatibility, the <code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.match()</span></code> operator
may also be used.</p>
<section id="simple-plain-text-matching-with-match">
<span id="postgresql-simple-match"></span><h3>Simple plain text matching with <code class="docutils literal notranslate"><span class="pre">match()</span></code><a class="headerlink" href="#simple-plain-text-matching-with-match" title="Link to this heading">¶</a></h3>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.match()</span></code> operator provides for cross-compatible simple
text matching.   For the PostgreSQL backend, it’s hardcoded to generate
an expression using the <code class="docutils literal notranslate"><span class="pre">&#64;&#64;</span></code> operator in conjunction with the
<code class="docutils literal notranslate"><span class="pre">plainto_tsquery()</span></code> PostgreSQL function.</p>
<p>On the PostgreSQL dialect, an expression like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">(</span><span class="n">sometable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;search string&quot;</span><span class="p">))</span></pre></div>
</div>
<p>would emit to the database:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="o">@@</span><span class="w"> </span><span class="n">plainto_tsquery</span><span class="p">(</span><span class="s1">&#39;search string&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table</span></pre></div>
</div>
<p>Above, passing a plain string to <code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.match()</span></code> will automatically
make use of <code class="docutils literal notranslate"><span class="pre">plainto_tsquery()</span></code> to specify the type of tsquery.  This
establishes basic database cross-compatibility for <code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.match()</span></code>
with other backends.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">在 2.0 版本发生变更: </span>The default tsquery generation function used by the
PostgreSQL dialect with <code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.match()</span></code> is <code class="docutils literal notranslate"><span class="pre">plainto_tsquery()</span></code>.</p>
<p>To render exactly what was rendered in 1.4, use the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">func</span>

<span class="n">select</span><span class="p">(</span><span class="n">sometable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">bool_op</span><span class="p">(</span><span class="s2">&quot;@@&quot;</span><span class="p">)(</span><span class="n">func</span><span class="o">.</span><span class="n">to_tsquery</span><span class="p">(</span><span class="s2">&quot;search string&quot;</span><span class="p">)))</span></pre></div>
</div>
<p>Which would emit:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="o">@@</span><span class="w"> </span><span class="n">to_tsquery</span><span class="p">(</span><span class="s1">&#39;search string&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table</span></pre></div>
</div>
</div>
</section>
<section id="using-postgresql-full-text-functions-and-operators-directly">
<h3>Using PostgreSQL full text functions and operators directly<a class="headerlink" href="#using-postgresql-full-text-functions-and-operators-directly" title="Link to this heading">¶</a></h3>
<p>Text search operations beyond the simple use of <code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.match()</span></code>
may make use of the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.func" title="sqlalchemy.sql.expression.func"><code class="xref py py-data docutils literal notranslate"><span class="pre">func</span></code></a> namespace to generate PostgreSQL full-text
functions, in combination with <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.Operators.bool_op" title="sqlalchemy.sql.expression.Operators.bool_op"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.bool_op()</span></code></a> to generate
any boolean operator.</p>
<p>For example, the query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">to_tsquery</span><span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bool_op</span><span class="p">(</span><span class="s2">&quot;@&gt;&quot;</span><span class="p">)(</span><span class="n">func</span><span class="o">.</span><span class="n">to_tsquery</span><span class="p">(</span><span class="s2">&quot;cat &amp; rat&quot;</span><span class="p">)))</span></pre></div>
</div>
<p>would generate:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">to_tsquery</span><span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">@&gt;</span><span class="w"> </span><span class="n">to_tsquery</span><span class="p">(</span><span class="s1">&#39;cat &amp; rat&#39;</span><span class="p">)</span></pre></div>
</div>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSVECTOR" title="sqlalchemy.dialects.postgresql.TSVECTOR"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSVECTOR</span></code></a> type can provide for explicit CAST:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">TSVECTOR</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">cast</span>

<span class="n">select</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;some text&quot;</span><span class="p">,</span> <span class="n">TSVECTOR</span><span class="p">))</span></pre></div>
</div>
<p>produces a statement equivalent to:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="s1">&#39;some text&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TSVECTOR</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">anon_1</span></pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">func</span></code> namespace is augmented by the PostgreSQL dialect to set up
correct argument and return types for most full text search functions.
These functions are used automatically by the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.func" title="sqlalchemy.sql.expression.func"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sqlalchemy.sql.expression.func</span></code></a> namespace
assuming the <code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql</span></code> package has been imported,
or <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a> has been invoked using a <code class="docutils literal notranslate"><span class="pre">postgresql</span></code>
dialect.  These functions are documented at:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.to_tsvector" title="sqlalchemy.dialects.postgresql.to_tsvector"><code class="xref py py-class docutils literal notranslate"><span class="pre">to_tsvector</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.to_tsquery" title="sqlalchemy.dialects.postgresql.to_tsquery"><code class="xref py py-class docutils literal notranslate"><span class="pre">to_tsquery</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.plainto_tsquery" title="sqlalchemy.dialects.postgresql.plainto_tsquery"><code class="xref py py-class docutils literal notranslate"><span class="pre">plainto_tsquery</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.phraseto_tsquery" title="sqlalchemy.dialects.postgresql.phraseto_tsquery"><code class="xref py py-class docutils literal notranslate"><span class="pre">phraseto_tsquery</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.websearch_to_tsquery" title="sqlalchemy.dialects.postgresql.websearch_to_tsquery"><code class="xref py py-class docutils literal notranslate"><span class="pre">websearch_to_tsquery</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ts_headline" title="sqlalchemy.dialects.postgresql.ts_headline"><code class="xref py py-class docutils literal notranslate"><span class="pre">ts_headline</span></code></a></p></li>
</ul>
</section>
<section id="specifying-the-regconfig-with-match-or-custom-operators">
<h3>Specifying the “regconfig” with <code class="docutils literal notranslate"><span class="pre">match()</span></code> or custom operators<a class="headerlink" href="#specifying-the-regconfig-with-match-or-custom-operators" title="Link to this heading">¶</a></h3>
<p>PostgreSQL’s <code class="docutils literal notranslate"><span class="pre">plainto_tsquery()</span></code> function accepts an optional
“regconfig” argument that is used to instruct PostgreSQL to use a
particular pre-computed GIN or GiST index in order to perform the search.
When using <code class="xref py py-meth docutils literal notranslate"><span class="pre">Operators.match()</span></code>, this additional parameter may be
specified using the <code class="docutils literal notranslate"><span class="pre">postgresql_regconfig</span></code> parameter, such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">(</span><span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;somestring&quot;</span><span class="p">,</span> <span class="n">postgresql_regconfig</span><span class="o">=</span><span class="s2">&quot;english&quot;</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>Which would emit:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">mytable</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">mytable</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">mytable</span><span class="p">.</span><span class="n">title</span><span class="w"> </span><span class="o">@@</span><span class="w"> </span><span class="n">plainto_tsquery</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;somestring&#39;</span><span class="p">)</span></pre></div>
</div>
<p>When using other PostgreSQL search functions with <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.func" title="sqlalchemy.sql.expression.func"><code class="xref py py-data docutils literal notranslate"><span class="pre">func</span></code></a>, the
“regconfig” parameter may be passed directly as the initial argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">(</span><span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">func</span><span class="o">.</span><span class="n">to_tsvector</span><span class="p">(</span><span class="s2">&quot;english&quot;</span><span class="p">,</span> <span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">bool_op</span><span class="p">(</span><span class="s2">&quot;@@&quot;</span><span class="p">)(</span>
        <span class="n">func</span><span class="o">.</span><span class="n">to_tsquery</span><span class="p">(</span><span class="s2">&quot;english&quot;</span><span class="p">,</span> <span class="s2">&quot;somestring&quot;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>produces a statement equivalent to:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">mytable</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">mytable</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">to_tsvector</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">mytable</span><span class="p">.</span><span class="n">title</span><span class="p">)</span><span class="w"> </span><span class="o">@@</span>
<span class="w">    </span><span class="n">to_tsquery</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;somestring&#39;</span><span class="p">)</span></pre></div>
</div>
<p>It is recommended that you use the <code class="docutils literal notranslate"><span class="pre">EXPLAIN</span> <span class="pre">ANALYZE...</span></code> tool from
PostgreSQL to ensure that you are generating queries with SQLAlchemy that
take full advantage of any indexes you may have created for full text search.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference external" href="https://www.postgresql.org/docs/current/textsearch-controls.html">Full Text Search</a> - in the PostgreSQL documentation</p>
</div>
</section>
</section>
<section id="from-only">
<h2>FROM ONLY …<a class="headerlink" href="#from-only" title="Link to this heading">¶</a></h2>
<p>The dialect supports PostgreSQL’s ONLY keyword for targeting only a particular
table in an inheritance hierarchy. This can be used to produce the
<code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">...</span> <span class="pre">FROM</span> <span class="pre">ONLY</span></code>, <code class="docutils literal notranslate"><span class="pre">UPDATE</span> <span class="pre">ONLY</span> <span class="pre">...</span></code>, and <code class="docutils literal notranslate"><span class="pre">DELETE</span> <span class="pre">FROM</span> <span class="pre">ONLY</span> <span class="pre">...</span></code>
syntaxes. It uses SQLAlchemy’s hints mechanism:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># SELECT ... FROM ONLY ...</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">with_hint</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="s2">&quot;ONLY&quot;</span><span class="p">,</span> <span class="s2">&quot;postgresql&quot;</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>

<span class="c1"># UPDATE ONLY ...</span>
<span class="n">table</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">dict</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">with_hint</span><span class="p">(</span>
    <span class="s2">&quot;ONLY&quot;</span><span class="p">,</span> <span class="n">dialect_name</span><span class="o">=</span><span class="s2">&quot;postgresql&quot;</span>
<span class="p">)</span>

<span class="c1"># DELETE FROM ONLY ...</span>
<span class="n">table</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span><span class="o">.</span><span class="n">with_hint</span><span class="p">(</span><span class="s2">&quot;ONLY&quot;</span><span class="p">,</span> <span class="n">dialect_name</span><span class="o">=</span><span class="s2">&quot;postgresql&quot;</span><span class="p">)</span></pre></div>
</div>
</section>
<section id="postgresql-specific-index-options">
<span id="postgresql-indexes"></span><h2>PostgreSQL-Specific Index Options<a class="headerlink" href="#postgresql-specific-index-options" title="Link to this heading">¶</a></h2>
<p>Several extensions to the <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> construct are available, specific
to the PostgreSQL dialect.</p>
<section id="covering-indexes">
<h3>Covering Indexes<a class="headerlink" href="#covering-indexes" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">postgresql_include</span></code> option renders INCLUDE(colname) for the given
string names:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">(</span><span class="s2">&quot;my_index&quot;</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">postgresql_include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span></pre></div>
</div>
<p>would render the index as <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">INDEX</span> <span class="pre">my_index</span> <span class="pre">ON</span> <span class="pre">table</span> <span class="pre">(x)</span> <span class="pre">INCLUDE</span> <span class="pre">(y)</span></code></p>
<p>Note that this feature requires PostgreSQL 11 or later.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4 版本加入.</span></p>
</div>
</section>
<section id="partial-indexes">
<span id="postgresql-partial-indexes"></span><h3>Partial Indexes<a class="headerlink" href="#partial-indexes" title="Link to this heading">¶</a></h3>
<p>Partial indexes add criterion to the index definition so that the index is
applied to a subset of rows.   These can be specified on <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a>
using the <code class="docutils literal notranslate"><span class="pre">postgresql_where</span></code> keyword argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">(</span><span class="s2">&quot;my_index&quot;</span><span class="p">,</span> <span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">postgresql_where</span><span class="o">=</span><span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span></pre></div>
</div>
</section>
<section id="operator-classes">
<span id="postgresql-operator-classes"></span><h3>Operator Classes<a class="headerlink" href="#operator-classes" title="Link to this heading">¶</a></h3>
<p>PostgreSQL allows the specification of an <em>operator class</em> for each column of
an index (see
<a class="reference external" href="https://www.postgresql.org/docs/current/interactive/indexes-opclass.html">https://www.postgresql.org/docs/current/interactive/indexes-opclass.html</a>).
The <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> construct allows these to be specified via the
<code class="docutils literal notranslate"><span class="pre">postgresql_ops</span></code> keyword argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">(</span>
    <span class="s2">&quot;my_index&quot;</span><span class="p">,</span>
    <span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
    <span class="n">postgresql_ops</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;text_pattern_ops&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;int4_ops&quot;</span><span class="p">},</span>
<span class="p">)</span></pre></div>
</div>
<p>Note that the keys in the <code class="docutils literal notranslate"><span class="pre">postgresql_ops</span></code> dictionaries are the
“key” name of the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>, i.e. the name used to access it from
the <code class="docutils literal notranslate"><span class="pre">.c</span></code> collection of <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>, which can be configured to be
different than the actual name of the column as expressed in the database.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">postgresql_ops</span></code> is to be used against a complex SQL expression such
as a function call, then to apply to the column it must be given a label
that is identified in the dictionary by name, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">(</span>
    <span class="s2">&quot;my_index&quot;</span><span class="p">,</span>
    <span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">func</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s2">&quot;data_lower&quot;</span><span class="p">),</span>
    <span class="n">postgresql_ops</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data_lower&quot;</span><span class="p">:</span> <span class="s2">&quot;text_pattern_ops&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;int4_ops&quot;</span><span class="p">},</span>
<span class="p">)</span></pre></div>
</div>
<p>Operator classes are also supported by the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExcludeConstraint</span></code></a> construct using the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.ops" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ExcludeConstraint.ops</span></code></a> parameter. See that parameter for
details.</p>
</section>
<section id="index-types">
<h3>Index Types<a class="headerlink" href="#index-types" title="Link to this heading">¶</a></h3>
<p>PostgreSQL provides several index types: B-Tree, Hash, GiST, and GIN, as well
as the ability for users to create their own (see
<a class="reference external" href="https://www.postgresql.org/docs/current/static/indexes-types.html">https://www.postgresql.org/docs/current/static/indexes-types.html</a>). These can be
specified on <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> using the <code class="docutils literal notranslate"><span class="pre">postgresql_using</span></code> keyword argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">(</span><span class="s2">&quot;my_index&quot;</span><span class="p">,</span> <span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">postgresql_using</span><span class="o">=</span><span class="s2">&quot;gin&quot;</span><span class="p">)</span></pre></div>
</div>
<p>The value passed to the keyword argument will be simply passed through to the
underlying CREATE INDEX command, so it <em>must</em> be a valid index type for your
version of PostgreSQL.</p>
</section>
<section id="index-storage-parameters">
<span id="postgresql-index-storage"></span><h3>Index Storage Parameters<a class="headerlink" href="#index-storage-parameters" title="Link to this heading">¶</a></h3>
<p>PostgreSQL allows storage parameters to be set on indexes. The storage
parameters available depend on the index method used by the index. Storage
parameters can be specified on <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> using the <code class="docutils literal notranslate"><span class="pre">postgresql_with</span></code>
keyword argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">(</span><span class="s2">&quot;my_index&quot;</span><span class="p">,</span> <span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">postgresql_with</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fillfactor&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">})</span></pre></div>
</div>
<p>PostgreSQL allows to define the tablespace in which to create the index.
The tablespace can be specified on <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> using the
<code class="docutils literal notranslate"><span class="pre">postgresql_tablespace</span></code> keyword argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">(</span><span class="s2">&quot;my_index&quot;</span><span class="p">,</span> <span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">postgresql_tablespace</span><span class="o">=</span><span class="s2">&quot;my_tablespace&quot;</span><span class="p">)</span></pre></div>
</div>
<p>Note that the same option is available on <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> as well.</p>
</section>
<section id="indexes-with-concurrently">
<span id="postgresql-index-concurrently"></span><h3>Indexes with CONCURRENTLY<a class="headerlink" href="#indexes-with-concurrently" title="Link to this heading">¶</a></h3>
<p>The PostgreSQL index option CONCURRENTLY is supported by passing the
flag <code class="docutils literal notranslate"><span class="pre">postgresql_concurrently</span></code> to the <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> construct:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tbl</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;testtbl&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">))</span>

<span class="n">idx1</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span><span class="s2">&quot;test_idx1&quot;</span><span class="p">,</span> <span class="n">tbl</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">postgresql_concurrently</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></pre></div>
</div>
<p>The above index construct will render DDL for CREATE INDEX, assuming
PostgreSQL 8.2 or higher is detected or for a connection-less dialect, as:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">CONCURRENTLY</span><span class="w"> </span><span class="n">test_idx1</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">testtbl</span><span class="w"> </span><span class="p">(</span><span class="k">data</span><span class="p">)</span></pre></div>
</div>
<p>For DROP INDEX, assuming PostgreSQL 9.2 or higher is detected or for
a connection-less dialect, it will emit:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">DROP</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">CONCURRENTLY</span><span class="w"> </span><span class="n">test_idx1</span></pre></div>
</div>
<p>When using CONCURRENTLY, the PostgreSQL database requires that the statement
be invoked outside of a transaction block.   The Python DBAPI enforces that
even for a single statement, a transaction is present, so to use this
construct, the DBAPI’s “autocommit” mode must be used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">String</span><span class="p">))</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span><span class="s2">&quot;foo_idx&quot;</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">postgresql_concurrently</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">isolation_level</span><span class="o">=</span><span class="s2">&quot;AUTOCOMMIT&quot;</span><span class="p">):</span>
        <span class="n">table</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#postgresql-isolation-level"><span class="std std-ref">Transaction Isolation Level</span></a></p>
</div>
</section>
</section>
<section id="postgresql-index-reflection">
<span id="id2"></span><h2>PostgreSQL Index Reflection<a class="headerlink" href="#postgresql-index-reflection" title="Link to this heading">¶</a></h2>
<p>The PostgreSQL database creates a UNIQUE INDEX implicitly whenever the
UNIQUE CONSTRAINT construct is used.   When inspecting a table using
<a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector" title="sqlalchemy.engine.reflection.Inspector"><code class="xref py py-class docutils literal notranslate"><span class="pre">Inspector</span></code></a>, the <a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_indexes" title="sqlalchemy.engine.reflection.Inspector.get_indexes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.get_indexes()</span></code></a>
and the <a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_unique_constraints" title="sqlalchemy.engine.reflection.Inspector.get_unique_constraints"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.get_unique_constraints()</span></code></a>
will report on these
two constructs distinctly; in the case of the index, the key
<code class="docutils literal notranslate"><span class="pre">duplicates_constraint</span></code> will be present in the index entry if it is
detected as mirroring a constraint.   When performing reflection using
<code class="docutils literal notranslate"><span class="pre">Table(...,</span> <span class="pre">autoload_with=engine)</span></code>, the UNIQUE INDEX is <strong>not</strong> returned
in <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.indexes" title="sqlalchemy.schema.Table.indexes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Table.indexes</span></code></a> when it is detected as mirroring a
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.UniqueConstraint" title="sqlalchemy.schema.UniqueConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">UniqueConstraint</span></code></a> in the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.constraints" title="sqlalchemy.schema.Table.constraints"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Table.constraints</span></code></a> collection
.</p>
</section>
<section id="special-reflection-options">
<h2>Special Reflection Options<a class="headerlink" href="#special-reflection-options" title="Link to this heading">¶</a></h2>
<p>The <a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector" title="sqlalchemy.engine.reflection.Inspector"><code class="xref py py-class docutils literal notranslate"><span class="pre">Inspector</span></code></a>
used for the PostgreSQL backend is an instance
of <a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector" title="sqlalchemy.dialects.postgresql.base.PGInspector"><code class="xref py py-class docutils literal notranslate"><span class="pre">PGInspector</span></code></a>, which offers additional methods:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">inspect</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+psycopg2://localhost/test&quot;</span><span class="p">)</span>
<span class="n">insp</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>  <span class="c1"># will be a PGInspector</span>

<span class="n">print</span><span class="p">(</span><span class="n">insp</span><span class="o">.</span><span class="n">get_enums</span><span class="p">())</span></pre></div>
</div>
<div class="table-wrapper longtable docutils container">
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector"><span class="sig-name descname">PGInspector</span></a></p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.base.PGInspector">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.base.</span></span><span class="sig-name descname"><span class="pre">PGInspector</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.base.PGInspector" title="Link to this definition">¶</a></dt>
<dd><div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_domains"><span class="sig-name descname">get_domains()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_enums"><span class="sig-name descname">get_enums()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_foreign_table_names"><span class="sig-name descname">get_foreign_table_names()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_table_oid"><span class="sig-name descname">get_table_oid()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.has_type"><span class="sig-name descname">has_type()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector" title="sqlalchemy.dialects.postgresql.base.PGInspector"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.base.PGInspector</span></code></a> (<a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector" title="sqlalchemy.engine.reflection.Inspector"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.reflection.Inspector</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.base.PGInspector.get_domains">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.base.PGInspector.</span></code></a><span class="sig-name descname"><span class="pre">get_domains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">ReflectedDomain</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_domains" title="Link to this definition">¶</a></dt>
<dd><p>Return a list of DOMAIN objects.</p>
<p>Each member is a dictionary containing these fields:</p>
<blockquote>
<div><ul class="simple">
<li><p>name - name of the domain</p></li>
<li><p>schema - the schema name for the domain.</p></li>
<li><p>visible - boolean, whether or not this domain is visible
in the default search path.</p></li>
<li><p>type - the type defined by this domain.</p></li>
<li><p>nullable - Indicates if this domain can be <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p></li>
<li><p>default - The default value of the domain or <code class="docutils literal notranslate"><span class="pre">None</span></code> if the
domain has no default.</p></li>
<li><p>constraints - A list of dict wit the constraint defined by this
domain. Each element constaints two keys: <code class="docutils literal notranslate"><span class="pre">name</span></code> of the
constraint and <code class="docutils literal notranslate"><span class="pre">check</span></code> with the constraint text.</p></li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.dialects.postgresql.base.PGInspector.get_domains.params.schema"></span><strong>schema</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_domains.params.schema">¶</a> – schema name.  If None, the default schema
(typically ‘public’) is used.  May also be set to <code class="docutils literal notranslate"><span class="pre">'*'</span></code> to
indicate load domains for all schemas.</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.base.PGInspector.get_enums">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.base.PGInspector.</span></code></a><span class="sig-name descname"><span class="pre">get_enums</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">ReflectedEnum</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_enums" title="Link to this definition">¶</a></dt>
<dd><p>Return a list of ENUM objects.</p>
<p>Each member is a dictionary containing these fields:</p>
<blockquote>
<div><ul class="simple">
<li><p>name - name of the enum</p></li>
<li><p>schema - the schema name for the enum.</p></li>
<li><p>visible - boolean, whether or not this enum is visible
in the default search path.</p></li>
<li><p>labels - a list of string labels that apply to the enum.</p></li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.dialects.postgresql.base.PGInspector.get_enums.params.schema"></span><strong>schema</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_enums.params.schema">¶</a> – schema name.  If None, the default schema
(typically ‘public’) is used.  May also be set to <code class="docutils literal notranslate"><span class="pre">'*'</span></code> to
indicate load enums for all schemas.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.base.PGInspector.get_foreign_table_names">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.base.PGInspector.</span></code></a><span class="sig-name descname"><span class="pre">get_foreign_table_names</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_foreign_table_names" title="Link to this definition">¶</a></dt>
<dd><p>Return a list of FOREIGN TABLE names.</p>
<p>Behavior is similar to that of
<a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_table_names" title="sqlalchemy.engine.reflection.Inspector.get_table_names"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.get_table_names()</span></code></a>,
except that the list is limited to those tables that report a
<code class="docutils literal notranslate"><span class="pre">relkind</span></code> value of <code class="docutils literal notranslate"><span class="pre">f</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.base.PGInspector.get_table_oid">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.base.PGInspector.</span></code></a><span class="sig-name descname"><span class="pre">get_table_oid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">int</span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_table_oid" title="Link to this definition">¶</a></dt>
<dd><p>Return the OID for the given table name.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.base.PGInspector.get_table_oid.params.table_name"></span><strong>table_name</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_table_oid.params.table_name">¶</a> – string name of the table.  For special quoting,
use <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.quoted_name" title="sqlalchemy.sql.expression.quoted_name"><code class="xref py py-class docutils literal notranslate"><span class="pre">quoted_name</span></code></a>.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.base.PGInspector.get_table_oid.params.schema"></span><strong>schema</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_table_oid.params.schema">¶</a> – string schema name; if omitted, uses the default schema
of the database connection.  For special quoting,
use <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.quoted_name" title="sqlalchemy.sql.expression.quoted_name"><code class="xref py py-class docutils literal notranslate"><span class="pre">quoted_name</span></code></a>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.base.PGInspector.has_type">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.base.PGInspector.</span></code></a><span class="sig-name descname"><span class="pre">has_type</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">type_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.base.PGInspector.has_type" title="Link to this definition">¶</a></dt>
<dd><p>Return if the database has the specified type in the provided
schema.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.base.PGInspector.has_type.params.type_name"></span><strong>type_name</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.has_type.params.type_name">¶</a> – the type to check.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.base.PGInspector.has_type.params.schema"></span><strong>schema</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.has_type.params.schema">¶</a> – schema name.  If None, the default schema
(typically ‘public’) is used.  May also be set to <code class="docutils literal notranslate"><span class="pre">'*'</span></code> to
check in all schemas.</p></li>
</ul>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
</dd></dl>

</dd></dl>

</section>
<section id="postgresql-table-options">
<span id="id3"></span><h2>PostgreSQL Table Options<a class="headerlink" href="#postgresql-table-options" title="Link to this heading">¶</a></h2>
<p>Several options for CREATE TABLE are supported directly by the PostgreSQL
dialect in conjunction with the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> construct:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">INHERITS</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span><span class="s2">&quot;some_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">postgresql_inherits</span><span class="o">=</span><span class="s2">&quot;some_supertable&quot;</span><span class="p">)</span>

<span class="n">Table</span><span class="p">(</span><span class="s2">&quot;some_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">postgresql_inherits</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;t1&quot;</span><span class="p">,</span> <span class="s2">&quot;t2&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">))</span></pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">COMMIT</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span><span class="s2">&quot;some_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">postgresql_on_commit</span><span class="o">=</span><span class="s2">&quot;PRESERVE ROWS&quot;</span><span class="p">)</span></pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">PARTITION</span> <span class="pre">BY</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;some_table&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">,</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">postgresql_partition_by</span><span class="o">=</span><span class="s2">&quot;LIST (part_column)&quot;</span><span class="p">,</span>
<span class="p">)</span></pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">TABLESPACE</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span><span class="s2">&quot;some_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">postgresql_tablespace</span><span class="o">=</span><span class="s2">&quot;some_tablespace&quot;</span><span class="p">)</span></pre></div>
</div>
<p>The above option is also available on the <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> construct.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">USING</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span><span class="s2">&quot;some_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">postgresql_using</span><span class="o">=</span><span class="s2">&quot;heap&quot;</span><span class="p">)</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.26 版本加入.</span></p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">WITH</span> <span class="pre">OIDS</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span><span class="s2">&quot;some_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">postgresql_with_oids</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">WITHOUT</span> <span class="pre">OIDS</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span><span class="s2">&quot;some_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">postgresql_with_oids</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></pre></div>
</div>
</li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference external" href="https://www.postgresql.org/docs/current/static/sql-createtable.html">PostgreSQL CREATE TABLE options</a> -
in the PostgreSQL documentation.</p>
</div>
</section>
<section id="postgresql-constraint-options">
<span id="id4"></span><h2>PostgreSQL Constraint Options<a class="headerlink" href="#postgresql-constraint-options" title="Link to this heading">¶</a></h2>
<p>The following option(s) are supported by the PostgreSQL dialect in conjunction
with selected constraint constructs:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">VALID</span></code>:  This option applies towards CHECK and FOREIGN KEY constraints
when the constraint is being added to an existing table via ALTER TABLE,
and has the effect that existing rows are not scanned during the ALTER
operation against the constraint being added.</p>
<p>When using a SQL migration tool such as <a class="reference external" href="https://alembic.sqlalchemy.org">Alembic</a>
that renders ALTER TABLE constructs, the <code class="docutils literal notranslate"><span class="pre">postgresql_not_valid</span></code> argument
may be specified as an additional keyword argument within the operation
that creates the constraint, as in the following Alembic example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">():</span>
    <span class="n">op</span><span class="o">.</span><span class="n">create_foreign_key</span><span class="p">(</span>
        <span class="s2">&quot;fk_user_address&quot;</span><span class="p">,</span>
        <span class="s2">&quot;address&quot;</span><span class="p">,</span>
        <span class="s2">&quot;user&quot;</span><span class="p">,</span>
        <span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
        <span class="n">postgresql_not_valid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span></pre></div>
</div>
<p>The keyword is ultimately accepted directly by the
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.CheckConstraint" title="sqlalchemy.schema.CheckConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">CheckConstraint</span></code></a>, <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ForeignKeyConstraint" title="sqlalchemy.schema.ForeignKeyConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKeyConstraint</span></code></a>
and <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKey</span></code></a> constructs; when using a tool like
Alembic, dialect-specific keyword arguments are passed through to
these constructs from the migration operation directives:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CheckConstraint</span><span class="p">(</span><span class="s2">&quot;some_field IS NOT NULL&quot;</span><span class="p">,</span> <span class="n">postgresql_not_valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ForeignKeyConstraint</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;some_id&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;some_table.some_id&quot;</span><span class="p">],</span> <span class="n">postgresql_not_valid</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4.32 版本加入.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference external" href="https://www.postgresql.org/docs/current/static/sql-altertable.html">PostgreSQL ALTER TABLE options</a> -
in the PostgreSQL documentation.</p>
</div>
</li>
<li><p>Column list with foreign key <code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">DELETE</span> <span class="pre">SET</span></code> actions:  This applies to
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKey</span></code></a> and <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ForeignKeyConstraint" title="sqlalchemy.schema.ForeignKeyConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKeyConstraint</span></code></a>, the <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ForeignKey.params.ondelete" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ForeignKey.ondelete</span></code></a>
parameter will accept on the PostgreSQL backend only a string list of column
names inside parenthesis, following the <code class="docutils literal notranslate"><span class="pre">SET</span> <span class="pre">NULL</span></code> or <code class="docutils literal notranslate"><span class="pre">SET</span> <span class="pre">DEFAULT</span></code>
phrases, which will limit the set of columns that are subject to the
action:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fktable</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;fktable&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;tid&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;fk_id_del_set_null&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span>
    <span class="n">ForeignKeyConstraint</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;tid&quot;</span><span class="p">,</span> <span class="s2">&quot;fk_id_del_set_null&quot;</span><span class="p">],</span>
        <span class="n">refcolumns</span><span class="o">=</span><span class="p">[</span><span class="n">pktable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">tid</span><span class="p">,</span> <span class="n">pktable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
        <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;SET NULL (fk_id_del_set_null)&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.40 版本加入.</span></p>
</div>
</li>
</ul>
</section>
<section id="table-values-table-and-column-valued-functions-row-and-tuple-objects">
<span id="postgresql-table-valued-overview"></span><h2>Table values, Table and Column valued functions, Row and Tuple objects<a class="headerlink" href="#table-values-table-and-column-valued-functions-row-and-tuple-objects" title="Link to this heading">¶</a></h2>
<p>PostgreSQL makes great use of modern SQL forms such as table-valued functions,
tables and rows as values.   These constructs are commonly used as part
of PostgreSQL’s support for complex datatypes such as JSON, ARRAY, and other
datatypes.  SQLAlchemy’s SQL expression language has native support for
most table-valued and row-valued forms.</p>
<section id="table-valued-functions">
<span id="postgresql-table-valued"></span><h3>Table-Valued Functions<a class="headerlink" href="#table-valued-functions" title="Link to this heading">¶</a></h3>
<p>Many PostgreSQL built-in functions are intended to be used in the FROM clause
of a SELECT statement, and are capable of returning table rows or sets of table
rows. A large portion of PostgreSQL’s JSON functions for example such as
<code class="docutils literal notranslate"><span class="pre">json_array_elements()</span></code>, <code class="docutils literal notranslate"><span class="pre">json_object_keys()</span></code>, <code class="docutils literal notranslate"><span class="pre">json_each_text()</span></code>,
<code class="docutils literal notranslate"><span class="pre">json_each()</span></code>, <code class="docutils literal notranslate"><span class="pre">json_to_record()</span></code>, <code class="docutils literal notranslate"><span class="pre">json_populate_recordset()</span></code> use such
forms. These classes of SQL function calling forms in SQLAlchemy are available
using the <a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.FunctionElement.table_valued" title="sqlalchemy.sql.functions.FunctionElement.table_valued"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FunctionElement.table_valued()</span></code></a> method in conjunction
with <a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.Function" title="sqlalchemy.sql.functions.Function"><code class="xref py py-class docutils literal notranslate"><span class="pre">Function</span></code></a> objects generated from the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.func" title="sqlalchemy.sql.expression.func"><code class="xref py py-data docutils literal notranslate"><span class="pre">func</span></code></a>
namespace.</p>
<p>Examples from PostgreSQL’s reference documentation follow below:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">json_each()</span></code>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">func</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span>
<span class="go">...     func.json_each(&#39;{&quot;a&quot;:&quot;foo&quot;, &quot;b&quot;:&quot;bar&quot;}&#39;).table_valued(&quot;key&quot;, &quot;value&quot;)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="n">anon_1</span><span class="p">.</span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">anon_1</span><span class="p">.</span><span class="n">value</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">json_each</span><span class="p">(:</span><span class="n">json_each_1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">anon_1</span>
</div></pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">json_populate_record()</span></code>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">literal_column</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span>
<span class="go">...     func.json_populate_record(</span>
<span class="go">...         literal_column(&quot;null::myrowtype&quot;), &#39;{&quot;a&quot;:1,&quot;b&quot;:2}&#39;</span>
<span class="go">...     ).table_valued(&quot;a&quot;, &quot;b&quot;, name=&quot;x&quot;)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">b</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">json_populate_record</span><span class="p">(</span><span class="k">null</span><span class="p">::</span><span class="n">myrowtype</span><span class="p">,</span><span class="w"> </span><span class="p">:</span><span class="n">json_populate_record_1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">x</span>
</div></pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">json_to_record()</span></code> - this form uses a PostgreSQL specific form of derived
columns in the alias, where we may make use of <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.column" title="sqlalchemy.sql.expression.column"><code class="xref py py-func docutils literal notranslate"><span class="pre">column()</span></code></a> elements with
types to produce them.  The <a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.FunctionElement.table_valued" title="sqlalchemy.sql.functions.FunctionElement.table_valued"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FunctionElement.table_valued()</span></code></a>
method produces  a <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.TableValuedAlias" title="sqlalchemy.sql.expression.TableValuedAlias"><code class="xref py py-class docutils literal notranslate"><span class="pre">TableValuedAlias</span></code></a> construct, and the method
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.TableValuedAlias.render_derived" title="sqlalchemy.sql.expression.TableValuedAlias.render_derived"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TableValuedAlias.render_derived()</span></code></a> method sets up the derived
columns specification:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Text</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span>
<span class="go">...     func.json_to_record(&#39;{&quot;a&quot;:1,&quot;b&quot;:[1,2,3],&quot;c&quot;:&quot;bar&quot;}&#39;)</span>
<span class="go">...     .table_valued(</span>
<span class="go">...         column(&quot;a&quot;, Integer),</span>
<span class="go">...         column(&quot;b&quot;, Text),</span>
<span class="go">...         column(&quot;d&quot;, Text),</span>
<span class="go">...     )</span>
<span class="go">...     .render_derived(name=&quot;x&quot;, with_types=True)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">d</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">json_to_record</span><span class="p">(:</span><span class="n">json_to_record_1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">)</span>
</div></pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">WITH</span> <span class="pre">ORDINALITY</span></code> - part of the SQL standard, <code class="docutils literal notranslate"><span class="pre">WITH</span> <span class="pre">ORDINALITY</span></code> adds an
ordinal counter to the output of a function and is accepted by a limited set
of PostgreSQL functions including <code class="docutils literal notranslate"><span class="pre">unnest()</span></code> and <code class="docutils literal notranslate"><span class="pre">generate_series()</span></code>. The
<a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.FunctionElement.table_valued" title="sqlalchemy.sql.functions.FunctionElement.table_valued"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FunctionElement.table_valued()</span></code></a> method accepts a keyword
parameter <code class="docutils literal notranslate"><span class="pre">with_ordinality</span></code> for this purpose, which accepts the string name
that will be applied to the “ordinality” column:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">func</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span>
<span class="go">...     func.generate_series(4, 1, -1)</span>
<span class="go">...     .table_valued(&quot;value&quot;, with_ordinality=&quot;ordinality&quot;)</span>
<span class="go">...     .render_derived()</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="n">anon_1</span><span class="p">.</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">anon_1</span><span class="p">.</span><span class="k">ordinality</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">generate_series</span><span class="p">(:</span><span class="n">generate_series_1</span><span class="p">,</span><span class="w"> </span><span class="p">:</span><span class="n">generate_series_2</span><span class="p">,</span><span class="w"> </span><span class="p">:</span><span class="n">generate_series_3</span><span class="p">)</span>
<span class="k">WITH</span><span class="w"> </span><span class="k">ORDINALITY</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">anon_1</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="k">ordinality</span><span class="p">)</span>
</div></pre></div>
</div>
</li>
</ul>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4.0b2 版本加入.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../tutorial/data_select.html#tutorial-functions-table-valued"><span class="std std-ref">表值函数</span></a> - in the <a class="reference internal" href="../tutorial/index.html#unified-tutorial"><span class="std std-ref">SQLAlchemy 统一教程</span></a></p>
</div>
</section>
<section id="column-valued-functions">
<span id="postgresql-column-valued"></span><h3>Column Valued Functions<a class="headerlink" href="#column-valued-functions" title="Link to this heading">¶</a></h3>
<p>Similar to the table valued function, a column valued function is present
in the FROM clause, but delivers itself to the columns clause as a single
scalar value.  PostgreSQL functions such as <code class="docutils literal notranslate"><span class="pre">json_array_elements()</span></code>,
<code class="docutils literal notranslate"><span class="pre">unnest()</span></code> and <code class="docutils literal notranslate"><span class="pre">generate_series()</span></code> may use this form. Column valued functions are available using the
<a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.FunctionElement.column_valued" title="sqlalchemy.sql.functions.FunctionElement.column_valued"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FunctionElement.column_valued()</span></code></a> method of <a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.FunctionElement" title="sqlalchemy.sql.functions.FunctionElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionElement</span></code></a>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">json_array_elements()</span></code>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">func</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span>
<span class="go">...     func.json_array_elements(&#39;[&quot;one&quot;, &quot;two&quot;]&#39;).column_valued(&quot;x&quot;)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="n">x</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">json_array_elements</span><span class="p">(:</span><span class="n">json_array_elements_1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">x</span>
</div></pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">unnest()</span></code> - in order to generate a PostgreSQL ARRAY literal, the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.array" title="sqlalchemy.dialects.postgresql.array"><code class="xref py py-func docutils literal notranslate"><span class="pre">array()</span></code></a> construct may be used:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">array</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">func</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">unnest</span><span class="p">(</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span><span class="o">.</span><span class="n">column_valued</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="n">anon_1</span>
<span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="nb">ARRAY</span><span class="p">[</span><span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">param_2</span><span class="p">)</span><span class="n">s</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">anon_1</span>
</div></pre></div>
</div>
<p>The function can of course be used against an existing table-bound column
that’s of type <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">table</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">ARRAY</span><span class="p">,</span> <span class="n">Integer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">func</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">column</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">ARRAY</span><span class="p">(</span><span class="n">Integer</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">unnest</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">column_valued</span><span class="p">(</span><span class="s2">&quot;unnested_value&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="n">unnested_value</span>
<span class="k">FROM</span><span class="w"> </span><span class="k">unnest</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">unnested_value</span>
</div></pre></div>
</div>
</li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../tutorial/data_select.html#tutorial-functions-column-valued"><span class="std std-ref">列值函数 - 表值函数作为标量列</span></a> - in the <a class="reference internal" href="../tutorial/index.html#unified-tutorial"><span class="std std-ref">SQLAlchemy 统一教程</span></a></p>
</div>
</section>
<section id="row-types">
<h3>Row Types<a class="headerlink" href="#row-types" title="Link to this heading">¶</a></h3>
<p>Built-in support for rendering a <code class="docutils literal notranslate"><span class="pre">ROW</span></code> may be approximated using
<code class="docutils literal notranslate"><span class="pre">func.ROW</span></code> with the <code class="xref py py-attr docutils literal notranslate"><span class="pre">sqlalchemy.func</span></code> namespace, or by using the
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.tuple_" title="sqlalchemy.sql.expression.tuple_"><code class="xref py py-func docutils literal notranslate"><span class="pre">tuple_()</span></code></a> construct:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">table</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">tuple_</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s2">&quot;fk&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     t.select()</span>
<span class="go">...     .where(tuple_(t.c.id, t.c.fk) &gt; (1, 2))</span>
<span class="go">...     .where(func.ROW(t.c.id, t.c.fk) &lt; func.ROW(3, 7))</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">fk</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">t</span>
<span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">fk</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(:</span><span class="n">param_1</span><span class="p">,</span><span class="w"> </span><span class="p">:</span><span class="n">param_2</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">ROW</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">fk</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">ROW</span><span class="p">(:</span><span class="n">ROW_1</span><span class="p">,</span><span class="w"> </span><span class="p">:</span><span class="n">ROW_2</span><span class="p">)</span>
</div></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference external" href="https://www.postgresql.org/docs/current/sql-expressions.html#SQL-SYNTAX-ROW-CONSTRUCTORS">PostgreSQL Row Constructors</a></p>
<p><a class="reference external" href="https://www.postgresql.org/docs/current/functions-comparisons.html#ROW-WISE-COMPARISON">PostgreSQL Row Constructor Comparison</a></p>
</div>
</section>
<section id="table-types-passed-to-functions">
<h3>Table Types passed to Functions<a class="headerlink" href="#table-types-passed-to-functions" title="Link to this heading">¶</a></h3>
<p>PostgreSQL supports passing a table as an argument to a function, which is
known as a “record” type. SQLAlchemy <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.FromClause" title="sqlalchemy.sql.expression.FromClause"><code class="xref py py-class docutils literal notranslate"><span class="pre">FromClause</span></code></a> objects
such as <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> support this special form using the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">FromClause.table_valued()</span></code> method, which is comparable to the
<a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.FunctionElement.table_valued" title="sqlalchemy.sql.functions.FunctionElement.table_valued"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FunctionElement.table_valued()</span></code></a> method except that the collection
of columns is already established by that of the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.FromClause" title="sqlalchemy.sql.expression.FromClause"><code class="xref py py-class docutils literal notranslate"><span class="pre">FromClause</span></code></a>
itself:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">table</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">row_to_json</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">table_valued</span><span class="p">()))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="n">row_to_json</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">row_to_json_1</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">a</span>
</div></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4.0b2 版本加入.</span></p>
</div>
</section>
</section>
<section id="array">
<h2>ARRAY 类型<a class="headerlink" href="#array" title="Link to this heading">¶</a></h2>
<p>ARRAY Types</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">中文</label><div class="tab-content docutils container">
<p>PostgreSQL方言支持数组，既可以作为多维列类型，也可以作为数组文字：</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> - ARRAY数据类型</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.array" title="sqlalchemy.dialects.postgresql.array"><code class="xref py py-class docutils literal notranslate"><span class="pre">array</span></code></a> - 数组文字</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.array_agg" title="sqlalchemy.dialects.postgresql.array_agg"><code class="xref py py-func docutils literal notranslate"><span class="pre">array_agg()</span></code></a> - ARRAY_AGG SQL函数</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.aggregate_order_by" title="sqlalchemy.dialects.postgresql.aggregate_order_by"><code class="xref py py-class docutils literal notranslate"><span class="pre">aggregate_order_by</span></code></a> - PG的ORDER BY聚合函数语法的助手类。</p></li>
</ul>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">英文</label><div class="tab-content docutils container">
<p>The PostgreSQL dialect supports arrays, both as multidimensional column types
as well as array literals:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> - ARRAY datatype</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.array" title="sqlalchemy.dialects.postgresql.array"><code class="xref py py-class docutils literal notranslate"><span class="pre">array</span></code></a> - array literal</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.array_agg" title="sqlalchemy.dialects.postgresql.array_agg"><code class="xref py py-func docutils literal notranslate"><span class="pre">array_agg()</span></code></a> - ARRAY_AGG SQL function</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.aggregate_order_by" title="sqlalchemy.dialects.postgresql.aggregate_order_by"><code class="xref py py-class docutils literal notranslate"><span class="pre">aggregate_order_by</span></code></a> - helper for PG’s ORDER BY aggregate function syntax.</p></li>
</ul>
</div>
</div>
</section>
<section id="json">
<span id="postgresql-json-types"></span><h2>JSON 类型<a class="headerlink" href="#json" title="Link to this heading">¶</a></h2>
<p>JSON Types</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--1-input--1" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--1">中文</label><div class="tab-content docutils container">
<p>PostgreSQL方言支持JSON和JSONB数据类型，包括psycopg2的原生支持以及所有PostgreSQL特殊运算符的支持：</p>
</div>
<input class="tab-input" id="tab-set--1-input--2" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--2">英文</label><div class="tab-content docutils container">
<p>The PostgreSQL dialect supports both JSON and JSONB datatypes, including
psycopg2’s native support and support for all of PostgreSQL’s special
operators:</p>
</div>
</div>
<ul class="simple">
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONB</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONPATH" title="sqlalchemy.dialects.postgresql.JSONPATH"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONPATH</span></code></a></p></li>
</ul>
</section>
<section id="hstore">
<h2>HSTORE 类型<a class="headerlink" href="#hstore" title="Link to this heading">¶</a></h2>
<p>HSTORE Type</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--2-input--1" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--1">中文</label><div class="tab-content docutils container">
<p>PostgreSQL的HSTORE类型以及hstore文字都受到支持：</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">HSTORE</span></code></a> - HSTORE数据类型</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.hstore" title="sqlalchemy.dialects.postgresql.hstore"><code class="xref py py-class docutils literal notranslate"><span class="pre">hstore</span></code></a> - hstore文字</p></li>
</ul>
</div>
<input class="tab-input" id="tab-set--2-input--2" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--2">英文</label><div class="tab-content docutils container">
<p>The PostgreSQL HSTORE type as well as hstore literals are supported:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">HSTORE</span></code></a> - HSTORE datatype</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.hstore" title="sqlalchemy.dialects.postgresql.hstore"><code class="xref py py-class docutils literal notranslate"><span class="pre">hstore</span></code></a> - hstore literal</p></li>
</ul>
</div>
</div>
</section>
<section id="enum">
<h2>ENUM 类型<a class="headerlink" href="#enum" title="Link to this heading">¶</a></h2>
<p>ENUM Types</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--3-input--1" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--1">中文</label><div class="tab-content docutils container">
<p>PostgreSQL具有一个独立创建的TYPE结构，用于实现枚举类型。这种方法在SQLAlchemy方面引入了在何时应该创建和删除此类型的显著复杂性。类型对象也是一个独立的可反映实体。应参考以下章节：</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a> - ENUM的DDL和类型支持。</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_enums" title="sqlalchemy.dialects.postgresql.base.PGInspector.get_enums"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PGInspector.get_enums()</span></code></a> - 检索当前ENUM类型的列表</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.create" title="sqlalchemy.dialects.postgresql.ENUM.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ENUM.create()</span></code></a> , <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.drop" title="sqlalchemy.dialects.postgresql.ENUM.drop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ENUM.drop()</span></code></a> - ENUM的单独CREATE和DROP命令。</p></li>
</ul>
</div>
<input class="tab-input" id="tab-set--3-input--2" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--2">英文</label><div class="tab-content docutils container">
<p>PostgreSQL has an independently creatable TYPE structure which is used
to implement an enumerated type.   This approach introduces significant
complexity on the SQLAlchemy side in terms of when this type should be
CREATED and DROPPED.   The type object is also an independently reflectable
entity.   The following sections should be consulted:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a> - DDL and typing support for ENUM.</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_enums" title="sqlalchemy.dialects.postgresql.base.PGInspector.get_enums"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PGInspector.get_enums()</span></code></a> - retrieve a listing of current ENUM types</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.create" title="sqlalchemy.dialects.postgresql.ENUM.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ENUM.create()</span></code></a> , <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.drop" title="sqlalchemy.dialects.postgresql.ENUM.drop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ENUM.drop()</span></code></a> - individual CREATE and DROP commands for ENUM.</p></li>
</ul>
</div>
</div>
<section id="enum-array">
<span id="postgresql-array-of-enum"></span><h3>将 ENUM 与 ARRAY 结合使用<a class="headerlink" href="#enum-array" title="Link to this heading">¶</a></h3>
<p>Using ENUM with ARRAY</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--4-input--1" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--1">中文</label><div class="tab-content docutils container">
<p>ENUM和ARRAY的组合目前不直接受后端DBAPI的支持。在SQLAlchemy 1.3.17之前，需要一个特殊的解决方法来允许这种组合工作，如下所述。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeDecorator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">ARRAY</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ArrayOfEnum</span><span class="p">(</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="n">impl</span> <span class="o">=</span> <span class="n">ARRAY</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bind_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bindvalue</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sa</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">bindvalue</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">result_processor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dialect</span><span class="p">,</span> <span class="n">coltype</span><span class="p">):</span>
        <span class="n">super_rp</span> <span class="o">=</span> <span class="n">super</span><span class="p">(</span><span class="n">ArrayOfEnum</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">result_processor</span><span class="p">(</span><span class="n">dialect</span><span class="p">,</span> <span class="n">coltype</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">handle_raw_string</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">inner</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^{(.*)}$&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">inner</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">inner</span> <span class="k">else</span> <span class="p">[]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">super_rp</span><span class="p">(</span><span class="n">handle_raw_string</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">process</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;mydata&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">ArrayOfEnum</span><span class="p">(</span><span class="n">ENUM</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;myenum&quot;</span><span class="p">))),</span>
<span class="p">)</span></pre></div>
</div>
<p>这种类型不包含为内置类型，因为它与在新版本中突然决定直接支持ENUM的ARRAY的DBAPI不兼容。</p>
</div>
<input class="tab-input" id="tab-set--4-input--2" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--2">英文</label><div class="tab-content docutils container">
<p>The combination of ENUM and ARRAY is not directly supported by backend
DBAPIs at this time.   Prior to SQLAlchemy 1.3.17, a special workaround
was needed in order to allow this combination to work, described below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeDecorator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">ARRAY</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ArrayOfEnum</span><span class="p">(</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="n">impl</span> <span class="o">=</span> <span class="n">ARRAY</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bind_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bindvalue</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sa</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">bindvalue</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">result_processor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dialect</span><span class="p">,</span> <span class="n">coltype</span><span class="p">):</span>
        <span class="n">super_rp</span> <span class="o">=</span> <span class="n">super</span><span class="p">(</span><span class="n">ArrayOfEnum</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">result_processor</span><span class="p">(</span><span class="n">dialect</span><span class="p">,</span> <span class="n">coltype</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">handle_raw_string</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">inner</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^{(.*)}$&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">inner</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">inner</span> <span class="k">else</span> <span class="p">[]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">super_rp</span><span class="p">(</span><span class="n">handle_raw_string</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">process</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;mydata&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">ArrayOfEnum</span><span class="p">(</span><span class="n">ENUM</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;myenum&quot;</span><span class="p">))),</span>
<span class="p">)</span></pre></div>
</div>
<p>This type is not included as a built-in type as it would be incompatible
with a DBAPI that suddenly decides to support ARRAY of ENUM directly in
a new version.</p>
</div>
</div>
</section>
<section id="json-jsonb-array">
<span id="postgresql-array-of-json"></span><h3>将 JSON/JSONB 与 ARRAY 结合使用<a class="headerlink" href="#json-jsonb-array" title="Link to this heading">¶</a></h3>
<p>Using JSON/JSONB with ARRAY</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--5-input--1" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--1">中文</label><div class="tab-content docutils container">
<p>类似于使用ENUM，在SQLAlchemy 1.3.17之前，对于JSON/JSONB的ARRAY，我们需要渲染适当的CAST。当前的psycopg2驱动程序正确处理结果集，无需任何特殊步骤。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">CastingArray</span><span class="p">(</span><span class="n">ARRAY</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bind_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bindvalue</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sa</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">bindvalue</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;mydata&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">CastingArray</span><span class="p">(</span><span class="n">JSONB</span><span class="p">)),</span>
<span class="p">)</span></pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--5-input--2" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--2">英文</label><div class="tab-content docutils container">
<p>Similar to using ENUM, prior to SQLAlchemy 1.3.17, for an ARRAY of JSON/JSONB
we need to render the appropriate CAST.   Current psycopg2 drivers accommodate
the result set correctly without any special steps.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">CastingArray</span><span class="p">(</span><span class="n">ARRAY</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bind_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bindvalue</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sa</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">bindvalue</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;mydata&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">CastingArray</span><span class="p">(</span><span class="n">JSONB</span><span class="p">)),</span>
<span class="p">)</span></pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="postgresql-ranges">
<span id="id5"></span><h2>范围和多范围类型<a class="headerlink" href="#postgresql-ranges" title="Link to this heading">¶</a></h2>
<p>Range and Multirange Types</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--6-input--1" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--1">中文</label><div class="tab-content docutils container">
<p>PostgreSQL范围和多范围类型支持psycopg、pg8000和asyncpg方言；psycopg2方言仅支持范围类型。</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.17 版本加入: </span>为pg8000方言添加了范围和多范围支持。需要pg8000 1.29.8或更高版本。</p>
</div>
<p>传递到数据库的数据值可以作为字符串值传递，也可以使用 <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a> 数据对象传递。</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入: </span>添加了用于指示范围的后端无关的 <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a> 对象。不再公开特定于``psycopg2``的范围类，仅由该特定方言内部使用。</p>
</div>
<p>例如，使用 <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSRANGE" title="sqlalchemy.dialects.postgresql.TSRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSRANGE</span></code></a> 数据类型的完全类型化模型示例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">Range</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">TSRANGE</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeclarativeBase</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">mapped_column</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="p">(</span><span class="n">DeclarativeBase</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span><span class="w"> </span><span class="nc">RoomBooking</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;room_booking&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">room</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span>
    <span class="n">during</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Range</span><span class="p">[</span><span class="n">datetime</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">TSRANGE</span><span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>要表示上述``during``列的数据，<a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a> 类型是一个简单的数据类，将表示范围的边界。下面说明了如何将一行插入到上述``room_booking``表中:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Session</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+psycopg://scott:tiger@pg14/dbname&quot;</span><span class="p">)</span>

<span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>

<span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">booking</span> <span class="o">=</span> <span class="n">RoomBooking</span><span class="p">(</span>
        <span class="n">room</span><span class="o">=</span><span class="s2">&quot;101&quot;</span><span class="p">,</span> <span class="n">during</span><span class="o">=</span><span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">23</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">booking</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div>
</div>
<p>从任何范围列中选择也将返回 <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a> 对象，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>

<span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">RoomBooking</span><span class="o">.</span><span class="n">during</span><span class="p">)):</span>
        <span class="n">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span></pre></div>
</div>
<p>可用的范围数据类型如下：</p>
</div>
<input class="tab-input" id="tab-set--6-input--2" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--2">英文</label><div class="tab-content docutils container">
<p>PostgreSQL range and multirange types are supported for the
psycopg, pg8000 and asyncpg dialects; the psycopg2 dialect supports the
range types only.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.17 版本加入: </span>Added range and multirange support for the pg8000</p>
</div>
<p>dialect.  pg8000 1.29.8 or greater is required.</p>
<p>Data values being passed to the database may be passed as string
values or by using the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a> data object.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入: </span>Added the backend-agnostic <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a></p>
</div>
<p>object used to indicate ranges.  The <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code>-specific range classes
are no longer exposed and are only used internally by that particular
dialect.</p>
<p>E.g. an example of a fully typed model using the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSRANGE" title="sqlalchemy.dialects.postgresql.TSRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSRANGE</span></code></a> datatype:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">Range</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">TSRANGE</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeclarativeBase</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">mapped_column</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="p">(</span><span class="n">DeclarativeBase</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span><span class="w"> </span><span class="nc">RoomBooking</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;room_booking&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">room</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span>
    <span class="n">during</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Range</span><span class="p">[</span><span class="n">datetime</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">TSRANGE</span><span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>To represent data for the <code class="docutils literal notranslate"><span class="pre">during</span></code> column above, the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a>
type is a simple dataclass that will represent the bounds of the range.
Below illustrates an INSERT of a row into the above <code class="docutils literal notranslate"><span class="pre">room_booking</span></code> table:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Session</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+psycopg://scott:tiger@pg14/dbname&quot;</span><span class="p">)</span>

<span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>

<span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">booking</span> <span class="o">=</span> <span class="n">RoomBooking</span><span class="p">(</span>
        <span class="n">room</span><span class="o">=</span><span class="s2">&quot;101&quot;</span><span class="p">,</span> <span class="n">during</span><span class="o">=</span><span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">23</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">booking</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div>
</div>
<p>Selecting from any range column will also return <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a>
objects as indicated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>

<span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">RoomBooking</span><span class="o">.</span><span class="n">during</span><span class="p">)):</span>
        <span class="n">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span></pre></div>
</div>
<p>The available range datatypes are as follows:</p>
</div>
</div>
<ul class="simple">
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT4RANGE" title="sqlalchemy.dialects.postgresql.INT4RANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">INT4RANGE</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT8RANGE" title="sqlalchemy.dialects.postgresql.INT8RANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">INT8RANGE</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.NUMRANGE" title="sqlalchemy.dialects.postgresql.NUMRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">NUMRANGE</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.DATERANGE" title="sqlalchemy.dialects.postgresql.DATERANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">DATERANGE</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSRANGE" title="sqlalchemy.dialects.postgresql.TSRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSRANGE</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSTZRANGE" title="sqlalchemy.dialects.postgresql.TSTZRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSTZRANGE</span></code></a></p></li>
</ul>
<div class="table-wrapper longtable docutils container">
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><span class="sig-name descname">Range</span></a></p></td>
<td><p>Represent a PostgreSQL range.</p></td>
</tr>
</tbody>
</table>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">Range</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range" title="Link to this definition">¶</a></dt>
<dd><p>Represent a PostgreSQL range.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="s2">&quot;()&quot;</span><span class="p">)</span></pre></div>
</div>
<p>The calling style is similar to that of psycopg and psycopg2, in part
to allow easier migration from previous SQLAlchemy versions that used
these objects directly.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.Range.params.lower"></span><strong>lower</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.Range.params.lower">¶</a> – Lower bound value, or None</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.Range.params.upper"></span><strong>upper</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.Range.params.upper">¶</a> – Upper bound value, or None</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.Range.params.bounds"></span><strong>bounds</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.Range.params.bounds">¶</a> – keyword-only, optional string value that is one of
<code class="docutils literal notranslate"><span class="pre">&quot;()&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;[)&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;(]&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;[]&quot;</span></code>.  Defaults to <code class="docutils literal notranslate"><span class="pre">&quot;[)&quot;</span></code>.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.Range.params.empty"></span><strong>empty</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.Range.params.empty">¶</a> – keyword-only, optional bool indicating this is an “empty”
range</p></li>
</ul>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.__eq__"><span class="sig-name descname">__eq__()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.adjacent_to"><span class="sig-name descname">adjacent_to()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.contained_by"><span class="sig-name descname">contained_by()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.contains"><span class="sig-name descname">contains()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.difference"><span class="sig-name descname">difference()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.intersection"><span class="sig-name descname">intersection()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.is_empty"><span class="sig-name descname">is_empty</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.isempty"><span class="sig-name descname">isempty</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.lower"><span class="sig-name descname">lower</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.lower_inc"><span class="sig-name descname">lower_inc</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.lower_inf"><span class="sig-name descname">lower_inf</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.not_extend_left_of"><span class="sig-name descname">not_extend_left_of()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.not_extend_right_of"><span class="sig-name descname">not_extend_right_of()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.overlaps"><span class="sig-name descname">overlaps()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.strictly_left_of"><span class="sig-name descname">strictly_left_of()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.strictly_right_of"><span class="sig-name descname">strictly_right_of()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.union"><span class="sig-name descname">union()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.upper"><span class="sig-name descname">upper</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.upper_inc"><span class="sig-name descname">upper_inc</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.upper_inf"><span class="sig-name descname">upper_inf</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Generic</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range.__eq__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range.</span></code></a><span class="sig-name descname"><span class="pre">__eq__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range.__eq__" title="Link to this definition">¶</a></dt>
<dd><p>Compare this range to the <cite>other</cite> taking into account
bounds inclusivity, returning <code class="docutils literal notranslate"><span class="pre">True</span></code> if they are equal.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range.adjacent_to">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range.</span></code></a><span class="sig-name descname"><span class="pre">adjacent_to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.ranges.Range"><span class="pre">Range</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range.adjacent_to" title="Link to this definition">¶</a></dt>
<dd><p>Determine whether this range is adjacent to the <cite>other</cite>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range.contained_by">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range.</span></code></a><span class="sig-name descname"><span class="pre">contained_by</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.ranges.Range"><span class="pre">Range</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range.contained_by" title="Link to this definition">¶</a></dt>
<dd><p>Determine whether this range is a contained by <cite>other</cite>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range.contains">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range.</span></code></a><span class="sig-name descname"><span class="pre">contains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_T</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.ranges.Range"><span class="pre">Range</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range.contains" title="Link to this definition">¶</a></dt>
<dd><p>Determine whether this range contains <cite>value</cite>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range.difference">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range.</span></code></a><span class="sig-name descname"><span class="pre">difference</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.ranges.Range"><span class="pre">Range</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.ranges.Range"><span class="pre">Range</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range.difference" title="Link to this definition">¶</a></dt>
<dd><p>Compute the difference between this range and the <cite>other</cite>.</p>
<p>This raises a <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> exception if the two ranges are
“disjunct”, that is neither adjacent nor overlapping.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range.intersection">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range.</span></code></a><span class="sig-name descname"><span class="pre">intersection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.ranges.Range"><span class="pre">Range</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.ranges.Range"><span class="pre">Range</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range.intersection" title="Link to this definition">¶</a></dt>
<dd><p>Compute the intersection of this range with the <cite>other</cite>.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.10 版本加入.</span></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range.is_empty">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range.</span></code></a><span class="sig-name descname"><span class="pre">is_empty</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range.is_empty" title="Link to this definition">¶</a></dt>
<dd><p>A synonym for the ‘empty’ attribute.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range.isempty">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range.</span></code></a><span class="sig-name descname"><span class="pre">isempty</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range.isempty" title="Link to this definition">¶</a></dt>
<dd><p>A synonym for the ‘empty’ attribute.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range.lower">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range.</span></code></a><span class="sig-name descname"><span class="pre">lower</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">_T</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range.lower" title="Link to this definition">¶</a></dt>
<dd><p>the lower bound</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range.lower_inc">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range.</span></code></a><span class="sig-name descname"><span class="pre">lower_inc</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range.lower_inc" title="Link to this definition">¶</a></dt>
<dd><p>Return True if the lower bound is inclusive.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range.lower_inf">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range.</span></code></a><span class="sig-name descname"><span class="pre">lower_inf</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range.lower_inf" title="Link to this definition">¶</a></dt>
<dd><p>Return True if this range is non-empty and lower bound is
infinite.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range.not_extend_left_of">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range.</span></code></a><span class="sig-name descname"><span class="pre">not_extend_left_of</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.ranges.Range"><span class="pre">Range</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range.not_extend_left_of" title="Link to this definition">¶</a></dt>
<dd><p>Determine whether this does not extend to the left of <cite>other</cite>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range.not_extend_right_of">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range.</span></code></a><span class="sig-name descname"><span class="pre">not_extend_right_of</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.ranges.Range"><span class="pre">Range</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range.not_extend_right_of" title="Link to this definition">¶</a></dt>
<dd><p>Determine whether this does not extend to the right of <cite>other</cite>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range.overlaps">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range.</span></code></a><span class="sig-name descname"><span class="pre">overlaps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.ranges.Range"><span class="pre">Range</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range.overlaps" title="Link to this definition">¶</a></dt>
<dd><p>Determine whether this range overlaps with <cite>other</cite>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range.strictly_left_of">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range.</span></code></a><span class="sig-name descname"><span class="pre">strictly_left_of</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.ranges.Range"><span class="pre">Range</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range.strictly_left_of" title="Link to this definition">¶</a></dt>
<dd><p>Determine whether this range is completely to the left of <cite>other</cite>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range.strictly_right_of">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range.</span></code></a><span class="sig-name descname"><span class="pre">strictly_right_of</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.ranges.Range"><span class="pre">Range</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range.strictly_right_of" title="Link to this definition">¶</a></dt>
<dd><p>Determine whether this range is completely to the right of <cite>other</cite>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range.union">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range.</span></code></a><span class="sig-name descname"><span class="pre">union</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.ranges.Range"><span class="pre">Range</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.ranges.Range"><span class="pre">Range</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range.union" title="Link to this definition">¶</a></dt>
<dd><p>Compute the union of this range with the <cite>other</cite>.</p>
<p>This raises a <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> exception if the two ranges are
“disjunct”, that is neither adjacent nor overlapping.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range.upper">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range.</span></code></a><span class="sig-name descname"><span class="pre">upper</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">_T</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range.upper" title="Link to this definition">¶</a></dt>
<dd><p>the upper bound</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range.upper_inc">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range.</span></code></a><span class="sig-name descname"><span class="pre">upper_inc</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range.upper_inc" title="Link to this definition">¶</a></dt>
<dd><p>Return True if the upper bound is inclusive.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Range.upper_inf">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Range.</span></code></a><span class="sig-name descname"><span class="pre">upper_inf</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Range.upper_inf" title="Link to this definition">¶</a></dt>
<dd><p>Return True if this range is non-empty and the upper bound is
infinite.</p>
</dd></dl>

</dd></dl>

<section id="id6">
<h3>多范围<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h3>
<p>Multiranges</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--7-input--1" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--1">中文</label><div class="tab-content docutils container">
<p>Multiranges在PostgreSQL 14及以上版本中受支持。SQLAlchemy的多范围数据类型处理 <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a> 类型的列表。</p>
<p>Multiranges仅支持psycopg、asyncpg和pg8000方言。SQLAlchemy的默认 <code class="docutils literal notranslate"><span class="pre">postgresql</span></code> 方言psycopg2不支持多范围数据类型。</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入: </span>添加了对MULTIRANGE数据类型的支持。SQLAlchemy将多范围值表示为 <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a> 对象的列表。</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.17 版本加入: </span>为pg8000方言添加了多范围支持。需要pg8000 1.29.8或更高版本。</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.26 版本加入: </span>添加了 <a class="reference internal" href="#sqlalchemy.dialects.postgresql.MultiRange" title="sqlalchemy.dialects.postgresql.MultiRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiRange</span></code></a> 序列。</p>
</div>
<p>下面的示例说明了 <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSMULTIRANGE" title="sqlalchemy.dialects.postgresql.TSMULTIRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSMULTIRANGE</span></code></a> 数据类型的使用:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">Range</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">TSMULTIRANGE</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeclarativeBase</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">mapped_column</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="p">(</span><span class="n">DeclarativeBase</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span><span class="w"> </span><span class="nc">EventCalendar</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;event_calendar&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">event_name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span>
    <span class="n">added</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span>
    <span class="n">in_session_periods</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Range</span><span class="p">[</span><span class="n">datetime</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">TSMULTIRANGE</span><span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>说明插入和选择记录:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Session</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+psycopg://scott:tiger@pg14/test&quot;</span><span class="p">)</span>

<span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>

<span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">calendar</span> <span class="o">=</span> <span class="n">EventCalendar</span><span class="p">(</span>
        <span class="n">event_name</span><span class="o">=</span><span class="s2">&quot;SQLAlchemy Tutorial Sessions&quot;</span><span class="p">,</span>
        <span class="n">in_session_periods</span><span class="o">=</span><span class="p">[</span>
            <span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">23</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">25</span><span class="p">)),</span>
            <span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">15</span><span class="p">)),</span>
            <span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">12</span><span class="p">)),</span>
        <span class="p">],</span>
    <span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">calendar</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">multirange</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">EventCalendar</span><span class="o">.</span><span class="n">in_session_periods</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">range_</span> <span class="ow">in</span> <span class="n">multirange</span><span class="p">:</span>
            <span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start: </span><span class="si">{</span><span class="n">range_</span><span class="o">.</span><span class="n">lower</span><span class="si">}</span><span class="s2">  End: </span><span class="si">{</span><span class="n">range_</span><span class="o">.</span><span class="n">upper</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>在上述示例中，ORM处理的 <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a> 类型列表不会自动检测特定列表值的原地更改；要使用ORM更新列表值，可以重新分配一个新列表给该属性，或者使用 <a class="reference internal" href="../orm/extensions/mutable.html#sqlalchemy.ext.mutable.MutableList" title="sqlalchemy.ext.mutable.MutableList"><code class="xref py py-class docutils literal notranslate"><span class="pre">MutableList</span></code></a> 类型修改器。有关背景信息，请参见章节 <a class="reference internal" href="../orm/extensions/mutable.html#mutable-toplevel"><span class="std std-ref">突变追踪</span></a>。</p>
</div>
</div>
<input class="tab-input" id="tab-set--7-input--2" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--2">英文</label><div class="tab-content docutils container">
<p>Multiranges are supported by PostgreSQL 14 and above.  SQLAlchemy’s
multirange datatypes deal in lists of <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a> types.</p>
<p>Multiranges are supported on the psycopg, asyncpg, and pg8000 dialects
<strong>only</strong>.  The psycopg2 dialect, which is SQLAlchemy’s default <code class="docutils literal notranslate"><span class="pre">postgresql</span></code>
dialect, <strong>does not</strong> support multirange datatypes.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入: </span>Added support for MULTIRANGE datatypes. SQLAlchemy represents a multirange value as a list of <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a> objects.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.17 版本加入: </span>Added multirange support for the pg8000 dialect. pg8000 1.29.8 or greater is required.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.26 版本加入: </span><a class="reference internal" href="#sqlalchemy.dialects.postgresql.MultiRange" title="sqlalchemy.dialects.postgresql.MultiRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiRange</span></code></a> sequence added.</p>
</div>
<p>The example below illustrates use of the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSMULTIRANGE" title="sqlalchemy.dialects.postgresql.TSMULTIRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSMULTIRANGE</span></code></a>
datatype:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">Range</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">TSMULTIRANGE</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeclarativeBase</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">mapped_column</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="p">(</span><span class="n">DeclarativeBase</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span><span class="w"> </span><span class="nc">EventCalendar</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;event_calendar&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">event_name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span>
    <span class="n">added</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span>
    <span class="n">in_session_periods</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Range</span><span class="p">[</span><span class="n">datetime</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">TSMULTIRANGE</span><span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>Illustrating insertion and selecting of a record:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Session</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+psycopg://scott:tiger@pg14/test&quot;</span><span class="p">)</span>

<span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>

<span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">calendar</span> <span class="o">=</span> <span class="n">EventCalendar</span><span class="p">(</span>
        <span class="n">event_name</span><span class="o">=</span><span class="s2">&quot;SQLAlchemy Tutorial Sessions&quot;</span><span class="p">,</span>
        <span class="n">in_session_periods</span><span class="o">=</span><span class="p">[</span>
            <span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">23</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">25</span><span class="p">)),</span>
            <span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">15</span><span class="p">)),</span>
            <span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">12</span><span class="p">)),</span>
        <span class="p">],</span>
    <span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">calendar</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">multirange</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">EventCalendar</span><span class="o">.</span><span class="n">in_session_periods</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">range_</span> <span class="ow">in</span> <span class="n">multirange</span><span class="p">:</span>
            <span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start: </span><span class="si">{</span><span class="n">range_</span><span class="o">.</span><span class="n">lower</span><span class="si">}</span><span class="s2">  End: </span><span class="si">{</span><span class="n">range_</span><span class="o">.</span><span class="n">upper</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>In the above example, the list of <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a> types
as handled by the ORM will not automatically detect in-place changes to
a particular list value; to update list values with the ORM, either re-assign
a new list to the attribute, or use the <a class="reference internal" href="../orm/extensions/mutable.html#sqlalchemy.ext.mutable.MutableList" title="sqlalchemy.ext.mutable.MutableList"><code class="xref py py-class docutils literal notranslate"><span class="pre">MutableList</span></code></a>
type modifier.  See the section <a class="reference internal" href="../orm/extensions/mutable.html#mutable-toplevel"><span class="std std-ref">突变追踪</span></a> for background.</p>
</div>
</div>
</div>
<section id="postgresql-multirange-list-use">
<span id="id7"></span><h4>使用多范围序列推断多范围类型<a class="headerlink" href="#postgresql-multirange-list-use" title="Link to this heading">¶</a></h4>
<p>Use of a MultiRange sequence to infer the multirange type</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--8-input--1" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--1">中文</label><div class="tab-content docutils container">
<p>在不指定类型的情况下使用多范围作为文字时，可以使用实用程序 <a class="reference internal" href="#sqlalchemy.dialects.postgresql.MultiRange" title="sqlalchemy.dialects.postgresql.MultiRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiRange</span></code></a> 序列:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">literal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">MultiRange</span>

<span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">EventCalendar</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">EventCalendar</span><span class="o">.</span><span class="n">added</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="s2">&quot;&lt;@&quot;</span><span class="p">)(</span>
            <span class="n">MultiRange</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">31</span><span class="p">)),</span>
                    <span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">30</span><span class="p">)),</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">in_range</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">literal</span><span class="p">(</span><span class="n">MultiRange</span><span class="p">([</span><span class="n">Range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]))))</span>
    <span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">lower</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">upper</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></pre></div>
</div>
<p>使用简单的 <code class="docutils literal notranslate"><span class="pre">list</span></code> 而不是 <a class="reference internal" href="#sqlalchemy.dialects.postgresql.MultiRange" title="sqlalchemy.dialects.postgresql.MultiRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiRange</span></code></a> 将需要手动将文字值的类型设置为适当的多范围类型。</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.26 版本加入: </span><a class="reference internal" href="#sqlalchemy.dialects.postgresql.MultiRange" title="sqlalchemy.dialects.postgresql.MultiRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiRange</span></code></a> 序列添加。</p>
</div>
<p>可用的多范围数据类型如下：</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT4MULTIRANGE" title="sqlalchemy.dialects.postgresql.INT4MULTIRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">INT4MULTIRANGE</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT8MULTIRANGE" title="sqlalchemy.dialects.postgresql.INT8MULTIRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">INT8MULTIRANGE</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.NUMMULTIRANGE" title="sqlalchemy.dialects.postgresql.NUMMULTIRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">NUMMULTIRANGE</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.DATEMULTIRANGE" title="sqlalchemy.dialects.postgresql.DATEMULTIRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">DATEMULTIRANGE</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSMULTIRANGE" title="sqlalchemy.dialects.postgresql.TSMULTIRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSMULTIRANGE</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSTZMULTIRANGE" title="sqlalchemy.dialects.postgresql.TSTZMULTIRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSTZMULTIRANGE</span></code></a></p></li>
</ul>
</div>
<input class="tab-input" id="tab-set--8-input--2" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--2">英文</label><div class="tab-content docutils container">
<p>When using a multirange as a literal without specifying the type
the utility <a class="reference internal" href="#sqlalchemy.dialects.postgresql.MultiRange" title="sqlalchemy.dialects.postgresql.MultiRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiRange</span></code></a> sequence can be used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">literal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">MultiRange</span>

<span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">EventCalendar</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">EventCalendar</span><span class="o">.</span><span class="n">added</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="s2">&quot;&lt;@&quot;</span><span class="p">)(</span>
            <span class="n">MultiRange</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">31</span><span class="p">)),</span>
                    <span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">30</span><span class="p">)),</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">in_range</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">literal</span><span class="p">(</span><span class="n">MultiRange</span><span class="p">([</span><span class="n">Range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]))))</span>
    <span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">lower</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">upper</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></pre></div>
</div>
<p>Using a simple <code class="docutils literal notranslate"><span class="pre">list</span></code> instead of <a class="reference internal" href="#sqlalchemy.dialects.postgresql.MultiRange" title="sqlalchemy.dialects.postgresql.MultiRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiRange</span></code></a> would require
manually setting the type of the literal value to the appropriate multirange type.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.26 版本加入: </span><a class="reference internal" href="#sqlalchemy.dialects.postgresql.MultiRange" title="sqlalchemy.dialects.postgresql.MultiRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiRange</span></code></a> sequence added.</p>
</div>
<p>The available multirange datatypes are as follows:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT4MULTIRANGE" title="sqlalchemy.dialects.postgresql.INT4MULTIRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">INT4MULTIRANGE</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT8MULTIRANGE" title="sqlalchemy.dialects.postgresql.INT8MULTIRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">INT8MULTIRANGE</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.NUMMULTIRANGE" title="sqlalchemy.dialects.postgresql.NUMMULTIRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">NUMMULTIRANGE</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.DATEMULTIRANGE" title="sqlalchemy.dialects.postgresql.DATEMULTIRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">DATEMULTIRANGE</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSMULTIRANGE" title="sqlalchemy.dialects.postgresql.TSMULTIRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSMULTIRANGE</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSTZMULTIRANGE" title="sqlalchemy.dialects.postgresql.TSTZMULTIRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSTZMULTIRANGE</span></code></a></p></li>
</ul>
</div>
</div>
</section>
</section>
</section>
<section id="postgresql-network-datatypes">
<span id="id8"></span><h2>网络数据类型<a class="headerlink" href="#postgresql-network-datatypes" title="Link to this heading">¶</a></h2>
<p>Network Data Types</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--9-input--1" name="tab-set--9" type="radio"><label class="tab-label" for="tab-set--9-input--1">中文</label><div class="tab-content docutils container">
<p>包含的网络数据类型有 <a class="reference internal" href="#sqlalchemy.dialects.postgresql.INET" title="sqlalchemy.dialects.postgresql.INET"><code class="xref py py-class docutils literal notranslate"><span class="pre">INET</span></code></a>，<a class="reference internal" href="#sqlalchemy.dialects.postgresql.CIDR" title="sqlalchemy.dialects.postgresql.CIDR"><code class="xref py py-class docutils literal notranslate"><span class="pre">CIDR</span></code></a>，<a class="reference internal" href="#sqlalchemy.dialects.postgresql.MACADDR" title="sqlalchemy.dialects.postgresql.MACADDR"><code class="xref py py-class docutils literal notranslate"><span class="pre">MACADDR</span></code></a>。</p>
<p>对于 <a class="reference internal" href="#sqlalchemy.dialects.postgresql.INET" title="sqlalchemy.dialects.postgresql.INET"><code class="xref py py-class docutils literal notranslate"><span class="pre">INET</span></code></a> 和 <a class="reference internal" href="#sqlalchemy.dialects.postgresql.CIDR" title="sqlalchemy.dialects.postgresql.CIDR"><code class="xref py py-class docutils literal notranslate"><span class="pre">CIDR</span></code></a> 数据类型，有条件支持这些数据类型发送和检索Python <code class="docutils literal notranslate"><span class="pre">ipaddress</span></code> 对象，包括 <code class="docutils literal notranslate"><span class="pre">ipaddress.IPv4Network</span></code>， <code class="docutils literal notranslate"><span class="pre">ipaddress.IPv6Network</span></code> ， <code class="docutils literal notranslate"><span class="pre">ipaddress.IPv4Address</span></code> ， <code class="docutils literal notranslate"><span class="pre">ipaddress.IPv6Address</span></code> 。此支持目前是 <strong>DBAPI本身的默认行为，并且因DBAPI而异。SQLAlchemy尚未实现自己的网络地址转换逻辑</strong>。</p>
<ul class="simple">
<li><p><a class="reference internal" href="#postgresql-psycopg"><span class="std std-ref">psycopg</span></a> 和 <a class="reference internal" href="#postgresql-asyncpg"><span class="std std-ref">asyncpg</span></a> 完全支持这些数据类型；默认情况下，来自 <code class="docutils literal notranslate"><span class="pre">ipaddress</span></code> 系列的对象会在行中返回。</p></li>
<li><p><a class="reference internal" href="#postgresql-psycopg2"><span class="std std-ref">psycopg2</span></a> 方言仅发送和接收字符串。</p></li>
<li><p><a class="reference internal" href="#postgresql-pg8000"><span class="std std-ref">pg8000</span></a> 方言支持 <a class="reference internal" href="#sqlalchemy.dialects.postgresql.INET" title="sqlalchemy.dialects.postgresql.INET"><code class="xref py py-class docutils literal notranslate"><span class="pre">INET</span></code></a> 数据类型的 <code class="docutils literal notranslate"><span class="pre">ipaddress.IPv4Address</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ipaddress.IPv6Address</span></code> 对象，但对 <a class="reference internal" href="#sqlalchemy.dialects.postgresql.CIDR" title="sqlalchemy.dialects.postgresql.CIDR"><code class="xref py py-class docutils literal notranslate"><span class="pre">CIDR</span></code></a> 类型使用字符串。</p></li>
</ul>
<p>要 <strong>将所有上述DBAPI标准化为只返回字符串</strong>，请使用 <code class="docutils literal notranslate"><span class="pre">native_inet_types</span></code> 参数，并传递值 <code class="docutils literal notranslate"><span class="pre">False</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg://scott:tiger@host/dbname&quot;</span><span class="p">,</span> <span class="n">native_inet_types</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span></pre></div>
</div>
<p>使用上述参数， <code class="docutils literal notranslate"><span class="pre">psycopg</span></code>、 <code class="docutils literal notranslate"><span class="pre">asyncpg</span></code> 和 <code class="docutils literal notranslate"><span class="pre">pg8000</span></code> 方言将禁用DBAPI对这些类型的适配，并仅返回字符串，匹配旧的 <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code> 方言的行为。</p>
<p>该参数也可以设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code> ，此时对于那些不支持或尚未完全支持将行转换为Python <code class="docutils literal notranslate"><span class="pre">ipaddress</span></code> 数据类型的后端（目前是psycopg2和pg8000），将引发 <code class="docutils literal notranslate"><span class="pre">NotImplementedError</span></code> 。</p>
</div>
<input class="tab-input" id="tab-set--9-input--2" name="tab-set--9" type="radio"><label class="tab-label" for="tab-set--9-input--2">英文</label><div class="tab-content docutils container">
<p>The included networking datatypes are <a class="reference internal" href="#sqlalchemy.dialects.postgresql.INET" title="sqlalchemy.dialects.postgresql.INET"><code class="xref py py-class docutils literal notranslate"><span class="pre">INET</span></code></a>,
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.CIDR" title="sqlalchemy.dialects.postgresql.CIDR"><code class="xref py py-class docutils literal notranslate"><span class="pre">CIDR</span></code></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.MACADDR" title="sqlalchemy.dialects.postgresql.MACADDR"><code class="xref py py-class docutils literal notranslate"><span class="pre">MACADDR</span></code></a>.</p>
<p>For <a class="reference internal" href="#sqlalchemy.dialects.postgresql.INET" title="sqlalchemy.dialects.postgresql.INET"><code class="xref py py-class docutils literal notranslate"><span class="pre">INET</span></code></a> and <a class="reference internal" href="#sqlalchemy.dialects.postgresql.CIDR" title="sqlalchemy.dialects.postgresql.CIDR"><code class="xref py py-class docutils literal notranslate"><span class="pre">CIDR</span></code></a> datatypes,
conditional support is available for these datatypes to send and retrieve
Python <code class="docutils literal notranslate"><span class="pre">ipaddress</span></code> objects including <code class="docutils literal notranslate"><span class="pre">ipaddress.IPv4Network</span></code>,
<code class="docutils literal notranslate"><span class="pre">ipaddress.IPv6Network</span></code>, <code class="docutils literal notranslate"><span class="pre">ipaddress.IPv4Address</span></code>,
<code class="docutils literal notranslate"><span class="pre">ipaddress.IPv6Address</span></code>.  This support is currently <strong>the default behavior of
the DBAPI itself, and varies per DBAPI.  SQLAlchemy does not yet implement its
own network address conversion logic</strong>.</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="#postgresql-psycopg"><span class="std std-ref">psycopg</span></a> and <a class="reference internal" href="#postgresql-asyncpg"><span class="std std-ref">asyncpg</span></a> support these</p></li>
</ul>
<p>datatypes fully; objects from the <code class="docutils literal notranslate"><span class="pre">ipaddress</span></code> family are returned in rows
by default.
* The <a class="reference internal" href="#postgresql-psycopg2"><span class="std std-ref">psycopg2</span></a> dialect only sends and receives strings.
* The <a class="reference internal" href="#postgresql-pg8000"><span class="std std-ref">pg8000</span></a> dialect supports <code class="docutils literal notranslate"><span class="pre">ipaddress.IPv4Address</span></code> and
<code class="docutils literal notranslate"><span class="pre">ipaddress.IPv6Address</span></code> objects for the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.INET" title="sqlalchemy.dialects.postgresql.INET"><code class="xref py py-class docutils literal notranslate"><span class="pre">INET</span></code></a> datatype,
but uses strings for <a class="reference internal" href="#sqlalchemy.dialects.postgresql.CIDR" title="sqlalchemy.dialects.postgresql.CIDR"><code class="xref py py-class docutils literal notranslate"><span class="pre">CIDR</span></code></a> types.</p>
<p>To <strong>normalize all the above DBAPIs to only return strings</strong>, use the
<code class="docutils literal notranslate"><span class="pre">native_inet_types</span></code> parameter, passing a value of <code class="docutils literal notranslate"><span class="pre">False</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg://scott:tiger@host/dbname&quot;</span><span class="p">,</span> <span class="n">native_inet_types</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span></pre></div>
</div>
<p>With the above parameter, the <code class="docutils literal notranslate"><span class="pre">psycopg</span></code>, <code class="docutils literal notranslate"><span class="pre">asyncpg</span></code> and <code class="docutils literal notranslate"><span class="pre">pg8000</span></code> dialects
will disable the DBAPI’s adaptation of these types and will return only strings,
matching the behavior of the older <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code> dialect.</p>
<p>The parameter may also be set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, where it will have the effect of
raising <code class="docutils literal notranslate"><span class="pre">NotImplementedError</span></code> for those backends that don’t support, or
don’t yet fully support, conversion of rows to Python <code class="docutils literal notranslate"><span class="pre">ipaddress</span></code> datatypes
(currently psycopg2 and pg8000).</p>
</div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.18 版本加入: </span>- added the <code class="docutils literal notranslate"><span class="pre">native_inet_types</span></code> parameter.</p>
</div>
</section>
<section id="id9">
<h2>PostgreSQL 数据类型<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h2>
<p>PostgreSQL Data Types</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--10-input--1" name="tab-set--10" type="radio"><label class="tab-label" for="tab-set--10-input--1">中文</label><div class="tab-content docutils container">
<p>与所有SQLAlchemy方言一样，所有已知对PostgreSQL有效的UPPERCASE类型都可以从顶级方言中导入，无论它们是来自 <a class="reference internal" href="../core/type_basics.html#module-sqlalchemy.types" title="sqlalchemy.types"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlalchemy.types</span></code></a> 还是来自本地方言:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ARRAY</span><span class="p">,</span>
    <span class="n">BIGINT</span><span class="p">,</span>
    <span class="n">BIT</span><span class="p">,</span>
    <span class="n">BOOLEAN</span><span class="p">,</span>
    <span class="n">BYTEA</span><span class="p">,</span>
    <span class="n">CHAR</span><span class="p">,</span>
    <span class="n">CIDR</span><span class="p">,</span>
    <span class="n">CITEXT</span><span class="p">,</span>
    <span class="n">DATE</span><span class="p">,</span>
    <span class="n">DATEMULTIRANGE</span><span class="p">,</span>
    <span class="n">DATERANGE</span><span class="p">,</span>
    <span class="n">DOMAIN</span><span class="p">,</span>
    <span class="n">DOUBLE_PRECISION</span><span class="p">,</span>
    <span class="n">ENUM</span><span class="p">,</span>
    <span class="n">FLOAT</span><span class="p">,</span>
    <span class="n">HSTORE</span><span class="p">,</span>
    <span class="n">INET</span><span class="p">,</span>
    <span class="n">INT4MULTIRANGE</span><span class="p">,</span>
    <span class="n">INT4RANGE</span><span class="p">,</span>
    <span class="n">INT8MULTIRANGE</span><span class="p">,</span>
    <span class="n">INT8RANGE</span><span class="p">,</span>
    <span class="n">INTEGER</span><span class="p">,</span>
    <span class="n">INTERVAL</span><span class="p">,</span>
    <span class="n">JSON</span><span class="p">,</span>
    <span class="n">JSONB</span><span class="p">,</span>
    <span class="n">JSONPATH</span><span class="p">,</span>
    <span class="n">MACADDR</span><span class="p">,</span>
    <span class="n">MACADDR8</span><span class="p">,</span>
    <span class="n">MONEY</span><span class="p">,</span>
    <span class="n">NUMERIC</span><span class="p">,</span>
    <span class="n">NUMMULTIRANGE</span><span class="p">,</span>
    <span class="n">NUMRANGE</span><span class="p">,</span>
    <span class="n">OID</span><span class="p">,</span>
    <span class="n">REAL</span><span class="p">,</span>
    <span class="n">REGCLASS</span><span class="p">,</span>
    <span class="n">REGCONFIG</span><span class="p">,</span>
    <span class="n">SMALLINT</span><span class="p">,</span>
    <span class="n">TEXT</span><span class="p">,</span>
    <span class="n">TIME</span><span class="p">,</span>
    <span class="n">TIMESTAMP</span><span class="p">,</span>
    <span class="n">TSMULTIRANGE</span><span class="p">,</span>
    <span class="n">TSQUERY</span><span class="p">,</span>
    <span class="n">TSRANGE</span><span class="p">,</span>
    <span class="n">TSTZMULTIRANGE</span><span class="p">,</span>
    <span class="n">TSTZRANGE</span><span class="p">,</span>
    <span class="n">TSVECTOR</span><span class="p">,</span>
    <span class="n">UUID</span><span class="p">,</span>
    <span class="n">VARCHAR</span><span class="p">,</span>
<span class="p">)</span></pre></div>
</div>
<p>特定于PostgreSQL或具有PostgreSQL特定构造参数的类型如下：</p>
</div>
<input class="tab-input" id="tab-set--10-input--2" name="tab-set--10" type="radio"><label class="tab-label" for="tab-set--10-input--2">英文</label><div class="tab-content docutils container">
<p>As with all SQLAlchemy dialects, all UPPERCASE types that are known to be
valid with PostgreSQL are importable from the top level dialect, whether
they originate from <a class="reference internal" href="../core/type_basics.html#module-sqlalchemy.types" title="sqlalchemy.types"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlalchemy.types</span></code></a> or from the local dialect:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ARRAY</span><span class="p">,</span>
    <span class="n">BIGINT</span><span class="p">,</span>
    <span class="n">BIT</span><span class="p">,</span>
    <span class="n">BOOLEAN</span><span class="p">,</span>
    <span class="n">BYTEA</span><span class="p">,</span>
    <span class="n">CHAR</span><span class="p">,</span>
    <span class="n">CIDR</span><span class="p">,</span>
    <span class="n">CITEXT</span><span class="p">,</span>
    <span class="n">DATE</span><span class="p">,</span>
    <span class="n">DATEMULTIRANGE</span><span class="p">,</span>
    <span class="n">DATERANGE</span><span class="p">,</span>
    <span class="n">DOMAIN</span><span class="p">,</span>
    <span class="n">DOUBLE_PRECISION</span><span class="p">,</span>
    <span class="n">ENUM</span><span class="p">,</span>
    <span class="n">FLOAT</span><span class="p">,</span>
    <span class="n">HSTORE</span><span class="p">,</span>
    <span class="n">INET</span><span class="p">,</span>
    <span class="n">INT4MULTIRANGE</span><span class="p">,</span>
    <span class="n">INT4RANGE</span><span class="p">,</span>
    <span class="n">INT8MULTIRANGE</span><span class="p">,</span>
    <span class="n">INT8RANGE</span><span class="p">,</span>
    <span class="n">INTEGER</span><span class="p">,</span>
    <span class="n">INTERVAL</span><span class="p">,</span>
    <span class="n">JSON</span><span class="p">,</span>
    <span class="n">JSONB</span><span class="p">,</span>
    <span class="n">JSONPATH</span><span class="p">,</span>
    <span class="n">MACADDR</span><span class="p">,</span>
    <span class="n">MACADDR8</span><span class="p">,</span>
    <span class="n">MONEY</span><span class="p">,</span>
    <span class="n">NUMERIC</span><span class="p">,</span>
    <span class="n">NUMMULTIRANGE</span><span class="p">,</span>
    <span class="n">NUMRANGE</span><span class="p">,</span>
    <span class="n">OID</span><span class="p">,</span>
    <span class="n">REAL</span><span class="p">,</span>
    <span class="n">REGCLASS</span><span class="p">,</span>
    <span class="n">REGCONFIG</span><span class="p">,</span>
    <span class="n">SMALLINT</span><span class="p">,</span>
    <span class="n">TEXT</span><span class="p">,</span>
    <span class="n">TIME</span><span class="p">,</span>
    <span class="n">TIMESTAMP</span><span class="p">,</span>
    <span class="n">TSMULTIRANGE</span><span class="p">,</span>
    <span class="n">TSQUERY</span><span class="p">,</span>
    <span class="n">TSRANGE</span><span class="p">,</span>
    <span class="n">TSTZMULTIRANGE</span><span class="p">,</span>
    <span class="n">TSTZRANGE</span><span class="p">,</span>
    <span class="n">TSVECTOR</span><span class="p">,</span>
    <span class="n">UUID</span><span class="p">,</span>
    <span class="n">VARCHAR</span><span class="p">,</span>
<span class="p">)</span></pre></div>
</div>
<p>Types which are specific to PostgreSQL, or have PostgreSQL-specific
construction arguments, are as follows:</p>
</div>
</div>
<div class="table-wrapper longtable docutils container">
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractMultiRange"><span class="sig-name descname">AbstractMultiRange</span></a></p></td>
<td><p>Base for PostgreSQL MULTIRANGE types.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange"><span class="sig-name descname">AbstractRange</span></a></p></td>
<td><p>Base class for single and multi Range SQL types.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractSingleRange"><span class="sig-name descname">AbstractSingleRange</span></a></p></td>
<td><p>Base for PostgreSQL RANGE types.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY"><span class="sig-name descname">ARRAY</span></a></p></td>
<td><p>PostgreSQL ARRAY type.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.BIT"><span class="sig-name descname">BIT</span></a></p></td>
<td></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.BYTEA"><span class="sig-name descname">BYTEA</span></a></p></td>
<td></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.CIDR"><span class="sig-name descname">CIDR</span></a></p></td>
<td></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.CITEXT"><span class="sig-name descname">CITEXT</span></a></p></td>
<td><p>Provide the PostgreSQL CITEXT type.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.DATEMULTIRANGE"><span class="sig-name descname">DATEMULTIRANGE</span></a></p></td>
<td><p>Represent the PostgreSQL DATEMULTIRANGE type.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.DATERANGE"><span class="sig-name descname">DATERANGE</span></a></p></td>
<td><p>Represent the PostgreSQL DATERANGE type.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN"><span class="sig-name descname">DOMAIN</span></a></p></td>
<td><p>Represent the DOMAIN PostgreSQL type.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM"><span class="sig-name descname">ENUM</span></a></p></td>
<td><p>PostgreSQL ENUM type.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE"><span class="sig-name descname">HSTORE</span></a></p></td>
<td><p>Represent the PostgreSQL HSTORE type.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INET"><span class="sig-name descname">INET</span></a></p></td>
<td></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT4MULTIRANGE"><span class="sig-name descname">INT4MULTIRANGE</span></a></p></td>
<td><p>Represent the PostgreSQL INT4MULTIRANGE type.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT4RANGE"><span class="sig-name descname">INT4RANGE</span></a></p></td>
<td><p>Represent the PostgreSQL INT4RANGE type.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT8MULTIRANGE"><span class="sig-name descname">INT8MULTIRANGE</span></a></p></td>
<td><p>Represent the PostgreSQL INT8MULTIRANGE type.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT8RANGE"><span class="sig-name descname">INT8RANGE</span></a></p></td>
<td><p>Represent the PostgreSQL INT8RANGE type.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INTERVAL"><span class="sig-name descname">INTERVAL</span></a></p></td>
<td><p>PostgreSQL INTERVAL type.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON"><span class="sig-name descname">JSON</span></a></p></td>
<td><p>Represent the PostgreSQL JSON type.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB"><span class="sig-name descname">JSONB</span></a></p></td>
<td><p>Represent the PostgreSQL JSONB type.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONPATH"><span class="sig-name descname">JSONPATH</span></a></p></td>
<td><p>JSON Path Type.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.MACADDR"><span class="sig-name descname">MACADDR</span></a></p></td>
<td></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.MACADDR8"><span class="sig-name descname">MACADDR8</span></a></p></td>
<td></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.MONEY"><span class="sig-name descname">MONEY</span></a></p></td>
<td><p>Provide the PostgreSQL MONEY type.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.MultiRange"><span class="sig-name descname">MultiRange</span></a></p></td>
<td><p>Represents a multirange sequence.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.NUMMULTIRANGE"><span class="sig-name descname">NUMMULTIRANGE</span></a></p></td>
<td><p>Represent the PostgreSQL NUMMULTIRANGE type.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.NUMRANGE"><span class="sig-name descname">NUMRANGE</span></a></p></td>
<td><p>Represent the PostgreSQL NUMRANGE type.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.OID"><span class="sig-name descname">OID</span></a></p></td>
<td><p>Provide the PostgreSQL OID type.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.REGCLASS"><span class="sig-name descname">REGCLASS</span></a></p></td>
<td><p>Provide the PostgreSQL REGCLASS type.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.REGCONFIG"><span class="sig-name descname">REGCONFIG</span></a></p></td>
<td><p>Provide the PostgreSQL REGCONFIG type.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TIME"><span class="sig-name descname">TIME</span></a></p></td>
<td><p>PostgreSQL TIME type.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TIMESTAMP"><span class="sig-name descname">TIMESTAMP</span></a></p></td>
<td><p>Provide the PostgreSQL TIMESTAMP type.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSMULTIRANGE"><span class="sig-name descname">TSMULTIRANGE</span></a></p></td>
<td><p>Represent the PostgreSQL TSRANGE type.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSQUERY"><span class="sig-name descname">TSQUERY</span></a></p></td>
<td><p>Provide the PostgreSQL TSQUERY type.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSRANGE"><span class="sig-name descname">TSRANGE</span></a></p></td>
<td><p>Represent the PostgreSQL TSRANGE type.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSTZMULTIRANGE"><span class="sig-name descname">TSTZMULTIRANGE</span></a></p></td>
<td><p>Represent the PostgreSQL TSTZRANGE type.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSTZRANGE"><span class="sig-name descname">TSTZRANGE</span></a></p></td>
<td><p>Represent the PostgreSQL TSTZRANGE type.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSVECTOR"><span class="sig-name descname">TSVECTOR</span></a></p></td>
<td><p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSVECTOR" title="sqlalchemy.dialects.postgresql.TSVECTOR"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSVECTOR</span></code></a> type implements the PostgreSQL
text search type TSVECTOR.</p></td>
</tr>
</tbody>
</table>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.AbstractRange">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">AbstractRange</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.AbstractRange" title="Link to this definition">¶</a></dt>
<dd><p>Base class for single and multi Range SQL types.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.adjacent_to"><span class="sig-name descname">adjacent_to()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.contained_by"><span class="sig-name descname">contained_by()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.contains"><span class="sig-name descname">contains()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.difference"><span class="sig-name descname">difference()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.intersection"><span class="sig-name descname">intersection()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.not_extend_left_of"><span class="sig-name descname">not_extend_left_of()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.not_extend_right_of"><span class="sig-name descname">not_extend_right_of()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.overlaps"><span class="sig-name descname">overlaps()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.strictly_left_of"><span class="sig-name descname">strictly_left_of()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.strictly_right_of"><span class="sig-name descname">strictly_right_of()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.union"><span class="sig-name descname">union()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange" title="sqlalchemy.dialects.postgresql.AbstractRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.AbstractRange</span></code></a> (<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">comparator_factory</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory" title="Link to this definition">¶</a></dt>
<dd><p>Define comparison operations for range types.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory" title="sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Comparator</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.adjacent_to">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.</span></code></a><span class="sig-name descname"><span class="pre">adjacent_to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.adjacent_to" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression. Returns true if the range in the column
is adjacent to the range in the operand.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.contained_by">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.</span></code></a><span class="sig-name descname"><span class="pre">contained_by</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.contained_by" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression. Returns true if the column is contained
within the right hand operand.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.contains">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.</span></code></a><span class="sig-name descname"><span class="pre">contains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.contains" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression. Returns true if the right hand operand,
which can be an element or a range, is contained within the
column.</p>
<p>kwargs may be ignored by this operator but are required for API
conformance.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.difference">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.</span></code></a><span class="sig-name descname"><span class="pre">difference</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.difference" title="Link to this definition">¶</a></dt>
<dd><p>Range expression. Returns the union of the two ranges.
Will raise an exception if the resulting range is not
contiguous.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.intersection">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.</span></code></a><span class="sig-name descname"><span class="pre">intersection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><span class="pre">Range</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.intersection" title="Link to this definition">¶</a></dt>
<dd><p>Range expression. Returns the intersection of the two ranges.
Will raise an exception if the resulting range is not
contiguous.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.not_extend_left_of">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.</span></code></a><span class="sig-name descname"><span class="pre">not_extend_left_of</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.not_extend_left_of" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression. Returns true if the range in the column
does not extend left of the range in the operand.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.not_extend_right_of">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.</span></code></a><span class="sig-name descname"><span class="pre">not_extend_right_of</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.not_extend_right_of" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression. Returns true if the range in the column
does not extend right of the range in the operand.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.overlaps">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.</span></code></a><span class="sig-name descname"><span class="pre">overlaps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.overlaps" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression. Returns true if the column overlaps
(has points in common with) the right hand operand.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.strictly_left_of">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.</span></code></a><span class="sig-name descname"><span class="pre">strictly_left_of</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.strictly_left_of" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression. Returns true if the column is strictly
left of the right hand operand.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.strictly_right_of">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.</span></code></a><span class="sig-name descname"><span class="pre">strictly_right_of</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.strictly_right_of" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression. Returns true if the column is strictly
right of the right hand operand.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.union">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.</span></code></a><span class="sig-name descname"><span class="pre">union</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.union" title="Link to this definition">¶</a></dt>
<dd><p>Range expression. Returns the union of the two ranges.
Will raise an exception if the resulting range is not
contiguous.</p>
</dd></dl>

</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.AbstractSingleRange">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">AbstractSingleRange</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.AbstractSingleRange" title="Link to this definition">¶</a></dt>
<dd><p>Base for PostgreSQL RANGE types.</p>
<p>These are types that return a single <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a> object.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference external" href="https://www.postgresql.org/docs/current/static/functions-range.html">PostgreSQL range functions</a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractSingleRange" title="sqlalchemy.dialects.postgresql.AbstractSingleRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.AbstractSingleRange</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange" title="sqlalchemy.dialects.postgresql.ranges.AbstractRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.AbstractRange</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.AbstractMultiRange">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">AbstractMultiRange</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.AbstractMultiRange" title="Link to this definition">¶</a></dt>
<dd><p>Base for PostgreSQL MULTIRANGE types.</p>
<p>these are types that return a sequence of <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range" title="sqlalchemy.dialects.postgresql.Range"><code class="xref py py-class docutils literal notranslate"><span class="pre">Range</span></code></a>
objects.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractMultiRange" title="sqlalchemy.dialects.postgresql.AbstractMultiRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.AbstractMultiRange</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange" title="sqlalchemy.dialects.postgresql.ranges.AbstractRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.AbstractRange</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ARRAY">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">ARRAY</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ARRAY" title="Link to this definition">¶</a></dt>
<dd><p>PostgreSQL ARRAY type.</p>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> type is constructed in the same way
as the core <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> type; a member type is required, and a
number of dimensions is recommended if the type is to be used for more
than one dimension:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects</span><span class="w"> </span><span class="kn">import</span> <span class="n">postgresql</span>

<span class="n">mytable</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;mytable&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">postgresql</span><span class="o">.</span><span class="n">ARRAY</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
<span class="p">)</span></pre></div>
</div>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> type provides all operations defined on the
core <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> type, including support for “dimensions”,
indexed access, and simple matching such as
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY.Comparator.any" title="sqlalchemy.types.ARRAY.Comparator.any"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.any()</span></code></a> and
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY.Comparator.all" title="sqlalchemy.types.ARRAY.Comparator.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.all()</span></code></a>.  <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a>
class also
provides PostgreSQL-specific methods for containment operations, including
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator.contains" title="sqlalchemy.dialects.postgresql.ARRAY.Comparator.contains"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.contains()</span></code></a>
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator.contained_by" title="sqlalchemy.dialects.postgresql.ARRAY.Comparator.contained_by"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.contained_by()</span></code></a>, and
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator.overlap" title="sqlalchemy.dialects.postgresql.ARRAY.Comparator.overlap"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.overlap()</span></code></a>, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">contains</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span></pre></div>
</div>
<p>Indexed access is one-based by default, to match that of PostgreSQL;
for zero-based indexed access, set
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.params.zero_indexes" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ARRAY.zero_indexes</span></code></a>.</p>
<p>Additionally, the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a>
type does not work directly in
conjunction with the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a> type.  For a workaround, see the
special type at <a class="reference internal" href="#postgresql-array-of-enum"><span class="std std-ref">将 ENUM 与 ARRAY 结合使用</span></a>.</p>
<div class="topic docutils container">
<p><strong>Detecting Changes in ARRAY columns when using the ORM</strong></p>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> type, when used with the SQLAlchemy ORM,
does not detect in-place mutations to the array. In order to detect
these, the <a class="reference internal" href="../orm/extensions/mutable.html#module-sqlalchemy.ext.mutable" title="sqlalchemy.ext.mutable"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlalchemy.ext.mutable</span></code></a> extension must be used, using
the <a class="reference internal" href="../orm/extensions/mutable.html#sqlalchemy.ext.mutable.MutableList" title="sqlalchemy.ext.mutable.MutableList"><code class="xref py py-class docutils literal notranslate"><span class="pre">MutableList</span></code></a> class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">ARRAY</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.mutable</span><span class="w"> </span><span class="kn">import</span> <span class="n">MutableList</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SomeOrmClass</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">MutableList</span><span class="o">.</span><span class="n">as_mutable</span><span class="p">(</span><span class="n">ARRAY</span><span class="p">(</span><span class="n">Integer</span><span class="p">)))</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>This extension will allow “in-place” changes such to the array
such as <code class="docutils literal notranslate"><span class="pre">.append()</span></code> to produce events which will be detected by the
unit of work.  Note that changes to elements <strong>inside</strong> the array,
including subarrays that are mutated in place, are <strong>not</strong> detected.</p>
<p>Alternatively, assigning a new array value to an ORM element that
replaces the old one will always trigger a change event.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> - base array type</p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.array" title="sqlalchemy.dialects.postgresql.array"><code class="xref py py-class docutils literal notranslate"><span class="pre">array</span></code></a> - produces a literal array value.</p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.__init__"><span class="sig-name descname">__init__()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator.contains"><span class="sig-name descname">contains()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator.contained_by"><span class="sig-name descname">contained_by()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator.overlap"><span class="sig-name descname">overlap()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ARRAY</span></code></a> (<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.ARRAY</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ARRAY.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ARRAY.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">item_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_TypeEngineArgument</span><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">as_tuple</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dimensions</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zero_indexes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ARRAY.__init__" title="Link to this definition">¶</a></dt>
<dd><p>Construct an ARRAY.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Column</span><span class="p">(</span><span class="s2">&quot;myarray&quot;</span><span class="p">,</span> <span class="n">ARRAY</span><span class="p">(</span><span class="n">Integer</span><span class="p">))</span></pre></div>
</div>
<p>Arguments are:</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ARRAY.params.item_type"></span><strong>item_type</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.params.item_type">¶</a> – The data type of items of this array. Note that
dimensionality is irrelevant here, so multi-dimensional arrays like
<code class="docutils literal notranslate"><span class="pre">INTEGER[][]</span></code>, are constructed as <code class="docutils literal notranslate"><span class="pre">ARRAY(Integer)</span></code>, not as
<code class="docutils literal notranslate"><span class="pre">ARRAY(ARRAY(Integer))</span></code> or such.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ARRAY.params.as_tuple"></span><strong>as_tuple=False</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.params.as_tuple">¶</a> – Specify whether return results
should be converted to tuples from lists. DBAPIs such
as psycopg2 return lists by default. When tuples are
returned, the results are hashable.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ARRAY.params.dimensions"></span><strong>dimensions</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.params.dimensions">¶</a> – if non-None, the ARRAY will assume a fixed
number of dimensions.  This will cause the DDL emitted for this
ARRAY to include the exact number of bracket clauses <code class="docutils literal notranslate"><span class="pre">[]</span></code>,
and will also optimize the performance of the type overall.
Note that PG arrays are always implicitly “non-dimensioned”,
meaning they can store any number of dimensions no matter how
they were declared.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ARRAY.params.zero_indexes"></span><strong>zero_indexes=False</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.params.zero_indexes">¶</a> – when True, index values will be converted
between Python zero-based and PostgreSQL one-based indexes, e.g.
a value of one will be added to all index values before passing
to the database.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ARRAY.Comparator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Comparator</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator" title="Link to this definition">¶</a></dt>
<dd><p>Define comparison operations for <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a>.</p>
<p>Note that these operations are in addition to those provided
by the base <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY.Comparator" title="sqlalchemy.types.ARRAY.Comparator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Comparator</span></code></a> class, including
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY.Comparator.any" title="sqlalchemy.types.ARRAY.Comparator.any"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.any()</span></code></a> and
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY.Comparator.all" title="sqlalchemy.types.ARRAY.Comparator.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.all()</span></code></a>.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator" title="sqlalchemy.dialects.postgresql.ARRAY.Comparator"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ARRAY.Comparator</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Comparator</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ARRAY.Comparator.contains">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ARRAY.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">contains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">typing_Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">typing_Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator.contains" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test if elements are a superset of the
elements of the argument array expression.</p>
<p>kwargs may be ignored by this operator but are required for API
conformance.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ARRAY.Comparator.contained_by">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ARRAY.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">contained_by</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">typing_Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator.contained_by" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test if elements are a proper subset of the
elements of the argument array expression.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ARRAY.Comparator.overlap">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ARRAY.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">overlap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">typing_Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator.overlap" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test if array has elements in common with
an argument array expression.</p>
</dd></dl>

</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.BIT">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">BIT</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.BIT" title="Link to this definition">¶</a></dt>
<dd><div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.BIT" title="sqlalchemy.dialects.postgresql.BIT"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.BIT</span></code></a> (<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.BYTEA">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">BYTEA</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.BYTEA" title="Link to this definition">¶</a></dt>
<dd><div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.BYTEA.__init__"><span class="sig-name descname">__init__()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.BYTEA" title="sqlalchemy.dialects.postgresql.BYTEA"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.BYTEA</span></code></a> (<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.LargeBinary" title="sqlalchemy.types.LargeBinary"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.LargeBinary</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.BYTEA.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.BYTEA"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.BYTEA.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.BYTEA.__init__" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.types.LargeBinary.__init__</span></code> <em>method of</em> <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.LargeBinary" title="sqlalchemy.types.LargeBinary"><code class="xref py py-class docutils literal notranslate"><span class="pre">LargeBinary</span></code></a></p>
</div>
<p>Construct a LargeBinary type.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.dialects.postgresql.BYTEA.params.length"></span><strong>length</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.BYTEA.params.length">¶</a> – optional, a length for the column for use in
DDL statements, for those binary types that accept a length,
such as the MySQL BLOB type.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.CIDR">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">CIDR</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.CIDR" title="Link to this definition">¶</a></dt>
<dd><div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.CIDR" title="sqlalchemy.dialects.postgresql.CIDR"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.CIDR</span></code></a> (<code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.types._NetworkAddressTypeMixin</span></code>, <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.CITEXT">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">CITEXT</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.CITEXT" title="Link to this definition">¶</a></dt>
<dd><p>Provide the PostgreSQL CITEXT type.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.7 版本加入.</span></p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.CITEXT.__init__"><span class="sig-name descname">__init__()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.CITEXT" title="sqlalchemy.dialects.postgresql.CITEXT"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.CITEXT</span></code></a> (<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.TEXT" title="sqlalchemy.types.TEXT"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TEXT</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.CITEXT.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.CITEXT"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.CITEXT.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">length</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.CITEXT.__init__" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.types.String.__init__</span></code> <em>method of</em> <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.String" title="sqlalchemy.types.String"><code class="xref py py-class docutils literal notranslate"><span class="pre">String</span></code></a></p>
</div>
<p>Create a string-holding type.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.CITEXT.params.length"></span><strong>length</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.CITEXT.params.length">¶</a> – optional, a length for the column for use in
DDL and CAST expressions.  May be safely omitted if no <code class="docutils literal notranslate"><span class="pre">CREATE</span>
<span class="pre">TABLE</span></code> will be issued.  Certain databases may require a
<code class="docutils literal notranslate"><span class="pre">length</span></code> for use in DDL, and will raise an exception when
the <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span></code> DDL is issued if a <code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code>
with no length is included.  Whether the value is
interpreted as bytes or characters is database specific.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.CITEXT.params.collation"></span><strong>collation</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.CITEXT.params.collation">¶</a> – <p>Optional, a column-level collation for
use in DDL and CAST expressions.  Renders using the
COLLATE keyword supported by SQLite, MySQL, and PostgreSQL.
E.g.:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">cast</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="n">String</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;some string&quot;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="n">collation</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">))))</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="k">CAST</span><span class="p">(:</span><span class="n">param_1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="k">COLLATE</span><span class="w"> </span><span class="n">utf8</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">anon_1</span>
</div></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>In most cases, the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Unicode" title="sqlalchemy.types.Unicode"><code class="xref py py-class docutils literal notranslate"><span class="pre">Unicode</span></code></a> or <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.UnicodeText" title="sqlalchemy.types.UnicodeText"><code class="xref py py-class docutils literal notranslate"><span class="pre">UnicodeText</span></code></a>
datatypes should be used for a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> that expects
to store non-ascii data. These datatypes will ensure that the
correct types are used on the database.</p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.DOMAIN">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">DOMAIN</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.DOMAIN" title="Link to this definition">¶</a></dt>
<dd><p>Represent the DOMAIN PostgreSQL type.</p>
<p>A domain is essentially a data type with optional constraints
that restrict the allowed set of values. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PositiveInt</span> <span class="o">=</span> <span class="n">DOMAIN</span><span class="p">(</span><span class="s2">&quot;pos_int&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="s2">&quot;VALUE &gt; 0&quot;</span><span class="p">,</span> <span class="n">not_null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">UsPostalCode</span> <span class="o">=</span> <span class="n">DOMAIN</span><span class="p">(</span>
    <span class="s2">&quot;us_postal_code&quot;</span><span class="p">,</span>
    <span class="n">Text</span><span class="p">,</span>
    <span class="n">check</span><span class="o">=</span><span class="s2">&quot;VALUE ~ &#39;^\d</span><span class="si">{5}</span><span class="s2">$&#39; OR VALUE ~ &#39;^\d</span><span class="si">{5}</span><span class="s2">-\d</span><span class="si">{4}</span><span class="s2">$&#39;&quot;</span><span class="p">,</span>
<span class="p">)</span></pre></div>
</div>
<p>See the <a class="reference external" href="https://www.postgresql.org/docs/current/sql-createdomain.html">PostgreSQL documentation</a> for additional details</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN.__init__"><span class="sig-name descname">__init__()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN.create"><span class="sig-name descname">create()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN.drop"><span class="sig-name descname">drop()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN" title="sqlalchemy.dialects.postgresql.DOMAIN"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.DOMAIN</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.named_types.NamedType</span></code>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.SchemaType" title="sqlalchemy.types.SchemaType"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.SchemaType</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.DOMAIN.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.DOMAIN.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_TypeEngineArgument</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.TextClause" title="sqlalchemy.sql.elements.TextClause"><span class="pre">elements.TextClause</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">constraint_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">not_null</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">check</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.TextClause" title="sqlalchemy.sql.elements.TextClause"><span class="pre">elements.TextClause</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">create_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.DOMAIN.__init__" title="Link to this definition">¶</a></dt>
<dd><p>Construct a DOMAIN.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.DOMAIN.params.name"></span><strong>name</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN.params.name">¶</a> – the name of the domain</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.DOMAIN.params.data_type"></span><strong>data_type</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN.params.data_type">¶</a> – The underlying data type of the domain.
This can include array specifiers.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.DOMAIN.params.collation"></span><strong>collation</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN.params.collation">¶</a> – An optional collation for the domain.
If no collation is specified, the underlying data type’s default
collation is used. The underlying type must be collatable if
<code class="docutils literal notranslate"><span class="pre">collation</span></code> is specified.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.DOMAIN.params.default"></span><strong>default</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN.params.default">¶</a> – The DEFAULT clause specifies a default value for
columns of the domain data type. The default should be a string
or a <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.text" title="sqlalchemy.sql.expression.text"><code class="xref py py-func docutils literal notranslate"><span class="pre">text()</span></code></a> value.
If no default value is specified, then the default value is
the null value.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.DOMAIN.params.constraint_name"></span><strong>constraint_name</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN.params.constraint_name">¶</a> – An optional name for a constraint.
If not specified, the backend generates a name.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.DOMAIN.params.not_null"></span><strong>not_null</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN.params.not_null">¶</a> – Values of this domain are prevented from being null.
By default domain are allowed to be null. If not specified
no nullability clause will be emitted.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.DOMAIN.params.check"></span><strong>check</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN.params.check">¶</a> – CHECK clause specify integrity constraint or test
which values of the domain must satisfy. A constraint must be
an expression producing a Boolean result that can use the key
word VALUE to refer to the value being tested.
Differently from PostgreSQL, only a single check clause is
currently allowed in SQLAlchemy.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.DOMAIN.params.schema"></span><strong>schema</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN.params.schema">¶</a> – optional schema name</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.DOMAIN.params.metadata"></span><strong>metadata</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN.params.metadata">¶</a> – optional <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a> object which
this <a class="reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN" title="sqlalchemy.dialects.postgresql.DOMAIN"><code class="xref py py-class docutils literal notranslate"><span class="pre">DOMAIN</span></code></a> will be directly associated</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.DOMAIN.params.create_type"></span><strong>create_type</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN.params.create_type">¶</a> – Defaults to True.
Indicates that <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TYPE</span></code> should be emitted, after optionally
checking for the presence of the type, when the parent table is
being created; and additionally that <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TYPE</span></code> is called
when the table is dropped.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.DOMAIN.create">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.DOMAIN.</span></code></a><span class="sig-name descname"><span class="pre">create</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bind</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checkfirst</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.DOMAIN.create" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="xref py py-meth docutils literal notranslate"><span class="pre">NamedType.create()</span></code> <em>method of</em> <code class="xref py py-class docutils literal notranslate"><span class="pre">NamedType</span></code></p>
</div>
<p>Emit <code class="docutils literal notranslate"><span class="pre">CREATE</span></code> DDL for this type.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.DOMAIN.create.params.bind"></span><strong>bind</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN.create.params.bind">¶</a> – a connectable <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>,
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>, or similar object to emit
SQL.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.DOMAIN.create.params.checkfirst"></span><strong>checkfirst</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN.create.params.checkfirst">¶</a> – if <code class="docutils literal notranslate"><span class="pre">True</span></code>, a query against
the PG catalog will be first performed to see
if the type does not exist already before
creating.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.DOMAIN.drop">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.DOMAIN.</span></code></a><span class="sig-name descname"><span class="pre">drop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bind</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checkfirst</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.DOMAIN.drop" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="xref py py-meth docutils literal notranslate"><span class="pre">NamedType.drop()</span></code> <em>method of</em> <code class="xref py py-class docutils literal notranslate"><span class="pre">NamedType</span></code></p>
</div>
<p>Emit <code class="docutils literal notranslate"><span class="pre">DROP</span></code> DDL for this type.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.DOMAIN.drop.params.bind"></span><strong>bind</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN.drop.params.bind">¶</a> – a connectable <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>,
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>, or similar object to emit
SQL.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.DOMAIN.drop.params.checkfirst"></span><strong>checkfirst</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN.drop.params.checkfirst">¶</a> – if <code class="docutils literal notranslate"><span class="pre">True</span></code>, a query against
the PG catalog will be first performed to see
if the type actually exists before dropping.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">DOUBLE_PRECISION</span></span></dt>
<dd><p>The SQL DOUBLE PRECISION type.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Double" title="sqlalchemy.types.Double"><code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code></a> - documentation for the base type.</p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.DOUBLE_PRECISION</span></code> (<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Double" title="sqlalchemy.types.Double"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Double</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.DOUBLE_PRECISION"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.DOUBLE_PRECISION.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">precision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">asdecimal</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decimal_return_scale</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.types.Float.__init__</span></code> <em>method of</em> <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float</span></code></a></p>
</div>
<p>Construct a Float.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.DOUBLE_PRECISION.params.precision"></span><strong>precision</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.DOUBLE_PRECISION.params.precision">¶</a> – <p>the numeric precision for use in DDL <code class="docutils literal notranslate"><span class="pre">CREATE</span>
<span class="pre">TABLE</span></code>. Backends <strong>should</strong> attempt to ensure this precision
indicates a number of digits for the generic
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float</span></code></a> datatype.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>For the Oracle Database backend, the
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float.params.precision" title="sqlalchemy.types.Float"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Float.precision</span></code></a> parameter is not accepted
when rendering DDL, as Oracle Database does not support float precision
specified as a number of decimal places. Instead, use the
Oracle Database-specific <a class="reference internal" href="oracle.html#sqlalchemy.dialects.oracle.FLOAT" title="sqlalchemy.dialects.oracle.FLOAT"><code class="xref py py-class docutils literal notranslate"><span class="pre">FLOAT</span></code></a> datatype and specify the
<a class="reference internal" href="oracle.html#sqlalchemy.dialects.oracle.FLOAT.params.binary_precision" title="sqlalchemy.dialects.oracle.FLOAT"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">FLOAT.binary_precision</span></code></a> parameter. This is new
in version 2.0 of SQLAlchemy.</p>
<p>To create a database agnostic <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float</span></code></a> that
separately specifies binary precision for Oracle Database, use
<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeEngine.with_variant()</span></code></a> as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Column</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Float</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects</span><span class="w"> </span><span class="kn">import</span> <span class="n">oracle</span>

<span class="n">Column</span><span class="p">(</span>
    <span class="s2">&quot;float_data&quot;</span><span class="p">,</span>
    <span class="n">Float</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">with_variant</span><span class="p">(</span><span class="n">oracle</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">(</span><span class="n">binary_precision</span><span class="o">=</span><span class="mi">16</span><span class="p">),</span> <span class="s2">&quot;oracle&quot;</span><span class="p">),</span>
<span class="p">)</span></pre></div>
</div>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.DOUBLE_PRECISION.params.asdecimal"></span><strong>asdecimal</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.DOUBLE_PRECISION.params.asdecimal">¶</a> – the same flag as that of <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal notranslate"><span class="pre">Numeric</span></code></a>, but
defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.   Note that setting this flag to <code class="docutils literal notranslate"><span class="pre">True</span></code>
results in floating point conversion.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.DOUBLE_PRECISION.params.decimal_return_scale"></span><strong>decimal_return_scale</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.DOUBLE_PRECISION.params.decimal_return_scale">¶</a> – Default scale to use when converting
from floats to Python decimals.  Floating point values will typically
be much longer due to decimal inaccuracy, and most floating point
database types don’t have a notion of “scale”, so by default the
float type looks for the first ten decimal places when converting.
Specifying this value will override that length.  Note that the
MySQL float types, which do include “scale”, will use “scale”
as the default for decimal_return_scale, if not otherwise specified.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ENUM">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">ENUM</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ENUM" title="Link to this definition">¶</a></dt>
<dd><p>PostgreSQL ENUM type.</p>
<p>This is a subclass of <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> which includes
support for PG’s <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TYPE</span></code> and <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TYPE</span></code>.</p>
<p>When the builtin type <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> is used and the
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum.params.native_enum" title="sqlalchemy.types.Enum"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Enum.native_enum</span></code></a> flag is left at its default of
True, the PostgreSQL backend will use a <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a>
type as the implementation, so the special create/drop rules
will be used.</p>
<p>The create/drop behavior of ENUM is necessarily intricate, due to the
awkward relationship the ENUM type has in relationship to the
parent table, in that it may be “owned” by just a single table, or
may be shared among many tables.</p>
<p>When using <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> or <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a>
in an “inline” fashion, the <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TYPE</span></code> and <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TYPE</span></code> is emitted
corresponding to when the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.create" title="sqlalchemy.schema.Table.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Table.create()</span></code></a> and
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.drop" title="sqlalchemy.schema.Table.drop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Table.drop()</span></code></a>
methods are called:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;sometable&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;some_enum&quot;</span><span class="p">,</span> <span class="n">ENUM</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;myenum&quot;</span><span class="p">)),</span>
<span class="p">)</span>

<span class="n">table</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>  <span class="c1"># will emit CREATE ENUM and CREATE TABLE</span>
<span class="n">table</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>  <span class="c1"># will emit DROP TABLE and DROP ENUM</span></pre></div>
</div>
<p>To use a common enumerated type between multiple tables, the best
practice is to declare the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> or
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a> independently, and associate it with the
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a> object itself:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_enum</span> <span class="o">=</span> <span class="n">ENUM</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;myenum&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;sometable_one&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;some_enum&quot;</span><span class="p">,</span> <span class="n">myenum</span><span class="p">))</span>

<span class="n">t2</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;sometable_two&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;some_enum&quot;</span><span class="p">,</span> <span class="n">myenum</span><span class="p">))</span></pre></div>
</div>
<p>When this pattern is used, care must still be taken at the level
of individual table creates.  Emitting CREATE TABLE without also
specifying <code class="docutils literal notranslate"><span class="pre">checkfirst=True</span></code> will still cause issues:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t1</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>  <span class="c1"># will fail: no such type &#39;myenum&#39;</span></pre></div>
</div>
<p>If we specify <code class="docutils literal notranslate"><span class="pre">checkfirst=True</span></code>, the individual table-level create
operation will check for the <code class="docutils literal notranslate"><span class="pre">ENUM</span></code> and create if not exists:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># will check if enum exists, and emit CREATE TYPE if not</span>
<span class="n">t1</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></pre></div>
</div>
<p>When using a metadata-level ENUM type, the type will always be created
and dropped if either the metadata-wide create/drop is called:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>  <span class="c1"># will emit CREATE TYPE</span>
<span class="n">metadata</span><span class="o">.</span><span class="n">drop_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>  <span class="c1"># will emit DROP TYPE</span></pre></div>
</div>
<p>The type can also be created and dropped directly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_enum</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
<span class="n">my_enum</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span></pre></div>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.__init__"><span class="sig-name descname">__init__()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.create"><span class="sig-name descname">create()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.drop"><span class="sig-name descname">drop()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ENUM</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.named_types.NamedType</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.NativeForEmulated</span></code>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Enum</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ENUM.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ENUM.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">enums</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NoArg</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">_NoArg.NO_ARG</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">create_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ENUM.__init__" title="Link to this definition">¶</a></dt>
<dd><p>Construct an <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a>.</p>
<p>Arguments are the same as that of
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a>, but also including
the following parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.dialects.postgresql.ENUM.params.create_type"></span><strong>create_type</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.params.create_type">¶</a> – Defaults to True.
Indicates that <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TYPE</span></code> should be
emitted, after optionally checking for the
presence of the type, when the parent
table is being created; and additionally
that <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TYPE</span></code> is called when the table
is dropped.    When <code class="docutils literal notranslate"><span class="pre">False</span></code>, no check
will be performed and no <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TYPE</span></code>
or <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TYPE</span></code> is emitted, unless
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.create" title="sqlalchemy.dialects.postgresql.ENUM.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ENUM.create()</span></code></a>
or <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.drop" title="sqlalchemy.dialects.postgresql.ENUM.drop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ENUM.drop()</span></code></a>
are called directly.
Setting to <code class="docutils literal notranslate"><span class="pre">False</span></code> is helpful
when invoking a creation scheme to a SQL file
without access to the actual database -
the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.create" title="sqlalchemy.dialects.postgresql.ENUM.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ENUM.create()</span></code></a> and
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.drop" title="sqlalchemy.dialects.postgresql.ENUM.drop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ENUM.drop()</span></code></a> methods can
be used to emit SQL to a target bind.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ENUM.create">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ENUM.</span></code></a><span class="sig-name descname"><span class="pre">create</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checkfirst</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ENUM.create" title="Link to this definition">¶</a></dt>
<dd><p>Emit <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TYPE</span></code> for this
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a>.</p>
<p>If the underlying dialect does not support
PostgreSQL CREATE TYPE, no action is taken.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ENUM.create.params.bind"></span><strong>bind</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.create.params.bind">¶</a> – a connectable <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>,
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>, or similar object to emit
SQL.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ENUM.create.params.checkfirst"></span><strong>checkfirst</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.create.params.checkfirst">¶</a> – if <code class="docutils literal notranslate"><span class="pre">True</span></code>, a query against
the PG catalog will be first performed to see
if the type does not exist already before
creating.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ENUM.drop">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ENUM.</span></code></a><span class="sig-name descname"><span class="pre">drop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checkfirst</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ENUM.drop" title="Link to this definition">¶</a></dt>
<dd><p>Emit <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TYPE</span></code> for this
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a>.</p>
<p>If the underlying dialect does not support
PostgreSQL DROP TYPE, no action is taken.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ENUM.drop.params.bind"></span><strong>bind</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.drop.params.bind">¶</a> – a connectable <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>,
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>, or similar object to emit
SQL.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ENUM.drop.params.checkfirst"></span><strong>checkfirst</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.drop.params.checkfirst">¶</a> – if <code class="docutils literal notranslate"><span class="pre">True</span></code>, a query against
the PG catalog will be first performed to see
if the type actually exists before dropping.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">HSTORE</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE" title="Link to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL HSTORE type.</p>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">HSTORE</span></code></a> type stores dictionaries containing strings, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;data_table&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">HSTORE</span><span class="p">),</span>
<span class="p">)</span>

<span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="n">data_table</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;key1&quot;</span><span class="p">:</span> <span class="s2">&quot;value1&quot;</span><span class="p">,</span> <span class="s2">&quot;key2&quot;</span><span class="p">:</span> <span class="s2">&quot;value2&quot;</span><span class="p">}</span>
    <span class="p">)</span></pre></div>
</div>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">HSTORE</span></code></a> provides for a wide range of operations, including:</p>
<ul>
<li><p>Index operations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;some key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;some value&quot;</span></pre></div>
</div>
</li>
<li><p>Containment operations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s2">&quot;some key&quot;</span><span class="p">)</span>

<span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">has_all</span><span class="p">([</span><span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">,</span> <span class="s2">&quot;three&quot;</span><span class="p">])</span></pre></div>
</div>
</li>
<li><p>Concatenation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="p">{</span><span class="s2">&quot;k1&quot;</span><span class="p">:</span> <span class="s2">&quot;v1&quot;</span><span class="p">}</span></pre></div>
</div>
</li>
</ul>
<p>For a full list of special methods see
<code class="xref py py-class docutils literal notranslate"><span class="pre">comparator_factory</span></code>.</p>
<div class="topic docutils container">
<p><strong>Detecting Changes in HSTORE columns when using the ORM</strong></p>
<p>For usage with the SQLAlchemy ORM, it may be desirable to combine the
usage of <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">HSTORE</span></code></a> with <a class="reference internal" href="../orm/extensions/mutable.html#sqlalchemy.ext.mutable.MutableDict" title="sqlalchemy.ext.mutable.MutableDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">MutableDict</span></code></a> dictionary now
part of the <a class="reference internal" href="../orm/extensions/mutable.html#module-sqlalchemy.ext.mutable" title="sqlalchemy.ext.mutable"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlalchemy.ext.mutable</span></code></a> extension. This extension
will allow “in-place” changes to the dictionary, e.g. addition of new
keys or replacement/removal of existing keys to/from the current
dictionary, to produce events which will be detected by the unit of
work:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.mutable</span><span class="w"> </span><span class="kn">import</span> <span class="n">MutableDict</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;data_table&quot;</span>

    <span class="n">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">MutableDict</span><span class="o">.</span><span class="n">as_mutable</span><span class="p">(</span><span class="n">HSTORE</span><span class="p">))</span>


<span class="n">my_object</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyClass</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>

<span class="c1"># in-place mutation, requires Mutable extension</span>
<span class="c1"># in order for the ORM to detect</span>
<span class="n">my_object</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;some_key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;some value&quot;</span>

<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>When the <a class="reference internal" href="../orm/extensions/mutable.html#module-sqlalchemy.ext.mutable" title="sqlalchemy.ext.mutable"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlalchemy.ext.mutable</span></code></a> extension is not used, the ORM
will not be alerted to any changes to the contents of an existing
dictionary, unless that dictionary value is re-assigned to the
HSTORE-attribute itself, thus generating a change event.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.hstore" title="sqlalchemy.dialects.postgresql.hstore"><code class="xref py py-class docutils literal notranslate"><span class="pre">hstore</span></code></a> - render the PostgreSQL <code class="docutils literal notranslate"><span class="pre">hstore()</span></code> function.</p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.array"><span class="sig-name descname">array()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.contained_by"><span class="sig-name descname">contained_by()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.contains"><span class="sig-name descname">contains()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.defined"><span class="sig-name descname">defined()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.delete"><span class="sig-name descname">delete()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.has_all"><span class="sig-name descname">has_all()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.has_any"><span class="sig-name descname">has_any()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.has_key"><span class="sig-name descname">has_key()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.keys"><span class="sig-name descname">keys()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.matrix"><span class="sig-name descname">matrix()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.slice"><span class="sig-name descname">slice()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.vals"><span class="sig-name descname">vals()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.__init__"><span class="sig-name descname">__init__()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.bind_processor"><span class="sig-name descname">bind_processor()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.comparator_factory"><span class="sig-name descname">comparator_factory</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.hashable"><span class="sig-name descname">hashable</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.result_processor"><span class="sig-name descname">result_processor()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE</span></code></a> (<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.Indexable" title="sqlalchemy.types.Indexable"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Indexable</span></code></a>, <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.Concatenable" title="sqlalchemy.types.Concatenable"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Concatenable</span></code></a>, <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Comparator</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator" title="Link to this definition">¶</a></dt>
<dd><p>Define comparison operations for <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">HSTORE</span></code></a>.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator" title="sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Comparator</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Comparator</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.array">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">array</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.array" title="Link to this definition">¶</a></dt>
<dd><p>Text array expression.  Returns array of alternating keys and
values.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.contained_by">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">contained_by</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.contained_by" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test if keys are a proper subset of the
keys of the argument jsonb expression.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.contains">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">contains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.contains" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test if keys (or array) are a superset
of/contained the keys of the argument jsonb expression.</p>
<p>kwargs may be ignored by this operator but are required for API
conformance.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.defined">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">defined</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.defined" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test for presence of a non-NULL value for
the key.  Note that the key may be a SQLA expression.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.delete">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">delete</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.delete" title="Link to this definition">¶</a></dt>
<dd><p>HStore expression.  Returns the contents of this hstore with the
given key deleted.  Note that the key may be a SQLA expression.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.has_all">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">has_all</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.has_all" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test for presence of all keys in jsonb</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.has_any">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">has_any</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.has_any" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test for presence of any key in jsonb</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.has_key">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">has_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.has_key" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test for presence of a key.  Note that the
key may be a SQLA expression.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.keys">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">keys</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.keys" title="Link to this definition">¶</a></dt>
<dd><p>Text array expression.  Returns array of keys.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.matrix">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">matrix</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.matrix" title="Link to this definition">¶</a></dt>
<dd><p>Text array expression.  Returns array of [key, value] pairs.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.slice">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">slice</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.slice" title="Link to this definition">¶</a></dt>
<dd><p>HStore expression.  Returns a subset of an hstore defined by
array of keys.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.vals">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">vals</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.vals" title="Link to this definition">¶</a></dt>
<dd><p>Text array expression.  Returns array of values.</p>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.__init__" title="Link to this definition">¶</a></dt>
<dd><p>Construct a new <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">HSTORE</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.dialects.postgresql.HSTORE.params.text_type"></span><strong>text_type</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.params.text_type">¶</a> – the type that should be used for indexed values.
Defaults to <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Text" title="sqlalchemy.types.Text"><code class="xref py py-class docutils literal notranslate"><span class="pre">Text</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.bind_processor">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.</span></code></a><span class="sig-name descname"><span class="pre">bind_processor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dialect</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.bind_processor" title="Link to this definition">¶</a></dt>
<dd><p>Return a conversion function for processing bind values.</p>
<p>Returns a callable which will receive a bind parameter value
as the sole positional argument and will return a value to
send to the DB-API.</p>
<p>If processing is not necessary, the method should return <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>This method is only called relative to a <strong>dialect specific type
object</strong>, which is often <strong>private to a dialect in use</strong> and is not
the same type object as the public facing one, which means it’s not
feasible to subclass a <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeEngine</span></code></a> class in order to
provide an alternate <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine.bind_processor" title="sqlalchemy.types.TypeEngine.bind_processor"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeEngine.bind_processor()</span></code></a>
method, unless subclassing the <a class="reference internal" href="../core/custom_types.html#sqlalchemy.types.UserDefinedType" title="sqlalchemy.types.UserDefinedType"><code class="xref py py-class docutils literal notranslate"><span class="pre">UserDefinedType</span></code></a>
class explicitly.</p>
<p>To provide alternate behavior for
<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine.bind_processor" title="sqlalchemy.types.TypeEngine.bind_processor"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeEngine.bind_processor()</span></code></a>, implement a
<a class="reference internal" href="../core/custom_types.html#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeDecorator</span></code></a> class and provide an implementation
of <a class="reference internal" href="../core/custom_types.html#sqlalchemy.types.TypeDecorator.process_bind_param" title="sqlalchemy.types.TypeDecorator.process_bind_param"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeDecorator.process_bind_param()</span></code></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/custom_types.html#types-typedecorator"><span class="std std-ref">增强现有类型</span></a></p>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.dialects.postgresql.HSTORE.bind_processor.params.dialect"></span><strong>dialect</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.bind_processor.params.dialect">¶</a> – Dialect instance in use.</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.comparator_factory">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.</span></code></a><span class="sig-name descname"><span class="pre">comparator_factory</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.comparator_factory" title="Link to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator" title="sqlalchemy.dialects.postgresql.hstore.HSTORE.Comparator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Comparator</span></code></a> 的别名</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.hashable">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.</span></code></a><span class="sig-name descname"><span class="pre">hashable</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">False</span></em><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.hashable" title="Link to this definition">¶</a></dt>
<dd><p>Flag, if False, means values from this type aren’t hashable.</p>
<p>Used by the ORM when uniquing result lists.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.result_processor">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.</span></code></a><span class="sig-name descname"><span class="pre">result_processor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dialect</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coltype</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.result_processor" title="Link to this definition">¶</a></dt>
<dd><p>Return a conversion function for processing result row values.</p>
<p>Returns a callable which will receive a result row column
value as the sole positional argument and will return a value
to return to the user.</p>
<p>If processing is not necessary, the method should return <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>This method is only called relative to a <strong>dialect specific type
object</strong>, which is often <strong>private to a dialect in use</strong> and is not
the same type object as the public facing one, which means it’s not
feasible to subclass a <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeEngine</span></code></a> class in order to
provide an alternate <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine.result_processor" title="sqlalchemy.types.TypeEngine.result_processor"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeEngine.result_processor()</span></code></a>
method, unless subclassing the <a class="reference internal" href="../core/custom_types.html#sqlalchemy.types.UserDefinedType" title="sqlalchemy.types.UserDefinedType"><code class="xref py py-class docutils literal notranslate"><span class="pre">UserDefinedType</span></code></a>
class explicitly.</p>
<p>To provide alternate behavior for
<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine.result_processor" title="sqlalchemy.types.TypeEngine.result_processor"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeEngine.result_processor()</span></code></a>, implement a
<a class="reference internal" href="../core/custom_types.html#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeDecorator</span></code></a> class and provide an implementation
of <a class="reference internal" href="../core/custom_types.html#sqlalchemy.types.TypeDecorator.process_result_value" title="sqlalchemy.types.TypeDecorator.process_result_value"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeDecorator.process_result_value()</span></code></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/custom_types.html#types-typedecorator"><span class="std std-ref">增强现有类型</span></a></p>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.HSTORE.result_processor.params.dialect"></span><strong>dialect</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.result_processor.params.dialect">¶</a> – Dialect instance in use.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.HSTORE.result_processor.params.coltype"></span><strong>coltype</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.result_processor.params.coltype">¶</a> – DBAPI coltype argument received in cursor.description.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.INET">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">INET</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.INET" title="Link to this definition">¶</a></dt>
<dd><div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.INET" title="sqlalchemy.dialects.postgresql.INET"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.INET</span></code></a> (<code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.types._NetworkAddressTypeMixin</span></code>, <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.INTERVAL">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">INTERVAL</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.INTERVAL" title="Link to this definition">¶</a></dt>
<dd><p>PostgreSQL INTERVAL type.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INTERVAL.__init__"><span class="sig-name descname">__init__()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.INTERVAL" title="sqlalchemy.dialects.postgresql.INTERVAL"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.INTERVAL</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.NativeForEmulated</span></code>, <code class="docutils literal notranslate"><span class="pre">sqlalchemy.types._AbstractInterval</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.INTERVAL.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INTERVAL"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.INTERVAL.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">precision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.INTERVAL.__init__" title="Link to this definition">¶</a></dt>
<dd><p>Construct an INTERVAL.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.INTERVAL.params.precision"></span><strong>precision</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.INTERVAL.params.precision">¶</a> – optional integer precision value</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.INTERVAL.params.fields"></span><strong>fields</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.INTERVAL.params.fields">¶</a> – string fields specifier.  allows storage of fields
to be limited, such as <code class="docutils literal notranslate"><span class="pre">&quot;YEAR&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;MONTH&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;DAY</span> <span class="pre">TO</span> <span class="pre">HOUR&quot;</span></code>,
etc.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSON">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">JSON</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSON" title="Link to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL JSON type.</p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> is used automatically whenever the base
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> datatype is used against a PostgreSQL backend,
however base <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> datatype does not provide Python
accessors for PostgreSQL-specific comparison methods such as
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON.Comparator.astext" title="sqlalchemy.dialects.postgresql.JSON.Comparator.astext"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.astext()</span></code></a>; additionally, to use
PostgreSQL <code class="docutils literal notranslate"><span class="pre">JSONB</span></code>, the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONB</span></code></a> datatype should
be used explicitly.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> - main documentation for the generic
cross-platform JSON datatype.</p>
</div>
<p>The operators provided by the PostgreSQL version of <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a>
include:</p>
<ul>
<li><p>Index operations (the <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> operator):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;some key&quot;</span><span class="p">]</span>

<span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span></pre></div>
</div>
</li>
<li><p>Index operations returning text
(the <code class="docutils literal notranslate"><span class="pre">-&gt;&gt;</span></code> operator):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;some key&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astext</span> <span class="o">==</span> <span class="s2">&quot;some value&quot;</span></pre></div>
</div>
<p>Note that equivalent functionality is available via the
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON.Comparator.as_string" title="sqlalchemy.types.JSON.Comparator.as_string"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Comparator.as_string</span></code></a> accessor.</p>
</li>
<li><p>Index operations with CAST
(equivalent to <code class="docutils literal notranslate"><span class="pre">CAST(col</span> <span class="pre">-&gt;&gt;</span> <span class="pre">['some</span> <span class="pre">key']</span> <span class="pre">AS</span> <span class="pre">&lt;type&gt;)</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;some key&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astext</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span></pre></div>
</div>
<p>Note that equivalent functionality is available via the
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON.Comparator.as_integer" title="sqlalchemy.types.JSON.Comparator.as_integer"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Comparator.as_integer</span></code></a> and similar accessors.</p>
</li>
<li><p>Path index operations (the <code class="docutils literal notranslate"><span class="pre">#&gt;</span></code> operator):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[(</span><span class="s2">&quot;key_1&quot;</span><span class="p">,</span> <span class="s2">&quot;key_2&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s2">&quot;key_n&quot;</span><span class="p">)]</span></pre></div>
</div>
</li>
<li><p>Path index operations returning text (the <code class="docutils literal notranslate"><span class="pre">#&gt;&gt;</span></code> operator):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;key_1&quot;</span><span class="p">,</span> <span class="s2">&quot;key_2&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s2">&quot;key_n&quot;</span><span class="p">)</span>
<span class="p">]</span><span class="o">.</span><span class="n">astext</span> <span class="o">==</span> <span class="s2">&quot;some value&quot;</span></pre></div>
</div>
</li>
</ul>
<p>Index operations return an expression object whose type defaults to
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> by default,
so that further JSON-oriented instructions
may be called upon the result type.</p>
<p>Custom serializers and deserializers are specified at the dialect level,
that is using <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>.  The reason for this is that when
using psycopg2, the DBAPI only allows serializers at the per-cursor
or per-connection level.   E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://scott:tiger@localhost/test&quot;</span><span class="p">,</span>
    <span class="n">json_serializer</span><span class="o">=</span><span class="n">my_serialize_fn</span><span class="p">,</span>
    <span class="n">json_deserializer</span><span class="o">=</span><span class="n">my_deserialize_fn</span><span class="p">,</span>
<span class="p">)</span></pre></div>
</div>
<p>When using the psycopg2 dialect, the json_deserializer is registered
against the database using <code class="docutils literal notranslate"><span class="pre">psycopg2.extras.register_default_json</span></code>.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> - Core level JSON type</p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONB</span></code></a></p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON.Comparator.astext"><span class="sig-name descname">astext</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON.__init__"><span class="sig-name descname">__init__()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON.comparator_factory"><span class="sig-name descname">comparator_factory</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON.render_bind_cast"><span class="sig-name descname">render_bind_cast</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSON</span></code></a> (<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.JSON</span></code></a>)</p>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSON.Comparator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Comparator</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSON.Comparator" title="Link to this definition">¶</a></dt>
<dd><p>Define comparison operations for <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a>.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON.Comparator" title="sqlalchemy.dialects.postgresql.JSON.Comparator"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSON.Comparator</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Comparator</span></code>)</p>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSON.Comparator.astext">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSON.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">astext</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSON.Comparator.astext" title="Link to this definition">¶</a></dt>
<dd><p>On an indexed expression, use the “astext” (e.g. “-&gt;&gt;”)
conversion when rendered in SQL.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">(</span><span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;some key&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astext</span><span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement.cast" title="sqlalchemy.sql.expression.ColumnElement.cast"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnElement.cast()</span></code></a></p>
</div>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSON.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSON.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">none_as_null</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">astext_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><span class="pre">TypeEngine</span></a><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSON.__init__" title="Link to this definition">¶</a></dt>
<dd><p>Construct a <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> type.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.JSON.params.none_as_null"></span><strong>none_as_null</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.JSON.params.none_as_null">¶</a> – <p>if True, persist the value <code class="docutils literal notranslate"><span class="pre">None</span></code> as a
SQL NULL value, not the JSON encoding of <code class="docutils literal notranslate"><span class="pre">null</span></code>.   Note that
when this flag is False, the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.null" title="sqlalchemy.sql.expression.null"><code class="xref py py-func docutils literal notranslate"><span class="pre">null()</span></code></a> construct can still
be used to persist a NULL value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">null</span>

<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">()})</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON.NULL" title="sqlalchemy.types.JSON.NULL"><code class="xref py py-attr docutils literal notranslate"><span class="pre">JSON.NULL</span></code></a></p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.JSON.params.astext_type"></span><strong>astext_type</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.JSON.params.astext_type">¶</a> – the type to use for the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON.Comparator.astext" title="sqlalchemy.dialects.postgresql.JSON.Comparator.astext"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Comparator.astext</span></code></a>
accessor on indexed attributes.  Defaults to <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Text" title="sqlalchemy.types.Text"><code class="xref py py-class docutils literal notranslate"><span class="pre">Text</span></code></a>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSON.comparator_factory">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSON.</span></code></a><span class="sig-name descname"><span class="pre">comparator_factory</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSON.comparator_factory" title="Link to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON.Comparator" title="sqlalchemy.dialects.postgresql.json.JSON.Comparator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Comparator</span></code></a> 的别名</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSON.render_bind_cast">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSON.</span></code></a><span class="sig-name descname"><span class="pre">render_bind_cast</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">True</span></em><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSON.render_bind_cast" title="Link to this definition">¶</a></dt>
<dd><p>Render bind casts for <a class="reference internal" href="../core/internals.html#sqlalchemy.engine.BindTyping.RENDER_CASTS" title="sqlalchemy.engine.BindTyping.RENDER_CASTS"><code class="xref py py-attr docutils literal notranslate"><span class="pre">BindTyping.RENDER_CASTS</span></code></a> mode.</p>
<p>If True, this type (usually a dialect level impl type) signals
to the compiler that a cast should be rendered around a bound parameter
for this type.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/internals.html#sqlalchemy.engine.BindTyping" title="sqlalchemy.engine.BindTyping"><code class="xref py py-class docutils literal notranslate"><span class="pre">BindTyping</span></code></a></p>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSONB">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">JSONB</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSONB" title="Link to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL JSONB type.</p>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONB</span></code></a> type stores arbitrary JSONB format data,
e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;data_table&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">JSONB</span><span class="p">),</span>
<span class="p">)</span>

<span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="n">data_table</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;key1&quot;</span><span class="p">:</span> <span class="s2">&quot;value1&quot;</span><span class="p">,</span> <span class="s2">&quot;key2&quot;</span><span class="p">:</span> <span class="s2">&quot;value2&quot;</span><span class="p">}</span>
    <span class="p">)</span></pre></div>
</div>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONB</span></code></a> type includes all operations provided by
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a>, including the same behaviors for indexing
operations.
It also adds additional operators specific to JSONB, including
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_key" title="sqlalchemy.dialects.postgresql.JSONB.Comparator.has_key"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.has_key()</span></code></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_all" title="sqlalchemy.dialects.postgresql.JSONB.Comparator.has_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.has_all()</span></code></a>,
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_any" title="sqlalchemy.dialects.postgresql.JSONB.Comparator.has_any"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.has_any()</span></code></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.contains" title="sqlalchemy.dialects.postgresql.JSONB.Comparator.contains"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.contains()</span></code></a>,
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.contained_by" title="sqlalchemy.dialects.postgresql.JSONB.Comparator.contained_by"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.contained_by()</span></code></a>,
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.delete_path" title="sqlalchemy.dialects.postgresql.JSONB.Comparator.delete_path"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.delete_path()</span></code></a>,
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.path_exists" title="sqlalchemy.dialects.postgresql.JSONB.Comparator.path_exists"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.path_exists()</span></code></a> and
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.path_match" title="sqlalchemy.dialects.postgresql.JSONB.Comparator.path_match"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.path_match()</span></code></a>.</p>
<p>Like the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> type, the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONB</span></code></a>
type does not detect
in-place changes when used with the ORM, unless the
<a class="reference internal" href="../orm/extensions/mutable.html#module-sqlalchemy.ext.mutable" title="sqlalchemy.ext.mutable"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlalchemy.ext.mutable</span></code></a> extension is used.</p>
<p>Custom serializers and deserializers
are shared with the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> class,
using the <code class="docutils literal notranslate"><span class="pre">json_serializer</span></code>
and <code class="docutils literal notranslate"><span class="pre">json_deserializer</span></code> keyword arguments.  These must be specified
at the dialect level using <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>.  When using
psycopg2, the serializers are associated with the jsonb type using
<code class="docutils literal notranslate"><span class="pre">psycopg2.extras.register_default_jsonb</span></code> on a per-connection basis,
in the same way that <code class="docutils literal notranslate"><span class="pre">psycopg2.extras.register_default_json</span></code> is used
to register these handlers with the json type.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a></p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.contained_by"><span class="sig-name descname">contained_by()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.contains"><span class="sig-name descname">contains()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.delete_path"><span class="sig-name descname">delete_path()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_all"><span class="sig-name descname">has_all()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_any"><span class="sig-name descname">has_any()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_key"><span class="sig-name descname">has_key()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.path_exists"><span class="sig-name descname">path_exists()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.path_match"><span class="sig-name descname">path_match()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.comparator_factory"><span class="sig-name descname">comparator_factory</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSONB</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.json.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.json.JSON</span></code></a>)</p>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSONB.Comparator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Comparator</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator" title="Link to this definition">¶</a></dt>
<dd><p>Define comparison operations for <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a>.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator" title="sqlalchemy.dialects.postgresql.JSONB.Comparator"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSONB.Comparator</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.json.Comparator</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSONB.Comparator.contained_by">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSONB.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">contained_by</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.contained_by" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test if keys are a proper subset of the
keys of the argument jsonb expression
(equivalent of the <code class="docutils literal notranslate"><span class="pre">&lt;&#64;</span></code> operator).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSONB.Comparator.contains">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSONB.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">contains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.contains" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test if keys (or array) are a superset
of/contained the keys of the argument jsonb expression
(equivalent of the <code class="docutils literal notranslate"><span class="pre">&#64;&gt;</span></code> operator).</p>
<p>kwargs may be ignored by this operator but are required for API
conformance.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSONB.Comparator.delete_path">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSONB.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">delete_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_pg_array</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><span class="pre">JSONB</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.delete_path" title="Link to this definition">¶</a></dt>
<dd><p>JSONB expression. Deletes field or array element specified in
the argument array (equivalent of the <code class="docutils literal notranslate"><span class="pre">#-</span></code> operator).</p>
<p>The input may be a list of strings that will be coerced to an
<code class="docutils literal notranslate"><span class="pre">ARRAY</span></code> or an instance of <code class="xref py py-meth docutils literal notranslate"><span class="pre">_postgres.array()</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSONB.Comparator.has_all">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSONB.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">has_all</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_all" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test for presence of all keys in jsonb
(equivalent of the <code class="docutils literal notranslate"><span class="pre">?&amp;</span></code> operator)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSONB.Comparator.has_any">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSONB.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">has_any</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_any" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test for presence of any key in jsonb
(equivalent of the <code class="docutils literal notranslate"><span class="pre">?|</span></code> operator)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSONB.Comparator.has_key">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSONB.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">has_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_key" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test for presence of a key (equivalent of
the <code class="docutils literal notranslate"><span class="pre">?</span></code> operator).  Note that the key may be a SQLA expression.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSONB.Comparator.path_exists">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSONB.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">path_exists</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.path_exists" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression. Test for presence of item given by the
argument JSONPath expression (equivalent of the <code class="docutils literal notranslate"><span class="pre">&#64;?</span></code> operator).</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSONB.Comparator.path_match">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSONB.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">path_match</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.path_match" title="Link to this definition">¶</a></dt>
<dd><p>Boolean expression. Test if JSONPath predicate given by the
argument JSONPath expression matches
(equivalent of the <code class="docutils literal notranslate"><span class="pre">&#64;&#64;</span></code> operator).</p>
<p>Only the first item of the result is taken into account.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
</dd></dl>

</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSONB.comparator_factory">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSONB.</span></code></a><span class="sig-name descname"><span class="pre">comparator_factory</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSONB.comparator_factory" title="Link to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator" title="sqlalchemy.dialects.postgresql.json.JSONB.Comparator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Comparator</span></code></a> 的别名</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSONPATH">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">JSONPATH</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSONPATH" title="Link to this definition">¶</a></dt>
<dd><p>JSON Path Type.</p>
<p>This is usually required to cast literal values to json path when using
json search like function, such as <code class="docutils literal notranslate"><span class="pre">jsonb_path_query_array</span></code> or
<code class="docutils literal notranslate"><span class="pre">jsonb_path_exists</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
    <span class="n">sa</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">jsonb_path_query_array</span><span class="p">(</span>
        <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">jsonb_col</span><span class="p">,</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;$.address.id&quot;</span><span class="p">,</span> <span class="n">JSONPATH</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONPATH" title="sqlalchemy.dialects.postgresql.JSONPATH"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSONPATH</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.json.JSONPathType</span></code>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.MACADDR">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">MACADDR</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.MACADDR" title="Link to this definition">¶</a></dt>
<dd><div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.MACADDR" title="sqlalchemy.dialects.postgresql.MACADDR"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.MACADDR</span></code></a> (<code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.types._NetworkAddressTypeMixin</span></code>, <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.MACADDR8">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">MACADDR8</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.MACADDR8" title="Link to this definition">¶</a></dt>
<dd><div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.MACADDR8" title="sqlalchemy.dialects.postgresql.MACADDR8"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.MACADDR8</span></code></a> (<code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.types._NetworkAddressTypeMixin</span></code>, <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.MONEY">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">MONEY</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.MONEY" title="Link to this definition">¶</a></dt>
<dd><p>Provide the PostgreSQL MONEY type.</p>
<p>Depending on driver, result rows using this type may return a
string value which includes currency symbols.</p>
<p>For this reason, it may be preferable to provide conversion to a
numerically-based currency datatype using <a class="reference internal" href="../core/custom_types.html#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeDecorator</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">decimal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dialect</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeDecorator</span>


<span class="k">class</span><span class="w"> </span><span class="nc">NumericMoney</span><span class="p">(</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="n">impl</span> <span class="o">=</span> <span class="n">MONEY</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_result_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dialect</span><span class="p">:</span> <span class="n">Dialect</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># adjust this for the currency and numeric</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\$([\d.]+)&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">value</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>Alternatively, the conversion may be applied as a CAST using
the <a class="reference internal" href="../core/custom_types.html#sqlalchemy.types.TypeDecorator.column_expression" title="sqlalchemy.types.TypeDecorator.column_expression"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeDecorator.column_expression()</span></code></a> method as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">decimal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">cast</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeDecorator</span>


<span class="k">class</span><span class="w"> </span><span class="nc">NumericMoney</span><span class="p">(</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="n">impl</span> <span class="o">=</span> <span class="n">MONEY</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">column_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">Numeric</span><span class="p">())</span></pre><div class="code-annotations-key"></div></div>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.MONEY" title="sqlalchemy.dialects.postgresql.MONEY"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.MONEY</span></code></a> (<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.OID">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">OID</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.OID" title="Link to this definition">¶</a></dt>
<dd><p>Provide the PostgreSQL OID type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.OID" title="sqlalchemy.dialects.postgresql.OID"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.OID</span></code></a> (<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">REAL</span></span></dt>
<dd><p>The SQL REAL type.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float</span></code></a> - documentation for the base type.</p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.REAL</span></code> (<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Float</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.REAL"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.REAL.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">precision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">asdecimal</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decimal_return_scale</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.types.Float.__init__</span></code> <em>method of</em> <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float</span></code></a></p>
</div>
<p>Construct a Float.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.REAL.params.precision"></span><strong>precision</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.REAL.params.precision">¶</a> – <p>the numeric precision for use in DDL <code class="docutils literal notranslate"><span class="pre">CREATE</span>
<span class="pre">TABLE</span></code>. Backends <strong>should</strong> attempt to ensure this precision
indicates a number of digits for the generic
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float</span></code></a> datatype.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>For the Oracle Database backend, the
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float.params.precision" title="sqlalchemy.types.Float"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Float.precision</span></code></a> parameter is not accepted
when rendering DDL, as Oracle Database does not support float precision
specified as a number of decimal places. Instead, use the
Oracle Database-specific <a class="reference internal" href="oracle.html#sqlalchemy.dialects.oracle.FLOAT" title="sqlalchemy.dialects.oracle.FLOAT"><code class="xref py py-class docutils literal notranslate"><span class="pre">FLOAT</span></code></a> datatype and specify the
<a class="reference internal" href="oracle.html#sqlalchemy.dialects.oracle.FLOAT.params.binary_precision" title="sqlalchemy.dialects.oracle.FLOAT"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">FLOAT.binary_precision</span></code></a> parameter. This is new
in version 2.0 of SQLAlchemy.</p>
<p>To create a database agnostic <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float</span></code></a> that
separately specifies binary precision for Oracle Database, use
<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeEngine.with_variant()</span></code></a> as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Column</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Float</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects</span><span class="w"> </span><span class="kn">import</span> <span class="n">oracle</span>

<span class="n">Column</span><span class="p">(</span>
    <span class="s2">&quot;float_data&quot;</span><span class="p">,</span>
    <span class="n">Float</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">with_variant</span><span class="p">(</span><span class="n">oracle</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">(</span><span class="n">binary_precision</span><span class="o">=</span><span class="mi">16</span><span class="p">),</span> <span class="s2">&quot;oracle&quot;</span><span class="p">),</span>
<span class="p">)</span></pre></div>
</div>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.REAL.params.asdecimal"></span><strong>asdecimal</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.REAL.params.asdecimal">¶</a> – the same flag as that of <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal notranslate"><span class="pre">Numeric</span></code></a>, but
defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.   Note that setting this flag to <code class="docutils literal notranslate"><span class="pre">True</span></code>
results in floating point conversion.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.REAL.params.decimal_return_scale"></span><strong>decimal_return_scale</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.REAL.params.decimal_return_scale">¶</a> – Default scale to use when converting
from floats to Python decimals.  Floating point values will typically
be much longer due to decimal inaccuracy, and most floating point
database types don’t have a notion of “scale”, so by default the
float type looks for the first ten decimal places when converting.
Specifying this value will override that length.  Note that the
MySQL float types, which do include “scale”, will use “scale”
as the default for decimal_return_scale, if not otherwise specified.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.REGCONFIG">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">REGCONFIG</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.REGCONFIG" title="Link to this definition">¶</a></dt>
<dd><p>Provide the PostgreSQL REGCONFIG type.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.0rc1 版本加入.</span></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.REGCONFIG" title="sqlalchemy.dialects.postgresql.REGCONFIG"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.REGCONFIG</span></code></a> (<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.REGCLASS">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">REGCLASS</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.REGCLASS" title="Link to this definition">¶</a></dt>
<dd><p>Provide the PostgreSQL REGCLASS type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.REGCLASS" title="sqlalchemy.dialects.postgresql.REGCLASS"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.REGCLASS</span></code></a> (<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.TIMESTAMP">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">TIMESTAMP</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.TIMESTAMP" title="Link to this definition">¶</a></dt>
<dd><p>Provide the PostgreSQL TIMESTAMP type.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TIMESTAMP.__init__"><span class="sig-name descname">__init__()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TIMESTAMP" title="sqlalchemy.dialects.postgresql.TIMESTAMP"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.TIMESTAMP</span></code></a> (<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.TIMESTAMP" title="sqlalchemy.types.TIMESTAMP"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TIMESTAMP</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.TIMESTAMP.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TIMESTAMP"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.TIMESTAMP.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timezone</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">precision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.TIMESTAMP.__init__" title="Link to this definition">¶</a></dt>
<dd><p>Construct a TIMESTAMP.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.TIMESTAMP.params.timezone"></span><strong>timezone</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.TIMESTAMP.params.timezone">¶</a> – boolean value if timezone present, default False</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.TIMESTAMP.params.precision"></span><strong>precision</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.TIMESTAMP.params.precision">¶</a> – <p>optional integer precision value</p>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4 版本加入.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.TIME">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">TIME</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.TIME" title="Link to this definition">¶</a></dt>
<dd><p>PostgreSQL TIME type.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TIME.__init__"><span class="sig-name descname">__init__()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TIME" title="sqlalchemy.dialects.postgresql.TIME"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.TIME</span></code></a> (<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.TIME" title="sqlalchemy.types.TIME"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TIME</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.TIME.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TIME"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.TIME.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timezone</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">precision</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.TIME.__init__" title="Link to this definition">¶</a></dt>
<dd><p>Construct a TIME.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.TIME.params.timezone"></span><strong>timezone</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.TIME.params.timezone">¶</a> – boolean value if timezone present, default False</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.TIME.params.precision"></span><strong>precision</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.TIME.params.precision">¶</a> – <p>optional integer precision value</p>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4 版本加入.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.TSQUERY">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">TSQUERY</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.TSQUERY" title="Link to this definition">¶</a></dt>
<dd><p>Provide the PostgreSQL TSQUERY type.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.0rc1 版本加入.</span></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSQUERY" title="sqlalchemy.dialects.postgresql.TSQUERY"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.TSQUERY</span></code></a> (<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.TSVECTOR">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">TSVECTOR</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.TSVECTOR" title="Link to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSVECTOR" title="sqlalchemy.dialects.postgresql.TSVECTOR"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSVECTOR</span></code></a> type implements the PostgreSQL
text search type TSVECTOR.</p>
<p>It can be used to do full text queries on natural language
documents.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#postgresql-match"><span class="std std-ref">Full Text Search</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSVECTOR" title="sqlalchemy.dialects.postgresql.TSVECTOR"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.TSVECTOR</span></code></a> (<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">UUID</span></span></dt>
<dd><p>Represent the SQL UUID type.</p>
<p>This is the SQL-native form of the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Uuid" title="sqlalchemy.types.Uuid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Uuid</span></code></a> database agnostic
datatype, and is backwards compatible with the previous PostgreSQL-only
version of <code class="docutils literal notranslate"><span class="pre">UUID</span></code>.</p>
<p>The <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.UUID" title="sqlalchemy.types.UUID"><code class="xref py py-class docutils literal notranslate"><span class="pre">UUID</span></code></a> datatype only works on databases that have a
SQL datatype named <code class="docutils literal notranslate"><span class="pre">UUID</span></code>. It will not function for backends which don’t
have this exact-named type, including SQL Server. For backend-agnostic UUID
values with native support, including for SQL Server’s <code class="docutils literal notranslate"><span class="pre">UNIQUEIDENTIFIER</span></code>
datatype, use the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Uuid" title="sqlalchemy.types.Uuid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Uuid</span></code></a> datatype.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Uuid" title="sqlalchemy.types.Uuid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Uuid</span></code></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.UUID</span></code> (<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Uuid" title="sqlalchemy.types.Uuid"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Uuid</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.NativeForEmulated</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.UUID"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.UUID.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">as_uuid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Construct a <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.UUID" title="sqlalchemy.types.UUID"><code class="xref py py-class docutils literal notranslate"><span class="pre">UUID</span></code></a> type.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.dialects.postgresql.UUID.params.as_uuid"></span><strong>as_uuid=True</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.UUID.params.as_uuid">¶</a> – <p>if True, values will be interpreted
as Python uuid objects, converting to/from string via the
DBAPI.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">在 2.0 版本发生变更: </span><code class="docutils literal notranslate"><span class="pre">as_uuid</span></code> now defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
</div>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.INT4RANGE">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">INT4RANGE</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.INT4RANGE" title="Link to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL INT4RANGE type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT4RANGE" title="sqlalchemy.dialects.postgresql.INT4RANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.INT4RANGE</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractSingleRange" title="sqlalchemy.dialects.postgresql.ranges.AbstractSingleRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.AbstractSingleRange</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.INT8RANGE">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">INT8RANGE</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.INT8RANGE" title="Link to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL INT8RANGE type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT8RANGE" title="sqlalchemy.dialects.postgresql.INT8RANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.INT8RANGE</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractSingleRange" title="sqlalchemy.dialects.postgresql.ranges.AbstractSingleRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.AbstractSingleRange</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.NUMRANGE">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">NUMRANGE</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.NUMRANGE" title="Link to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL NUMRANGE type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.NUMRANGE" title="sqlalchemy.dialects.postgresql.NUMRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.NUMRANGE</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractSingleRange" title="sqlalchemy.dialects.postgresql.ranges.AbstractSingleRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.AbstractSingleRange</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.DATERANGE">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">DATERANGE</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.DATERANGE" title="Link to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL DATERANGE type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.DATERANGE" title="sqlalchemy.dialects.postgresql.DATERANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.DATERANGE</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractSingleRange" title="sqlalchemy.dialects.postgresql.ranges.AbstractSingleRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.AbstractSingleRange</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.TSRANGE">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">TSRANGE</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.TSRANGE" title="Link to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL TSRANGE type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSRANGE" title="sqlalchemy.dialects.postgresql.TSRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.TSRANGE</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractSingleRange" title="sqlalchemy.dialects.postgresql.ranges.AbstractSingleRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.AbstractSingleRange</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.TSTZRANGE">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">TSTZRANGE</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.TSTZRANGE" title="Link to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL TSTZRANGE type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSTZRANGE" title="sqlalchemy.dialects.postgresql.TSTZRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.TSTZRANGE</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractSingleRange" title="sqlalchemy.dialects.postgresql.ranges.AbstractSingleRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.AbstractSingleRange</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.INT4MULTIRANGE">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">INT4MULTIRANGE</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.INT4MULTIRANGE" title="Link to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL INT4MULTIRANGE type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT4MULTIRANGE" title="sqlalchemy.dialects.postgresql.INT4MULTIRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.INT4MULTIRANGE</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractMultiRange" title="sqlalchemy.dialects.postgresql.ranges.AbstractMultiRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.AbstractMultiRange</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.INT8MULTIRANGE">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">INT8MULTIRANGE</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.INT8MULTIRANGE" title="Link to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL INT8MULTIRANGE type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT8MULTIRANGE" title="sqlalchemy.dialects.postgresql.INT8MULTIRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.INT8MULTIRANGE</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractMultiRange" title="sqlalchemy.dialects.postgresql.ranges.AbstractMultiRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.AbstractMultiRange</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.NUMMULTIRANGE">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">NUMMULTIRANGE</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.NUMMULTIRANGE" title="Link to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL NUMMULTIRANGE type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.NUMMULTIRANGE" title="sqlalchemy.dialects.postgresql.NUMMULTIRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.NUMMULTIRANGE</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractMultiRange" title="sqlalchemy.dialects.postgresql.ranges.AbstractMultiRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.AbstractMultiRange</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.DATEMULTIRANGE">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">DATEMULTIRANGE</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.DATEMULTIRANGE" title="Link to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL DATEMULTIRANGE type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.DATEMULTIRANGE" title="sqlalchemy.dialects.postgresql.DATEMULTIRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.DATEMULTIRANGE</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractMultiRange" title="sqlalchemy.dialects.postgresql.ranges.AbstractMultiRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.AbstractMultiRange</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.TSMULTIRANGE">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">TSMULTIRANGE</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.TSMULTIRANGE" title="Link to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL TSRANGE type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSMULTIRANGE" title="sqlalchemy.dialects.postgresql.TSMULTIRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.TSMULTIRANGE</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractMultiRange" title="sqlalchemy.dialects.postgresql.ranges.AbstractMultiRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.AbstractMultiRange</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.TSTZMULTIRANGE">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">TSTZMULTIRANGE</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.TSTZMULTIRANGE" title="Link to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL TSTZRANGE type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSTZMULTIRANGE" title="sqlalchemy.dialects.postgresql.TSTZMULTIRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.TSTZMULTIRANGE</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractMultiRange" title="sqlalchemy.dialects.postgresql.ranges.AbstractMultiRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.AbstractMultiRange</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.MultiRange">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">MultiRange</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.MultiRange" title="Link to this definition">¶</a></dt>
<dd><p>Represents a multirange sequence.</p>
<p>This list subclass is an utility to allow automatic type inference of
the proper multi-range SQL type depending on the single range values.
This is useful when operating on literal multi-ranges:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sa</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">MultiRange</span><span class="p">,</span> <span class="n">Range</span>

<span class="n">value</span> <span class="o">=</span> <span class="n">literal</span><span class="p">(</span><span class="n">MultiRange</span><span class="p">([</span><span class="n">Range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]))</span>

<span class="n">select</span><span class="p">(</span><span class="n">tbl</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tbl</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)(</span><span class="n">MultiRange</span><span class="p">([</span><span class="n">Range</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)])))</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.26 版本加入.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<ul class="simple">
<li><p><a class="reference internal" href="#postgresql-multirange-list-use"><span class="std std-ref">使用多范围序列推断多范围类型</span></a>.</p></li>
</ul>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.MultiRange" title="sqlalchemy.dialects.postgresql.MultiRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.MultiRange</span></code></a> (<code class="docutils literal notranslate"><span class="pre">builtins.list</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Generic</span></code>)</p>
</div>
</dd></dl>

</section>
<section id="postgresql-sql">
<h2>PostgreSQL SQL 元素和函数<a class="headerlink" href="#postgresql-sql" title="Link to this heading">¶</a></h2>
<p>PostgreSQL SQL Elements and Functions</p>
<div class="table-wrapper longtable docutils container">
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.aggregate_order_by"><span class="sig-name descname">aggregate_order_by</span></a></p></td>
<td><p>Represent a PostgreSQL aggregate order by expression.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.All"><span class="sig-name descname">All</span></a>(other, arrexpr[, operator])</p></td>
<td><p>A synonym for the ARRAY-level <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY.Comparator.all" title="sqlalchemy.types.ARRAY.Comparator.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.all()</span></code></a> method.
See that method for details.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Any"><span class="sig-name descname">Any</span></a>(other, arrexpr[, operator])</p></td>
<td><p>A synonym for the ARRAY-level <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY.Comparator.any" title="sqlalchemy.types.ARRAY.Comparator.any"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.any()</span></code></a> method.
See that method for details.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.array"><span class="sig-name descname">array</span></a></p></td>
<td><p>A PostgreSQL ARRAY literal.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.array_agg"><span class="sig-name descname">array_agg</span></a>(*arg, **kw)</p></td>
<td><p>PostgreSQL-specific form of <a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.array_agg" title="sqlalchemy.sql.functions.array_agg"><code class="xref py py-class docutils literal notranslate"><span class="pre">array_agg</span></code></a>, ensures
return type is <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> and not
the plain <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a>, unless an explicit <code class="docutils literal notranslate"><span class="pre">type_</span></code>
is passed.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.distinct_on"><span class="sig-name descname">distinct_on</span></a>(*expr)</p></td>
<td><p>apply a DISTINCT_ON to a SELECT statement</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.hstore"><span class="sig-name descname">hstore</span></a></p></td>
<td><p>Construct an hstore value within a SQL expression using the
PostgreSQL <code class="docutils literal notranslate"><span class="pre">hstore()</span></code> function.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.phraseto_tsquery"><span class="sig-name descname">phraseto_tsquery</span></a></p></td>
<td><p>The PostgreSQL <code class="docutils literal notranslate"><span class="pre">phraseto_tsquery</span></code> SQL function.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.plainto_tsquery"><span class="sig-name descname">plainto_tsquery</span></a></p></td>
<td><p>The PostgreSQL <code class="docutils literal notranslate"><span class="pre">plainto_tsquery</span></code> SQL function.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.to_tsquery"><span class="sig-name descname">to_tsquery</span></a></p></td>
<td><p>The PostgreSQL <code class="docutils literal notranslate"><span class="pre">to_tsquery</span></code> SQL function.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.to_tsvector"><span class="sig-name descname">to_tsvector</span></a></p></td>
<td><p>The PostgreSQL <code class="docutils literal notranslate"><span class="pre">to_tsvector</span></code> SQL function.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ts_headline"><span class="sig-name descname">ts_headline</span></a></p></td>
<td><p>The PostgreSQL <code class="docutils literal notranslate"><span class="pre">ts_headline</span></code> SQL function.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.websearch_to_tsquery"><span class="sig-name descname">websearch_to_tsquery</span></a></p></td>
<td><p>The PostgreSQL <code class="docutils literal notranslate"><span class="pre">websearch_to_tsquery</span></code> SQL function.</p></td>
</tr>
</tbody>
</table>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.aggregate_order_by">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">aggregate_order_by</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.aggregate_order_by" title="Link to this definition">¶</a></dt>
<dd><p>Represent a PostgreSQL aggregate order by expression.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">aggregate_order_by</span>

<span class="n">expr</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">array_agg</span><span class="p">(</span><span class="n">aggregate_order_by</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">desc</span><span class="p">()))</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span></pre></div>
</div>
<p>would represent the expression:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">array_agg</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table</span><span class="p">;</span></pre></div>
</div>
<p>Similarly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">expr</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">string_agg</span><span class="p">(</span>
    <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">aggregate_order_by</span><span class="p">(</span><span class="n">literal_column</span><span class="p">(</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="p">),</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span></pre></div>
</div>
<p>Would represent:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">string_agg</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table</span><span class="p">;</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.array_agg" title="sqlalchemy.sql.functions.array_agg"><code class="xref py py-class docutils literal notranslate"><span class="pre">array_agg</span></code></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.aggregate_order_by" title="sqlalchemy.dialects.postgresql.aggregate_order_by"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.aggregate_order_by</span></code></a> (<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.expression.ColumnElement</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.array">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">array</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.array" title="Link to this definition">¶</a></dt>
<dd><p>A PostgreSQL ARRAY literal.</p>
<p>This is used to produce ARRAY literals in SQL expressions, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">array</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects</span><span class="w"> </span><span class="kn">import</span> <span class="n">postgresql</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">func</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]))</span>

<span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">dialect</span><span class="o">=</span><span class="n">postgresql</span><span class="o">.</span><span class="n">dialect</span><span class="p">()))</span></pre></div>
</div>
<p>Produces the SQL:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="nb">ARRAY</span><span class="p">[</span><span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">param_2</span><span class="p">)</span><span class="n">s</span><span class="p">]</span><span class="w"> </span><span class="o">||</span>
<span class="w">    </span><span class="nb">ARRAY</span><span class="p">[</span><span class="o">%</span><span class="p">(</span><span class="n">param_3</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">param_4</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">param_5</span><span class="p">)</span><span class="n">s</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">anon_1</span></pre></div>
</div>
<p>An instance of <a class="reference internal" href="#sqlalchemy.dialects.postgresql.array" title="sqlalchemy.dialects.postgresql.array.array"><code class="xref py py-class docutils literal notranslate"><span class="pre">array</span></code></a> will always have the datatype
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a>.  The “inner” type of the array is inferred from the
values present, unless the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.array.params.type_" title="sqlalchemy.dialects.postgresql.array"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">array.type_</span></code></a> keyword
argument is passed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">],</span> <span class="n">type_</span><span class="o">=</span><span class="n">CHAR</span><span class="p">)</span></pre></div>
</div>
<p>When constructing an empty array, the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.array.params.type_" title="sqlalchemy.dialects.postgresql.array"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">array.type_</span></code></a>
argument is particularly important as PostgreSQL server typically requires
a cast to be rendered for the inner type in order to render an empty array.
SQLAlchemy’s compilation for the empty array will produce this cast so
that:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">array</span><span class="p">([],</span> <span class="n">type_</span><span class="o">=</span><span class="n">Integer</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">dialect</span><span class="o">=</span><span class="n">postgresql</span><span class="o">.</span><span class="n">dialect</span><span class="p">()))</span></pre></div>
</div>
<p>Produces:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="nb">ARRAY</span><span class="p">[]::</span><span class="nb">INTEGER</span><span class="p">[]</span></pre></div>
</div>
<p>As required by PostgreSQL for empty arrays.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.40 版本加入: </span>added support to render empty PostgreSQL array
literals with a required cast.</p>
</div>
<p>Multidimensional arrays are produced by nesting <a class="reference internal" href="#sqlalchemy.dialects.postgresql.array" title="sqlalchemy.dialects.postgresql.array.array"><code class="xref py py-class docutils literal notranslate"><span class="pre">array</span></code></a> constructs.
The dimensionality of the final <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a>
type is calculated by
recursively adding the dimensions of the inner <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a>
type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span>
    <span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span> <span class="n">array</span><span class="p">([</span><span class="n">column</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)])]</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">dialect</span><span class="o">=</span><span class="n">postgresql</span><span class="o">.</span><span class="n">dialect</span><span class="p">()))</span></pre></div>
</div>
<p>Produces:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="nb">ARRAY</span><span class="p">[</span>
<span class="w">    </span><span class="nb">ARRAY</span><span class="p">[</span><span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">param_2</span><span class="p">)</span><span class="n">s</span><span class="p">],</span>
<span class="w">    </span><span class="nb">ARRAY</span><span class="p">[</span><span class="o">%</span><span class="p">(</span><span class="n">param_3</span><span class="p">)</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">param_4</span><span class="p">)</span><span class="n">s</span><span class="p">],</span>
<span class="w">    </span><span class="nb">ARRAY</span><span class="p">[</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">]</span>
<span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">anon_1</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a></p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.array.__init__"><span class="sig-name descname">__init__()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.array" title="sqlalchemy.dialects.postgresql.array"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.array</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.expression.ExpressionClauseList</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.array.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.array"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.array.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">clauses</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type_</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_TypeEngineArgument</span><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">typing_Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.array.__init__" title="Link to this definition">¶</a></dt>
<dd><p>Construct an ARRAY literal.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.array.params.clauses"></span><strong>clauses</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.array.params.clauses">¶</a> – iterable, such as a list, containing elements to be
rendered in the array</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.array.params.type_"></span><strong>type_</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.array.params.type_">¶</a> – optional type.  If omitted, the type is inferred
from the contents of the array.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.array_agg">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">array_agg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">arg</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.array_agg" title="Link to this definition">¶</a></dt>
<dd><p>PostgreSQL-specific form of <a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.array_agg" title="sqlalchemy.sql.functions.array_agg"><code class="xref py py-class docutils literal notranslate"><span class="pre">array_agg</span></code></a>, ensures
return type is <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> and not
the plain <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a>, unless an explicit <code class="docutils literal notranslate"><span class="pre">type_</span></code>
is passed.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Any">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">Any</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">other:</span> <span class="pre">typing_Any,</span> <span class="pre">arrexpr:</span> <span class="pre">_ColumnExpressionArgument[_T],</span> <span class="pre">operator:</span> <span class="pre">OperatorType</span> <span class="pre">=</span> <span class="pre">&lt;built-in</span> <span class="pre">function</span> <span class="pre">eq&gt;</span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Any" title="Link to this definition">¶</a></dt>
<dd><p>A synonym for the ARRAY-level <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY.Comparator.any" title="sqlalchemy.types.ARRAY.Comparator.any"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.any()</span></code></a> method.
See that method for details.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.All">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">All</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">other:</span> <span class="pre">typing_Any,</span> <span class="pre">arrexpr:</span> <span class="pre">_ColumnExpressionArgument[_T],</span> <span class="pre">operator:</span> <span class="pre">OperatorType</span> <span class="pre">=</span> <span class="pre">&lt;built-in</span> <span class="pre">function</span> <span class="pre">eq&gt;</span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.All" title="Link to this definition">¶</a></dt>
<dd><p>A synonym for the ARRAY-level <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY.Comparator.all" title="sqlalchemy.types.ARRAY.Comparator.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.all()</span></code></a> method.
See that method for details.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.hstore">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">hstore</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.hstore" title="Link to this definition">¶</a></dt>
<dd><p>Construct an hstore value within a SQL expression using the
PostgreSQL <code class="docutils literal notranslate"><span class="pre">hstore()</span></code> function.</p>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.hstore" title="sqlalchemy.dialects.postgresql.hstore.hstore"><code class="xref py py-class docutils literal notranslate"><span class="pre">hstore</span></code></a> function accepts one or two arguments as described
in the PostgreSQL documentation.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">hstore</span>

<span class="n">select</span><span class="p">(</span><span class="n">hstore</span><span class="p">(</span><span class="s2">&quot;key1&quot;</span><span class="p">,</span> <span class="s2">&quot;value1&quot;</span><span class="p">))</span>

<span class="n">select</span><span class="p">(</span>
    <span class="n">hstore</span><span class="p">(</span>
        <span class="n">array</span><span class="p">([</span><span class="s2">&quot;key1&quot;</span><span class="p">,</span> <span class="s2">&quot;key2&quot;</span><span class="p">,</span> <span class="s2">&quot;key3&quot;</span><span class="p">]),</span>
        <span class="n">array</span><span class="p">([</span><span class="s2">&quot;value1&quot;</span><span class="p">,</span> <span class="s2">&quot;value2&quot;</span><span class="p">,</span> <span class="s2">&quot;value3&quot;</span><span class="p">]),</span>
    <span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.hstore.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">HSTORE</span></code></a> - the PostgreSQL <code class="docutils literal notranslate"><span class="pre">HSTORE</span></code> datatype.</p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.hstore.inherit_cache"><span class="sig-name descname">inherit_cache</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.hstore.type"><span class="sig-name descname">type</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.hstore" title="sqlalchemy.dialects.postgresql.hstore"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.hstore</span></code></a> (<a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.GenericFunction" title="sqlalchemy.sql.functions.GenericFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.functions.GenericFunction</span></code></a>)</p>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.hstore.inherit_cache">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.hstore"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.hstore.</span></code></a><span class="sig-name descname"><span class="pre">inherit_cache</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">True</span></em><a class="headerlink" href="#sqlalchemy.dialects.postgresql.hstore.inherit_cache" title="Link to this definition">¶</a></dt>
<dd><p>Indicate if this <a class="reference internal" href="../core/foundation.html#sqlalchemy.sql.traversals.HasCacheKey" title="sqlalchemy.sql.traversals.HasCacheKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">HasCacheKey</span></code></a> instance should make use of the
cache key generation scheme used by its immediate superclass.</p>
<p>The attribute defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>, which indicates that a construct has
not yet taken into account whether or not its appropriate for it to
participate in caching; this is functionally equivalent to setting the
value to <code class="docutils literal notranslate"><span class="pre">False</span></code>, except that a warning is also emitted.</p>
<p>This flag can be set to <code class="docutils literal notranslate"><span class="pre">True</span></code> on a particular class, if the SQL that
corresponds to the object does not change based on attributes which
are local to this class, and not its superclass.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/compiler.html#compilerext-caching"><span class="std std-ref">Enabling Caching Support for Custom Constructs</span></a> - General guideslines for setting the
<a class="reference internal" href="../core/foundation.html#sqlalchemy.sql.traversals.HasCacheKey.inherit_cache" title="sqlalchemy.sql.traversals.HasCacheKey.inherit_cache"><code class="xref py py-attr docutils literal notranslate"><span class="pre">HasCacheKey.inherit_cache</span></code></a> attribute for third-party or user
defined SQL constructs.</p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.hstore.type">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.hstore"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.hstore.</span></code></a><span class="sig-name descname"><span class="pre">type</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.hstore.type" title="Link to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.hstore.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">HSTORE</span></code></a> 的别名</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.to_tsvector">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">to_tsvector</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.to_tsvector" title="Link to this definition">¶</a></dt>
<dd><p>The PostgreSQL <code class="docutils literal notranslate"><span class="pre">to_tsvector</span></code> SQL function.</p>
<p>This function applies automatic casting of the REGCONFIG argument
to use the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.REGCONFIG" title="sqlalchemy.dialects.postgresql.REGCONFIG"><code class="xref py py-class docutils literal notranslate"><span class="pre">REGCONFIG</span></code></a> datatype automatically,
and applies a return type of <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSVECTOR" title="sqlalchemy.dialects.postgresql.TSVECTOR"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSVECTOR</span></code></a>.</p>
<p>Assuming the PostgreSQL dialect has been imported, either by invoking
<code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">sqlalchemy.dialects</span> <span class="pre">import</span> <span class="pre">postgresql</span></code>, or by creating a PostgreSQL
engine using <code class="docutils literal notranslate"><span class="pre">create_engine(&quot;postgresql...&quot;)</span></code>,
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.to_tsvector" title="sqlalchemy.dialects.postgresql.to_tsvector"><code class="xref py py-class docutils literal notranslate"><span class="pre">to_tsvector</span></code></a> will be used automatically when invoking
<code class="docutils literal notranslate"><span class="pre">sqlalchemy.func.to_tsvector()</span></code>, ensuring the correct argument and return
type handlers are used at compile and execution time.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.0rc1 版本加入.</span></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.to_tsvector" title="sqlalchemy.dialects.postgresql.to_tsvector"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.to_tsvector</span></code></a> (<code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ext._regconfig_fn</span></code>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.to_tsquery">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">to_tsquery</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.to_tsquery" title="Link to this definition">¶</a></dt>
<dd><p>The PostgreSQL <code class="docutils literal notranslate"><span class="pre">to_tsquery</span></code> SQL function.</p>
<p>This function applies automatic casting of the REGCONFIG argument
to use the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.REGCONFIG" title="sqlalchemy.dialects.postgresql.REGCONFIG"><code class="xref py py-class docutils literal notranslate"><span class="pre">REGCONFIG</span></code></a> datatype automatically,
and applies a return type of <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSQUERY" title="sqlalchemy.dialects.postgresql.TSQUERY"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSQUERY</span></code></a>.</p>
<p>Assuming the PostgreSQL dialect has been imported, either by invoking
<code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">sqlalchemy.dialects</span> <span class="pre">import</span> <span class="pre">postgresql</span></code>, or by creating a PostgreSQL
engine using <code class="docutils literal notranslate"><span class="pre">create_engine(&quot;postgresql...&quot;)</span></code>,
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.to_tsquery" title="sqlalchemy.dialects.postgresql.to_tsquery"><code class="xref py py-class docutils literal notranslate"><span class="pre">to_tsquery</span></code></a> will be used automatically when invoking
<code class="docutils literal notranslate"><span class="pre">sqlalchemy.func.to_tsquery()</span></code>, ensuring the correct argument and return
type handlers are used at compile and execution time.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.0rc1 版本加入.</span></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.to_tsquery" title="sqlalchemy.dialects.postgresql.to_tsquery"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.to_tsquery</span></code></a> (<code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ext._regconfig_fn</span></code>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.plainto_tsquery">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">plainto_tsquery</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.plainto_tsquery" title="Link to this definition">¶</a></dt>
<dd><p>The PostgreSQL <code class="docutils literal notranslate"><span class="pre">plainto_tsquery</span></code> SQL function.</p>
<p>This function applies automatic casting of the REGCONFIG argument
to use the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.REGCONFIG" title="sqlalchemy.dialects.postgresql.REGCONFIG"><code class="xref py py-class docutils literal notranslate"><span class="pre">REGCONFIG</span></code></a> datatype automatically,
and applies a return type of <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSQUERY" title="sqlalchemy.dialects.postgresql.TSQUERY"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSQUERY</span></code></a>.</p>
<p>Assuming the PostgreSQL dialect has been imported, either by invoking
<code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">sqlalchemy.dialects</span> <span class="pre">import</span> <span class="pre">postgresql</span></code>, or by creating a PostgreSQL
engine using <code class="docutils literal notranslate"><span class="pre">create_engine(&quot;postgresql...&quot;)</span></code>,
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.plainto_tsquery" title="sqlalchemy.dialects.postgresql.plainto_tsquery"><code class="xref py py-class docutils literal notranslate"><span class="pre">plainto_tsquery</span></code></a> will be used automatically when
invoking <code class="docutils literal notranslate"><span class="pre">sqlalchemy.func.plainto_tsquery()</span></code>, ensuring the correct
argument and return type handlers are used at compile and execution time.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.0rc1 版本加入.</span></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.plainto_tsquery" title="sqlalchemy.dialects.postgresql.plainto_tsquery"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.plainto_tsquery</span></code></a> (<code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ext._regconfig_fn</span></code>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.phraseto_tsquery">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">phraseto_tsquery</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.phraseto_tsquery" title="Link to this definition">¶</a></dt>
<dd><p>The PostgreSQL <code class="docutils literal notranslate"><span class="pre">phraseto_tsquery</span></code> SQL function.</p>
<p>This function applies automatic casting of the REGCONFIG argument
to use the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.REGCONFIG" title="sqlalchemy.dialects.postgresql.REGCONFIG"><code class="xref py py-class docutils literal notranslate"><span class="pre">REGCONFIG</span></code></a> datatype automatically,
and applies a return type of <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSQUERY" title="sqlalchemy.dialects.postgresql.TSQUERY"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSQUERY</span></code></a>.</p>
<p>Assuming the PostgreSQL dialect has been imported, either by invoking
<code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">sqlalchemy.dialects</span> <span class="pre">import</span> <span class="pre">postgresql</span></code>, or by creating a PostgreSQL
engine using <code class="docutils literal notranslate"><span class="pre">create_engine(&quot;postgresql...&quot;)</span></code>,
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.phraseto_tsquery" title="sqlalchemy.dialects.postgresql.phraseto_tsquery"><code class="xref py py-class docutils literal notranslate"><span class="pre">phraseto_tsquery</span></code></a> will be used automatically when
invoking <code class="docutils literal notranslate"><span class="pre">sqlalchemy.func.phraseto_tsquery()</span></code>, ensuring the correct
argument and return type handlers are used at compile and execution time.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.0rc1 版本加入.</span></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.phraseto_tsquery" title="sqlalchemy.dialects.postgresql.phraseto_tsquery"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.phraseto_tsquery</span></code></a> (<code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ext._regconfig_fn</span></code>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.websearch_to_tsquery">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">websearch_to_tsquery</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.websearch_to_tsquery" title="Link to this definition">¶</a></dt>
<dd><p>The PostgreSQL <code class="docutils literal notranslate"><span class="pre">websearch_to_tsquery</span></code> SQL function.</p>
<p>This function applies automatic casting of the REGCONFIG argument
to use the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.REGCONFIG" title="sqlalchemy.dialects.postgresql.REGCONFIG"><code class="xref py py-class docutils literal notranslate"><span class="pre">REGCONFIG</span></code></a> datatype automatically,
and applies a return type of <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSQUERY" title="sqlalchemy.dialects.postgresql.TSQUERY"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSQUERY</span></code></a>.</p>
<p>Assuming the PostgreSQL dialect has been imported, either by invoking
<code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">sqlalchemy.dialects</span> <span class="pre">import</span> <span class="pre">postgresql</span></code>, or by creating a PostgreSQL
engine using <code class="docutils literal notranslate"><span class="pre">create_engine(&quot;postgresql...&quot;)</span></code>,
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.websearch_to_tsquery" title="sqlalchemy.dialects.postgresql.websearch_to_tsquery"><code class="xref py py-class docutils literal notranslate"><span class="pre">websearch_to_tsquery</span></code></a> will be used automatically when
invoking <code class="docutils literal notranslate"><span class="pre">sqlalchemy.func.websearch_to_tsquery()</span></code>, ensuring the correct
argument and return type handlers are used at compile and execution time.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.0rc1 版本加入.</span></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.websearch_to_tsquery" title="sqlalchemy.dialects.postgresql.websearch_to_tsquery"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.websearch_to_tsquery</span></code></a> (<code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ext._regconfig_fn</span></code>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ts_headline">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">ts_headline</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ts_headline" title="Link to this definition">¶</a></dt>
<dd><p>The PostgreSQL <code class="docutils literal notranslate"><span class="pre">ts_headline</span></code> SQL function.</p>
<p>This function applies automatic casting of the REGCONFIG argument
to use the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.REGCONFIG" title="sqlalchemy.dialects.postgresql.REGCONFIG"><code class="xref py py-class docutils literal notranslate"><span class="pre">REGCONFIG</span></code></a> datatype automatically,
and applies a return type of <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.TEXT" title="sqlalchemy.types.TEXT"><code class="xref py py-class docutils literal notranslate"><span class="pre">TEXT</span></code></a>.</p>
<p>Assuming the PostgreSQL dialect has been imported, either by invoking
<code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">sqlalchemy.dialects</span> <span class="pre">import</span> <span class="pre">postgresql</span></code>, or by creating a PostgreSQL
engine using <code class="docutils literal notranslate"><span class="pre">create_engine(&quot;postgresql...&quot;)</span></code>,
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ts_headline" title="sqlalchemy.dialects.postgresql.ts_headline"><code class="xref py py-class docutils literal notranslate"><span class="pre">ts_headline</span></code></a> will be used automatically when invoking
<code class="docutils literal notranslate"><span class="pre">sqlalchemy.func.ts_headline()</span></code>, ensuring the correct argument and return
type handlers are used at compile and execution time.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.0rc1 版本加入.</span></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ts_headline" title="sqlalchemy.dialects.postgresql.ts_headline"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ts_headline</span></code></a> (<code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ext._regconfig_fn</span></code>)</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.distinct_on">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">distinct_on</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">expr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_ColumnExpressionArgument</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DistinctOnClause</span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.distinct_on" title="Link to this definition">¶</a></dt>
<dd><p>apply a DISTINCT_ON to a SELECT statement</p>
<p>e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">tbl</span><span class="p">)</span><span class="o">.</span><span class="n">ext</span><span class="p">(</span><span class="n">distinct_on</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">some_col</span><span class="p">))</span></pre></div>
</div>
<p>this supersedes the previous approach of using
<code class="docutils literal notranslate"><span class="pre">select(tbl).distinct(t.c.some_col))</span></code> to apply a similar construct.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.1 版本加入.</span></p>
</div>
</dd></dl>

</section>
<section id="id11">
<h2>PostgreSQL 约束类型<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h2>
<p>PostgreSQL Constraint Types</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--11-input--1" name="tab-set--11" type="radio"><label class="tab-label" for="tab-set--11-input--1">中文</label><div class="tab-content docutils container">
<p>SQLAlchemy通过 <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExcludeConstraint</span></code></a> 类支持PostgreSQL EXCLUDE约束：</p>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ExcludeConstraint">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">ExcludeConstraint</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="Link to this definition">¶</a></dt>
<dd><p>A table-level EXCLUDE constraint.</p>
<p>Defines an EXCLUDE constraint as described in the <a class="reference external" href="https://www.postgresql.org/docs/current/static/sql-createtable.html#SQL-CREATETABLE-EXCLUDE">PostgreSQL
documentation</a>.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ExcludeConstraint</span></code></a> (<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ColumnCollectionConstraint" title="sqlalchemy.schema.ColumnCollectionConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.schema.ColumnCollectionConstraint</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ExcludeConstraint.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">elements</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.__init__" title="Link to this definition">¶</a></dt>
<dd><p>Create an <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExcludeConstraint</span></code></a> object.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">const</span> <span class="o">=</span> <span class="n">ExcludeConstraint</span><span class="p">(</span>
    <span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="s2">&quot;period&quot;</span><span class="p">),</span> <span class="s2">&quot;&amp;&amp;&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="s2">&quot;group&quot;</span><span class="p">),</span> <span class="s2">&quot;=&quot;</span><span class="p">),</span>
    <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="s2">&quot;group&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;some group&quot;</span><span class="p">),</span>
    <span class="n">ops</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;group&quot;</span><span class="p">:</span> <span class="s2">&quot;my_operator_class&quot;</span><span class="p">},</span>
<span class="p">)</span></pre></div>
</div>
<p>The constraint is normally embedded into the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>
construct
directly, or added later using <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.append_constraint" title="sqlalchemy.schema.Table.append_constraint"><code class="xref py py-meth docutils literal notranslate"><span class="pre">append_constraint()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;some_table&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;period&quot;</span><span class="p">,</span> <span class="n">TSRANGE</span><span class="p">()),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;group&quot;</span><span class="p">,</span> <span class="n">String</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">some_table</span><span class="o">.</span><span class="n">append_constraint</span><span class="p">(</span>
    <span class="n">ExcludeConstraint</span><span class="p">(</span>
        <span class="p">(</span><span class="n">some_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">period</span><span class="p">,</span> <span class="s2">&quot;&amp;&amp;&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">some_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">),</span>
        <span class="n">where</span><span class="o">=</span><span class="n">some_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">group</span> <span class="o">!=</span> <span class="s2">&quot;some group&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;some_table_excl_const&quot;</span><span class="p">,</span>
        <span class="n">ops</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;group&quot;</span><span class="p">:</span> <span class="s2">&quot;my_operator_class&quot;</span><span class="p">},</span>
    <span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>The exclude constraint defined in this example requires the
<code class="docutils literal notranslate"><span class="pre">btree_gist</span></code> extension, that can be created using the
command <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">EXTENSION</span> <span class="pre">btree_gist;</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.*elements"></span><strong>*elements</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.*elements">¶</a> – <p>A sequence of two tuples of the form <code class="docutils literal notranslate"><span class="pre">(column,</span> <span class="pre">operator)</span></code> where
“column” is either a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> object, or a SQL
expression element (e.g. <code class="docutils literal notranslate"><span class="pre">func.int8range(table.from,</span> <span class="pre">table.to)</span></code>)
or the name of a column as string, and “operator” is a string
containing the operator to use (e.g. <cite>“&amp;&amp;”</cite> or <cite>“=”</cite>).</p>
<p>In order to specify a column name when a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>
object is not available, while ensuring
that any necessary quoting rules take effect, an ad-hoc
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> or <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.column" title="sqlalchemy.sql.expression.column"><code class="xref py py-func docutils literal notranslate"><span class="pre">column()</span></code></a>
object should be used.
The <code class="docutils literal notranslate"><span class="pre">column</span></code> may also be a string SQL expression when
passed as <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.literal_column" title="sqlalchemy.sql.expression.literal_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">literal_column()</span></code></a> or
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.text" title="sqlalchemy.sql.expression.text"><code class="xref py py-func docutils literal notranslate"><span class="pre">text()</span></code></a></p>
</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.name"></span><strong>name</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.name">¶</a> – Optional, the in-database name of this constraint.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.deferrable"></span><strong>deferrable</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.deferrable">¶</a> – Optional bool.  If set, emit DEFERRABLE or NOT DEFERRABLE when
issuing DDL for this constraint.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.initially"></span><strong>initially</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.initially">¶</a> – Optional string.  If set, emit INITIALLY &lt;value&gt; when issuing DDL
for this constraint.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.using"></span><strong>using</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.using">¶</a> – Optional string.  If set, emit USING &lt;index_method&gt; when issuing DDL
for this constraint. Defaults to ‘gist’.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.where"></span><strong>where</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.where">¶</a> – <p>Optional SQL expression construct or literal SQL string.
If set, emit WHERE &lt;predicate&gt; when issuing DDL
for this constraint.</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.where" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ExcludeConstraint.where</span></code></a> argument to <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExcludeConstraint</span></code></a> can be passed as a Python string argument, which will be treated as <strong>trusted SQL text</strong> and rendered as given.  <strong>DO NOT PASS UNTRUSTED INPUT TO THIS PARAMETER</strong>.</p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.ops"></span><strong>ops</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.ops">¶</a> – <p>Optional dictionary.  Used to define operator classes for the
elements; works the same way as that of the
<a class="reference internal" href="#postgresql-operator-classes"><span class="std std-ref">postgresql_ops</span></a>
parameter specified to the <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> construct.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#postgresql-operator-classes"><span class="std std-ref">Operator Classes</span></a> - general description of how
PostgreSQL operator classes are specified.</p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<p>例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExcludeConstraint</span><span class="p">,</span> <span class="n">TSRANGE</span>


<span class="k">class</span><span class="w"> </span><span class="nc">RoomBooking</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;room_booking&quot;</span>

    <span class="n">room</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">(),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">during</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">TSRANGE</span><span class="p">())</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span><span class="n">ExcludeConstraint</span><span class="p">((</span><span class="s2">&quot;room&quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;during&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;&amp;&quot;</span><span class="p">)),)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
</div>
<input class="tab-input" id="tab-set--11-input--2" name="tab-set--11" type="radio"><label class="tab-label" for="tab-set--11-input--2">英文</label><div class="tab-content docutils container">
<p>SQLAlchemy supports PostgreSQL EXCLUDE constraints via the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExcludeConstraint</span></code></a> class:</p>
<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">ExcludeConstraint</span></span></dt>
<dd><p>A table-level EXCLUDE constraint.</p>
<p>Defines an EXCLUDE constraint as described in the <a class="reference external" href="https://www.postgresql.org/docs/current/static/sql-createtable.html#SQL-CREATETABLE-EXCLUDE">PostgreSQL
documentation</a>.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ExcludeConstraint</span></code></a> (<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ColumnCollectionConstraint" title="sqlalchemy.schema.ColumnCollectionConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.schema.ColumnCollectionConstraint</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ExcludeConstraint.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">elements</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Create an <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExcludeConstraint</span></code></a> object.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">const</span> <span class="o">=</span> <span class="n">ExcludeConstraint</span><span class="p">(</span>
    <span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="s2">&quot;period&quot;</span><span class="p">),</span> <span class="s2">&quot;&amp;&amp;&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="s2">&quot;group&quot;</span><span class="p">),</span> <span class="s2">&quot;=&quot;</span><span class="p">),</span>
    <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="s2">&quot;group&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;some group&quot;</span><span class="p">),</span>
    <span class="n">ops</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;group&quot;</span><span class="p">:</span> <span class="s2">&quot;my_operator_class&quot;</span><span class="p">},</span>
<span class="p">)</span></pre></div>
</div>
<p>The constraint is normally embedded into the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>
construct
directly, or added later using <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.append_constraint" title="sqlalchemy.schema.Table.append_constraint"><code class="xref py py-meth docutils literal notranslate"><span class="pre">append_constraint()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;some_table&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;period&quot;</span><span class="p">,</span> <span class="n">TSRANGE</span><span class="p">()),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;group&quot;</span><span class="p">,</span> <span class="n">String</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">some_table</span><span class="o">.</span><span class="n">append_constraint</span><span class="p">(</span>
    <span class="n">ExcludeConstraint</span><span class="p">(</span>
        <span class="p">(</span><span class="n">some_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">period</span><span class="p">,</span> <span class="s2">&quot;&amp;&amp;&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">some_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">),</span>
        <span class="n">where</span><span class="o">=</span><span class="n">some_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">group</span> <span class="o">!=</span> <span class="s2">&quot;some group&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;some_table_excl_const&quot;</span><span class="p">,</span>
        <span class="n">ops</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;group&quot;</span><span class="p">:</span> <span class="s2">&quot;my_operator_class&quot;</span><span class="p">},</span>
    <span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>The exclude constraint defined in this example requires the
<code class="docutils literal notranslate"><span class="pre">btree_gist</span></code> extension, that can be created using the
command <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">EXTENSION</span> <span class="pre">btree_gist;</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.*elements"></span><strong>*elements</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.*elements">¶</a> – <p>A sequence of two tuples of the form <code class="docutils literal notranslate"><span class="pre">(column,</span> <span class="pre">operator)</span></code> where
“column” is either a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> object, or a SQL
expression element (e.g. <code class="docutils literal notranslate"><span class="pre">func.int8range(table.from,</span> <span class="pre">table.to)</span></code>)
or the name of a column as string, and “operator” is a string
containing the operator to use (e.g. <cite>“&amp;&amp;”</cite> or <cite>“=”</cite>).</p>
<p>In order to specify a column name when a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>
object is not available, while ensuring
that any necessary quoting rules take effect, an ad-hoc
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> or <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.column" title="sqlalchemy.sql.expression.column"><code class="xref py py-func docutils literal notranslate"><span class="pre">column()</span></code></a>
object should be used.
The <code class="docutils literal notranslate"><span class="pre">column</span></code> may also be a string SQL expression when
passed as <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.literal_column" title="sqlalchemy.sql.expression.literal_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">literal_column()</span></code></a> or
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.text" title="sqlalchemy.sql.expression.text"><code class="xref py py-func docutils literal notranslate"><span class="pre">text()</span></code></a></p>
</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.name"></span><strong>name</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.name">¶</a> – Optional, the in-database name of this constraint.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.deferrable"></span><strong>deferrable</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.deferrable">¶</a> – Optional bool.  If set, emit DEFERRABLE or NOT DEFERRABLE when
issuing DDL for this constraint.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.initially"></span><strong>initially</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.initially">¶</a> – Optional string.  If set, emit INITIALLY &lt;value&gt; when issuing DDL
for this constraint.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.using"></span><strong>using</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.using">¶</a> – Optional string.  If set, emit USING &lt;index_method&gt; when issuing DDL
for this constraint. Defaults to ‘gist’.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.where"></span><strong>where</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.where">¶</a> – <p>Optional SQL expression construct or literal SQL string.
If set, emit WHERE &lt;predicate&gt; when issuing DDL
for this constraint.</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.where" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ExcludeConstraint.where</span></code></a> argument to <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExcludeConstraint</span></code></a> can be passed as a Python string argument, which will be treated as <strong>trusted SQL text</strong> and rendered as given.  <strong>DO NOT PASS UNTRUSTED INPUT TO THIS PARAMETER</strong>.</p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.ops"></span><strong>ops</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.ops">¶</a> – <p>Optional dictionary.  Used to define operator classes for the
elements; works the same way as that of the
<a class="reference internal" href="#postgresql-operator-classes"><span class="std std-ref">postgresql_ops</span></a>
parameter specified to the <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> construct.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#postgresql-operator-classes"><span class="std std-ref">Operator Classes</span></a> - general description of how
PostgreSQL operator classes are specified.</p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExcludeConstraint</span><span class="p">,</span> <span class="n">TSRANGE</span>


<span class="k">class</span><span class="w"> </span><span class="nc">RoomBooking</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;room_booking&quot;</span>

    <span class="n">room</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">(),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">during</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">TSRANGE</span><span class="p">())</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span><span class="n">ExcludeConstraint</span><span class="p">((</span><span class="s2">&quot;room&quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;during&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;&amp;&quot;</span><span class="p">)),)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
</div>
</div>
</section>
<section id="postgresql-dml">
<h2>PostgreSQL DML 构造<a class="headerlink" href="#postgresql-dml" title="Link to this heading">¶</a></h2>
<p>PostgreSQL DML Constructs</p>
<div class="table-wrapper longtable docutils container">
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.insert"><span class="sig-name descname">insert</span></a>(table)</p></td>
<td><p>Construct a PostgreSQL-specific variant <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert" title="sqlalchemy.dialects.postgresql.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a>
construct.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert"><span class="sig-name descname">Insert</span></a></p></td>
<td><p>PostgreSQL-specific implementation of INSERT.</p></td>
</tr>
</tbody>
</table>
</div>
<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.insert">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">insert</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_DMLTableArgument</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert" title="sqlalchemy.dialects.postgresql.Insert"><span class="pre">Insert</span></a></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.insert" title="Link to this definition">¶</a></dt>
<dd><p>Construct a PostgreSQL-specific variant <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert" title="sqlalchemy.dialects.postgresql.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a>
construct.</p>
<div class="inherited-member docutils container">
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.insert" title="sqlalchemy.dialects.postgresql.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.insert()</span></code></a> function creates
a <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert" title="sqlalchemy.dialects.postgresql.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Insert</span></code></a>.  This class is based
on the dialect-agnostic <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> construct which may
be constructed using the <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.insert" title="sqlalchemy.sql.expression.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a> function in
SQLAlchemy Core.</p>
</div>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert" title="sqlalchemy.dialects.postgresql.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> construct includes additional methods
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update()</span></code></a>,
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.on_conflict_do_nothing()</span></code></a>.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Insert">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">Insert</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Insert" title="Link to this definition">¶</a></dt>
<dd><p>PostgreSQL-specific implementation of INSERT.</p>
<p>Adds methods for PG-specific syntaxes such as ON CONFLICT.</p>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert" title="sqlalchemy.dialects.postgresql.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> object is created using the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.insert" title="sqlalchemy.dialects.postgresql.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.insert()</span></code></a> function.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.excluded"><span class="sig-name descname">excluded</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.inherit_cache"><span class="sig-name descname">inherit_cache</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing"><span class="sig-name descname">on_conflict_do_nothing()</span></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><span class="sig-name descname">on_conflict_do_update()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert" title="sqlalchemy.dialects.postgresql.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Insert</span></code></a> (<a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.expression.Insert</span></code></a>)</p>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Insert.excluded">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Insert.</span></code></a><span class="sig-name descname"><span class="pre">excluded</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Insert.excluded" title="Link to this definition">¶</a></dt>
<dd><p>Provide the <code class="docutils literal notranslate"><span class="pre">excluded</span></code> namespace for an ON CONFLICT statement</p>
<p>PG’s ON CONFLICT clause allows reference to the row that would
be inserted, known as <code class="docutils literal notranslate"><span class="pre">excluded</span></code>.  This attribute provides
all columns in this row to be referenceable.</p>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.excluded" title="sqlalchemy.dialects.postgresql.Insert.excluded"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Insert.excluded</span></code></a> attribute is an
instance of <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnCollection" title="sqlalchemy.sql.expression.ColumnCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnCollection</span></code></a>, which provides
an interface the same as that of the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.c" title="sqlalchemy.schema.Table.c"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Table.c</span></code></a>
collection described at <a class="reference internal" href="../core/metadata.html#metadata-tables-and-columns"><span class="std std-ref">访问表和列</span></a>.
With this collection, ordinary names are accessible like attributes
(e.g. <code class="docutils literal notranslate"><span class="pre">stmt.excluded.some_column</span></code>), but special names and
dictionary method names should be accessed using indexed access,
such as <code class="docutils literal notranslate"><span class="pre">stmt.excluded[&quot;column</span> <span class="pre">name&quot;]</span></code> or
<code class="docutils literal notranslate"><span class="pre">stmt.excluded[&quot;values&quot;]</span></code>.   See the docstring for
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnCollection" title="sqlalchemy.sql.expression.ColumnCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnCollection</span></code></a> for further examples.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#postgresql-insert-on-conflict"><span class="std std-ref">INSERT…ON CONFLICT (Upsert)</span></a> - example of how
to use <code class="xref py py-attr docutils literal notranslate"><span class="pre">Insert.excluded</span></code></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Insert.inherit_cache">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Insert.</span></code></a><span class="sig-name descname"><span class="pre">inherit_cache</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">True</span></em><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Insert.inherit_cache" title="Link to this definition">¶</a></dt>
<dd><p>Indicate if this <a class="reference internal" href="../core/foundation.html#sqlalchemy.sql.traversals.HasCacheKey" title="sqlalchemy.sql.traversals.HasCacheKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">HasCacheKey</span></code></a> instance should make use of the
cache key generation scheme used by its immediate superclass.</p>
<p>The attribute defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>, which indicates that a construct has
not yet taken into account whether or not its appropriate for it to
participate in caching; this is functionally equivalent to setting the
value to <code class="docutils literal notranslate"><span class="pre">False</span></code>, except that a warning is also emitted.</p>
<p>This flag can be set to <code class="docutils literal notranslate"><span class="pre">True</span></code> on a particular class, if the SQL that
corresponds to the object does not change based on attributes which
are local to this class, and not its superclass.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/compiler.html#compilerext-caching"><span class="std std-ref">Enabling Caching Support for Custom Constructs</span></a> - General guideslines for setting the
<a class="reference internal" href="../core/foundation.html#sqlalchemy.sql.traversals.HasCacheKey.inherit_cache" title="sqlalchemy.sql.traversals.HasCacheKey.inherit_cache"><code class="xref py py-attr docutils literal notranslate"><span class="pre">HasCacheKey.inherit_cache</span></code></a> attribute for third-party or user
defined SQL constructs.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Insert.</span></code></a><span class="sig-name descname"><span class="pre">on_conflict_do_nothing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">constraint</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ColumnCollectionConstraint" title="sqlalchemy.sql.schema.ColumnCollectionConstraint"><span class="pre">ColumnCollectionConstraint</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.sql.schema.Index"><span class="pre">Index</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_elements</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.sql.schema.Column"><span class="pre">Column</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DDLConstraintColumnRole</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_where</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">WhereHavingRole</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing" title="Link to this definition">¶</a></dt>
<dd><p>Specifies a DO NOTHING action for ON CONFLICT clause.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">constraint</span></code> and <code class="docutils literal notranslate"><span class="pre">index_elements</span></code> arguments
are optional, but only one of these can be specified.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing.params.constraint"></span><strong>constraint</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing.params.constraint">¶</a> – The name of a unique or exclusion constraint on the table,
or the constraint object itself if it has a .name attribute.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing.params.index_elements"></span><strong>index_elements</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing.params.index_elements">¶</a> – A sequence consisting of string column names, <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>
objects, or other column expression objects that will be used
to infer a target index.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing.params.index_where"></span><strong>index_where</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing.params.index_where">¶</a> – Additional WHERE criterion that can be used to infer a
conditional target index.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#postgresql-insert-on-conflict"><span class="std std-ref">INSERT…ON CONFLICT (Upsert)</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Insert.</span></code></a><span class="sig-name descname"><span class="pre">on_conflict_do_update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">constraint</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ColumnCollectionConstraint" title="sqlalchemy.sql.schema.ColumnCollectionConstraint"><span class="pre">ColumnCollectionConstraint</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.sql.schema.Index"><span class="pre">Index</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_elements</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.sql.schema.Column"><span class="pre">Column</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DDLConstraintColumnRole</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_where</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">WhereHavingRole</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">set_</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Mapping</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnCollection" title="sqlalchemy.sql.base.ColumnCollection"><span class="pre">ColumnCollection</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">where</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">WhereHavingRole</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update" title="Link to this definition">¶</a></dt>
<dd><p>Specifies a DO UPDATE SET action for ON CONFLICT clause.</p>
<p>Either the <code class="docutils literal notranslate"><span class="pre">constraint</span></code> or <code class="docutils literal notranslate"><span class="pre">index_elements</span></code> argument is
required, but only one of these can be specified.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.constraint"></span><strong>constraint</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.constraint">¶</a> – The name of a unique or exclusion constraint on the table,
or the constraint object itself if it has a .name attribute.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.index_elements"></span><strong>index_elements</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.index_elements">¶</a> – A sequence consisting of string column names, <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>
objects, or other column expression objects that will be used
to infer a target index.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.index_where"></span><strong>index_where</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.index_where">¶</a> – Additional WHERE criterion that can be used to infer a
conditional target index.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.set_"></span><strong>set_</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.set_">¶</a> – <p>A dictionary or other mapping object
where the keys are either names of columns in the target table,
or <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> objects or other ORM-mapped columns
matching that of the target table, and expressions or literals
as values, specifying the <code class="docutils literal notranslate"><span class="pre">SET</span></code> actions to take.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4 版本加入: </span>The
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.set_" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.set_</span></code></a>
parameter supports <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> objects from the target
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> as keys.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>This dictionary does <strong>not</strong> take into account
Python-specified default UPDATE values or generation functions,
e.g. those specified using <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column.params.onupdate" title="sqlalchemy.schema.Column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Column.onupdate</span></code></a>.
These values will not be exercised for an ON CONFLICT style of
UPDATE, unless they are manually specified in the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.set_" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.set_</span></code></a> dictionary.</p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.where"></span><strong>where</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.where">¶</a> – Optional argument. An expression object representing a <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>
clause that restricts the rows affected by <code class="docutils literal notranslate"><span class="pre">DO</span> <span class="pre">UPDATE</span> <span class="pre">SET</span></code>. Rows not
meeting the <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> condition will not be updated (effectively a
<code class="docutils literal notranslate"><span class="pre">DO</span> <span class="pre">NOTHING</span></code> for those rows).</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#postgresql-insert-on-conflict"><span class="std std-ref">INSERT…ON CONFLICT (Upsert)</span></a></p>
</div>
</dd></dl>

</dd></dl>

</section>
<section id="module-sqlalchemy.dialects.postgresql.psycopg2">
<span id="psycopg2"></span><span id="postgresql-psycopg2"></span><h2>psycopg2<a class="headerlink" href="#module-sqlalchemy.dialects.postgresql.psycopg2" title="Link to this heading">¶</a></h2>
<p>Support for the PostgreSQL database via the psycopg2 driver.</p>
<section id="dialect-postgresql-psycopg2-url">
<h3>DBAPI<a class="headerlink" href="#dialect-postgresql-psycopg2-url" title="Link to this heading">¶</a></h3>
<p>Documentation and download information (if applicable) for psycopg2 is available at:
<a class="reference external" href="https://pypi.org/project/psycopg2/">https://pypi.org/project/psycopg2/</a></p>
</section>
<section id="dialect-postgresql-psycopg2-connect">
<h3>Connecting<a class="headerlink" href="#dialect-postgresql-psycopg2-connect" title="Link to this heading">¶</a></h3>
<p>Connect String:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">postgresql</span><span class="o">+</span><span class="n">psycopg2</span><span class="p">:</span><span class="o">//</span><span class="n">user</span><span class="p">:</span><span class="n">password</span><span class="nd">@host</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">dbname</span><span class="p">[</span><span class="err">?</span><span class="n">key</span><span class="o">=</span><span class="n">value</span><span class="o">&amp;</span><span class="n">key</span><span class="o">=</span><span class="n">value</span><span class="o">...</span><span class="p">]</span></pre></div>
</div>
</p>
</section>
<section id="psycopg2-connect-arguments">
<span id="psycopg2-toplevel"></span><h3>psycopg2 Connect Arguments<a class="headerlink" href="#psycopg2-connect-arguments" title="Link to this heading">¶</a></h3>
<p>Keyword arguments that are specific to the SQLAlchemy psycopg2 dialect
may be passed to <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>, and include the following:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">isolation_level</span></code>: This option, available for all PostgreSQL dialects,
includes the <code class="docutils literal notranslate"><span class="pre">AUTOCOMMIT</span></code> isolation level when using the psycopg2
dialect.   This option sets the <strong>default</strong> isolation level for the
connection that is set immediately upon connection to the database before
the connection is pooled.  This option is generally superseded by the more
modern <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.isolation_level" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.isolation_level</span></code></a>
execution option, detailed at <a class="reference internal" href="../core/connections.html#dbapi-autocommit"><span class="std std-ref">设置事务隔离级别（包括 DBAPI 自动提交）</span></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#psycopg2-isolation-level"><span class="std std-ref">Psycopg2 Transaction Isolation Level</span></a></p>
<p><a class="reference internal" href="../core/connections.html#dbapi-autocommit"><span class="std std-ref">设置事务隔离级别（包括 DBAPI 自动提交）</span></a></p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">client_encoding</span></code>: sets the client encoding in a libpq-agnostic way,
using psycopg2’s <code class="docutils literal notranslate"><span class="pre">set_client_encoding()</span></code> method.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#psycopg2-unicode"><span class="std std-ref">Unicode with Psycopg2</span></a></p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">executemany_mode</span></code>, <code class="docutils literal notranslate"><span class="pre">executemany_batch_page_size</span></code>,
<code class="docutils literal notranslate"><span class="pre">executemany_values_page_size</span></code>: Allows use of psycopg2
extensions for optimizing “executemany”-style queries.  See the referenced
section below for details.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#psycopg2-executemany-mode"><span class="std std-ref">Psycopg2 Fast Execution Helpers</span></a></p>
</div>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>The above keyword arguments are <strong>dialect</strong> keyword arguments, meaning
that they are passed as explicit keyword arguments to <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://scott:tiger@localhost/test&quot;</span><span class="p">,</span>
    <span class="n">isolation_level</span><span class="o">=</span><span class="s2">&quot;SERIALIZABLE&quot;</span><span class="p">,</span>
<span class="p">)</span></pre></div>
</div>
<p>These should not be confused with <strong>DBAPI</strong> connect arguments, which
are passed as part of the <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.connect_args" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.connect_args</span></code></a>
dictionary and/or are passed in the URL query string, as detailed in
the section <a class="reference internal" href="../core/engines.html#custom-dbapi-args"><span class="std std-ref">自定义 DBAPI connect() 参数/连接例程</span></a>.</p>
</div>
</section>
<section id="ssl-connections">
<span id="psycopg2-ssl"></span><h3>SSL Connections<a class="headerlink" href="#ssl-connections" title="Link to this heading">¶</a></h3>
<p>The psycopg2 module has a connection argument named <code class="docutils literal notranslate"><span class="pre">sslmode</span></code> for
controlling its behavior regarding secure (SSL) connections. The default is
<code class="docutils literal notranslate"><span class="pre">sslmode=prefer</span></code>; it will attempt an SSL connection and if that fails it
will fall back to an unencrypted connection. <code class="docutils literal notranslate"><span class="pre">sslmode=require</span></code> may be used
to ensure that only secure connections are established.  Consult the
psycopg2 / libpq documentation for further options that are available.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">sslmode</span></code> is specific to psycopg2 so it is included in the
connection URI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://scott:tiger@192.168.0.199:5432/test?sslmode=require&quot;</span>
<span class="p">)</span></pre></div>
</div>
</section>
<section id="unix-domain-connections">
<h3>Unix Domain Connections<a class="headerlink" href="#unix-domain-connections" title="Link to this heading">¶</a></h3>
<p>psycopg2 supports connecting via Unix domain connections.   When the <code class="docutils literal notranslate"><span class="pre">host</span></code>
portion of the URL is omitted, SQLAlchemy passes <code class="docutils literal notranslate"><span class="pre">None</span></code> to psycopg2,
which specifies Unix-domain communication rather than TCP/IP communication:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+psycopg2://user:password@/dbname&quot;</span><span class="p">)</span></pre></div>
</div>
<p>By default, the socket file used is to connect to a Unix-domain socket
in <code class="docutils literal notranslate"><span class="pre">/tmp</span></code>, or whatever socket directory was specified when PostgreSQL
was built.  This value can be overridden by passing a pathname to psycopg2,
using <code class="docutils literal notranslate"><span class="pre">host</span></code> as an additional keyword argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://user:password@/dbname?host=/var/lib/postgresql&quot;</span>
<span class="p">)</span></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>The format accepted here allows for a hostname in the main URL
in addition to the “host” query string argument.  <strong>When using this URL
format, the initial host is silently ignored</strong>.  That is, this URL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://user:password@myhost1/dbname?host=myhost2&quot;</span>
<span class="p">)</span></pre></div>
</div>
<p>Above, the hostname <code class="docutils literal notranslate"><span class="pre">myhost1</span></code> is <strong>silently ignored and discarded.</strong>  The
host which is connected is the <code class="docutils literal notranslate"><span class="pre">myhost2</span></code> host.</p>
<p>This is to maintain some degree of compatibility with PostgreSQL’s own URL
format which has been tested to behave the same way and for which tools like
PifPaf hardcode two hostnames.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference external" href="https://www.postgresql.org/docs/current/static/libpq-connect.html#LIBPQ-PQCONNECTDBPARAMS">PQconnectdbParams </a></p>
</div>
</section>
<section id="specifying-multiple-fallback-hosts">
<span id="psycopg2-multi-host"></span><h3>Specifying multiple fallback hosts<a class="headerlink" href="#specifying-multiple-fallback-hosts" title="Link to this heading">¶</a></h3>
<p>psycopg2 supports multiple connection points in the connection string.
When the <code class="docutils literal notranslate"><span class="pre">host</span></code> parameter is used multiple times in the query section of
the URL, SQLAlchemy will create a single string of the host and port
information provided to make the connections.  Tokens may consist of
<code class="docutils literal notranslate"><span class="pre">host::port</span></code> or just <code class="docutils literal notranslate"><span class="pre">host</span></code>; in the latter case, the default port
is selected by libpq.  In the example below, three host connections
are specified, for <code class="docutils literal notranslate"><span class="pre">HostA::PortA</span></code>, <code class="docutils literal notranslate"><span class="pre">HostB</span></code> connecting to the default port,
and <code class="docutils literal notranslate"><span class="pre">HostC::PortC</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://user:password@/dbname?host=HostA:PortA&amp;host=HostB&amp;host=HostC:PortC&quot;</span>
<span class="p">)</span></pre></div>
</div>
<p>As an alternative, libpq query string format also may be used; this specifies
<code class="docutils literal notranslate"><span class="pre">host</span></code> and <code class="docutils literal notranslate"><span class="pre">port</span></code> as single query string arguments with comma-separated
lists - the default port can be chosen by indicating an empty value
in the comma separated list:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://user:password@/dbname?host=HostA,HostB,HostC&amp;port=PortA,,PortC&quot;</span>
<span class="p">)</span></pre></div>
</div>
<p>With either URL style, connections to each host is attempted based on a
configurable strategy, which may be configured using the libpq
<code class="docutils literal notranslate"><span class="pre">target_session_attrs</span></code> parameter.  Per libpq this defaults to <code class="docutils literal notranslate"><span class="pre">any</span></code>
which indicates a connection to each host is then attempted until a connection is successful.
Other strategies include <code class="docutils literal notranslate"><span class="pre">primary</span></code>, <code class="docutils literal notranslate"><span class="pre">prefer-standby</span></code>, etc.  The complete
list is documented by PostgreSQL at
<a class="reference external" href="https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNSTRING">libpq connection strings</a>.</p>
<p>For example, to indicate two hosts using the <code class="docutils literal notranslate"><span class="pre">primary</span></code> strategy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://user:password@/dbname?host=HostA:PortA&amp;host=HostB&amp;host=HostC:PortC&amp;target_session_attrs=primary&quot;</span>
<span class="p">)</span></pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">在 1.4.40 版本发生变更: </span>Port specification in psycopg2 multiple host format
is repaired, previously ports were not correctly interpreted in this context.
libpq comma-separated format is also now supported.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference external" href="https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNSTRING">libpq connection strings</a> - please refer
to this section in the libpq documentation for complete background on multiple host support.</p>
</div>
</section>
<section id="empty-dsn-connections-environment-variable-connections">
<h3>Empty DSN Connections / Environment Variable Connections<a class="headerlink" href="#empty-dsn-connections-environment-variable-connections" title="Link to this heading">¶</a></h3>
<p>The psycopg2 DBAPI can connect to PostgreSQL by passing an empty DSN to the
libpq client library, which by default indicates to connect to a localhost
PostgreSQL database that is open for “trust” connections.  This behavior can be
further tailored using a particular set of environment variables which are
prefixed with <code class="docutils literal notranslate"><span class="pre">PG_...</span></code>, which are  consumed by <code class="docutils literal notranslate"><span class="pre">libpq</span></code> to take the place of
any or all elements of the connection string.</p>
<p>For this form, the URL can be passed without any elements other than the
initial scheme:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+psycopg2://&quot;</span><span class="p">)</span></pre></div>
</div>
<p>In the above form, a blank “dsn” string is passed to the <code class="docutils literal notranslate"><span class="pre">psycopg2.connect()</span></code>
function which in turn represents an empty DSN passed to libpq.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference external" href="https://www.postgresql.org/docs/current/libpq-envars.html">Environment Variables</a> -
PostgreSQL documentation on how to use <code class="docutils literal notranslate"><span class="pre">PG_...</span></code>
environment variables for connections.</p>
</div>
</section>
<section id="per-statement-connection-execution-options">
<span id="psycopg2-execution-options"></span><h3>Per-Statement/Connection Execution Options<a class="headerlink" href="#per-statement-connection-execution-options" title="Link to this heading">¶</a></h3>
<p>The following DBAPI-specific options are respected when used with
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execution_options" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code></a>,
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Executable.execution_options" title="sqlalchemy.sql.expression.Executable.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Executable.execution_options()</span></code></a>,
<a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query.execution_options" title="sqlalchemy.orm.Query.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.execution_options()</span></code></a>,
in addition to those not specific to DBAPIs:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">isolation_level</span></code> - Set the transaction isolation level for the lifespan
of a <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> (can only be set on a connection,
not a statement
or query).   See <a class="reference internal" href="#psycopg2-isolation-level"><span class="std std-ref">Psycopg2 Transaction Isolation Level</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stream_results</span></code> - Enable or disable usage of psycopg2 server side
cursors - this feature makes use of “named” cursors in combination with
special result handling methods so that result rows are not fully buffered.
Defaults to False, meaning cursors are buffered by default.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_row_buffer</span></code> - when using <code class="docutils literal notranslate"><span class="pre">stream_results</span></code>, an integer value that
specifies the maximum number of rows to buffer at a time.  This is
interpreted by the <code class="xref py py-class docutils literal notranslate"><span class="pre">BufferedRowCursorResult</span></code>, and if omitted the
buffer will grow to ultimately store 1000 rows at a time.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">在 1.4 版本发生变更: </span>The <code class="docutils literal notranslate"><span class="pre">max_row_buffer</span></code> size can now be greater than
1000, and the buffer will grow to that size.</p>
</div>
</li>
</ul>
</section>
<section id="psycopg2-fast-execution-helpers">
<span id="psycopg2-executemany-mode"></span><span id="psycopg2-batch-mode"></span><h3>Psycopg2 Fast Execution Helpers<a class="headerlink" href="#psycopg2-fast-execution-helpers" title="Link to this heading">¶</a></h3>
<p>Modern versions of psycopg2 include a feature known as
<a class="reference external" href="https://www.psycopg.org/docs/extras.html#fast-execution-helpers">Fast Execution Helpers </a>, which
have been shown in benchmarking to improve psycopg2’s executemany()
performance, primarily with INSERT statements, by at least
an order of magnitude.</p>
<p>SQLAlchemy implements a native form of the “insert many values”
handler that will rewrite a single-row INSERT statement to accommodate for
many values at once within an extended VALUES clause; this handler is
equivalent to psycopg2’s <code class="docutils literal notranslate"><span class="pre">execute_values()</span></code> handler; an overview of this
feature and its configuration are at <a class="reference internal" href="../core/connections.html#engine-insertmanyvalues"><span class="std std-ref">INSERT 语句的“插入多个值”行为</span></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入: </span>Replaced psycopg2’s <code class="docutils literal notranslate"><span class="pre">execute_values()</span></code> fast execution
helper with a native SQLAlchemy mechanism known as
<a class="reference internal" href="../core/connections.html#engine-insertmanyvalues"><span class="std std-ref">insertmanyvalues</span></a>.</p>
</div>
<p>The psycopg2 dialect retains the ability to use the psycopg2-specific
<code class="docutils literal notranslate"><span class="pre">execute_batch()</span></code> feature, although it is not expected that this is a widely
used feature.  The use of this extension may be enabled using the
<code class="docutils literal notranslate"><span class="pre">executemany_mode</span></code> flag which may be passed to <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://scott:tiger@host/dbname&quot;</span><span class="p">,</span>
    <span class="n">executemany_mode</span><span class="o">=</span><span class="s2">&quot;values_plus_batch&quot;</span><span class="p">,</span>
<span class="p">)</span></pre></div>
</div>
<p>Possible options for <code class="docutils literal notranslate"><span class="pre">executemany_mode</span></code> include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">values_only</span></code> - this is the default value.  SQLAlchemy’s native
<a class="reference internal" href="../core/connections.html#engine-insertmanyvalues"><span class="std std-ref">insertmanyvalues</span></a> handler is used for qualifying
INSERT statements, assuming
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.use_insertmanyvalues" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.use_insertmanyvalues</span></code></a> is left at
its default value of <code class="docutils literal notranslate"><span class="pre">True</span></code>.  This handler rewrites simple
INSERT statements to include multiple VALUES clauses so that many
parameter sets can be inserted with one statement.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'values_plus_batch'</span></code>- SQLAlchemy’s native
<a class="reference internal" href="../core/connections.html#engine-insertmanyvalues"><span class="std std-ref">insertmanyvalues</span></a> handler is used for qualifying
INSERT statements, assuming
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.use_insertmanyvalues" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.use_insertmanyvalues</span></code></a> is left at its default
value of <code class="docutils literal notranslate"><span class="pre">True</span></code>. Then, psycopg2’s <code class="docutils literal notranslate"><span class="pre">execute_batch()</span></code> handler is used for
qualifying UPDATE and DELETE statements when executed with multiple parameter
sets. When using this mode, the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult.rowcount" title="sqlalchemy.engine.CursorResult.rowcount"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CursorResult.rowcount</span></code></a>
attribute will not contain a value for executemany-style executions against
UPDATE and DELETE statements.</p></li>
</ul>
<div class="versionchanged">
<p><span class="versionmodified changed">在 2.0 版本发生变更: </span>Removed the <code class="docutils literal notranslate"><span class="pre">'batch'</span></code> and <code class="docutils literal notranslate"><span class="pre">'None'</span></code> options
from psycopg2 <code class="docutils literal notranslate"><span class="pre">executemany_mode</span></code>.  Control over batching for INSERT
statements is now configured via the
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.use_insertmanyvalues" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.use_insertmanyvalues</span></code></a> engine-level parameter.</p>
</div>
<p>The term “qualifying statements” refers to the statement being executed
being a Core <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.insert" title="sqlalchemy.sql.expression.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a>, <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.update" title="sqlalchemy.sql.expression.update"><code class="xref py py-func docutils literal notranslate"><span class="pre">update()</span></code></a>
or <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.delete" title="sqlalchemy.sql.expression.delete"><code class="xref py py-func docutils literal notranslate"><span class="pre">delete()</span></code></a> construct, and <strong>not</strong> a plain textual SQL
string or one constructed using <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.text" title="sqlalchemy.sql.expression.text"><code class="xref py py-func docutils literal notranslate"><span class="pre">text()</span></code></a>.  It also may <strong>not</strong> be
a special “extension” statement such as an “ON CONFLICT” “upsert” statement.
When using the ORM, all insert/update/delete statements used by the ORM flush process
are qualifying.</p>
<p>The “page size” for the psycopg2 “batch” strategy can be affected
by using the <code class="docutils literal notranslate"><span class="pre">executemany_batch_page_size</span></code> parameter, which defaults to
100.</p>
<p>For the “insertmanyvalues” feature, the page size can be controlled using the
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.insertmanyvalues_page_size" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.insertmanyvalues_page_size</span></code></a> parameter,
which defaults to 1000.  An example of modifying both parameters
is below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://scott:tiger@host/dbname&quot;</span><span class="p">,</span>
    <span class="n">executemany_mode</span><span class="o">=</span><span class="s2">&quot;values_plus_batch&quot;</span><span class="p">,</span>
    <span class="n">insertmanyvalues_page_size</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
    <span class="n">executemany_batch_page_size</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
<span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../core/connections.html#engine-insertmanyvalues"><span class="std std-ref">INSERT 语句的“插入多个值”行为</span></a> - background on “insertmanyvalues”</p>
<p><a class="reference internal" href="../tutorial/dbapi_transactions.html#tutorial-multiple-parameters"><span class="std std-ref">发送多个参数</span></a> - General information on using the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>
object to execute statements in such a way as to make
use of the DBAPI <code class="docutils literal notranslate"><span class="pre">.executemany()</span></code> method.</p>
</div>
</section>
<section id="unicode-with-psycopg2">
<span id="psycopg2-unicode"></span><h3>Unicode with Psycopg2<a class="headerlink" href="#unicode-with-psycopg2" title="Link to this heading">¶</a></h3>
<p>The psycopg2 DBAPI driver supports Unicode data transparently.</p>
<p>The client character encoding can be controlled for the psycopg2 dialect
in the following ways:</p>
<ul>
<li><p>For PostgreSQL 9.1 and above, the <code class="docutils literal notranslate"><span class="pre">client_encoding</span></code> parameter may be
passed in the database URL; this parameter is consumed by the underlying
<code class="docutils literal notranslate"><span class="pre">libpq</span></code> PostgreSQL client library:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://user:pass@host/dbname?client_encoding=utf8&quot;</span>
<span class="p">)</span></pre></div>
</div>
<p>Alternatively, the above <code class="docutils literal notranslate"><span class="pre">client_encoding</span></code> value may be passed using
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.connect_args" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.connect_args</span></code></a> for programmatic establishment with
<code class="docutils literal notranslate"><span class="pre">libpq</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://user:pass@host/dbname&quot;</span><span class="p">,</span>
    <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;client_encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;utf8&quot;</span><span class="p">},</span>
<span class="p">)</span></pre></div>
</div>
</li>
<li><p>For all PostgreSQL versions, psycopg2 supports a client-side encoding
value that will be passed to database connections when they are first
established.  The SQLAlchemy psycopg2 dialect supports this using the
<code class="docutils literal notranslate"><span class="pre">client_encoding</span></code> parameter passed to <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://user:pass@host/dbname&quot;</span><span class="p">,</span> <span class="n">client_encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span>
<span class="p">)</span></pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>The above <code class="docutils literal notranslate"><span class="pre">client_encoding</span></code> parameter admittedly is very similar
in appearance to usage of the parameter within the
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.connect_args" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.connect_args</span></code></a> dictionary; the difference
above is that the parameter is consumed by psycopg2 and is
passed to the database connection using <code class="docutils literal notranslate"><span class="pre">SET</span> <span class="pre">client_encoding</span> <span class="pre">TO</span>
<span class="pre">'utf8'</span></code>; in the previously mentioned style, the parameter is instead
passed through psycopg2 and consumed by the <code class="docutils literal notranslate"><span class="pre">libpq</span></code> library.</p>
</div>
</li>
<li><p>A common way to set up client encoding with PostgreSQL databases is to
ensure it is configured within the server-side postgresql.conf file;
this is the recommended way to set encoding for a server that is
consistently of one encoding in all databases:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># postgresql.conf file</span>

<span class="c1"># client_encoding = sql_ascii # actually, defaults to database</span>
<span class="c1"># encoding</span>
<span class="n">client_encoding</span> <span class="o">=</span> <span class="n">utf8</span></pre></div>
</div>
</li>
</ul>
</section>
<section id="transactions">
<h3>Transactions<a class="headerlink" href="#transactions" title="Link to this heading">¶</a></h3>
<p>The psycopg2 dialect fully supports SAVEPOINT and two-phase commit operations.</p>
</section>
<section id="psycopg2-transaction-isolation-level">
<span id="psycopg2-isolation-level"></span><h3>Psycopg2 Transaction Isolation Level<a class="headerlink" href="#psycopg2-transaction-isolation-level" title="Link to this heading">¶</a></h3>
<p>As discussed in <a class="reference internal" href="#postgresql-isolation-level"><span class="std std-ref">Transaction Isolation Level</span></a>,
all PostgreSQL dialects support setting of transaction isolation level
both via the <code class="docutils literal notranslate"><span class="pre">isolation_level</span></code> parameter passed to <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>
,
as well as the <code class="docutils literal notranslate"><span class="pre">isolation_level</span></code> argument used by
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execution_options" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code></a>.  When using the psycopg2 dialect
, these
options make use of psycopg2’s <code class="docutils literal notranslate"><span class="pre">set_isolation_level()</span></code> connection method,
rather than emitting a PostgreSQL directive; this is because psycopg2’s
API-level setting is always emitted at the start of each transaction in any
case.</p>
<p>The psycopg2 dialect supports these constants for isolation level:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">READ</span> <span class="pre">COMMITTED</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">READ</span> <span class="pre">UNCOMMITTED</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">REPEATABLE</span> <span class="pre">READ</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SERIALIZABLE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AUTOCOMMIT</span></code></p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#postgresql-isolation-level"><span class="std std-ref">Transaction Isolation Level</span></a></p>
<p><a class="reference internal" href="#pg8000-isolation-level"><span class="std std-ref">pg8000 Transaction Isolation Level</span></a></p>
</div>
</section>
<section id="notice-logging">
<h3>NOTICE logging<a class="headerlink" href="#notice-logging" title="Link to this heading">¶</a></h3>
<p>The psycopg2 dialect will log PostgreSQL NOTICE messages
via the <code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql</span></code> logger.  When this logger
is set to the <code class="docutils literal notranslate"><span class="pre">logging.INFO</span></code> level, notice messages will be logged:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;sqlalchemy.dialects.postgresql&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span></pre></div>
</div>
<p>Above, it is assumed that logging is configured externally.  If this is not
the case, configuration such as <code class="docutils literal notranslate"><span class="pre">logging.basicConfig()</span></code> must be utilized:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>  <span class="c1"># log messages to stdout</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;sqlalchemy.dialects.postgresql&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference external" href="https://docs.python.org/3/howto/logging.html">Logging HOWTO</a> - on the python.org website</p>
</div>
</section>
<section id="hstore-type">
<span id="psycopg2-hstore"></span><h3>HSTORE type<a class="headerlink" href="#hstore-type" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code> DBAPI includes an extension to natively handle marshalling of
the HSTORE type.   The SQLAlchemy psycopg2 dialect will enable this extension
by default when psycopg2 version 2.4 or greater is used, and
it is detected that the target database has the HSTORE type set up for use.
In other words, when the dialect makes the first
connection, a sequence like the following is performed:</p>
<ol class="arabic simple">
<li><p>Request the available HSTORE oids using
<code class="docutils literal notranslate"><span class="pre">psycopg2.extras.HstoreAdapter.get_oids()</span></code>.
If this function returns a list of HSTORE identifiers, we then determine
that the <code class="docutils literal notranslate"><span class="pre">HSTORE</span></code> extension is present.
This function is <strong>skipped</strong> if the version of psycopg2 installed is
less than version 2.4.</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">use_native_hstore</span></code> flag is at its default of <code class="docutils literal notranslate"><span class="pre">True</span></code>, and
we’ve detected that <code class="docutils literal notranslate"><span class="pre">HSTORE</span></code> oids are available, the
<code class="docutils literal notranslate"><span class="pre">psycopg2.extensions.register_hstore()</span></code> extension is invoked for all
connections.</p></li>
</ol>
<p>The <code class="docutils literal notranslate"><span class="pre">register_hstore()</span></code> extension has the effect of <strong>all Python
dictionaries being accepted as parameters regardless of the type of target
column in SQL</strong>. The dictionaries are converted by this extension into a
textual HSTORE expression.  If this behavior is not desired, disable the
use of the hstore extension by setting <code class="docutils literal notranslate"><span class="pre">use_native_hstore</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code> as
follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://scott:tiger@localhost/test&quot;</span><span class="p">,</span>
    <span class="n">use_native_hstore</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span></pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">HSTORE</span></code> type is <strong>still supported</strong> when the
<code class="docutils literal notranslate"><span class="pre">psycopg2.extensions.register_hstore()</span></code> extension is not used.  It merely
means that the coercion between Python dictionaries and the HSTORE
string format, on both the parameter side and the result side, will take
place within SQLAlchemy’s own marshalling logic, and not that of <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code>
which may be more performant.</p>
</section>
</section>
<section id="module-sqlalchemy.dialects.postgresql.psycopg">
<span id="psycopg"></span><span id="postgresql-psycopg"></span><h2>psycopg<a class="headerlink" href="#module-sqlalchemy.dialects.postgresql.psycopg" title="Link to this heading">¶</a></h2>
<p>Support for the PostgreSQL database via the psycopg (a.k.a. psycopg 3) driver.</p>
<section id="dialect-postgresql-psycopg-url">
<h3>DBAPI<a class="headerlink" href="#dialect-postgresql-psycopg-url" title="Link to this heading">¶</a></h3>
<p>Documentation and download information (if applicable) for psycopg (a.k.a. psycopg 3) is available at:
<a class="reference external" href="https://pypi.org/project/psycopg/">https://pypi.org/project/psycopg/</a></p>
</section>
<section id="dialect-postgresql-psycopg-connect">
<h3>Connecting<a class="headerlink" href="#dialect-postgresql-psycopg-connect" title="Link to this heading">¶</a></h3>
<p>Connect String:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">postgresql</span><span class="o">+</span><span class="n">psycopg</span><span class="p">:</span><span class="o">//</span><span class="n">user</span><span class="p">:</span><span class="n">password</span><span class="nd">@host</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">dbname</span><span class="p">[</span><span class="err">?</span><span class="n">key</span><span class="o">=</span><span class="n">value</span><span class="o">&amp;</span><span class="n">key</span><span class="o">=</span><span class="n">value</span><span class="o">...</span><span class="p">]</span></pre></div>
</div>
</p>
</section>
<p><code class="docutils literal notranslate"><span class="pre">psycopg</span></code> is the package and module name for version 3 of the <code class="docutils literal notranslate"><span class="pre">psycopg</span></code>
database driver, formerly known as <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code>.  This driver is different
enough from its <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code> predecessor that SQLAlchemy supports it
via a totally separate dialect; support for <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code> is expected to remain
for as long as that package continues to function for modern Python versions,
and also remains the default dialect for the <code class="docutils literal notranslate"><span class="pre">postgresql://</span></code> dialect
series.</p>
<p>The SQLAlchemy <code class="docutils literal notranslate"><span class="pre">psycopg</span></code> dialect provides both a sync and an async
implementation under the same dialect name. The proper version is
selected depending on how the engine is created:</p>
<ul>
<li><p>calling <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a> with <code class="docutils literal notranslate"><span class="pre">postgresql+psycopg://...</span></code> will
automatically select the sync version, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_engine</span>

<span class="n">sync_engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg://scott:tiger@localhost/test&quot;</span>
<span class="p">)</span></pre></div>
</div>
</li>
<li><p>calling <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.create_async_engine" title="sqlalchemy.ext.asyncio.create_async_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_async_engine()</span></code></a> with
<code class="docutils literal notranslate"><span class="pre">postgresql+psycopg://...</span></code> will automatically select the async version,
e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_async_engine</span>

<span class="n">asyncio_engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg://scott:tiger@localhost/test&quot;</span>
<span class="p">)</span></pre></div>
</div>
</li>
</ul>
<p>The asyncio version of the dialect may also be specified explicitly using the
<code class="docutils literal notranslate"><span class="pre">psycopg_async</span></code> suffix, as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_async_engine</span>

<span class="n">asyncio_engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg_async://scott:tiger@localhost/test&quot;</span>
<span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#postgresql-psycopg2"><span class="std std-ref">psycopg2</span></a> - The SQLAlchemy <code class="docutils literal notranslate"><span class="pre">psycopg</span></code>
dialect shares most of its behavior with the <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code> dialect.
Further documentation is available there.</p>
</div>
<section id="using-a-different-cursor-class">
<h3>Using a different Cursor class<a class="headerlink" href="#using-a-different-cursor-class" title="Link to this heading">¶</a></h3>
<p>One of the differences between <code class="docutils literal notranslate"><span class="pre">psycopg</span></code> and the older <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code>
is how bound parameters are handled: <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code> would bind them
client side, while <code class="docutils literal notranslate"><span class="pre">psycopg</span></code> by default will bind them server side.</p>
<p>It’s possible to configure <code class="docutils literal notranslate"><span class="pre">psycopg</span></code> to do client side binding by
specifying the <code class="docutils literal notranslate"><span class="pre">cursor_factory</span></code> to be <code class="docutils literal notranslate"><span class="pre">ClientCursor</span></code> when creating
the engine:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">psycopg</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientCursor</span>

<span class="n">client_side_engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg://...&quot;</span><span class="p">,</span>
    <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cursor_factory&quot;</span><span class="p">:</span> <span class="n">ClientCursor</span><span class="p">},</span>
<span class="p">)</span></pre></div>
</div>
<p>Similarly when using an async engine the <code class="docutils literal notranslate"><span class="pre">AsyncClientCursor</span></code> can be
specified:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">psycopg</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncClientCursor</span>

<span class="n">client_side_engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg://...&quot;</span><span class="p">,</span>
    <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cursor_factory&quot;</span><span class="p">:</span> <span class="n">AsyncClientCursor</span><span class="p">},</span>
<span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference external" href="https://www.psycopg.org/psycopg3/docs/advanced/cursors.html#client-side-binding-cursors">Client-side-binding cursors</a></p>
</div>
</section>
</section>
<section id="module-sqlalchemy.dialects.postgresql.pg8000">
<span id="pg8000"></span><span id="postgresql-pg8000"></span><h2>pg8000<a class="headerlink" href="#module-sqlalchemy.dialects.postgresql.pg8000" title="Link to this heading">¶</a></h2>
<p>Support for the PostgreSQL database via the pg8000 driver.</p>
<section id="dialect-postgresql-pg8000-url">
<h3>DBAPI<a class="headerlink" href="#dialect-postgresql-pg8000-url" title="Link to this heading">¶</a></h3>
<p>Documentation and download information (if applicable) for pg8000 is available at:
<a class="reference external" href="https://pypi.org/project/pg8000/">https://pypi.org/project/pg8000/</a></p>
</section>
<section id="dialect-postgresql-pg8000-connect">
<h3>Connecting<a class="headerlink" href="#dialect-postgresql-pg8000-connect" title="Link to this heading">¶</a></h3>
<p>Connect String:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">postgresql</span><span class="o">+</span><span class="n">pg8000</span><span class="p">:</span><span class="o">//</span><span class="n">user</span><span class="p">:</span><span class="n">password</span><span class="nd">@host</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">dbname</span><span class="p">[</span><span class="err">?</span><span class="n">key</span><span class="o">=</span><span class="n">value</span><span class="o">&amp;</span><span class="n">key</span><span class="o">=</span><span class="n">value</span><span class="o">...</span><span class="p">]</span></pre></div>
</div>
</p>
</section>
<div class="versionchanged">
<p><span class="versionmodified changed">在 1.4 版本发生变更: </span>The pg8000 dialect has been updated for version
1.16.6 and higher, and is again part of SQLAlchemy’s continuous integration
with full feature support.</p>
</div>
<section id="unicode">
<span id="pg8000-unicode"></span><h3>Unicode<a class="headerlink" href="#unicode" title="Link to this heading">¶</a></h3>
<p>pg8000 will encode / decode string values between it and the server using the
PostgreSQL <code class="docutils literal notranslate"><span class="pre">client_encoding</span></code> parameter; by default this is the value in
the <code class="docutils literal notranslate"><span class="pre">postgresql.conf</span></code> file, which often defaults to <code class="docutils literal notranslate"><span class="pre">SQL_ASCII</span></code>.
Typically, this can be changed to <code class="docutils literal notranslate"><span class="pre">utf-8</span></code>, as a more useful default:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># client_encoding = sql_ascii # actually, defaults to database encoding</span>
<span class="n">client_encoding</span> <span class="o">=</span> <span class="n">utf8</span></pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">client_encoding</span></code> can be overridden for a session by executing the SQL:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SET</span><span class="w"> </span><span class="n">CLIENT_ENCODING</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="p">;</span></pre></div>
</div>
<p>SQLAlchemy will execute this SQL on all new connections based on the value
passed to <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a> using the <code class="docutils literal notranslate"><span class="pre">client_encoding</span></code> parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+pg8000://user:pass@host/dbname&quot;</span><span class="p">,</span> <span class="n">client_encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span>
<span class="p">)</span></pre></div>
</div>
</section>
<section id="pg8000-ssl">
<span id="id15"></span><h3>SSL Connections<a class="headerlink" href="#pg8000-ssl" title="Link to this heading">¶</a></h3>
<p>pg8000 accepts a Python <code class="docutils literal notranslate"><span class="pre">SSLContext</span></code> object which may be specified using the
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.connect_args" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.connect_args</span></code></a> dictionary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">ssl</span>

<span class="n">ssl_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">()</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+pg8000://scott:tiger@192.168.0.199/test&quot;</span><span class="p">,</span>
    <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ssl_context&quot;</span><span class="p">:</span> <span class="n">ssl_context</span><span class="p">},</span>
<span class="p">)</span></pre></div>
</div>
<p>If the server uses an automatically-generated certificate that is self-signed
or does not match the host name (as seen from the client), it may also be
necessary to disable hostname checking:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">ssl</span>

<span class="n">ssl_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">()</span>
<span class="n">ssl_context</span><span class="o">.</span><span class="n">check_hostname</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">ssl_context</span><span class="o">.</span><span class="n">verify_mode</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_NONE</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+pg8000://scott:tiger@192.168.0.199/test&quot;</span><span class="p">,</span>
    <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ssl_context&quot;</span><span class="p">:</span> <span class="n">ssl_context</span><span class="p">},</span>
<span class="p">)</span></pre></div>
</div>
</section>
<section id="pg8000-transaction-isolation-level">
<span id="pg8000-isolation-level"></span><h3>pg8000 Transaction Isolation Level<a class="headerlink" href="#pg8000-transaction-isolation-level" title="Link to this heading">¶</a></h3>
<p>The pg8000 dialect offers the same isolation level settings as that
of the <a class="reference internal" href="#psycopg2-isolation-level"><span class="std std-ref">psycopg2</span></a> dialect:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">READ</span> <span class="pre">COMMITTED</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">READ</span> <span class="pre">UNCOMMITTED</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">REPEATABLE</span> <span class="pre">READ</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SERIALIZABLE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AUTOCOMMIT</span></code></p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#postgresql-isolation-level"><span class="std std-ref">Transaction Isolation Level</span></a></p>
<p><a class="reference internal" href="#psycopg2-isolation-level"><span class="std std-ref">Psycopg2 Transaction Isolation Level</span></a></p>
</div>
</section>
</section>
<section id="module-sqlalchemy.dialects.postgresql.asyncpg">
<span id="asyncpg"></span><span id="postgresql-asyncpg"></span><span id="dialect-postgresql-asyncpg"></span><h2>asyncpg<a class="headerlink" href="#module-sqlalchemy.dialects.postgresql.asyncpg" title="Link to this heading">¶</a></h2>
<p>Support for the PostgreSQL database via the asyncpg driver.</p>
<section id="dialect-postgresql-asyncpg-url">
<h3>DBAPI<a class="headerlink" href="#dialect-postgresql-asyncpg-url" title="Link to this heading">¶</a></h3>
<p>Documentation and download information (if applicable) for asyncpg is available at:
<a class="reference external" href="https://magicstack.github.io/asyncpg/">https://magicstack.github.io/asyncpg/</a></p>
</section>
<section id="dialect-postgresql-asyncpg-connect">
<h3>Connecting<a class="headerlink" href="#dialect-postgresql-asyncpg-connect" title="Link to this heading">¶</a></h3>
<p>Connect String:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">postgresql</span><span class="o">+</span><span class="n">asyncpg</span><span class="p">:</span><span class="o">//</span><span class="n">user</span><span class="p">:</span><span class="n">password</span><span class="nd">@host</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">dbname</span><span class="p">[</span><span class="err">?</span><span class="n">key</span><span class="o">=</span><span class="n">value</span><span class="o">&amp;</span><span class="n">key</span><span class="o">=</span><span class="n">value</span><span class="o">...</span><span class="p">]</span></pre></div>
</div>
</p>
</section>
<p>The asyncpg dialect is SQLAlchemy’s first Python asyncio dialect.</p>
<p>Using a special asyncio mediation layer, the asyncpg dialect is usable
as the backend for the <a class="reference internal" href="../orm/extensions/asyncio.html#asyncio-toplevel"><span class="std std-ref">SQLAlchemy asyncio</span></a>
extension package.</p>
<p>This dialect should normally be used only with the
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.create_async_engine" title="sqlalchemy.ext.asyncio.create_async_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_async_engine()</span></code></a> engine creation function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_async_engine</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+asyncpg://user:pass@hostname/dbname&quot;</span>
<span class="p">)</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4 版本加入.</span></p>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>By default asyncpg does not decode the <code class="docutils literal notranslate"><span class="pre">json</span></code> and <code class="docutils literal notranslate"><span class="pre">jsonb</span></code> types and
returns them as strings. SQLAlchemy sets default type decoder for <code class="docutils literal notranslate"><span class="pre">json</span></code>
and <code class="docutils literal notranslate"><span class="pre">jsonb</span></code> types using the python builtin <code class="docutils literal notranslate"><span class="pre">json.loads</span></code> function.
The json implementation used can be changed by setting the attribute
<code class="docutils literal notranslate"><span class="pre">json_deserializer</span></code> when creating the engine with
<code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code> or <code class="xref py py-func docutils literal notranslate"><span class="pre">create_async_engine()</span></code>.</p>
</div>
<section id="multihost-connections">
<span id="asyncpg-multihost"></span><h3>Multihost Connections<a class="headerlink" href="#multihost-connections" title="Link to this heading">¶</a></h3>
<p>The asyncpg dialect features support for multiple fallback hosts in the
same way as that of the psycopg2 and psycopg dialects.  The
syntax is the same,
using <code class="docutils literal notranslate"><span class="pre">host=&lt;host&gt;:&lt;port&gt;</span></code> combinations as additional query string arguments;
however, there is no default port, so all hosts must have a complete port number
present, otherwise an exception is raised:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+asyncpg://user:password@/dbname?host=HostA:5432&amp;host=HostB:5432&amp;host=HostC:5432&quot;</span>
<span class="p">)</span></pre></div>
</div>
<p>For complete background on this syntax, see <a class="reference internal" href="#psycopg2-multi-host"><span class="std std-ref">Specifying multiple fallback hosts</span></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.18 版本加入.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#psycopg2-multi-host"><span class="std std-ref">Specifying multiple fallback hosts</span></a></p>
</div>
</section>
<section id="prepared-statement-cache">
<span id="asyncpg-prepared-statement-cache"></span><h3>Prepared Statement Cache<a class="headerlink" href="#prepared-statement-cache" title="Link to this heading">¶</a></h3>
<p>The asyncpg SQLAlchemy dialect makes use of <code class="docutils literal notranslate"><span class="pre">asyncpg.connection.prepare()</span></code>
for all statements.   The prepared statement objects are cached after
construction which appears to grant a 10% or more performance improvement for
statement invocation.   The cache is on a per-DBAPI connection basis, which
means that the primary storage for prepared statements is within DBAPI
connections pooled within the connection pool.   The size of this cache
defaults to 100 statements per DBAPI connection and may be adjusted using the
<code class="docutils literal notranslate"><span class="pre">prepared_statement_cache_size</span></code> DBAPI argument (note that while this argument
is implemented by SQLAlchemy, it is part of the DBAPI emulation portion of the
asyncpg dialect, therefore is handled as a DBAPI argument, not a dialect
argument):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+asyncpg://user:pass@hostname/dbname?prepared_statement_cache_size=500&quot;</span>
<span class="p">)</span></pre></div>
</div>
<p>To disable the prepared statement cache, use a value of zero:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+asyncpg://user:pass@hostname/dbname?prepared_statement_cache_size=0&quot;</span>
<span class="p">)</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4.0b2 版本加入: </span>Added <code class="docutils literal notranslate"><span class="pre">prepared_statement_cache_size</span></code> for asyncpg.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>The <code class="docutils literal notranslate"><span class="pre">asyncpg</span></code> database driver necessarily uses caches for
PostgreSQL type OIDs, which become stale when custom PostgreSQL datatypes
such as <code class="docutils literal notranslate"><span class="pre">ENUM</span></code> objects are changed via DDL operations.   Additionally,
prepared statements themselves which are optionally cached by SQLAlchemy’s
driver as described above may also become “stale” when DDL has been emitted
to the PostgreSQL database which modifies the tables or other objects
involved in a particular prepared statement.</p>
<p>The SQLAlchemy asyncpg dialect will invalidate these caches within its local
process when statements that represent DDL are emitted on a local
connection, but this is only controllable within a single Python process /
database engine.     If DDL changes are made from other database engines
and/or processes, a running application may encounter asyncpg exceptions
<code class="docutils literal notranslate"><span class="pre">InvalidCachedStatementError</span></code> and/or <code class="docutils literal notranslate"><span class="pre">InternalServerError(&quot;cache</span> <span class="pre">lookup</span>
<span class="pre">failed</span> <span class="pre">for</span> <span class="pre">type</span> <span class="pre">&lt;oid&gt;&quot;)</span></code> if it refers to pooled database connections which
operated upon the previous structures. The SQLAlchemy asyncpg dialect will
recover from these error cases when the driver raises these exceptions by
clearing its internal caches as well as those of the asyncpg driver in
response to them, but cannot prevent them from being raised in the first
place if the cached prepared statement or asyncpg type caches have gone
stale, nor can it retry the statement as the PostgreSQL transaction is
invalidated when these errors occur.</p>
</div>
</section>
<section id="prepared-statement-name-with-pgbouncer">
<span id="asyncpg-prepared-statement-name"></span><h3>Prepared Statement Name with PGBouncer<a class="headerlink" href="#prepared-statement-name-with-pgbouncer" title="Link to this heading">¶</a></h3>
<p>By default, asyncpg enumerates prepared statements in numeric order, which
can lead to errors if a name has already been taken for another prepared
statement. This issue can arise if your application uses database proxies
such as PgBouncer to handle connections. One possible workaround is to
use dynamic prepared statement names, which asyncpg now supports through
an optional <code class="docutils literal notranslate"><span class="pre">name</span></code> value for the statement name. This allows you to
generate your own unique names that won’t conflict with existing ones.
To achieve this, you can provide a function that will be called every time
a prepared statement is prepared:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">uuid4</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+asyncpg://user:pass@somepgbouncer/dbname&quot;</span><span class="p">,</span>
    <span class="n">poolclass</span><span class="o">=</span><span class="n">NullPool</span><span class="p">,</span>
    <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;prepared_statement_name_func&quot;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;__asyncpg_</span><span class="si">{</span><span class="n">uuid4</span><span class="p">()</span><span class="si">}</span><span class="s2">__&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference external" href="https://github.com/MagicStack/asyncpg/issues/837">https://github.com/MagicStack/asyncpg/issues/837</a></p>
<p><a class="reference external" href="https://github.com/sqlalchemy/sqlalchemy/issues/6467">https://github.com/sqlalchemy/sqlalchemy/issues/6467</a></p>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>When using PGBouncer, to prevent a buildup of useless prepared statements in
your application, it’s important to use the <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullPool</span></code></a> pool
class, and to configure PgBouncer to use <a class="reference external" href="https://www.postgresql.org/docs/current/sql-discard.html">DISCARD</a>
when returning connections.  The DISCARD command is used to release resources held by the db connection,
including prepared statements. Without proper setup, prepared statements can
accumulate quickly and cause performance issues.</p>
</div>
</section>
<section id="disabling-the-postgresql-jit-to-improve-enum-datatype-handling">
<h3>Disabling the PostgreSQL JIT to improve ENUM datatype handling<a class="headerlink" href="#disabling-the-postgresql-jit-to-improve-enum-datatype-handling" title="Link to this heading">¶</a></h3>
<p>Asyncpg has an <a class="reference external" href="https://github.com/MagicStack/asyncpg/issues/727">issue</a> when
using PostgreSQL ENUM datatypes, where upon the creation of new database
connections, an expensive query may be emitted in order to retrieve metadata
regarding custom types which has been shown to negatively affect performance.
To mitigate this issue, the PostgreSQL “jit” setting may be disabled from the
client using this setting passed to <a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.create_async_engine" title="sqlalchemy.ext.asyncio.create_async_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_async_engine()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+asyncpg://user:password@localhost/tmp&quot;</span><span class="p">,</span>
    <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;server_settings&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;jit&quot;</span><span class="p">:</span> <span class="s2">&quot;off&quot;</span><span class="p">}},</span>
<span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference external" href="https://github.com/MagicStack/asyncpg/issues/727">https://github.com/MagicStack/asyncpg/issues/727</a></p>
</div>
</section>
</section>
<section id="module-sqlalchemy.dialects.postgresql.psycopg2cffi">
<span id="psycopg2cffi"></span><h2>psycopg2cffi<a class="headerlink" href="#module-sqlalchemy.dialects.postgresql.psycopg2cffi" title="Link to this heading">¶</a></h2>
<p>Support for the PostgreSQL database via the psycopg2cffi driver.</p>
<section id="dialect-postgresql-psycopg2cffi-url">
<h3>DBAPI<a class="headerlink" href="#dialect-postgresql-psycopg2cffi-url" title="Link to this heading">¶</a></h3>
<p>Documentation and download information (if applicable) for psycopg2cffi is available at:
<a class="reference external" href="https://pypi.org/project/psycopg2cffi/">https://pypi.org/project/psycopg2cffi/</a></p>
</section>
<section id="dialect-postgresql-psycopg2cffi-connect">
<h3>Connecting<a class="headerlink" href="#dialect-postgresql-psycopg2cffi-connect" title="Link to this heading">¶</a></h3>
<p>Connect String:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">postgresql</span><span class="o">+</span><span class="n">psycopg2cffi</span><span class="p">:</span><span class="o">//</span><span class="n">user</span><span class="p">:</span><span class="n">password</span><span class="nd">@host</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">dbname</span><span class="p">[</span><span class="err">?</span><span class="n">key</span><span class="o">=</span><span class="n">value</span><span class="o">&amp;</span><span class="n">key</span><span class="o">=</span><span class="n">value</span><span class="o">...</span><span class="p">]</span></pre></div>
</div>
</p>
</section>
<p><code class="docutils literal notranslate"><span class="pre">psycopg2cffi</span></code> is an adaptation of <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code>, using CFFI for the C
layer. This makes it suitable for use in e.g. PyPy. Documentation
is as per <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code>.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#module-sqlalchemy.dialects.postgresql.psycopg2" title="sqlalchemy.dialects.postgresql.psycopg2"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.psycopg2</span></code></a></p>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="mysql.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">MySQL 和 MariaDB</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Dialects</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                <a href="../copyright.html">Copyright</a> &#169; 2007-2025, the SQLAlchemy authors and contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on 04/05/2025 04:00:26</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">PostgreSQL</a><ul>
<li><a class="reference internal" href="#dialect-postgresql">Support for the PostgreSQL database.</a></li>
<li><a class="reference internal" href="#sequences-serial-identity">Sequences/SERIAL/IDENTITY</a><ul>
<li><a class="reference internal" href="#postgresql-10-and-above-identity-columns">PostgreSQL 10 and above IDENTITY columns</a></li>
</ul>
</li>
<li><a class="reference internal" href="#server-side-cursors">Server Side Cursors</a></li>
<li><a class="reference internal" href="#transaction-isolation-level">Transaction Isolation Level</a></li>
<li><a class="reference internal" href="#setting-read-only-deferrable">Setting READ ONLY / DEFERRABLE</a></li>
<li><a class="reference internal" href="#temporary-table-resource-reset-for-connection-pooling">Temporary Table / Resource Reset for Connection Pooling</a></li>
<li><a class="reference internal" href="#setting-alternate-search-paths-on-connect">Setting Alternate Search Paths on Connect</a></li>
<li><a class="reference internal" href="#remote-schema-table-introspection-and-postgresql-search-path">Remote-Schema Table Introspection and PostgreSQL search_path</a></li>
<li><a class="reference internal" href="#insert-update-returning">INSERT/UPDATE…RETURNING</a></li>
<li><a class="reference internal" href="#insert-on-conflict-upsert">INSERT…ON CONFLICT (Upsert)</a><ul>
<li><a class="reference internal" href="#specifying-the-target">Specifying the Target</a></li>
<li><a class="reference internal" href="#the-set-clause">The SET Clause</a></li>
<li><a class="reference internal" href="#updating-using-the-excluded-insert-values">Updating using the Excluded INSERT Values</a></li>
<li><a class="reference internal" href="#additional-where-criteria">Additional WHERE Criteria</a></li>
<li><a class="reference internal" href="#skipping-rows-with-do-nothing">Skipping Rows with DO NOTHING</a></li>
</ul>
</li>
<li><a class="reference internal" href="#full-text-search">Full Text Search</a><ul>
<li><a class="reference internal" href="#simple-plain-text-matching-with-match">Simple plain text matching with <code class="docutils literal notranslate"><span class="pre">match()</span></code></a></li>
<li><a class="reference internal" href="#using-postgresql-full-text-functions-and-operators-directly">Using PostgreSQL full text functions and operators directly</a></li>
<li><a class="reference internal" href="#specifying-the-regconfig-with-match-or-custom-operators">Specifying the “regconfig” with <code class="docutils literal notranslate"><span class="pre">match()</span></code> or custom operators</a></li>
</ul>
</li>
<li><a class="reference internal" href="#from-only">FROM ONLY …</a></li>
<li><a class="reference internal" href="#postgresql-specific-index-options">PostgreSQL-Specific Index Options</a><ul>
<li><a class="reference internal" href="#covering-indexes">Covering Indexes</a></li>
<li><a class="reference internal" href="#partial-indexes">Partial Indexes</a></li>
<li><a class="reference internal" href="#operator-classes">Operator Classes</a></li>
<li><a class="reference internal" href="#index-types">Index Types</a></li>
<li><a class="reference internal" href="#index-storage-parameters">Index Storage Parameters</a></li>
<li><a class="reference internal" href="#indexes-with-concurrently">Indexes with CONCURRENTLY</a></li>
</ul>
</li>
<li><a class="reference internal" href="#postgresql-index-reflection">PostgreSQL Index Reflection</a></li>
<li><a class="reference internal" href="#special-reflection-options">Special Reflection Options</a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector"><code class="docutils literal notranslate"><span class="pre">PGInspector</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_domains"><code class="docutils literal notranslate"><span class="pre">PGInspector.get_domains()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_enums"><code class="docutils literal notranslate"><span class="pre">PGInspector.get_enums()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_foreign_table_names"><code class="docutils literal notranslate"><span class="pre">PGInspector.get_foreign_table_names()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_table_oid"><code class="docutils literal notranslate"><span class="pre">PGInspector.get_table_oid()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.has_type"><code class="docutils literal notranslate"><span class="pre">PGInspector.has_type()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#postgresql-table-options">PostgreSQL Table Options</a></li>
<li><a class="reference internal" href="#postgresql-constraint-options">PostgreSQL Constraint Options</a></li>
<li><a class="reference internal" href="#table-values-table-and-column-valued-functions-row-and-tuple-objects">Table values, Table and Column valued functions, Row and Tuple objects</a><ul>
<li><a class="reference internal" href="#table-valued-functions">Table-Valued Functions</a></li>
<li><a class="reference internal" href="#column-valued-functions">Column Valued Functions</a></li>
<li><a class="reference internal" href="#row-types">Row Types</a></li>
<li><a class="reference internal" href="#table-types-passed-to-functions">Table Types passed to Functions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#array">ARRAY 类型</a></li>
<li><a class="reference internal" href="#json">JSON 类型</a></li>
<li><a class="reference internal" href="#hstore">HSTORE 类型</a></li>
<li><a class="reference internal" href="#enum">ENUM 类型</a><ul>
<li><a class="reference internal" href="#enum-array">将 ENUM 与 ARRAY 结合使用</a></li>
<li><a class="reference internal" href="#json-jsonb-array">将 JSON/JSONB 与 ARRAY 结合使用</a></li>
</ul>
</li>
<li><a class="reference internal" href="#postgresql-ranges">范围和多范围类型</a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range"><code class="docutils literal notranslate"><span class="pre">Range</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.__eq__"><code class="docutils literal notranslate"><span class="pre">Range.__eq__()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.adjacent_to"><code class="docutils literal notranslate"><span class="pre">Range.adjacent_to()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.contained_by"><code class="docutils literal notranslate"><span class="pre">Range.contained_by()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.contains"><code class="docutils literal notranslate"><span class="pre">Range.contains()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.difference"><code class="docutils literal notranslate"><span class="pre">Range.difference()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.intersection"><code class="docutils literal notranslate"><span class="pre">Range.intersection()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.is_empty"><code class="docutils literal notranslate"><span class="pre">Range.is_empty</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.isempty"><code class="docutils literal notranslate"><span class="pre">Range.isempty</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.lower"><code class="docutils literal notranslate"><span class="pre">Range.lower</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.lower_inc"><code class="docutils literal notranslate"><span class="pre">Range.lower_inc</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.lower_inf"><code class="docutils literal notranslate"><span class="pre">Range.lower_inf</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.not_extend_left_of"><code class="docutils literal notranslate"><span class="pre">Range.not_extend_left_of()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.not_extend_right_of"><code class="docutils literal notranslate"><span class="pre">Range.not_extend_right_of()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.overlaps"><code class="docutils literal notranslate"><span class="pre">Range.overlaps()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.strictly_left_of"><code class="docutils literal notranslate"><span class="pre">Range.strictly_left_of()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.strictly_right_of"><code class="docutils literal notranslate"><span class="pre">Range.strictly_right_of()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.union"><code class="docutils literal notranslate"><span class="pre">Range.union()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.upper"><code class="docutils literal notranslate"><span class="pre">Range.upper</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.upper_inc"><code class="docutils literal notranslate"><span class="pre">Range.upper_inc</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Range.upper_inf"><code class="docutils literal notranslate"><span class="pre">Range.upper_inf</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6">多范围</a><ul>
<li><a class="reference internal" href="#postgresql-multirange-list-use">使用多范围序列推断多范围类型</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#postgresql-network-datatypes">网络数据类型</a></li>
<li><a class="reference internal" href="#id9">PostgreSQL 数据类型</a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange"><code class="docutils literal notranslate"><span class="pre">AbstractRange</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory"><code class="docutils literal notranslate"><span class="pre">AbstractRange.comparator_factory</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.adjacent_to"><code class="docutils literal notranslate"><span class="pre">AbstractRange.comparator_factory.adjacent_to()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.contained_by"><code class="docutils literal notranslate"><span class="pre">AbstractRange.comparator_factory.contained_by()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.contains"><code class="docutils literal notranslate"><span class="pre">AbstractRange.comparator_factory.contains()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.difference"><code class="docutils literal notranslate"><span class="pre">AbstractRange.comparator_factory.difference()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.intersection"><code class="docutils literal notranslate"><span class="pre">AbstractRange.comparator_factory.intersection()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.not_extend_left_of"><code class="docutils literal notranslate"><span class="pre">AbstractRange.comparator_factory.not_extend_left_of()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.not_extend_right_of"><code class="docutils literal notranslate"><span class="pre">AbstractRange.comparator_factory.not_extend_right_of()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.overlaps"><code class="docutils literal notranslate"><span class="pre">AbstractRange.comparator_factory.overlaps()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.strictly_left_of"><code class="docutils literal notranslate"><span class="pre">AbstractRange.comparator_factory.strictly_left_of()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.strictly_right_of"><code class="docutils literal notranslate"><span class="pre">AbstractRange.comparator_factory.strictly_right_of()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractRange.comparator_factory.union"><code class="docutils literal notranslate"><span class="pre">AbstractRange.comparator_factory.union()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractSingleRange"><code class="docutils literal notranslate"><span class="pre">AbstractSingleRange</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.AbstractMultiRange"><code class="docutils literal notranslate"><span class="pre">AbstractMultiRange</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY"><code class="docutils literal notranslate"><span class="pre">ARRAY</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.__init__"><code class="docutils literal notranslate"><span class="pre">ARRAY.__init__()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator"><code class="docutils literal notranslate"><span class="pre">ARRAY.Comparator</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator.contains"><code class="docutils literal notranslate"><span class="pre">ARRAY.Comparator.contains()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator.contained_by"><code class="docutils literal notranslate"><span class="pre">ARRAY.Comparator.contained_by()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator.overlap"><code class="docutils literal notranslate"><span class="pre">ARRAY.Comparator.overlap()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.BIT"><code class="docutils literal notranslate"><span class="pre">BIT</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.BYTEA"><code class="docutils literal notranslate"><span class="pre">BYTEA</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.BYTEA.__init__"><code class="docutils literal notranslate"><span class="pre">BYTEA.__init__()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.CIDR"><code class="docutils literal notranslate"><span class="pre">CIDR</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.CITEXT"><code class="docutils literal notranslate"><span class="pre">CITEXT</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.CITEXT.__init__"><code class="docutils literal notranslate"><span class="pre">CITEXT.__init__()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN"><code class="docutils literal notranslate"><span class="pre">DOMAIN</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN.__init__"><code class="docutils literal notranslate"><span class="pre">DOMAIN.__init__()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN.create"><code class="docutils literal notranslate"><span class="pre">DOMAIN.create()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.DOMAIN.drop"><code class="docutils literal notranslate"><span class="pre">DOMAIN.drop()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM"><code class="docutils literal notranslate"><span class="pre">ENUM</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.__init__"><code class="docutils literal notranslate"><span class="pre">ENUM.__init__()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.create"><code class="docutils literal notranslate"><span class="pre">ENUM.create()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.drop"><code class="docutils literal notranslate"><span class="pre">ENUM.drop()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE"><code class="docutils literal notranslate"><span class="pre">HSTORE</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">HSTORE.Comparator</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.array"><code class="docutils literal notranslate"><span class="pre">HSTORE.Comparator.array()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.contained_by"><code class="docutils literal notranslate"><span class="pre">HSTORE.Comparator.contained_by()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.contains"><code class="docutils literal notranslate"><span class="pre">HSTORE.Comparator.contains()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.defined"><code class="docutils literal notranslate"><span class="pre">HSTORE.Comparator.defined()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.delete"><code class="docutils literal notranslate"><span class="pre">HSTORE.Comparator.delete()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.has_all"><code class="docutils literal notranslate"><span class="pre">HSTORE.Comparator.has_all()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.has_any"><code class="docutils literal notranslate"><span class="pre">HSTORE.Comparator.has_any()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.has_key"><code class="docutils literal notranslate"><span class="pre">HSTORE.Comparator.has_key()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.keys"><code class="docutils literal notranslate"><span class="pre">HSTORE.Comparator.keys()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.matrix"><code class="docutils literal notranslate"><span class="pre">HSTORE.Comparator.matrix()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.slice"><code class="docutils literal notranslate"><span class="pre">HSTORE.Comparator.slice()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.vals"><code class="docutils literal notranslate"><span class="pre">HSTORE.Comparator.vals()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.__init__"><code class="docutils literal notranslate"><span class="pre">HSTORE.__init__()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.bind_processor"><code class="docutils literal notranslate"><span class="pre">HSTORE.bind_processor()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.comparator_factory"><code class="docutils literal notranslate"><span class="pre">HSTORE.comparator_factory</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.hashable"><code class="docutils literal notranslate"><span class="pre">HSTORE.hashable</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.result_processor"><code class="docutils literal notranslate"><span class="pre">HSTORE.result_processor()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INET"><code class="docutils literal notranslate"><span class="pre">INET</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INTERVAL"><code class="docutils literal notranslate"><span class="pre">INTERVAL</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INTERVAL.__init__"><code class="docutils literal notranslate"><span class="pre">INTERVAL.__init__()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON"><code class="docutils literal notranslate"><span class="pre">JSON</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON.Comparator"><code class="docutils literal notranslate"><span class="pre">JSON.Comparator</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON.Comparator.astext"><code class="docutils literal notranslate"><span class="pre">JSON.Comparator.astext</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON.__init__"><code class="docutils literal notranslate"><span class="pre">JSON.__init__()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON.comparator_factory"><code class="docutils literal notranslate"><span class="pre">JSON.comparator_factory</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON.render_bind_cast"><code class="docutils literal notranslate"><span class="pre">JSON.render_bind_cast</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB"><code class="docutils literal notranslate"><span class="pre">JSONB</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator"><code class="docutils literal notranslate"><span class="pre">JSONB.Comparator</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.contained_by"><code class="docutils literal notranslate"><span class="pre">JSONB.Comparator.contained_by()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.contains"><code class="docutils literal notranslate"><span class="pre">JSONB.Comparator.contains()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.delete_path"><code class="docutils literal notranslate"><span class="pre">JSONB.Comparator.delete_path()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_all"><code class="docutils literal notranslate"><span class="pre">JSONB.Comparator.has_all()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_any"><code class="docutils literal notranslate"><span class="pre">JSONB.Comparator.has_any()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_key"><code class="docutils literal notranslate"><span class="pre">JSONB.Comparator.has_key()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.path_exists"><code class="docutils literal notranslate"><span class="pre">JSONB.Comparator.path_exists()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.path_match"><code class="docutils literal notranslate"><span class="pre">JSONB.Comparator.path_match()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.comparator_factory"><code class="docutils literal notranslate"><span class="pre">JSONB.comparator_factory</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONPATH"><code class="docutils literal notranslate"><span class="pre">JSONPATH</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.MACADDR"><code class="docutils literal notranslate"><span class="pre">MACADDR</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.MACADDR8"><code class="docutils literal notranslate"><span class="pre">MACADDR8</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.MONEY"><code class="docutils literal notranslate"><span class="pre">MONEY</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.OID"><code class="docutils literal notranslate"><span class="pre">OID</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.REGCONFIG"><code class="docutils literal notranslate"><span class="pre">REGCONFIG</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.REGCLASS"><code class="docutils literal notranslate"><span class="pre">REGCLASS</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TIMESTAMP"><code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TIMESTAMP.__init__"><code class="docutils literal notranslate"><span class="pre">TIMESTAMP.__init__()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TIME"><code class="docutils literal notranslate"><span class="pre">TIME</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TIME.__init__"><code class="docutils literal notranslate"><span class="pre">TIME.__init__()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSQUERY"><code class="docutils literal notranslate"><span class="pre">TSQUERY</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSVECTOR"><code class="docutils literal notranslate"><span class="pre">TSVECTOR</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT4RANGE"><code class="docutils literal notranslate"><span class="pre">INT4RANGE</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT8RANGE"><code class="docutils literal notranslate"><span class="pre">INT8RANGE</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.NUMRANGE"><code class="docutils literal notranslate"><span class="pre">NUMRANGE</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.DATERANGE"><code class="docutils literal notranslate"><span class="pre">DATERANGE</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSRANGE"><code class="docutils literal notranslate"><span class="pre">TSRANGE</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSTZRANGE"><code class="docutils literal notranslate"><span class="pre">TSTZRANGE</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT4MULTIRANGE"><code class="docutils literal notranslate"><span class="pre">INT4MULTIRANGE</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT8MULTIRANGE"><code class="docutils literal notranslate"><span class="pre">INT8MULTIRANGE</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.NUMMULTIRANGE"><code class="docutils literal notranslate"><span class="pre">NUMMULTIRANGE</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.DATEMULTIRANGE"><code class="docutils literal notranslate"><span class="pre">DATEMULTIRANGE</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSMULTIRANGE"><code class="docutils literal notranslate"><span class="pre">TSMULTIRANGE</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSTZMULTIRANGE"><code class="docutils literal notranslate"><span class="pre">TSTZMULTIRANGE</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.MultiRange"><code class="docutils literal notranslate"><span class="pre">MultiRange</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#postgresql-sql">PostgreSQL SQL 元素和函数</a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.aggregate_order_by"><code class="docutils literal notranslate"><span class="pre">aggregate_order_by</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.array"><code class="docutils literal notranslate"><span class="pre">array</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.array.__init__"><code class="docutils literal notranslate"><span class="pre">array.__init__()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.array_agg"><code class="docutils literal notranslate"><span class="pre">array_agg()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Any"><code class="docutils literal notranslate"><span class="pre">Any()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.All"><code class="docutils literal notranslate"><span class="pre">All()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.hstore"><code class="docutils literal notranslate"><span class="pre">hstore</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.hstore.inherit_cache"><code class="docutils literal notranslate"><span class="pre">hstore.inherit_cache</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.hstore.type"><code class="docutils literal notranslate"><span class="pre">hstore.type</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.to_tsvector"><code class="docutils literal notranslate"><span class="pre">to_tsvector</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.to_tsquery"><code class="docutils literal notranslate"><span class="pre">to_tsquery</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.plainto_tsquery"><code class="docutils literal notranslate"><span class="pre">plainto_tsquery</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.phraseto_tsquery"><code class="docutils literal notranslate"><span class="pre">phraseto_tsquery</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.websearch_to_tsquery"><code class="docutils literal notranslate"><span class="pre">websearch_to_tsquery</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ts_headline"><code class="docutils literal notranslate"><span class="pre">ts_headline</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.distinct_on"><code class="docutils literal notranslate"><span class="pre">distinct_on()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#id11">PostgreSQL 约束类型</a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="docutils literal notranslate"><span class="pre">ExcludeConstraint</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.__init__"><code class="docutils literal notranslate"><span class="pre">ExcludeConstraint.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#postgresql-dml">PostgreSQL DML 构造</a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.insert"><code class="docutils literal notranslate"><span class="pre">insert()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert"><code class="docutils literal notranslate"><span class="pre">Insert</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.excluded"><code class="docutils literal notranslate"><span class="pre">Insert.excluded</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.inherit_cache"><code class="docutils literal notranslate"><span class="pre">Insert.inherit_cache</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing"><code class="docutils literal notranslate"><span class="pre">Insert.on_conflict_do_nothing()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#module-sqlalchemy.dialects.postgresql.psycopg2">psycopg2</a><ul>
<li><a class="reference internal" href="#dialect-postgresql-psycopg2-url">DBAPI</a></li>
<li><a class="reference internal" href="#dialect-postgresql-psycopg2-connect">Connecting</a></li>
<li><a class="reference internal" href="#psycopg2-connect-arguments">psycopg2 Connect Arguments</a></li>
<li><a class="reference internal" href="#ssl-connections">SSL Connections</a></li>
<li><a class="reference internal" href="#unix-domain-connections">Unix Domain Connections</a></li>
<li><a class="reference internal" href="#specifying-multiple-fallback-hosts">Specifying multiple fallback hosts</a></li>
<li><a class="reference internal" href="#empty-dsn-connections-environment-variable-connections">Empty DSN Connections / Environment Variable Connections</a></li>
<li><a class="reference internal" href="#per-statement-connection-execution-options">Per-Statement/Connection Execution Options</a></li>
<li><a class="reference internal" href="#psycopg2-fast-execution-helpers">Psycopg2 Fast Execution Helpers</a></li>
<li><a class="reference internal" href="#unicode-with-psycopg2">Unicode with Psycopg2</a></li>
<li><a class="reference internal" href="#transactions">Transactions</a></li>
<li><a class="reference internal" href="#psycopg2-transaction-isolation-level">Psycopg2 Transaction Isolation Level</a></li>
<li><a class="reference internal" href="#notice-logging">NOTICE logging</a></li>
<li><a class="reference internal" href="#hstore-type">HSTORE type</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-sqlalchemy.dialects.postgresql.psycopg">psycopg</a><ul>
<li><a class="reference internal" href="#dialect-postgresql-psycopg-url">DBAPI</a></li>
<li><a class="reference internal" href="#dialect-postgresql-psycopg-connect">Connecting</a></li>
<li><a class="reference internal" href="#using-a-different-cursor-class">Using a different Cursor class</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-sqlalchemy.dialects.postgresql.pg8000">pg8000</a><ul>
<li><a class="reference internal" href="#dialect-postgresql-pg8000-url">DBAPI</a></li>
<li><a class="reference internal" href="#dialect-postgresql-pg8000-connect">Connecting</a></li>
<li><a class="reference internal" href="#unicode">Unicode</a></li>
<li><a class="reference internal" href="#pg8000-ssl">SSL Connections</a></li>
<li><a class="reference internal" href="#pg8000-transaction-isolation-level">pg8000 Transaction Isolation Level</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-sqlalchemy.dialects.postgresql.asyncpg">asyncpg</a><ul>
<li><a class="reference internal" href="#dialect-postgresql-asyncpg-url">DBAPI</a></li>
<li><a class="reference internal" href="#dialect-postgresql-asyncpg-connect">Connecting</a></li>
<li><a class="reference internal" href="#multihost-connections">Multihost Connections</a></li>
<li><a class="reference internal" href="#prepared-statement-cache">Prepared Statement Cache</a></li>
<li><a class="reference internal" href="#prepared-statement-name-with-pgbouncer">Prepared Statement Name with PGBouncer</a></li>
<li><a class="reference internal" href="#disabling-the-postgresql-jit-to-improve-enum-datatype-handling">Disabling the PostgreSQL JIT to improve ENUM datatype handling</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-sqlalchemy.dialects.postgresql.psycopg2cffi">psycopg2cffi</a><ul>
<li><a class="reference internal" href="#dialect-postgresql-psycopg2cffi-url">DBAPI</a></li>
<li><a class="reference internal" href="#dialect-postgresql-psycopg2cffi-connect">Connecting</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=2d0eb83f"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=2f3e6152"></script>
    <script src="../_static/translations.js?v=beaddf03"></script>
    </body>
</html>