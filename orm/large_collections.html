<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="索引" href="../genindex.html" /><link rel="search" title="搜索" href="../search.html" /><link rel="copyright" title="版权所有" href="../copyright.html" /><link rel="next" title="集合自定义和 API 详细信息" href="collection_api.html" /><link rel="prev" title="配置关系连接方式" href="join_conditions.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.08.06 -->
        <title>使用大型集合 - SQLAlchemy 2.1 Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/changelog.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_paramlinks.css" />
    <link rel="stylesheet" type="text/css" href="../_static/docs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">SQLAlchemy 2.1 Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">SQLAlchemy 2.1 Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">概述</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorial/index.html">SQLAlchemy 统一教程</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of SQLAlchemy 统一教程</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/engine.html">建立连接 - Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/dbapi_transactions.html">使用事务和DBAPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/metadata.html">使用数据库元数据</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../tutorial/data.html">处理数据</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of 处理数据</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/data_insert.html">使用 INSERT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/data_select.html">使用 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/data_update.html">使用 UPDATE 和 DELETE 语句</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/orm_data_manipulation.html">使用 ORM 进行数据操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/orm_related_objects.html">使用 ORM 相关对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/further_reading.html">进一步阅读</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">SQLAlchemy ORM</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of SQLAlchemy ORM</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">ORM 快速入门</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="mapper_config.html">ORM 映射类配置</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of ORM 映射类配置</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="mapping_styles.html">ORM 映射类概述</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="declarative_mapping.html">使用声明式映射类</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of 使用声明式映射类</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="declarative_styles.html">声明式映射风格</a></li>
<li class="toctree-l4"><a class="reference internal" href="declarative_tables.html">声明式的表配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="declarative_config.html">使用声明式映射器配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="declarative_mixins.html">使用 Mixins 组合映射层次结构</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dataclasses.html">与dataclass和attrs的集成</a></li>
<li class="toctree-l3"><a class="reference internal" href="mapped_sql_expr.html">SQL 表达式作为映射属性</a></li>
<li class="toctree-l3"><a class="reference internal" href="mapped_attributes.html">更改Attribute的行为</a></li>
<li class="toctree-l3"><a class="reference internal" href="composites.html">复合列类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="inheritance.html">映射类继承层次结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="nonstandard_mappings.html">非传统映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="versioning.html">配置版本计数器</a></li>
<li class="toctree-l3"><a class="reference internal" href="mapping_api.html">类映射 API</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="scalar_mapping.html">映射 SQL 表达式</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of 映射 SQL 表达式</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="mapping_columns.html">映射表格列</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="relationships.html">关系配置</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of 关系配置</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="basic_relationships.html">基本关系模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="self_referential.html">邻接表关系</a></li>
<li class="toctree-l3"><a class="reference internal" href="join_conditions.html">配置关系连接方式</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">使用大型集合</a></li>
<li class="toctree-l3"><a class="reference internal" href="collection_api.html">集合自定义和 API 详细信息</a></li>
<li class="toctree-l3"><a class="reference internal" href="relationship_persistence.html">特殊关系的持久化模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="backref.html">使用旧版“backref”关系参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="relationship_api.html">关系 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="queryguide/index.html">ORM 查询指南</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of ORM 查询指南</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="queryguide/select.html">为 ORM 映射类编写 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="queryguide/inheritance.html">为继承映射编写 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="queryguide/dml.html">启用 ORM 的 INSERT、UPDATE 和 DELETE 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="queryguide/columns.html">列加载选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="queryguide/relationships.html">关系加载技术</a></li>
<li class="toctree-l3"><a class="reference internal" href="queryguide/api.html">用于查询的 ORM API 功能</a></li>
<li class="toctree-l3"><a class="reference internal" href="queryguide/query.html">旧式查询 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="session.html">使用会话</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of 使用会话</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="session_basics.html">会话基础知识</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_state_management.html">状态管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="cascades.html">级联</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_transaction.html">事务和连接管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="persistence_techniques.html">附加持久性技术</a></li>
<li class="toctree-l3"><a class="reference internal" href="contextual.html">上下文/线程本地会话</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_events.html">使用事件跟踪查询、对象和会话更改</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_api.html">会话 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="extending.html">事件和内部</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of 事件和内部</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="events.html">ORM 事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="internals.html">ORM 内部</a></li>
<li class="toctree-l3"><a class="reference internal" href="exceptions.html">ORM 异常</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="extensions/index.html">ORM 扩展</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of ORM 扩展</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="extensions/asyncio.html">异步 I/O (asyncio)</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions/associationproxy.html">关联代理</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions/automap.html">自动映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions/baked.html">烘焙查询</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions/declarative/index.html">声明式扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions/mutable.html">突变追踪</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions/orderinglist.html">排序列表</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions/horizontal_shard.html">水平分片</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions/hybrid.html">混合属性</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions/indexable.html">Indexable</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions/instrumentation.html">替代类检测</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="examples.html">核心和 ORM 示例</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../core/index.html">SQLAlchemy Core</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of SQLAlchemy Core</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/expression_api.html">SQL 语句和表达式 API</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of SQL 语句和表达式 API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/sqlelement.html">列元素和表达式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/operators.html">操作符参考</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/selectable.html">SELECT 和相关构造</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/dml.html">插入,更新,删除</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/functions.html">SQL 和 范型函数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/compiler.html">自定义 SQL 构造和编译扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/serializer.html">表达式序列化器扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/foundation.html">SQL 表达式语言基础构造</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/visitors.html">访问者和遍历实用程序</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/schema.html">Schema 定义语言</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of Schema 定义语言</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/metadata.html">使用元数据描述数据库</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/reflection.html">反映数据库对象</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/defaults.html">列 INSERT/UPDATE 默认值</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/constraints.html">定义约束和索引</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/ddl.html">自定义 DDL</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/types.html">SQL 数据类型对象</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of SQL 数据类型对象</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/type_basics.html">类型层次结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/custom_types.html">自定义类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/type_api.html">基本类型 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/engines_connections.html">Engine和Connection的使用</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of Engine和Connection的使用</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/engines.html">Engine 配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/connections.html">使用Engines和Connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/pooling.html">连接池</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/events.html">核心事件</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/api_basics.html">Core API 基础</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of Core API 基础</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/event.html">事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/inspection.html">运行时审查 API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/exceptions.html">Core 异常</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/internals.html">Core 内部</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../dialects/index.html">Dialects</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of Dialects</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../dialects/postgresql.html">PostgreSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dialects/mysql.html">MySQL 和 MariaDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dialects/sqlite.html">SQLite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dialects/oracle.html">Oracle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dialects/mssql.html">Microsoft SQL Server</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../faq/index.html">常见问题</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of 常见问题</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../faq/installation.html">安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/connections.html">连接 / 引擎</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/metadata_schema.html">元数据 / Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/sqlexpressions.html">SQL 表达式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/ormconfiguration.html">ORM 配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/performance.html">性能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/sessions.html">会话 / 查询</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/thirdparty.html">第三方包集成问题</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../errors.html">错误消息</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../changelog/index.html">变更和迁移</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of 变更和迁移</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_21.html">SQLAlchemy 2.1 有什么新功能？</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_21.html">2.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_20.html">2.0 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_14.html">1.4 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_13.html">1.3 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_12.html">1.2 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_11.html">1.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_10.html">1.0 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_09.html">0.9 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_08.html">0.8 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_07.html">0.7 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_06.html">0.6 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_05.html">0.5 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_04.html">0.4 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_03.html">0.3 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_02.html">0.2 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_01.html">0.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_20.html">SQLAlchemy 2.0 - Major Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/whatsnew_20.html">What’s New in SQLAlchemy 2.0?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_14.html">What’s New in SQLAlchemy 1.4?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_13.html">What’s New in SQLAlchemy 1.3?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_12.html">What’s New in SQLAlchemy 1.2?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_11.html">What’s New in SQLAlchemy 1.1?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_10.html">What’s New in SQLAlchemy 1.0?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_09.html">What’s New in SQLAlchemy 0.9?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_08.html">What’s New in SQLAlchemy 0.8?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_07.html">What’s New in SQLAlchemy 0.7?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_06.html">What’s New in SQLAlchemy 0.6?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_05.html">What’s new in SQLAlchemy 0.5?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_04.html">What’s new in SQLAlchemy 0.4?</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="largecollections">
<span id="id1"></span><h1>使用大型集合<a class="headerlink" href="#largecollections" title="Link to this heading">¶</a></h1>
<p>Working with Large Collections</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">中文</label><div class="tab-content docutils container">
<p><a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> 的默认行为是根据配置的 <a class="reference internal" href="queryguide/relationships.html#orm-queryguide-relationship-loaders"><span class="std std-ref">加载策略</span></a> 将集合的内容完全加载到内存中，该策略控制何时以及如何从数据库加载这些内容。相关集合不仅可以在访问时加载到内存中，或提前加载，但在大多数情况下，当集合本身发生变化时，以及在工作单元系统要删除所属对象时，也需要填充。</p>
<p>当相关集合可能非常大时，在任何情况下都可能不适合将这样的集合填充到内存中，因为该操作可能会过度消耗时间、网络和内存资源。</p>
<p>本节包括旨在允许 <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> 与大型集合一起使用的 API 功能，同时保持足够的性能。</p>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">英文</label><div class="tab-content docutils container">
<p>The default behavior of <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> is to fully load
the contents of collections into memory, based on a configured
<a class="reference internal" href="queryguide/relationships.html#orm-queryguide-relationship-loaders"><span class="std std-ref">loader strategy</span></a> that controls
when and how these contents are loaded from the database.  Related collections
may be loaded into memory not just when they are accessed, or eagerly loaded,
but in most cases will require population when the collection
itself is mutated, as well as in cases where the owning object is to be
deleted by the unit of work system.</p>
<p>When a related collection is potentially very large, it may not be feasible
for such a collection to be populated into memory under any circumstances,
as the operation may be overly consuming of time, network and memory
resources.</p>
<p>This section includes API features intended to allow <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>
to be used with large collections while maintaining adequate performance.</p>
</div>
</div>
<section id="write-only-relationship">
<span id="id2"></span><h2>只写关系<a class="headerlink" href="#write-only-relationship" title="Link to this heading">¶</a></h2>
<p>Write Only Relationships</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--1-input--1" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--1">中文</label><div class="tab-content docutils container">
<p><strong>仅写</strong> 加载策略是配置 <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> 的主要手段，该关系将保持可写，但不会将其内容加载到内存中。以下是现代类型注释声明形式中仅写 ORM 配置的示例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">decimal</span><span class="w"> </span><span class="kn">import</span> <span class="n">Decimal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForeignKey</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">func</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeclarativeBase</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">mapped_column</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">relationship</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Session</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">WriteOnlyMapped</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="p">(</span><span class="n">DeclarativeBase</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">Account</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;account&quot;</span>
<span class="gp">... </span>    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">identifier</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">account_transactions</span><span class="p">:</span> <span class="n">WriteOnlyMapped</span><span class="p">[</span><span class="s2">&quot;AccountTransaction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">passive_deletes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">order_by</span><span class="o">=</span><span class="s2">&quot;AccountTransaction.timestamp&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Account(identifier=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">!r}</span><span class="s2">)&quot;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">AccountTransaction</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;account_transaction&quot;</span>
<span class="gp">... </span>    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">account_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;account.id&quot;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;cascade&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="gp">... </span>    <span class="n">description</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">amount</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Decimal</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">timestamp</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="p">(</span>
<span class="gp">... </span>            <span class="sa">f</span><span class="s2">&quot;AccountTransaction(amount=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">amount</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
<span class="gp">... </span>            <span class="sa">f</span><span class="s2">&quot;timestamp=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span><span class="si">!r}</span><span class="s2">)&quot;</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;eager_defaults&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>如上所述， <code class="docutils literal notranslate"><span class="pre">account_transactions</span></code> 关系不是使用普通的 <a class="reference internal" href="internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> 注释进行配置，而是使用 <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyMapped" title="sqlalchemy.orm.WriteOnlyMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyMapped</span></code></a> 类型注释，在运行时将 <a class="reference internal" href="queryguide/relationships.html#orm-queryguide-relationship-loaders"><span class="std std-ref">loader strategy</span></a> 分配为 <code class="docutils literal notranslate"><span class="pre">lazy=&quot;write_only&quot;</span></code> 给目标 <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>。
<a class="reference internal" href="#sqlalchemy.orm.WriteOnlyMapped" title="sqlalchemy.orm.WriteOnlyMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyMapped</span></code></a> 注释是 <a class="reference internal" href="internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> 注释的替代形式，表示在对象实例上使用 <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a> 集合类型。</p>
<p>上述 <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> 配置还包括几个特定于删除 <code class="docutils literal notranslate"><span class="pre">Account</span></code> 对象以及从 <code class="docutils literal notranslate"><span class="pre">account_transactions</span></code> 集合中删除 <code class="docutils literal notranslate"><span class="pre">AccountTransaction</span></code> 对象时要采取的操作的元素。这些元素是：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">passive_deletes=True</span></code> - 允许 <a class="reference internal" href="../glossary.html#term-unit-of-work"><span class="xref std std-term">unit of work</span></a> 在删除 <code class="docutils literal notranslate"><span class="pre">Account</span></code> 时无需加载集合；请参阅 <a class="reference internal" href="cascades.html#passive-deletes"><span class="std std-ref">使用具有 ORM 关系的外键 ON DELETE 级联</span></a>。</p></li>
<li><p>在 <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKey</span></code></a> 约束上配置的 <code class="docutils literal notranslate"><span class="pre">ondelete=&quot;cascade&quot;</span></code>。这也详见 <a class="reference internal" href="cascades.html#passive-deletes"><span class="std std-ref">使用具有 ORM 关系的外键 ON DELETE 级联</span></a>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cascade=&quot;all,</span> <span class="pre">delete-orphan&quot;</span></code> - 指示 <a class="reference internal" href="../glossary.html#term-unit-of-work"><span class="xref std std-term">unit of work</span></a> 在从集合中删除 <code class="docutils literal notranslate"><span class="pre">AccountTransaction</span></code> 对象时将其删除。请参阅 <a class="reference internal" href="cascades.html#cascade-delete-orphan"><span class="std std-ref">删除-孤立</span></a> 在 <a class="reference internal" href="cascades.html#unitofwork-cascades"><span class="std std-ref">级联</span></a> 文档中。</p></li>
</ul>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入: </span>添加了“仅写”关系加载器。</p>
</div>
</div>
<input class="tab-input" id="tab-set--1-input--2" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--2">英文</label><div class="tab-content docutils container">
<p>The <strong>write only</strong> loader strategy is the primary means of configuring a
<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> that will remain writeable, but will not load
its contents into memory.  A write-only ORM configuration in modern
type-annotated Declarative form is illustrated below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">decimal</span><span class="w"> </span><span class="kn">import</span> <span class="n">Decimal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForeignKey</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">func</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeclarativeBase</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">mapped_column</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">relationship</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Session</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">WriteOnlyMapped</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="p">(</span><span class="n">DeclarativeBase</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">Account</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;account&quot;</span>
<span class="gp">... </span>    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">identifier</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">account_transactions</span><span class="p">:</span> <span class="n">WriteOnlyMapped</span><span class="p">[</span><span class="s2">&quot;AccountTransaction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">passive_deletes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">order_by</span><span class="o">=</span><span class="s2">&quot;AccountTransaction.timestamp&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Account(identifier=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">!r}</span><span class="s2">)&quot;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">AccountTransaction</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;account_transaction&quot;</span>
<span class="gp">... </span>    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">account_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;account.id&quot;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;cascade&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="gp">... </span>    <span class="n">description</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">amount</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Decimal</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">timestamp</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="p">(</span>
<span class="gp">... </span>            <span class="sa">f</span><span class="s2">&quot;AccountTransaction(amount=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">amount</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
<span class="gp">... </span>            <span class="sa">f</span><span class="s2">&quot;timestamp=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span><span class="si">!r}</span><span class="s2">)&quot;</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;eager_defaults&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>Above, the <code class="docutils literal notranslate"><span class="pre">account_transactions</span></code> relationship is configured not using the
ordinary <a class="reference internal" href="internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> annotation, but instead
using the <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyMapped" title="sqlalchemy.orm.WriteOnlyMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyMapped</span></code></a> type annotation, which at runtime will
assign the <a class="reference internal" href="queryguide/relationships.html#orm-queryguide-relationship-loaders"><span class="std std-ref">loader strategy</span></a> of
<code class="docutils literal notranslate"><span class="pre">lazy=&quot;write_only&quot;</span></code> to the target <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>.
The <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyMapped" title="sqlalchemy.orm.WriteOnlyMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyMapped</span></code></a> annotation is an
alternative form of the <a class="reference internal" href="internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> annotation which indicate the use
of the <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a> collection type on instances of the
object.</p>
<p>The above <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> configuration also includes several
elements that are specific to what action to take when <code class="docutils literal notranslate"><span class="pre">Account</span></code> objects
are deleted, as well as when <code class="docutils literal notranslate"><span class="pre">AccountTransaction</span></code> objects are removed from the
<code class="docutils literal notranslate"><span class="pre">account_transactions</span></code> collection.  These elements are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">passive_deletes=True</span></code> - allows the <a class="reference internal" href="../glossary.html#term-unit-of-work"><span class="xref std std-term">unit of work</span></a> to forego having
to load the collection when <code class="docutils literal notranslate"><span class="pre">Account</span></code> is deleted; see
<a class="reference internal" href="cascades.html#passive-deletes"><span class="std std-ref">使用具有 ORM 关系的外键 ON DELETE 级联</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ondelete=&quot;cascade&quot;</span></code> configured on the <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ForeignKey" title="sqlalchemy.schema.ForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKey</span></code></a> constraint.
This is also detailed at <a class="reference internal" href="cascades.html#passive-deletes"><span class="std std-ref">使用具有 ORM 关系的外键 ON DELETE 级联</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cascade=&quot;all,</span> <span class="pre">delete-orphan&quot;</span></code> - instructs the <a class="reference internal" href="../glossary.html#term-unit-of-work"><span class="xref std std-term">unit of work</span></a> to
delete <code class="docutils literal notranslate"><span class="pre">AccountTransaction</span></code> objects when they are removed from the
collection.  See <a class="reference internal" href="cascades.html#cascade-delete-orphan"><span class="std std-ref">删除-孤立</span></a> in the <a class="reference internal" href="cascades.html#unitofwork-cascades"><span class="std std-ref">级联</span></a>
document.</p></li>
</ul>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入: </span>Added “Write only” relationship loaders.</p>
</div>
</div>
</div>
<section id="id3">
<h3>创建和保存新的只写集合<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h3>
<p>Creating and Persisting New Write Only Collections</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--2-input--1" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--1">中文</label><div class="tab-content docutils container">
<p>仅写集合仅允许对 <a class="reference internal" href="../glossary.html#term-transient"><span class="xref std std-term">transient</span></a> 或 <a class="reference internal" href="../glossary.html#term-pending"><span class="xref std std-term">pending</span></a> 对象直接赋值集合。使用上述映射，这意味着我们可以创建一个新的 <code class="docutils literal notranslate"><span class="pre">Account</span></code> 对象，并添加一系列 <code class="docutils literal notranslate"><span class="pre">AccountTransaction</span></code> 对象到 <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 中。可以使用任何 Python 可迭代对象作为开始的对象源，下面我们使用 Python <code class="docutils literal notranslate"><span class="pre">list</span></code>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">new_account</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span>
<span class="go">...     identifier=&quot;account_01&quot;,</span>
<span class="go">...     account_transactions=[</span>
<span class="go">...         AccountTransaction(description=&quot;initial deposit&quot;, amount=Decimal(&quot;500.00&quot;)),</span>
<span class="go">...         AccountTransaction(description=&quot;transfer&quot;, amount=Decimal(&quot;1000.00&quot;)),</span>
<span class="go">...         AccountTransaction(description=&quot;withdrawal&quot;, amount=Decimal(&quot;-29.50&quot;)),</span>
<span class="go">...     ],</span>
<span class="go">... )</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
<span class="go">...     session.add(new_account)</span>
<span class="go">...     session.commit()</span>
<div class='show_sql'><span class="k">BEGIN</span><span class="w"> </span><span class="p">(</span><span class="k">implicit</span><span class="p">)</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">)</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;account_01&#39;</span><span class="p">,)</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNING</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span>
<span class="p">[...</span><span class="w"> </span><span class="p">(</span><span class="n">insertmanyvalues</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">ordered</span><span class="p">;</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">supported</span><span class="p">)]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;initial deposit&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNING</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span>
<span class="p">[</span><span class="n">insertmanyvalues</span><span class="w"> </span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">ordered</span><span class="p">;</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">supported</span><span class="p">)]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;transfer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNING</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span>
<span class="p">[</span><span class="n">insertmanyvalues</span><span class="w"> </span><span class="mi">3</span><span class="o">/</span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">ordered</span><span class="p">;</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">supported</span><span class="p">)]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;withdrawal&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">29</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
<span class="k">COMMIT</span>
</div></pre></div>
</div>
<p>一旦对象被持久化到数据库（即处于 <a class="reference internal" href="../glossary.html#term-persistent"><span class="xref std std-term">persistent</span></a> 或 <a class="reference internal" href="../glossary.html#term-detached"><span class="xref std std-term">detached</span></a> 状态），集合可以通过新项目进行扩展，也可以删除单个项目。然而，集合 <strong>不能再通过完全替换集合进行重新赋值</strong> ，因为这样的操作需要将以前的集合完全加载到内存中，以便将旧条目与新条目进行对比:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">new_account</span><span class="o">.</span><span class="n">account_transactions</span> <span class="o">=</span> <span class="p">[</span>
<span class="go">...     AccountTransaction(description=&quot;some transaction&quot;, amount=Decimal(&quot;10.00&quot;))</span>
<span class="go">... ]</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">sqlalchemy.exc.InvalidRequestError: Collection &quot;Account.account_transactions&quot; does not</span>
<span class="go">support implicit iteration; collection replacement operations can&#39;t be used</span></pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--2-input--2" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--2">英文</label><div class="tab-content docutils container">
<p>The write-only collection allows for direct assignment of the collection
as a whole <strong>only</strong> for <a class="reference internal" href="../glossary.html#term-transient"><span class="xref std std-term">transient</span></a> or <a class="reference internal" href="../glossary.html#term-pending"><span class="xref std std-term">pending</span></a> objects.
With our above mapping, this indicates we can create a new <code class="docutils literal notranslate"><span class="pre">Account</span></code>
object with a sequence of <code class="docutils literal notranslate"><span class="pre">AccountTransaction</span></code> objects to be added
to a <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>.   Any Python iterable may be used as the
source of objects to start, where below we use a Python <code class="docutils literal notranslate"><span class="pre">list</span></code>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">new_account</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span>
<span class="go">...     identifier=&quot;account_01&quot;,</span>
<span class="go">...     account_transactions=[</span>
<span class="go">...         AccountTransaction(description=&quot;initial deposit&quot;, amount=Decimal(&quot;500.00&quot;)),</span>
<span class="go">...         AccountTransaction(description=&quot;transfer&quot;, amount=Decimal(&quot;1000.00&quot;)),</span>
<span class="go">...         AccountTransaction(description=&quot;withdrawal&quot;, amount=Decimal(&quot;-29.50&quot;)),</span>
<span class="go">...     ],</span>
<span class="go">... )</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
<span class="go">...     session.add(new_account)</span>
<span class="go">...     session.commit()</span>
<div class='show_sql'><span class="k">BEGIN</span><span class="w"> </span><span class="p">(</span><span class="k">implicit</span><span class="p">)</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">)</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;account_01&#39;</span><span class="p">,)</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNING</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span>
<span class="p">[...</span><span class="w"> </span><span class="p">(</span><span class="n">insertmanyvalues</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">ordered</span><span class="p">;</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">supported</span><span class="p">)]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;initial deposit&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNING</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span>
<span class="p">[</span><span class="n">insertmanyvalues</span><span class="w"> </span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">ordered</span><span class="p">;</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">supported</span><span class="p">)]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;transfer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNING</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span>
<span class="p">[</span><span class="n">insertmanyvalues</span><span class="w"> </span><span class="mi">3</span><span class="o">/</span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">ordered</span><span class="p">;</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">supported</span><span class="p">)]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;withdrawal&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">29</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
<span class="k">COMMIT</span>
</div></pre></div>
</div>
<p>Once an object is database-persisted (i.e. in the <a class="reference internal" href="../glossary.html#term-persistent"><span class="xref std std-term">persistent</span></a> or
<a class="reference internal" href="../glossary.html#term-detached"><span class="xref std std-term">detached</span></a> state), the collection has the ability to be extended with new
items as well as the ability for individual items to be removed. However, the
collection may <strong>no longer be re-assigned with a full replacement collection</strong>,
as such an operation requires that the previous collection is fully
loaded into memory in order to reconcile the old entries with the new ones:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">new_account</span><span class="o">.</span><span class="n">account_transactions</span> <span class="o">=</span> <span class="p">[</span>
<span class="go">...     AccountTransaction(description=&quot;some transaction&quot;, amount=Decimal(&quot;10.00&quot;))</span>
<span class="go">... ]</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">sqlalchemy.exc.InvalidRequestError: Collection &quot;Account.account_transactions&quot; does not</span>
<span class="go">support implicit iteration; collection replacement operations can&#39;t be used</span></pre></div>
</div>
</div>
</div>
</section>
<section id="id4">
<h3>向现有集合添加新项目<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h3>
<p>Adding New Items to an Existing Collection</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--3-input--1" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--1">中文</label><div class="tab-content docutils container">
<p>对于持久对象的仅写集合，
使用 <a class="reference internal" href="../glossary.html#term-unit-of-work"><span class="xref std std-term">unit of work</span></a> 进程修改集合只能通过使用 <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.add" title="sqlalchemy.orm.WriteOnlyCollection.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.add()</span></code></a>、
<a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.add_all" title="sqlalchemy.orm.WriteOnlyCollection.add_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.add_all()</span></code></a> 和 <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.remove" title="sqlalchemy.orm.WriteOnlyCollection.remove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.remove()</span></code></a> 方法进行:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">existing_account</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Account</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="s2">&quot;account_01&quot;</span><span class="p">))</span>
<div class='show_sql'><span class="k">BEGIN</span><span class="w"> </span><span class="p">(</span><span class="k">implicit</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">identifier</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">account</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">identifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;account_01&#39;</span><span class="p">,)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">existing_account</span><span class="o">.</span><span class="n">account_transactions</span><span class="o">.</span><span class="n">add_all</span><span class="p">(</span>
<span class="go">...     [</span>
<span class="go">...         AccountTransaction(description=&quot;paycheck&quot;, amount=Decimal(&quot;2000.00&quot;)),</span>
<span class="go">...         AccountTransaction(description=&quot;rent&quot;, amount=Decimal(&quot;-800.00&quot;)),</span>
<span class="go">...     ]</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<div class='show_sql'><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNING</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span>
<span class="p">[...</span><span class="w"> </span><span class="p">(</span><span class="n">insertmanyvalues</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="n">ordered</span><span class="p">;</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">supported</span><span class="p">)]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;paycheck&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNING</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span>
<span class="p">[</span><span class="n">insertmanyvalues</span><span class="w"> </span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="n">ordered</span><span class="p">;</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">supported</span><span class="p">)]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;rent&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">800</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>
<span class="k">COMMIT</span>
</div></pre></div>
</div>
<p>上面添加的项目保存在 <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 的待处理队列中，直到下一次刷新，
此时它们将被插入到数据库中，前提是添加的对象之前是 <a class="reference internal" href="../glossary.html#term-transient"><span class="xref std std-term">transient</span></a> 的。</p>
</div>
<input class="tab-input" id="tab-set--3-input--2" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--2">英文</label><div class="tab-content docutils container">
<p>For write-only collections of persistent objects,
modifications to the collection using <a class="reference internal" href="../glossary.html#term-unit-of-work"><span class="xref std std-term">unit of work</span></a> processes may proceed
only by using the <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.add" title="sqlalchemy.orm.WriteOnlyCollection.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.add()</span></code></a>,
<a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.add_all" title="sqlalchemy.orm.WriteOnlyCollection.add_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.add_all()</span></code></a> and <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.remove" title="sqlalchemy.orm.WriteOnlyCollection.remove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.remove()</span></code></a>
methods:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">expire_on_commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">existing_account</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Account</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="s2">&quot;account_01&quot;</span><span class="p">))</span>
<div class='show_sql'><span class="k">BEGIN</span><span class="w"> </span><span class="p">(</span><span class="k">implicit</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">identifier</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">account</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">identifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;account_01&#39;</span><span class="p">,)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">existing_account</span><span class="o">.</span><span class="n">account_transactions</span><span class="o">.</span><span class="n">add_all</span><span class="p">(</span>
<span class="go">...     [</span>
<span class="go">...         AccountTransaction(description=&quot;paycheck&quot;, amount=Decimal(&quot;2000.00&quot;)),</span>
<span class="go">...         AccountTransaction(description=&quot;rent&quot;, amount=Decimal(&quot;-800.00&quot;)),</span>
<span class="go">...     ]</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<div class='show_sql'><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNING</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span>
<span class="p">[...</span><span class="w"> </span><span class="p">(</span><span class="n">insertmanyvalues</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="n">ordered</span><span class="p">;</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">supported</span><span class="p">)]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;paycheck&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNING</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span>
<span class="p">[</span><span class="n">insertmanyvalues</span><span class="w"> </span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="n">ordered</span><span class="p">;</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">supported</span><span class="p">)]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;rent&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">800</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>
<span class="k">COMMIT</span>
</div></pre></div>
</div>
<p>The items added above are held in a pending queue within the
<a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> until the next flush, at which point they are INSERTed
into the database, assuming the added objects were previously <a class="reference internal" href="../glossary.html#term-transient"><span class="xref std std-term">transient</span></a>.</p>
</div>
</div>
</section>
<section id="id5">
<h3>查询项目<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h3>
<p>Querying Items</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--4-input--1" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--1">中文</label><div class="tab-content docutils container">
<p><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a> 不在任何时候存储对集合当前内容的引用，也不会有任何行为直接向数据库发出 SELECT 以加载它们；其主要假设是集合可能包含成千上万或数百万行，不应作为任何其他操作的副作用完全加载到内存中。</p>
<p>相反，<a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a> 包含生成 SQL 的助手方法，如 <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.select" title="sqlalchemy.orm.WriteOnlyCollection.select"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.select()</span></code></a>，该方法将生成一个 <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> 构造，该构造预先配置了当前父行的正确 WHERE / FROM 条件，然后可以进一步修改以选择所需的任何行范围，并可以使用 <a class="reference internal" href="queryguide/api.html#orm-queryguide-yield-per"><span class="std std-ref">server side cursors</span></a> 等功能调用，以便希望以内存高效的方式遍历整个集合的进程。</p>
<p>生成的语句如下所示。请注意，它还包括在示例映射中由 <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> 的 <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.order_by" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.order_by</span></code></a> 参数指示的 ORDER BY 条件；如果未配置该参数，则会省略此条件:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">existing_account</span><span class="o">.</span><span class="n">account_transactions</span><span class="o">.</span><span class="n">select</span><span class="p">())</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">account_id</span><span class="p">,</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">description</span><span class="p">,</span>
<span class="n">account_transaction</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="k">timestamp</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">account_transaction</span>
<span class="k">WHERE</span><span class="w"> </span><span class="p">:</span><span class="n">param_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">account_id</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="k">timestamp</span>
</div></pre></div>
</div>
<p>我们可以将此 <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> 构造与 <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 结合使用，以查询 <code class="docutils literal notranslate"><span class="pre">AccountTransaction</span></code> 对象，最简单的方法是使用 <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.scalars" title="sqlalchemy.orm.Session.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.scalars()</span></code></a> 方法，该方法将返回一个 <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a>，直接生成 ORM 对象。通常，但不是必须的，<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> 会进一步修改以限制返回的记录；在下面的示例中，添加了额外的 WHERE 条件以仅加载“借记”账户交易，并添加了“LIMIT 10”以仅检索前十行:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">account_transactions</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span>
<span class="go">...     existing_account.account_transactions.select()</span>
<span class="go">...     .where(AccountTransaction.amount &lt; 0)</span>
<span class="go">...     .limit(10)</span>
<span class="go">... ).all()</span>
<div class='show_sql'><span class="k">BEGIN</span><span class="w"> </span><span class="p">(</span><span class="k">implicit</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">account_id</span><span class="p">,</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">description</span><span class="p">,</span>
<span class="n">account_transaction</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="k">timestamp</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">account_transaction</span>
<span class="k">WHERE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">account_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">?</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="k">timestamp</span><span class="w">  </span><span class="k">LIMIT</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">OFFSET</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">account_transactions</span><span class="p">)</span>
<span class="go">[AccountTransaction(amount=-29.50, timestamp=&#39;...&#39;), AccountTransaction(amount=-800.00, timestamp=&#39;...&#39;)]</span></pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--4-input--2" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--2">英文</label><div class="tab-content docutils container">
<p>The <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a> does not at any point store a reference
to the current contents of the collection, nor does it have any behavior where
it would directly emit a SELECT to the database in order to load them; the
overriding assumption is that the collection may contain many thousands or
millions of rows, and should never be fully loaded into memory as a side effect
of any other operation.</p>
<p>Instead, the <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a> includes SQL-generating helpers
such as <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.select" title="sqlalchemy.orm.WriteOnlyCollection.select"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.select()</span></code></a>, which will generate
a <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> construct pre-configured with the correct WHERE / FROM
criteria for the current parent row, which can then be further modified in
order to SELECT any range of rows desired, as well as invoked using features
like <a class="reference internal" href="queryguide/api.html#orm-queryguide-yield-per"><span class="std std-ref">server side cursors</span></a> for processes that
wish to iterate through the full collection in a memory-efficient manner.</p>
<p>The statement generated is illustrated below. Note it also includes ORDER BY
criteria, indicated in the example mapping by the
<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.order_by" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.order_by</span></code></a> parameter of <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>;
this criteria would be omitted if the parameter were not configured:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">existing_account</span><span class="o">.</span><span class="n">account_transactions</span><span class="o">.</span><span class="n">select</span><span class="p">())</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">account_id</span><span class="p">,</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">description</span><span class="p">,</span>
<span class="n">account_transaction</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="k">timestamp</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">account_transaction</span>
<span class="k">WHERE</span><span class="w"> </span><span class="p">:</span><span class="n">param_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">account_id</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="k">timestamp</span>
</div></pre></div>
</div>
<p>We may use this <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> construct along with the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>
in order to query for <code class="docutils literal notranslate"><span class="pre">AccountTransaction</span></code> objects, most easily using the
<a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.scalars" title="sqlalchemy.orm.Session.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.scalars()</span></code></a> method that will return a <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> that
yields ORM objects directly. It’s typical, though not required, that the
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> would be modified further to limit the records returned; in
the example below, additional WHERE criteria to load only “debit” account
transactions is added, along with “LIMIT 10” to retrieve only the first ten
rows:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">account_transactions</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span>
<span class="go">...     existing_account.account_transactions.select()</span>
<span class="go">...     .where(AccountTransaction.amount &lt; 0)</span>
<span class="go">...     .limit(10)</span>
<span class="go">... ).all()</span>
<div class='show_sql'><span class="k">BEGIN</span><span class="w"> </span><span class="p">(</span><span class="k">implicit</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">account_id</span><span class="p">,</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">description</span><span class="p">,</span>
<span class="n">account_transaction</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="k">timestamp</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">account_transaction</span>
<span class="k">WHERE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">account_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">?</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="k">timestamp</span><span class="w">  </span><span class="k">LIMIT</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">OFFSET</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">account_transactions</span><span class="p">)</span>
<span class="go">[AccountTransaction(amount=-29.50, timestamp=&#39;...&#39;), AccountTransaction(amount=-800.00, timestamp=&#39;...&#39;)]</span></pre></div>
</div>
</div>
</div>
</section>
<section id="id6">
<h3>删除项目<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h3>
<p>Removing Items</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--5-input--1" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--1">中文</label><div class="tab-content docutils container">
<p>在当前 <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 中处于 <a class="reference internal" href="../glossary.html#term-persistent"><span class="xref std std-term">persistent</span></a> 状态的单个项目可以使用 <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.remove" title="sqlalchemy.orm.WriteOnlyCollection.remove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.remove()</span></code></a> 方法标记为从集合中移除。刷新过程将隐式地认为对象已经是集合的一部分。下面的示例演示了移除单个 <code class="docutils literal notranslate"><span class="pre">AccountTransaction</span></code> 项目，根据 <a class="reference internal" href="cascades.html#unitofwork-cascades"><span class="std std-ref">cascade</span></a> 设置，这将导致该行的 DELETE：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">existing_transaction</span> <span class="o">=</span> <span class="n">account_transactions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">existing_account</span><span class="o">.</span><span class="n">account_transactions</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">existing_transaction</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="go">{execsql}DELETE FROM account_transaction WHERE account_transaction.id = ?</span>
<span class="go">[...] (3,)</span>
<span class="go">COMMIT</span></pre></div>
</div>
<p>与任何 ORM 映射的集合一样，对象移除可以继续进行，将对象从集合中取消关联，同时将对象保留在数据库中，或者根据 <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> 的 <a class="reference internal" href="cascades.html#cascade-delete-orphan"><span class="std std-ref">删除-孤立</span></a> 配置为其行发出 DELETE。</p>
<p>不删除的集合移除涉及为 <a class="reference internal" href="basic_relationships.html#relationship-patterns-o2m"><span class="std std-ref">one-to-many</span></a> 关系将外键列设置为 NULL，或者为 <a class="reference internal" href="basic_relationships.html#relationships-many-to-many"><span class="std std-ref">many-to-many</span></a> 关系删除相应的关联行。</p>
</div>
<input class="tab-input" id="tab-set--5-input--2" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--2">英文</label><div class="tab-content docutils container">
<p>Individual items that are loaded in the <a class="reference internal" href="../glossary.html#term-persistent"><span class="xref std std-term">persistent</span></a>
state against the current <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> may be marked for removal
from the collection using the <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.remove" title="sqlalchemy.orm.WriteOnlyCollection.remove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.remove()</span></code></a> method.
The flush process will implicitly consider the object to be already part
of the collection when the operation proceeds.   The example below
illustrates removal of an individual <code class="docutils literal notranslate"><span class="pre">AccountTransaction</span></code> item,
which per <a class="reference internal" href="cascades.html#unitofwork-cascades"><span class="std std-ref">cascade</span></a> settings results in a
DELETE of that row:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">existing_transaction</span> <span class="o">=</span> <span class="n">account_transactions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">existing_account</span><span class="o">.</span><span class="n">account_transactions</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">existing_transaction</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div>
</div>
<p>{execsql}DELETE FROM account_transaction WHERE account_transaction.id = ?
[…] (3,)
COMMIT</p>
<p>As with any ORM-mapped collection, object removal may proceed either to
de-associate the object from the collection while leaving the object present in
the database, or may issue a DELETE for its row, based on the
<a class="reference internal" href="cascades.html#cascade-delete-orphan"><span class="std std-ref">删除-孤立</span></a> configuration of the <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>.</p>
<p>Collection removal without deletion involves setting foreign key columns to
NULL for a <a class="reference internal" href="basic_relationships.html#relationship-patterns-o2m"><span class="std std-ref">one-to-many</span></a> relationship, or
deleting the corresponding association row for a
<a class="reference internal" href="basic_relationships.html#relationships-many-to-many"><span class="std std-ref">many-to-many</span></a> relationship.</p>
</div>
</div>
</section>
<section id="id7">
<h3>批量插入新项目<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h3>
<p>Bulk INSERT of New Items</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--6-input--1" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--1">中文</label><div class="tab-content docutils container">
<p><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a> 可以生成 DML 构造，如 <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> 对象，可以在 ORM 上下文中用于产生批量插入行为。请参阅 <a class="reference internal" href="queryguide/dml.html#orm-queryguide-bulk-insert"><span class="std std-ref">ORM 批量 INSERT 语句</span></a> 部分，了解 ORM 批量插入的概述。</p>
</div>
<input class="tab-input" id="tab-set--6-input--2" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--2">英文</label><div class="tab-content docutils container">
<p>The <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a> can generate DML constructs such as
<a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> objects, which may be used in an ORM context to
produce bulk insert behavior.  See the section
<a class="reference internal" href="queryguide/dml.html#orm-queryguide-bulk-insert"><span class="std std-ref">ORM 批量 INSERT 语句</span></a> for an overview of ORM bulk inserts.</p>
</div>
</div>
<section id="id8">
<h4>一对多集合<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h4>
<p>One to Many Collections</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--7-input--1" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--1">中文</label><div class="tab-content docutils container">
<p>对于 <strong>仅常规一对多集合</strong>，<a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.insert" title="sqlalchemy.orm.WriteOnlyCollection.insert"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.insert()</span></code></a> 方法将生成一个 <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> 构造，该构造预先建立了与父对象对应的 VALUES 条件。由于这个 VALUES 条件完全针对相关表，因此该语句可用于插入新行，并同时成为相关集合中的新记录:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="go">...     existing_account.account_transactions.insert(),</span>
<span class="go">...     [</span>
<span class="go">...         {&quot;description&quot;: &quot;transaction 1&quot;, &quot;amount&quot;: Decimal(&quot;47.50&quot;)},</span>
<span class="go">...         {&quot;description&quot;: &quot;transaction 2&quot;, &quot;amount&quot;: Decimal(&quot;-501.25&quot;)},</span>
<span class="go">...         {&quot;description&quot;: &quot;transaction 3&quot;, &quot;amount&quot;: Decimal(&quot;1800.00&quot;)},</span>
<span class="go">...         {&quot;description&quot;: &quot;transaction 4&quot;, &quot;amount&quot;: Decimal(&quot;-300.00&quot;)},</span>
<span class="go">...     ],</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">BEGIN</span><span class="w"> </span><span class="p">(</span><span class="k">implicit</span><span class="p">)</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">)</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;transaction 1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">47</span><span class="p">.</span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;transaction 2&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">501</span><span class="p">.</span><span class="mi">25</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;transaction 3&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1800</span><span class="p">.</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;transaction 4&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">300</span><span class="p">.</span><span class="mi">0</span><span class="p">)]</span>
<span class="o">&lt;</span><span class="p">...</span><span class="o">&gt;</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="go">COMMIT</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="queryguide/dml.html#orm-queryguide-bulk-insert"><span class="std std-ref">ORM 批量 INSERT 语句</span></a> - 在 <a class="reference internal" href="queryguide/index.html#queryguide-toplevel"><span class="std std-ref">ORM 查询指南</span></a></p>
<p><a class="reference internal" href="basic_relationships.html#relationship-patterns-o2m"><span class="std std-ref">一对多</span></a> - 在 <a class="reference internal" href="basic_relationships.html#relationship-patterns"><span class="std std-ref">基本关系模式</span></a></p>
</div>
</div>
<input class="tab-input" id="tab-set--7-input--2" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--2">英文</label><div class="tab-content docutils container">
<p>For a <strong>regular one to many collection only</strong>, the <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.insert" title="sqlalchemy.orm.WriteOnlyCollection.insert"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.insert()</span></code></a>
method will produce an <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> construct which is pre-established with
VALUES criteria corresponding to the parent object.  As this VALUES criteria
is entirely against the related table, the statement can be used to
INSERT new rows that will at the same time become new records in the
related collection:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="go">...     existing_account.account_transactions.insert(),</span>
<span class="go">...     [</span>
<span class="go">...         {&quot;description&quot;: &quot;transaction 1&quot;, &quot;amount&quot;: Decimal(&quot;47.50&quot;)},</span>
<span class="go">...         {&quot;description&quot;: &quot;transaction 2&quot;, &quot;amount&quot;: Decimal(&quot;-501.25&quot;)},</span>
<span class="go">...         {&quot;description&quot;: &quot;transaction 3&quot;, &quot;amount&quot;: Decimal(&quot;1800.00&quot;)},</span>
<span class="go">...         {&quot;description&quot;: &quot;transaction 4&quot;, &quot;amount&quot;: Decimal(&quot;-300.00&quot;)},</span>
<span class="go">...     ],</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">BEGIN</span><span class="w"> </span><span class="p">(</span><span class="k">implicit</span><span class="p">)</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">)</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;transaction 1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">47</span><span class="p">.</span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;transaction 2&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">501</span><span class="p">.</span><span class="mi">25</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;transaction 3&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1800</span><span class="p">.</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;transaction 4&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">300</span><span class="p">.</span><span class="mi">0</span><span class="p">)]</span>
<span class="o">&lt;</span><span class="p">...</span><span class="o">&gt;</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="go">COMMIT</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="queryguide/dml.html#orm-queryguide-bulk-insert"><span class="std std-ref">ORM 批量 INSERT 语句</span></a> - in the <a class="reference internal" href="queryguide/index.html#queryguide-toplevel"><span class="std std-ref">ORM 查询指南</span></a></p>
<p><a class="reference internal" href="basic_relationships.html#relationship-patterns-o2m"><span class="std std-ref">一对多</span></a> - at <a class="reference internal" href="basic_relationships.html#relationship-patterns"><span class="std std-ref">基本关系模式</span></a></p>
</div>
</div>
</div>
</section>
<section id="id9">
<h4>多对多集合<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h4>
<p>Many to Many Collections</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--8-input--1" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--1">中文</label><div class="tab-content docutils container">
<p>对于 <strong>多对多集合</strong>，两个类之间的关系涉及一个使用 <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-class docutils literal notranslate"><span class="pre">relationship</span></code></a> 的 <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.secondary" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.secondary</span></code></a> 参数配置的第三个表。要使用 <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a> 将行批量插入到此类型的集合中，可以先单独批量插入新记录，使用 RETURNING 检索这些记录，然后将这些记录传递给 <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.add_all" title="sqlalchemy.orm.WriteOnlyCollection.add_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.add_all()</span></code></a> 方法，其中工作单元进程将继续将它们作为集合的一部分进行持久化。</p>
<p>假设一个 <code class="docutils literal notranslate"><span class="pre">BankAudit</span></code> 类引用了许多使用多对多表的 <code class="docutils literal notranslate"><span class="pre">AccountTransaction</span></code> 记录:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Column</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">audit_to_transaction</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
<span class="go">...     &quot;audit_transaction&quot;,</span>
<span class="go">...     Base.metadata,</span>
<span class="go">...     Column(&quot;audit_id&quot;, ForeignKey(&quot;audit.id&quot;, ondelete=&quot;CASCADE&quot;), primary_key=True),</span>
<span class="go">...     Column(</span>
<span class="go">...         &quot;transaction_id&quot;,</span>
<span class="go">...         ForeignKey(&quot;account_transaction.id&quot;, ondelete=&quot;CASCADE&quot;),</span>
<span class="go">...         primary_key=True,</span>
<span class="go">...     ),</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">BankAudit</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="go">...     __tablename__ = &quot;audit&quot;</span>
<span class="go">...     id: Mapped[int] = mapped_column(primary_key=True)</span>
<span class="go">...     account_transactions: WriteOnlyMapped[&quot;AccountTransaction&quot;] = relationship(</span>
<span class="go">...         secondary=audit_to_transaction, passive_deletes=True</span>
<span class="go">...     )</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>为了说明这两个操作，我们使用批量插入添加更多 <code class="docutils literal notranslate"><span class="pre">AccountTransaction</span></code> 对象，通过在批量 INSERT 语句中添加 <code class="docutils literal notranslate"><span class="pre">returning(AccountTransaction)</span></code> 使用 RETURNING 检索它们（请注意，我们也可以同样轻松地使用现有的 <code class="docutils literal notranslate"><span class="pre">AccountTransaction</span></code> 对象）:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">new_transactions</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span>
<span class="go">...     existing_account.account_transactions.insert().returning(AccountTransaction),</span>
<span class="go">...     [</span>
<span class="go">...         {&quot;description&quot;: &quot;odd trans 1&quot;, &quot;amount&quot;: Decimal(&quot;50000.00&quot;)},</span>
<span class="go">...         {&quot;description&quot;: &quot;odd trans 2&quot;, &quot;amount&quot;: Decimal(&quot;25000.00&quot;)},</span>
<span class="go">...         {&quot;description&quot;: &quot;odd trans 3&quot;, &quot;amount&quot;: Decimal(&quot;45.00&quot;)},</span>
<span class="go">...     ],</span>
<span class="go">... ).all()</span>
<div class='show_sql'><span class="k">BEGIN</span><span class="w"> </span><span class="p">(</span><span class="k">implicit</span><span class="p">)</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span>
<span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">)</span>
<span class="k">RETURNING</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">account_id</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;odd trans 1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">50000</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;odd trans 2&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">25000</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;odd trans 3&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">45</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>
</div></pre></div>
</div>
<p>准备好一系列 <code class="docutils literal notranslate"><span class="pre">AccountTransaction</span></code> 对象后，使用 <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.add_all" title="sqlalchemy.orm.WriteOnlyCollection.add_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.add_all()</span></code></a> 方法一次关联多行到新的 <code class="docutils literal notranslate"><span class="pre">BankAudit</span></code> 对象:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bank_audit</span> <span class="o">=</span> <span class="n">BankAudit</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">bank_audit</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bank_audit</span><span class="o">.</span><span class="n">account_transactions</span><span class="o">.</span><span class="n">add_all</span><span class="p">(</span><span class="n">new_transactions</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<div class='show_sql'><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">audit</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">VALUES</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">audit_transaction</span><span class="w"> </span><span class="p">(</span><span class="n">audit_id</span><span class="p">,</span><span class="w"> </span><span class="n">transaction_id</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">)</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">)]</span>
<span class="k">COMMIT</span>
</div></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="queryguide/dml.html#orm-queryguide-bulk-insert"><span class="std std-ref">ORM 批量 INSERT 语句</span></a> - 在 <a class="reference internal" href="queryguide/index.html#queryguide-toplevel"><span class="std std-ref">ORM 查询指南</span></a></p>
<p><a class="reference internal" href="basic_relationships.html#relationships-many-to-many"><span class="std std-ref">多对多</span></a> - 在 <a class="reference internal" href="basic_relationships.html#relationship-patterns"><span class="std std-ref">基本关系模式</span></a></p>
</div>
</div>
<input class="tab-input" id="tab-set--8-input--2" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--2">英文</label><div class="tab-content docutils container">
<p>For a <strong>many to many collection</strong>, the relationship between two classes
involves a third table that is configured using the
<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.secondary" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.secondary</span></code></a> parameter of <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-class docutils literal notranslate"><span class="pre">relationship</span></code></a>.
To bulk insert rows into a collection of this type using
<a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a>, the new records may be bulk-inserted separately
first, retrieved using RETURNING, and those records then passed to the
<a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.add_all" title="sqlalchemy.orm.WriteOnlyCollection.add_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.add_all()</span></code></a> method where the unit of work process
will proceed to persist them as part of the collection.</p>
<p>Supposing a class <code class="docutils literal notranslate"><span class="pre">BankAudit</span></code> referred to many <code class="docutils literal notranslate"><span class="pre">AccountTransaction</span></code>
records using a many-to-many table:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Column</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">audit_to_transaction</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
<span class="go">...     &quot;audit_transaction&quot;,</span>
<span class="go">...     Base.metadata,</span>
<span class="go">...     Column(&quot;audit_id&quot;, ForeignKey(&quot;audit.id&quot;, ondelete=&quot;CASCADE&quot;), primary_key=True),</span>
<span class="go">...     Column(</span>
<span class="go">...         &quot;transaction_id&quot;,</span>
<span class="go">...         ForeignKey(&quot;account_transaction.id&quot;, ondelete=&quot;CASCADE&quot;),</span>
<span class="go">...         primary_key=True,</span>
<span class="go">...     ),</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">BankAudit</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="go">...     __tablename__ = &quot;audit&quot;</span>
<span class="go">...     id: Mapped[int] = mapped_column(primary_key=True)</span>
<span class="go">...     account_transactions: WriteOnlyMapped[&quot;AccountTransaction&quot;] = relationship(</span>
<span class="go">...         secondary=audit_to_transaction, passive_deletes=True</span>
<span class="go">...     )</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>To illustrate the two operations, we add more <code class="docutils literal notranslate"><span class="pre">AccountTransaction</span></code> objects
using bulk insert, which we retrieve using RETURNING by adding
<code class="docutils literal notranslate"><span class="pre">returning(AccountTransaction)</span></code> to the bulk INSERT statement (note that
we could just as easily use existing <code class="docutils literal notranslate"><span class="pre">AccountTransaction</span></code> objects as well):</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">new_transactions</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span></pre></div>
</div>
<p>…     existing_account.account_transactions.insert().returning(AccountTransaction),
…     [
…         {“description”: “odd trans 1”, “amount”: Decimal(“50000.00”)},
…         {“description”: “odd trans 2”, “amount”: Decimal(“25000.00”)},
…         {“description”: “odd trans 3”, “amount”: Decimal(“45.00”)},
…     ],
… ).all()
{execsql}BEGIN (implicit)
INSERT INTO account_transaction (account_id, description, amount, timestamp) VALUES
(?, ?, ?, CURRENT_TIMESTAMP), (?, ?, ?, CURRENT_TIMESTAMP), (?, ?, ?, CURRENT_TIMESTAMP)
RETURNING id, account_id, description, amount, timestamp
[…] (1, ‘odd trans 1’, 50000.0, 1, ‘odd trans 2’, 25000.0, 1, ‘odd trans 3’, 45.0)
{stop}</p>
<p>With a list of <code class="docutils literal notranslate"><span class="pre">AccountTransaction</span></code> objects ready, the
<a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.add_all" title="sqlalchemy.orm.WriteOnlyCollection.add_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.add_all()</span></code></a> method is used to associate many rows
at once with a new <code class="docutils literal notranslate"><span class="pre">BankAudit</span></code> object:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bank_audit</span> <span class="o">=</span> <span class="n">BankAudit</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">bank_audit</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bank_audit</span><span class="o">.</span><span class="n">account_transactions</span><span class="o">.</span><span class="n">add_all</span><span class="p">(</span><span class="n">new_transactions</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div>
</div>
<p>{execsql}INSERT INTO audit DEFAULT VALUES
[…] ()
INSERT INTO audit_transaction (audit_id, transaction_id) VALUES (?, ?)
[…] [(1, 10), (1, 11), (1, 12)]
COMMIT</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="queryguide/dml.html#orm-queryguide-bulk-insert"><span class="std std-ref">ORM 批量 INSERT 语句</span></a> - in the <a class="reference internal" href="queryguide/index.html#queryguide-toplevel"><span class="std std-ref">ORM 查询指南</span></a></p>
<p><a class="reference internal" href="basic_relationships.html#relationships-many-to-many"><span class="std std-ref">多对多</span></a> - at <a class="reference internal" href="basic_relationships.html#relationship-patterns"><span class="std std-ref">基本关系模式</span></a></p>
</div>
</div>
</div>
</section>
</section>
<section id="id10">
<h3>批量更新和删除项目<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h3>
<p>Bulk UPDATE and DELETE of Items</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--9-input--1" name="tab-set--9" type="radio"><label class="tab-label" for="tab-set--9-input--1">中文</label><div class="tab-content docutils container">
<p>类似于 <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a> 可以生成带有预先建立的 WHERE 条件的 <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> 构造，它也可以生成带有相同 WHERE 条件的 <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.expression.Update"><code class="xref py py-class docutils literal notranslate"><span class="pre">Update</span></code></a> 和 <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Delete" title="sqlalchemy.sql.expression.Delete"><code class="xref py py-class docutils literal notranslate"><span class="pre">Delete</span></code></a> 构造，以允许针对大集合中的元素进行条件更新和删除语句。</p>
</div>
<input class="tab-input" id="tab-set--9-input--2" name="tab-set--9" type="radio"><label class="tab-label" for="tab-set--9-input--2">英文</label><div class="tab-content docutils container">
<p>In a similar way in which <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a> can generate
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> constructs with WHERE criteria pre-established, it can
also generate <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.expression.Update"><code class="xref py py-class docutils literal notranslate"><span class="pre">Update</span></code></a> and <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Delete" title="sqlalchemy.sql.expression.Delete"><code class="xref py py-class docutils literal notranslate"><span class="pre">Delete</span></code></a> constructs with that
same WHERE criteria, to allow criteria-oriented UPDATE and DELETE statements
against the elements in a large collection.</p>
</div>
</div>
<section id="id11">
<h4>一对多集合<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h4>
<p>One To Many Collections</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--10-input--1" name="tab-set--10" type="radio"><label class="tab-label" for="tab-set--10-input--1">中文</label><div class="tab-content docutils container">
<p>正如 INSERT 的情况一样，这个功能对于 <strong>一对多集合</strong> 最为简单。</p>
<p>在下面的示例中，使用 <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.update" title="sqlalchemy.orm.WriteOnlyCollection.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.update()</span></code></a> 方法对集合中的元素生成一个 UPDATE 语句，定位“amount”等于 <code class="docutils literal notranslate"><span class="pre">-800</span></code> 的行，并将金额增加 <code class="docutils literal notranslate"><span class="pre">200</span></code>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="go">...     existing_account.account_transactions.update()</span>
<span class="go">...     .values(amount=AccountTransaction.amount + 200)</span>
<span class="go">...     .where(AccountTransaction.amount == -800),</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">BEGIN</span><span class="w"> </span><span class="p">(</span><span class="k">implicit</span><span class="p">)</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">amount</span><span class="o">=</span><span class="p">(</span><span class="n">account_transaction</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">?</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">account_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">800</span><span class="p">)</span>
</div><span class="go">&lt;...&gt;</span></pre></div>
</div>
<p>以类似的方式，<a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.delete" title="sqlalchemy.orm.WriteOnlyCollection.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.delete()</span></code></a> 将生成一个 DELETE 语句并以相同的方式调用:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="go">...     existing_account.account_transactions.delete().where(</span>
<span class="go">...         AccountTransaction.amount.between(0, 30)</span>
<span class="go">...     ),</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">account_id</span>
<span class="k">AND</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">RETURNING</span><span class="w"> </span><span class="n">id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span>
<span class="o">&lt;</span><span class="p">...</span><span class="o">&gt;</span>
</div></pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--10-input--2" name="tab-set--10" type="radio"><label class="tab-label" for="tab-set--10-input--2">英文</label><div class="tab-content docutils container">
<p>As is the case with INSERT, this feature is most straightforward with <strong>one
to many collections</strong>.</p>
<p>In the example below, the <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.update" title="sqlalchemy.orm.WriteOnlyCollection.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.update()</span></code></a> method is used
to generate an UPDATE statement is emitted against the elements
in the collection, locating rows where the “amount” is equal to <code class="docutils literal notranslate"><span class="pre">-800</span></code> and
adding the amount of <code class="docutils literal notranslate"><span class="pre">200</span></code> to them:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="go">...     existing_account.account_transactions.update()</span>
<span class="go">...     .values(amount=AccountTransaction.amount + 200)</span>
<span class="go">...     .where(AccountTransaction.amount == -800),</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">BEGIN</span><span class="w"> </span><span class="p">(</span><span class="k">implicit</span><span class="p">)</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">amount</span><span class="o">=</span><span class="p">(</span><span class="n">account_transaction</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">?</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">account_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">800</span><span class="p">)</span>
</div><span class="go">&lt;...&gt;</span></pre></div>
</div>
<p>In a similar way, <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.delete" title="sqlalchemy.orm.WriteOnlyCollection.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.delete()</span></code></a> will produce a
DELETE statement that is invoked in the same way:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="go">...     existing_account.account_transactions.delete().where(</span>
<span class="go">...         AccountTransaction.amount.between(0, 30)</span>
<span class="go">...     ),</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">account_id</span>
<span class="k">AND</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">RETURNING</span><span class="w"> </span><span class="n">id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span>
<span class="o">&lt;</span><span class="p">...</span><span class="o">&gt;</span>
</div></pre></div>
</div>
</div>
</div>
</section>
<section id="id12">
<h4>多对多集合<a class="headerlink" href="#id12" title="Link to this heading">¶</a></h4>
<p>Many to Many Collections</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--11-input--1" name="tab-set--11" type="radio"><label class="tab-label" for="tab-set--11-input--1">中文</label><div class="tab-content docutils container">
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>这里的技术涉及多表 UPDATE 表达式，这稍微高级一些。</p>
</div>
<p>对于 <strong>多对多集合</strong> 的批量 UPDATE 和 DELETE，为了使 UPDATE 或 DELETE 语句与父对象的主键相关，必须显式地将关联表作为 UPDATE/DELETE 语句的一部分，这需要后端支持非标准 SQL 语法，或者在构造 UPDATE 或 DELETE 语句时采取额外的显式步骤。</p>
<p>对于支持多表版本的 UPDATE 的后端，<a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.update" title="sqlalchemy.orm.WriteOnlyCollection.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.update()</span></code></a> 方法对于多对多集合应该可以在没有额外步骤的情况下工作，如下面的示例中，对多对多 <code class="docutils literal notranslate"><span class="pre">BankAudit.account_transactions</span></code> 集合中的 <code class="docutils literal notranslate"><span class="pre">AccountTransaction</span></code> 对象进行 UPDATE 操作:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="go">...     bank_audit.account_transactions.update().values(</span>
<span class="go">...         description=AccountTransaction.description + &quot; (audited)&quot;</span>
<span class="go">...     )</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">UPDATE</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">description</span><span class="o">=</span><span class="p">(</span><span class="n">account_transaction</span><span class="p">.</span><span class="n">description</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">?</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">audit_transaction</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">audit_transaction</span><span class="p">.</span><span class="n">audit_id</span>
<span class="k">AND</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">audit_transaction</span><span class="p">.</span><span class="n">transaction_id</span><span class="w"> </span><span class="k">RETURNING</span><span class="w"> </span><span class="n">id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39; (audited)&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</div><span class="go">&lt;...&gt;</span></pre></div>
</div>
<p>上述语句自动使用了“UPDATE..FROM”语法，SQLite 和其他后端支持这种语法，以在 WHERE 子句中命名额外的 <code class="docutils literal notranslate"><span class="pre">audit_transaction</span></code> 表。</p>
<p>对于不支持多表语法的多对多集合的 UPDATE 或 DELETE，可以将多对多条件移动到 SELECT 中，例如可以与 IN 结合以匹配行。这里 <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a> 仍然能帮助我们，因为我们使用 <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.select" title="sqlalchemy.orm.WriteOnlyCollection.select"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.select()</span></code></a> 方法为我们生成这个 SELECT，使用 <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.with_only_columns" title="sqlalchemy.sql.expression.Select.with_only_columns"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.with_only_columns()</span></code></a> 方法生成一个 <a class="reference internal" href="../glossary.html#term-scalar-subquery"><span class="xref std std-term">scalar subquery</span></a>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">update</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">subq</span> <span class="o">=</span> <span class="n">bank_audit</span><span class="o">.</span><span class="n">account_transactions</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">with_only_columns</span><span class="p">(</span><span class="n">AccountTransaction</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="go">...     update(AccountTransaction)</span>
<span class="go">...     .values(description=AccountTransaction.description + &quot; (audited)&quot;)</span>
<span class="go">...     .where(AccountTransaction.id.in_(subq))</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">UPDATE</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">description</span><span class="o">=</span><span class="p">(</span><span class="n">account_transaction</span><span class="p">.</span><span class="n">description</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">?</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">id</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">audit_transaction</span>
<span class="k">WHERE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">audit_transaction</span><span class="p">.</span><span class="n">audit_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">audit_transaction</span><span class="p">.</span><span class="n">transaction_id</span><span class="p">)</span>
<span class="k">RETURNING</span><span class="w"> </span><span class="n">id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39; (audited)&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="o">&lt;</span><span class="p">...</span><span class="o">&gt;</span>
</div></pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--11-input--2" name="tab-set--11" type="radio"><label class="tab-label" for="tab-set--11-input--2">英文</label><div class="tab-content docutils container">
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>The techniques here involve multi-table UPDATE expressions, which are
slightly more advanced.</p>
</div>
<p>For bulk UPDATE and DELETE of <strong>many to many collections</strong>, in order for
an UPDATE or DELETE statement to relate to the primary key of the
parent object, the association table must be explicitly part of the
UPDATE/DELETE statement, which requires
either that the backend includes supports for non-standard SQL syntaxes,
or extra explicit steps when constructing the UPDATE or DELETE statement.</p>
<p>For backends that support multi-table versions of UPDATE, the
<a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.update" title="sqlalchemy.orm.WriteOnlyCollection.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.update()</span></code></a> method should work without extra steps
for a many-to-many collection, as in the example below where an UPDATE
is emitted against <code class="docutils literal notranslate"><span class="pre">AccountTransaction</span></code> objects in terms of the
many-to-many <code class="docutils literal notranslate"><span class="pre">BankAudit.account_transactions</span></code> collection:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="go">...     bank_audit.account_transactions.update().values(</span>
<span class="go">...         description=AccountTransaction.description + &quot; (audited)&quot;</span>
<span class="go">...     )</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">UPDATE</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">description</span><span class="o">=</span><span class="p">(</span><span class="n">account_transaction</span><span class="p">.</span><span class="n">description</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">?</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">audit_transaction</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">audit_transaction</span><span class="p">.</span><span class="n">audit_id</span>
<span class="k">AND</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">audit_transaction</span><span class="p">.</span><span class="n">transaction_id</span><span class="w"> </span><span class="k">RETURNING</span><span class="w"> </span><span class="n">id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39; (audited)&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</div><span class="go">&lt;...&gt;</span></pre></div>
</div>
<p>The above statement automatically makes use of “UPDATE..FROM” syntax,
supported by SQLite and others, to name the additional <code class="docutils literal notranslate"><span class="pre">audit_transaction</span></code>
table in the WHERE clause.</p>
<p>To UPDATE or DELETE a many-to-many collection where multi-table syntax is
not available, the many-to-many criteria may be moved into SELECT that
for example may be combined with IN to match rows.
The <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a> still helps us here, as we use the
<a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.select" title="sqlalchemy.orm.WriteOnlyCollection.select"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.select()</span></code></a> method to generate this SELECT for
us, making use of the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.with_only_columns" title="sqlalchemy.sql.expression.Select.with_only_columns"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.with_only_columns()</span></code></a> method to
produce a <a class="reference internal" href="../glossary.html#term-scalar-subquery"><span class="xref std std-term">scalar subquery</span></a>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">update</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">subq</span> <span class="o">=</span> <span class="n">bank_audit</span><span class="o">.</span><span class="n">account_transactions</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">with_only_columns</span><span class="p">(</span><span class="n">AccountTransaction</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="go">...     update(AccountTransaction)</span>
<span class="go">...     .values(description=AccountTransaction.description + &quot; (audited)&quot;)</span>
<span class="go">...     .where(AccountTransaction.id.in_(subq))</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">UPDATE</span><span class="w"> </span><span class="n">account_transaction</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">description</span><span class="o">=</span><span class="p">(</span><span class="n">account_transaction</span><span class="p">.</span><span class="n">description</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">?</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">id</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">audit_transaction</span>
<span class="k">WHERE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">audit_transaction</span><span class="p">.</span><span class="n">audit_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">account_transaction</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">audit_transaction</span><span class="p">.</span><span class="n">transaction_id</span><span class="p">)</span>
<span class="k">RETURNING</span><span class="w"> </span><span class="n">id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39; (audited)&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="o">&lt;</span><span class="p">...</span><span class="o">&gt;</span>
</div></pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="api">
<h3>只写集合 - API 文档<a class="headerlink" href="#api" title="Link to this heading">¶</a></h3>
<p>Write Only Collections - API Documentation</p>
<div class="table-wrapper longtable docutils container">
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection"><span class="sig-name descname">WriteOnlyCollection</span></a></p></td>
<td><p>Write-only collection which can synchronize changes into the
attribute event system.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyMapped"><span class="sig-name descname">WriteOnlyMapped</span></a></p></td>
<td><p>Represent the ORM mapped attribute type for a “write only” relationship.</p></td>
</tr>
</tbody>
</table>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.orm.WriteOnlyCollection">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">WriteOnlyCollection</span></span><a class="headerlink" href="#sqlalchemy.orm.WriteOnlyCollection" title="Link to this definition">¶</a></dt>
<dd><p>Write-only collection which can synchronize changes into the
attribute event system.</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a> is used in a mapping by
using the <code class="docutils literal notranslate"><span class="pre">&quot;write_only&quot;</span></code> lazy loading strategy with
<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>.     For background on this configuration,
see <a class="reference internal" href="#write-only-relationship"><span class="std std-ref">只写关系</span></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#write-only-relationship"><span class="std std-ref">只写关系</span></a></p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.add"><span class="sig-name descname">add()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.add_all"><span class="sig-name descname">add_all()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.delete"><span class="sig-name descname">delete()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.insert"><span class="sig-name descname">insert()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.remove"><span class="sig-name descname">remove()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.select"><span class="sig-name descname">select()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.update"><span class="sig-name descname">update()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.WriteOnlyCollection</span></code></a> (<code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.writeonly._AbstractCollectionWriter</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.WriteOnlyCollection.add">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.WriteOnlyCollection.</span></code></a><span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">item</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_T</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.WriteOnlyCollection.add" title="Link to this definition">¶</a></dt>
<dd><p>Add an item to this <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a>.</p>
<p>The given item will be persisted to the database in terms of
the parent instance’s collection on the next flush.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.WriteOnlyCollection.add_all">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.WriteOnlyCollection.</span></code></a><span class="sig-name descname"><span class="pre">add_all</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iterator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.WriteOnlyCollection.add_all" title="Link to this definition">¶</a></dt>
<dd><p>Add an iterable of items to this <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a>.</p>
<p>The given items will be persisted to the database in terms of
the parent instance’s collection on the next flush.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.WriteOnlyCollection.delete">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.WriteOnlyCollection.</span></code></a><span class="sig-name descname"><span class="pre">delete</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Delete" title="sqlalchemy.sql.dml.Delete"><span class="pre">Delete</span></a></span></span><a class="headerlink" href="#sqlalchemy.orm.WriteOnlyCollection.delete" title="Link to this definition">¶</a></dt>
<dd><p>Produce a <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Delete" title="sqlalchemy.sql.expression.Delete"><code class="xref py py-class docutils literal notranslate"><span class="pre">Delete</span></code></a> which will refer to rows in terms
of this instance-local <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.WriteOnlyCollection.insert">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.WriteOnlyCollection.</span></code></a><span class="sig-name descname"><span class="pre">insert</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.dml.Insert"><span class="pre">Insert</span></a></span></span><a class="headerlink" href="#sqlalchemy.orm.WriteOnlyCollection.insert" title="Link to this definition">¶</a></dt>
<dd><p>For one-to-many collections, produce a <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> which
will insert new rows in terms of this this instance-local
<a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a>.</p>
<p>This construct is only supported for a <a class="reference internal" href="internals.html#sqlalchemy.orm.Relationship" title="sqlalchemy.orm.Relationship"><code class="xref py py-class docutils literal notranslate"><span class="pre">Relationship</span></code></a>
that does <strong>not</strong> include the <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.secondary" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.secondary</span></code></a>
parameter.  For relationships that refer to a many-to-many table,
use ordinary bulk insert techniques to produce new objects, then
use <code class="xref py py-meth docutils literal notranslate"><span class="pre">AbstractCollectionWriter.add_all()</span></code> to associate them
with the collection.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.WriteOnlyCollection.remove">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.WriteOnlyCollection.</span></code></a><span class="sig-name descname"><span class="pre">remove</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">item</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_T</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.WriteOnlyCollection.remove" title="Link to this definition">¶</a></dt>
<dd><p>Remove an item from this <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a>.</p>
<p>The given item will be removed from the parent instance’s collection on
the next flush.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.WriteOnlyCollection.select">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.WriteOnlyCollection.</span></code></a><span class="sig-name descname"><span class="pre">select</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><span class="pre">Select</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.orm.WriteOnlyCollection.select" title="Link to this definition">¶</a></dt>
<dd><p>Produce a <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> construct that represents the
rows within this instance-local <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.WriteOnlyCollection.update">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.WriteOnlyCollection.</span></code></a><span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.dml.Update"><span class="pre">Update</span></a></span></span><a class="headerlink" href="#sqlalchemy.orm.WriteOnlyCollection.update" title="Link to this definition">¶</a></dt>
<dd><p>Produce a <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.expression.Update"><code class="xref py py-class docutils literal notranslate"><span class="pre">Update</span></code></a> which will refer to rows in terms
of this instance-local <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a>.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.orm.WriteOnlyMapped">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">WriteOnlyMapped</span></span><a class="headerlink" href="#sqlalchemy.orm.WriteOnlyMapped" title="Link to this definition">¶</a></dt>
<dd><p>Represent the ORM mapped attribute type for a “write only” relationship.</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyMapped" title="sqlalchemy.orm.WriteOnlyMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyMapped</span></code></a> type annotation may be used in an
<a class="reference internal" href="declarative_tables.html#orm-declarative-mapped-column"><span class="std std-ref">Annotated Declarative Table</span></a> mapping
to indicate that the <code class="docutils literal notranslate"><span class="pre">lazy=&quot;write_only&quot;</span></code> loader strategy should be used
for a particular <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>.</p>
<p>E.g.:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">class User(Base):</span>
<span class="go">    __tablename__ = &quot;user&quot;</span>
<span class="go">    id: Mapped[int] = mapped_column(primary_key=True)</span>
<span class="go">    addresses: WriteOnlyMapped[Address] = relationship(</span>
<span class="go">        cascade=&quot;all,delete-orphan&quot;</span>
<span class="go">    )</span></pre></div>
</div>
<p>See the section <a class="reference internal" href="#write-only-relationship"><span class="std std-ref">只写关系</span></a> for background.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#write-only-relationship"><span class="std std-ref">只写关系</span></a> - complete background</p>
<p><a class="reference internal" href="#sqlalchemy.orm.DynamicMapped" title="sqlalchemy.orm.DynamicMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">DynamicMapped</span></code></a> - includes legacy <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> support</p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyMapped" title="sqlalchemy.orm.WriteOnlyMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.WriteOnlyMapped</span></code></a> (<code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.base._MappedAnnotationBase</span></code>)</p>
</div>
</dd></dl>

</section>
</section>
<section id="dynamic-relationship">
<span id="id13"></span><h2>动态关系加载器<a class="headerlink" href="#dynamic-relationship" title="Link to this heading">¶</a></h2>
<p>Dynamic Relationship Loaders</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--12-input--1" name="tab-set--12" type="radio"><label class="tab-label" for="tab-set--12-input--1">中文</label><div class="tab-content docutils container">
<div class="admonition legacy">
<p class="admonition-title">Legacy Feature</p>
<p>“dynamic” 懒加载策略是现在 “write_only” 策略的旧形式，详见
<a class="reference internal" href="#write-only-relationship"><span class="std std-ref">只写关系</span></a> 部分。</p>
<p>“dynamic” 策略从相关集合生成一个旧的 <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> 对象。
然而，”dynamic” 关系的一个主要缺点是，有几种情况下集合会完全迭代，
其中一些情况并不明显，只能通过逐个案例进行仔细编程和测试来防止。
因此，对于真正的大集合管理，应优先使用 <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a>。</p>
<p>动态加载器也不兼容 <a class="reference internal" href="extensions/asyncio.html#asyncio-toplevel"><span class="std std-ref">异步 I/O (asyncio)</span></a> 扩展。它可以在某些限制下使用，
如 <a class="reference internal" href="extensions/asyncio.html#dynamic-asyncio"><span class="std std-ref">Asyncio dynamic guidelines</span></a> 中所示，
但再次推荐使用完全兼容 asyncio 的 <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a>。</p>
</div>
<p>动态关系策略允许配置一个 <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>，当在一个实例上访问时，
将返回一个旧的 <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> 对象代替集合。
然后可以进一步修改 <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> 以便根据过滤条件迭代数据库集合。
返回的 <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> 对象是 <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery" title="sqlalchemy.orm.AppenderQuery"><code class="xref py py-class docutils literal notranslate"><span class="pre">AppenderQuery</span></code></a> 的实例，
它结合了 <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> 的加载和迭代行为以及基本的集合变异方法，
如 <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery.append" title="sqlalchemy.orm.AppenderQuery.append"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AppenderQuery.append()</span></code></a> 和 <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery.remove" title="sqlalchemy.orm.AppenderQuery.remove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AppenderQuery.remove()</span></code></a>。</p>
<p>动态加载策略可以使用 <a class="reference internal" href="#sqlalchemy.orm.DynamicMapped" title="sqlalchemy.orm.DynamicMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">DynamicMapped</span></code></a> 注释类以类型注释声明形式进行配置:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">DynamicMapped</span>


<span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">posts</span><span class="p">:</span> <span class="n">DynamicMapped</span><span class="p">[</span><span class="n">Post</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">()</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>如上所述，单个 <code class="docutils literal notranslate"><span class="pre">User</span></code> 对象上的 <code class="docutils literal notranslate"><span class="pre">User.posts</span></code> 集合将返回 <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery" title="sqlalchemy.orm.AppenderQuery"><code class="xref py py-class docutils literal notranslate"><span class="pre">AppenderQuery</span></code></a> 对象，
这是 <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> 的子类，还支持基本的集合变异操作:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">jack</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>

<span class="c1"># 过滤 Jack 的博客文章</span>
<span class="n">posts</span> <span class="o">=</span> <span class="n">jack</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Post</span><span class="o">.</span><span class="n">headline</span> <span class="o">==</span> <span class="s2">&quot;this is a post&quot;</span><span class="p">)</span>

<span class="c1"># 应用数组切片</span>
<span class="n">posts</span> <span class="o">=</span> <span class="n">jack</span><span class="o">.</span><span class="n">posts</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span></pre></div>
</div>
<p>动态关系支持有限的写操作，通过 <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery.append" title="sqlalchemy.orm.AppenderQuery.append"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AppenderQuery.append()</span></code></a> 和 <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery.remove" title="sqlalchemy.orm.AppenderQuery.remove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AppenderQuery.remove()</span></code></a> 方法:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">oldpost</span> <span class="o">=</span> <span class="n">jack</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Post</span><span class="o">.</span><span class="n">headline</span> <span class="o">==</span> <span class="s2">&quot;old post&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
<span class="n">jack</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">oldpost</span><span class="p">)</span>

<span class="n">jack</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Post</span><span class="p">(</span><span class="s2">&quot;new post&quot;</span><span class="p">))</span></pre></div>
</div>
<p>由于动态关系的读取端始终查询数据库，
因此对底层集合的更改在数据刷新之前不会可见。
然而，只要正在使用的 <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 上启用了 “autoflush”，
这将在每次集合即将发出查询时自动发生。</p>
</div>
<input class="tab-input" id="tab-set--12-input--2" name="tab-set--12" type="radio"><label class="tab-label" for="tab-set--12-input--2">英文</label><div class="tab-content docutils container">
<div class="admonition legacy">
<p class="admonition-title">Legacy Feature</p>
<p>The “dynamic” lazy loader strategy is the legacy form of what is
now the “write_only” strategy described in the section
<a class="reference internal" href="#write-only-relationship"><span class="std std-ref">只写关系</span></a>.</p>
<p>The “dynamic” strategy produces a legacy <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object from the
related collection. However, a major drawback of “dynamic” relationships is
that there are several cases where the collection will fully iterate, some
of which are non-obvious, which can only be prevented with careful
programming and testing on a case-by-case basis. Therefore, for truly large
collection management, the <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a> should be
preferred.</p>
<p>The dynamic loader is also not compatible with the <a class="reference internal" href="extensions/asyncio.html#asyncio-toplevel"><span class="std std-ref">异步 I/O (asyncio)</span></a>
extension. It can be used with some limitations, as indicated in
<a class="reference internal" href="extensions/asyncio.html#dynamic-asyncio"><span class="std std-ref">Asyncio dynamic guidelines</span></a>, but again the
<a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a>, which is fully compatible with asyncio,
should be preferred.</p>
</div>
<p>The dynamic relationship strategy allows configuration of a
<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> which when accessed on an instance will return a
legacy <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object in place of the collection. The
<a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> can then be modified further so that the database
collection may be iterated based on filtering criteria. The returned
<a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object is an instance of <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery" title="sqlalchemy.orm.AppenderQuery"><code class="xref py py-class docutils literal notranslate"><span class="pre">AppenderQuery</span></code></a>, which
combines the loading and iteration behavior of <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> along with
rudimentary collection mutation methods such as
<a class="reference internal" href="#sqlalchemy.orm.AppenderQuery.append" title="sqlalchemy.orm.AppenderQuery.append"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AppenderQuery.append()</span></code></a> and <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery.remove" title="sqlalchemy.orm.AppenderQuery.remove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AppenderQuery.remove()</span></code></a>.</p>
<p>The “dynamic” loader strategy may be configured with
type-annotated Declarative form using the <a class="reference internal" href="#sqlalchemy.orm.DynamicMapped" title="sqlalchemy.orm.DynamicMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">DynamicMapped</span></code></a>
annotation class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">DynamicMapped</span>


<span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">posts</span><span class="p">:</span> <span class="n">DynamicMapped</span><span class="p">[</span><span class="n">Post</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">()</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>Above, the <code class="docutils literal notranslate"><span class="pre">User.posts</span></code> collection on an individual <code class="docutils literal notranslate"><span class="pre">User</span></code> object
will return the <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery" title="sqlalchemy.orm.AppenderQuery"><code class="xref py py-class docutils literal notranslate"><span class="pre">AppenderQuery</span></code></a> object, which is a subclass
of <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> that also supports basic collection mutation
operations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">jack</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>

<span class="c1"># filter Jack&#39;s blog posts</span>
<span class="n">posts</span> <span class="o">=</span> <span class="n">jack</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Post</span><span class="o">.</span><span class="n">headline</span> <span class="o">==</span> <span class="s2">&quot;this is a post&quot;</span><span class="p">)</span>

<span class="c1"># apply array slices</span>
<span class="n">posts</span> <span class="o">=</span> <span class="n">jack</span><span class="o">.</span><span class="n">posts</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span></pre></div>
</div>
<p>The dynamic relationship supports limited write operations, via the
<a class="reference internal" href="#sqlalchemy.orm.AppenderQuery.append" title="sqlalchemy.orm.AppenderQuery.append"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AppenderQuery.append()</span></code></a> and <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery.remove" title="sqlalchemy.orm.AppenderQuery.remove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AppenderQuery.remove()</span></code></a> methods:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">oldpost</span> <span class="o">=</span> <span class="n">jack</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Post</span><span class="o">.</span><span class="n">headline</span> <span class="o">==</span> <span class="s2">&quot;old post&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
<span class="n">jack</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">oldpost</span><span class="p">)</span>

<span class="n">jack</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Post</span><span class="p">(</span><span class="s2">&quot;new post&quot;</span><span class="p">))</span></pre></div>
</div>
<p>Since the read side of the dynamic relationship always queries the
database, changes to the underlying collection will not be visible
until the data has been flushed.  However, as long as “autoflush” is
enabled on the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> in use, this will occur
automatically each time the collection is about to emit a
query.</p>
</div>
</div>
<section id="id14">
<h3>动态关系加载器 - API<a class="headerlink" href="#id14" title="Link to this heading">¶</a></h3>
<p>Dynamic Relationship Loaders - API</p>
<div class="table-wrapper longtable docutils container">
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.AppenderQuery"><span class="sig-name descname">AppenderQuery</span></a></p></td>
<td><p>A dynamic query that supports basic collection storage operations.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.DynamicMapped"><span class="sig-name descname">DynamicMapped</span></a></p></td>
<td><p>Represent the ORM mapped attribute type for a “dynamic” relationship.</p></td>
</tr>
</tbody>
</table>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.orm.AppenderQuery">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">AppenderQuery</span></span><a class="headerlink" href="#sqlalchemy.orm.AppenderQuery" title="Link to this definition">¶</a></dt>
<dd><p>A dynamic query that supports basic collection storage operations.</p>
<p>Methods on <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery" title="sqlalchemy.orm.AppenderQuery"><code class="xref py py-class docutils literal notranslate"><span class="pre">AppenderQuery</span></code></a> include all methods of
<a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a>, plus additional methods used for collection
persistence.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.orm.AppenderQuery.add"><span class="sig-name descname">add()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery.add_all"><span class="sig-name descname">add_all()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery.append"><span class="sig-name descname">append()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery.count"><span class="sig-name descname">count()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery.extend"><span class="sig-name descname">extend()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery.remove"><span class="sig-name descname">remove()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery" title="sqlalchemy.orm.AppenderQuery"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.AppenderQuery</span></code></a> (<code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.dynamic._AppenderMixin</span></code>, <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.Query</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.AppenderQuery.add">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.AppenderQuery"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.AppenderQuery.</span></code></a><span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">item</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_T</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.AppenderQuery.add" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.dynamic._AppenderMixin.add</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.dynamic._AppenderMixin</span></code></p>
</div>
<p>Add an item to this <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery" title="sqlalchemy.orm.AppenderQuery"><code class="xref py py-class docutils literal notranslate"><span class="pre">AppenderQuery</span></code></a>.</p>
<p>The given item will be persisted to the database in terms of
the parent instance’s collection on the next flush.</p>
<p>This method is provided to assist in delivering forwards-compatibility
with the <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a> collection class.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.AppenderQuery.add_all">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.AppenderQuery"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.AppenderQuery.</span></code></a><span class="sig-name descname"><span class="pre">add_all</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iterator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.AppenderQuery.add_all" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.dynamic._AppenderMixin.add_all</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.dynamic._AppenderMixin</span></code></p>
</div>
<p>Add an iterable of items to this <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery" title="sqlalchemy.orm.AppenderQuery"><code class="xref py py-class docutils literal notranslate"><span class="pre">AppenderQuery</span></code></a>.</p>
<p>The given items will be persisted to the database in terms of
the parent instance’s collection on the next flush.</p>
<p>This method is provided to assist in delivering forwards-compatibility
with the <a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection" title="sqlalchemy.orm.WriteOnlyCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a> collection class.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.AppenderQuery.append">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.AppenderQuery"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.AppenderQuery.</span></code></a><span class="sig-name descname"><span class="pre">append</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">item</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_T</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.AppenderQuery.append" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.dynamic._AppenderMixin.append</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.dynamic._AppenderMixin</span></code></p>
</div>
<p>Append an item to this <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery" title="sqlalchemy.orm.AppenderQuery"><code class="xref py py-class docutils literal notranslate"><span class="pre">AppenderQuery</span></code></a>.</p>
<p>The given item will be persisted to the database in terms of
the parent instance’s collection on the next flush.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.AppenderQuery.count">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.AppenderQuery"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.AppenderQuery.</span></code></a><span class="sig-name descname"><span class="pre">count</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">int</span></span></span><a class="headerlink" href="#sqlalchemy.orm.AppenderQuery.count" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.dynamic._AppenderMixin.count</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.dynamic._AppenderMixin</span></code></p>
</div>
<p>Return a count of rows this the SQL formed by this <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a>
would return.</p>
<p>This generates the SQL for this Query as follows:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">count_1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">rest</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">follows</span><span class="p">...</span><span class="o">&gt;</span>
<span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">anon_1</span></pre></div>
</div>
<p>The above SQL returns a single row, which is the aggregate value
of the count function; the <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query.count" title="sqlalchemy.orm.Query.count"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.count()</span></code></a>
method then returns
that single integer value.</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>It is important to note that the value returned by
count() is <strong>not the same as the number of ORM objects that this
Query would return from a method such as the .all() method</strong>.
The <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object,
when asked to return full entities,
will <strong>deduplicate entries based on primary key</strong>, meaning if the
same primary key value would appear in the results more than once,
only one object of that primary key would be present.  This does
not apply to a query that is against individual columns.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../faq/sessions.html#faq-query-deduplicating"><span class="std std-ref">我的查询没有返回与 query.count() 告诉我的相同数量的对象 - 为什么？</span></a></p>
</div>
</div>
<p>For fine grained control over specific columns to count, to skip the
usage of a subquery or otherwise control of the FROM clause, or to use
other aggregate functions, use <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.func" title="sqlalchemy.sql.expression.func"><code class="xref py py-attr docutils literal notranslate"><span class="pre">expression.func</span></code></a>
expressions in conjunction with <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.query" title="sqlalchemy.orm.Session.query"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.query()</span></code></a>, i.e.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">func</span>

<span class="c1"># count User records, without</span>
<span class="c1"># using a subquery.</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

<span class="c1"># return count of user &quot;id&quot; grouped</span>
<span class="c1"># by &quot;name&quot;</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">))</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">distinct</span>

<span class="c1"># count distinct &quot;name&quot; values</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">distinct</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../changelog/migration_20.html#migration-20-query-usage"><span class="std std-ref">2.0 Migration - ORM Usage</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.AppenderQuery.extend">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.AppenderQuery"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.AppenderQuery.</span></code></a><span class="sig-name descname"><span class="pre">extend</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iterator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.AppenderQuery.extend" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.dynamic._AppenderMixin.extend</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.dynamic._AppenderMixin</span></code></p>
</div>
<p>Add an iterable of items to this <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery" title="sqlalchemy.orm.AppenderQuery"><code class="xref py py-class docutils literal notranslate"><span class="pre">AppenderQuery</span></code></a>.</p>
<p>The given items will be persisted to the database in terms of
the parent instance’s collection on the next flush.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.AppenderQuery.remove">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.AppenderQuery"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.AppenderQuery.</span></code></a><span class="sig-name descname"><span class="pre">remove</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">item</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_T</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.AppenderQuery.remove" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.dynamic._AppenderMixin.remove</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.dynamic._AppenderMixin</span></code></p>
</div>
<p>Remove an item from this <a class="reference internal" href="#sqlalchemy.orm.AppenderQuery" title="sqlalchemy.orm.AppenderQuery"><code class="xref py py-class docutils literal notranslate"><span class="pre">AppenderQuery</span></code></a>.</p>
<p>The given item will be removed from the parent instance’s collection on
the next flush.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.orm.DynamicMapped">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">DynamicMapped</span></span><a class="headerlink" href="#sqlalchemy.orm.DynamicMapped" title="Link to this definition">¶</a></dt>
<dd><p>Represent the ORM mapped attribute type for a “dynamic” relationship.</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.DynamicMapped" title="sqlalchemy.orm.DynamicMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">DynamicMapped</span></code></a> type annotation may be used in an
<a class="reference internal" href="declarative_tables.html#orm-declarative-mapped-column"><span class="std std-ref">Annotated Declarative Table</span></a> mapping
to indicate that the <code class="docutils literal notranslate"><span class="pre">lazy=&quot;dynamic&quot;</span></code> loader strategy should be used
for a particular <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>.</p>
<div class="admonition legacy">
<p class="admonition-title">Legacy Feature</p>
<p>The “dynamic” lazy loader strategy is the legacy form of what
is now the “write_only” strategy described in the section
<a class="reference internal" href="#write-only-relationship"><span class="std std-ref">只写关系</span></a>.</p>
</div>
<p>E.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span>
    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">addresses</span><span class="p">:</span> <span class="n">DynamicMapped</span><span class="p">[</span><span class="n">Address</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span>
        <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all,delete-orphan&quot;</span>
    <span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>See the section <a class="reference internal" href="#dynamic-relationship"><span class="std std-ref">动态关系加载器</span></a> for background.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#dynamic-relationship"><span class="std std-ref">动态关系加载器</span></a> - complete background</p>
<p><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyMapped" title="sqlalchemy.orm.WriteOnlyMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyMapped</span></code></a> - fully 2.0 style version</p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.orm.DynamicMapped" title="sqlalchemy.orm.DynamicMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.DynamicMapped</span></code></a> (<code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.base._MappedAnnotationBase</span></code>)</p>
</div>
</dd></dl>

</section>
</section>
<section id="raiseload">
<span id="collections-raiseload"></span><h2>设置 RaiseLoad<a class="headerlink" href="#raiseload" title="Link to this heading">¶</a></h2>
<p>Setting RaiseLoad</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--13-input--1" name="tab-set--13" type="radio"><label class="tab-label" for="tab-set--13-input--1">中文</label><div class="tab-content docutils container">
<p>“raise”-加载关系将在属性通常会发出延迟加载的位置引发 <a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;some_table&quot;</span>

    <span class="c1"># ...</span>

    <span class="n">children</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">MyRelatedClass</span><span class="p">]]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">lazy</span><span class="o">=</span><span class="s2">&quot;raise&quot;</span><span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>如上所述，如果 <code class="docutils literal notranslate"><span class="pre">children</span></code> 集合尚未填充，访问该属性将引发异常。 这包括读取访问，但对于集合，也会影响写入访问，因为在加载集合之前无法对其进行修改。 其原理是确保应用程序在某个上下文中不会发出任何意外的延迟加载。 不必通过读取 SQL 日志来确定是否所有必要的属性都已急切加载，“raise”策略将导致未加载的属性在访问时立即引发异常。 该 raise 策略还可使用 <a class="reference internal" href="queryguide/relationships.html#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal notranslate"><span class="pre">raiseload()</span></code></a> 加载选项在查询选项基础上使用。</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="queryguide/relationships.html#prevent-lazy-with-raiseload"><span class="std std-ref">使用 raiseload 防止不必要的延迟加载</span></a></p>
</div>
</div>
<input class="tab-input" id="tab-set--13-input--2" name="tab-set--13" type="radio"><label class="tab-label" for="tab-set--13-input--2">英文</label><div class="tab-content docutils container">
<p>A “raise”-loaded relationship will raise an
<a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a> where the attribute would normally
emit a lazy load:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;some_table&quot;</span>

    <span class="c1"># ...</span>

    <span class="n">children</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">MyRelatedClass</span><span class="p">]]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">lazy</span><span class="o">=</span><span class="s2">&quot;raise&quot;</span><span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>Above, attribute access on the <code class="docutils literal notranslate"><span class="pre">children</span></code> collection will raise an exception
if it was not previously populated.  This includes read access but for
collections will also affect write access, as collections can’t be mutated
without first loading them.  The rationale for this is to ensure that an
application is not emitting any unexpected lazy loads within a certain context.
Rather than having to read through SQL logs to determine that all necessary
attributes were eager loaded, the “raise” strategy will cause unloaded
attributes to raise immediately if accessed.  The raise strategy is
also available on a query option basis using the <a class="reference internal" href="queryguide/relationships.html#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal notranslate"><span class="pre">raiseload()</span></code></a>
loader option.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="queryguide/relationships.html#prevent-lazy-with-raiseload"><span class="std std-ref">使用 raiseload 防止不必要的延迟加载</span></a></p>
</div>
</div>
</div>
</section>
<section id="id15">
<h2>使用被动删除<a class="headerlink" href="#id15" title="Link to this heading">¶</a></h2>
<p>Using Passive Deletes</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--14-input--1" name="tab-set--14" type="radio"><label class="tab-label" for="tab-set--14-input--1">中文</label><div class="tab-content docutils container">
<p>在 SQLAlchemy 中，集合管理的一个重要方面是，当引用集合的对象被删除时，SQLAlchemy 需要考虑在此集合中的对象。这些对象将需要与父对象取消关联，对于一对多集合，这意味着外键列将被设置为 NULL，或者根据 <a class="reference internal" href="cascades.html#unitofwork-cascades"><span class="std std-ref">cascade</span></a> 设置，可能会发出 DELETE 以删除这些行。</p>
<p><a class="reference internal" href="../glossary.html#term-unit-of-work"><span class="xref std std-term">unit of work</span></a> 进程仅逐行考虑对象，这意味着 DELETE 操作意味着集合中的所有行必须在刷新过程中完全加载到内存中。这对于大集合来说是不可行的，因此我们寻求依赖数据库自身的能力，使用外键 ON DELETE 规则自动更新或删除这些行，指示工作单元无需实际加载这些行即可处理它们。可以通过在 <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> 构造上配置 <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.passive_deletes" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.passive_deletes</span></code></a> 来指示工作单元以这种方式工作；使用的外键约束也必须正确配置。</p>
<p>有关完整“被动删除”配置的更多详细信息，请参见 <a class="reference internal" href="cascades.html#passive-deletes"><span class="std std-ref">使用具有 ORM 关系的外键 ON DELETE 级联</span></a> 部分。</p>
</div>
<input class="tab-input" id="tab-set--14-input--2" name="tab-set--14" type="radio"><label class="tab-label" for="tab-set--14-input--2">英文</label><div class="tab-content docutils container">
<p>An important aspect of collection management in SQLAlchemy is that when an
object that refers to a collection is deleted, SQLAlchemy needs to consider the
objects that are inside this collection. Those objects will need to be
de-associated from the parent, which for a one-to-many collection would mean
that foreign key columns are set to NULL, or based on
<a class="reference internal" href="cascades.html#unitofwork-cascades"><span class="std std-ref">cascade</span></a> settings, may instead want to emit a
DELETE for these rows.</p>
<p>The <a class="reference internal" href="../glossary.html#term-unit-of-work"><span class="xref std std-term">unit of work</span></a> process only considers objects on a row-by-row basis,
meaning a DELETE operation implies that all rows within a collection must be
fully loaded into memory inside the flush process. This is not feasible for
large collections, so we instead seek to rely upon the database’s own
capability to update or delete the rows automatically using foreign key ON
DELETE rules, instructing the unit of work to forego actually needing to load
these rows in order to handle them. The unit of work can be instructed to work
in this manner by configuring <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.passive_deletes" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.passive_deletes</span></code></a> on
the <a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> construct; the foreign key constraints in use
must also be correctly configured.</p>
<p>For further detail on a complete “passive delete” configuration, see the
section <a class="reference internal" href="cascades.html#passive-deletes"><span class="std std-ref">使用具有 ORM 关系的外键 ON DELETE 级联</span></a>.</p>
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="collection_api.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">集合自定义和 API 详细信息</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="join_conditions.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">配置关系连接方式</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                <a href="../copyright.html">Copyright</a> &#169; 2007-2025, the SQLAlchemy authors and contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on 04/05/2025 04:00:26</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">使用大型集合</a><ul>
<li><a class="reference internal" href="#write-only-relationship">只写关系</a><ul>
<li><a class="reference internal" href="#id3">创建和保存新的只写集合</a></li>
<li><a class="reference internal" href="#id4">向现有集合添加新项目</a></li>
<li><a class="reference internal" href="#id5">查询项目</a></li>
<li><a class="reference internal" href="#id6">删除项目</a></li>
<li><a class="reference internal" href="#id7">批量插入新项目</a><ul>
<li><a class="reference internal" href="#id8">一对多集合</a></li>
<li><a class="reference internal" href="#id9">多对多集合</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id10">批量更新和删除项目</a><ul>
<li><a class="reference internal" href="#id11">一对多集合</a></li>
<li><a class="reference internal" href="#id12">多对多集合</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api">只写集合 - API 文档</a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection"><code class="docutils literal notranslate"><span class="pre">WriteOnlyCollection</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.add"><code class="docutils literal notranslate"><span class="pre">WriteOnlyCollection.add()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.add_all"><code class="docutils literal notranslate"><span class="pre">WriteOnlyCollection.add_all()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.delete"><code class="docutils literal notranslate"><span class="pre">WriteOnlyCollection.delete()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.insert"><code class="docutils literal notranslate"><span class="pre">WriteOnlyCollection.insert()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.remove"><code class="docutils literal notranslate"><span class="pre">WriteOnlyCollection.remove()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.select"><code class="docutils literal notranslate"><span class="pre">WriteOnlyCollection.select()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyCollection.update"><code class="docutils literal notranslate"><span class="pre">WriteOnlyCollection.update()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.orm.WriteOnlyMapped"><code class="docutils literal notranslate"><span class="pre">WriteOnlyMapped</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#dynamic-relationship">动态关系加载器</a><ul>
<li><a class="reference internal" href="#id14">动态关系加载器 - API</a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.AppenderQuery"><code class="docutils literal notranslate"><span class="pre">AppenderQuery</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.AppenderQuery.add"><code class="docutils literal notranslate"><span class="pre">AppenderQuery.add()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.AppenderQuery.add_all"><code class="docutils literal notranslate"><span class="pre">AppenderQuery.add_all()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.AppenderQuery.append"><code class="docutils literal notranslate"><span class="pre">AppenderQuery.append()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.AppenderQuery.count"><code class="docutils literal notranslate"><span class="pre">AppenderQuery.count()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.AppenderQuery.extend"><code class="docutils literal notranslate"><span class="pre">AppenderQuery.extend()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.AppenderQuery.remove"><code class="docutils literal notranslate"><span class="pre">AppenderQuery.remove()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.orm.DynamicMapped"><code class="docutils literal notranslate"><span class="pre">DynamicMapped</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#raiseload">设置 RaiseLoad</a></li>
<li><a class="reference internal" href="#id15">使用被动删除</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=2d0eb83f"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=2f3e6152"></script>
    <script src="../_static/translations.js?v=beaddf03"></script>
    </body>
</html>