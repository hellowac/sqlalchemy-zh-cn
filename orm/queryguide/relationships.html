<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="索引" href="../../genindex.html" /><link rel="search" title="搜索" href="../../search.html" /><link rel="copyright" title="版权所有" href="../../copyright.html" /><link rel="next" title="用于查询的 ORM API 功能" href="api.html" /><link rel="prev" title="列加载选项" href="columns.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.08.06 -->
        <title>关系加载技术 - SQLAlchemy 2.1 Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/changelog.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_paramlinks.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/docs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">SQLAlchemy 2.1 Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">SQLAlchemy 2.1 Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">概述</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorial/index.html">SQLAlchemy 统一教程</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of SQLAlchemy 统一教程</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/engine.html">建立连接 - Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/dbapi_transactions.html">使用事务和DBAPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/metadata.html">使用数据库元数据</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../tutorial/data.html">处理数据</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of 处理数据</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorial/data_insert.html">使用 INSERT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorial/data_select.html">使用 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorial/data_update.html">使用 UPDATE 和 DELETE 语句</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/orm_data_manipulation.html">使用 ORM 进行数据操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/orm_related_objects.html">使用 ORM 相关对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/further_reading.html">进一步阅读</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">SQLAlchemy ORM</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of SQLAlchemy ORM</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html">ORM 快速入门</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../mapper_config.html">ORM 映射类配置</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of ORM 映射类配置</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../mapping_styles.html">ORM 映射类概述</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../declarative_mapping.html">使用声明式映射类</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of 使用声明式映射类</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../declarative_styles.html">声明式映射风格</a></li>
<li class="toctree-l4"><a class="reference internal" href="../declarative_tables.html">声明式的表配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="../declarative_config.html">使用声明式映射器配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="../declarative_mixins.html">使用 Mixins 组合映射层次结构</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../dataclasses.html">与dataclass和attrs的集成</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mapped_sql_expr.html">SQL 表达式作为映射属性</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mapped_attributes.html">更改Attribute的行为</a></li>
<li class="toctree-l3"><a class="reference internal" href="../composites.html">复合列类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="../inheritance.html">映射类继承层次结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nonstandard_mappings.html">非传统映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="../versioning.html">配置版本计数器</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mapping_api.html">类映射 API</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../scalar_mapping.html">映射 SQL 表达式</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of 映射 SQL 表达式</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../mapping_columns.html">映射表格列</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../relationships.html">关系配置</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of 关系配置</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic_relationships.html">基本关系模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../self_referential.html">邻接表关系</a></li>
<li class="toctree-l3"><a class="reference internal" href="../join_conditions.html">配置关系连接方式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../large_collections.html">使用大型集合</a></li>
<li class="toctree-l3"><a class="reference internal" href="../collection_api.html">集合自定义和 API 详细信息</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relationship_persistence.html">特殊关系的持久化模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../backref.html">使用旧版“backref”关系参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relationship_api.html">关系 API</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="index.html">ORM 查询指南</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of ORM 查询指南</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="select.html">为 ORM 映射类编写 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="inheritance.html">为继承映射编写 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="dml.html">启用 ORM 的 INSERT、UPDATE 和 DELETE 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="columns.html">列加载选项</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">关系加载技术</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.html">用于查询的 ORM API 功能</a></li>
<li class="toctree-l3"><a class="reference internal" href="query.html">旧式查询 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../session.html">使用会话</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of 使用会话</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../session_basics.html">会话基础知识</a></li>
<li class="toctree-l3"><a class="reference internal" href="../session_state_management.html">状态管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cascades.html">级联</a></li>
<li class="toctree-l3"><a class="reference internal" href="../session_transaction.html">事务和连接管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../persistence_techniques.html">附加持久性技术</a></li>
<li class="toctree-l3"><a class="reference internal" href="../contextual.html">上下文/线程本地会话</a></li>
<li class="toctree-l3"><a class="reference internal" href="../session_events.html">使用事件跟踪查询、对象和会话更改</a></li>
<li class="toctree-l3"><a class="reference internal" href="../session_api.html">会话 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../extending.html">事件和内部</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of 事件和内部</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../events.html">ORM 事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals.html">ORM 内部</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exceptions.html">ORM 异常</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../extensions/index.html">ORM 扩展</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of ORM 扩展</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../extensions/asyncio.html">异步 I/O (asyncio)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/associationproxy.html">关联代理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/automap.html">自动映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/baked.html">烘焙查询</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/declarative/index.html">声明式扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/mutable.html">突变追踪</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/orderinglist.html">排序列表</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/horizontal_shard.html">水平分片</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/hybrid.html">混合属性</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/indexable.html">Indexable</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/instrumentation.html">替代类检测</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html">核心和 ORM 示例</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../core/index.html">SQLAlchemy Core</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of SQLAlchemy Core</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../core/expression_api.html">SQL 语句和表达式 API</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of SQL 语句和表达式 API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../core/sqlelement.html">列元素和表达式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/operators.html">操作符参考</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/selectable.html">SELECT 和相关构造</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/dml.html">插入,更新,删除</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/functions.html">SQL 和 范型函数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/compiler.html">自定义 SQL 构造和编译扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/serializer.html">表达式序列化器扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/foundation.html">SQL 表达式语言基础构造</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/visitors.html">访问者和遍历实用程序</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../core/schema.html">Schema 定义语言</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of Schema 定义语言</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../core/metadata.html">使用元数据描述数据库</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/reflection.html">反映数据库对象</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/defaults.html">列 INSERT/UPDATE 默认值</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/constraints.html">定义约束和索引</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/ddl.html">自定义 DDL</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../core/types.html">SQL 数据类型对象</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of SQL 数据类型对象</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../core/type_basics.html">类型层次结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/custom_types.html">自定义类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/type_api.html">基本类型 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../core/engines_connections.html">Engine和Connection的使用</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of Engine和Connection的使用</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../core/engines.html">Engine 配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/connections.html">使用Engines和Connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/pooling.html">连接池</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/events.html">核心事件</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../core/api_basics.html">Core API 基础</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of Core API 基础</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../core/event.html">事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/inspection.html">运行时审查 API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/exceptions.html">Core 异常</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/internals.html">Core 内部</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dialects/index.html">Dialects</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of Dialects</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dialects/postgresql.html">PostgreSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dialects/mysql.html">MySQL 和 MariaDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dialects/sqlite.html">SQLite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dialects/oracle.html">Oracle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dialects/mssql.html">Microsoft SQL Server</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../faq/index.html">常见问题</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of 常见问题</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../faq/installation.html">安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/connections.html">连接 / 引擎</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/metadata_schema.html">元数据 / Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/sqlexpressions.html">SQL 表达式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/ormconfiguration.html">ORM 配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/performance.html">性能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/sessions.html">会话 / 查询</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/thirdparty.html">第三方包集成问题</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../errors.html">错误消息</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../changelog/index.html">变更和迁移</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of 变更和迁移</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_21.html">SQLAlchemy 2.1 有什么新功能？</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_21.html">2.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_20.html">2.0 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_14.html">1.4 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_13.html">1.3 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_12.html">1.2 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_11.html">1.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_10.html">1.0 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_09.html">0.9 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_08.html">0.8 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_07.html">0.7 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_06.html">0.6 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_05.html">0.5 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_04.html">0.4 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_03.html">0.3 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_02.html">0.2 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_01.html">0.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_20.html">SQLAlchemy 2.0 - Major Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/whatsnew_20.html">What’s New in SQLAlchemy 2.0?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_14.html">What’s New in SQLAlchemy 1.4?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_13.html">What’s New in SQLAlchemy 1.3?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_12.html">What’s New in SQLAlchemy 1.2?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_11.html">What’s New in SQLAlchemy 1.1?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_10.html">What’s New in SQLAlchemy 1.0?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_09.html">What’s New in SQLAlchemy 0.9?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_08.html">What’s New in SQLAlchemy 0.8?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_07.html">What’s New in SQLAlchemy 0.7?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_06.html">What’s New in SQLAlchemy 0.6?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_05.html">What’s new in SQLAlchemy 0.5?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_04.html">What’s new in SQLAlchemy 0.4?</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <aside class="topic">
<p class="topic-title">ORM Querying Guide</p>
<p>This page is part of the <a class="reference internal" href="index.html"><span class="doc">ORM 查询指南</span></a>.</p>
<p>Previous: <a class="reference internal" href="columns.html"><span class="doc">列加载选项</span></a>   |   Next: <a class="reference internal" href="api.html"><span class="doc">用于查询的 ORM API 功能</span></a></p>
</aside>
<section id="loading-toplevel">
<span id="orm-queryguide-relationship-loaders"></span><span id="id1"></span><h1>关系加载技术<a class="headerlink" href="#loading-toplevel" title="Link to this heading">¶</a></h1>
<p>Relationship Loading Techniques</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">中文</label><div class="tab-content docutils container">
<div class="admonition- admonition">
<p class="admonition-title">关于本文档</p>
<p>本节深入介绍了如何加载相关对象。读者应熟悉 <a class="reference internal" href="../relationships.html#relationship-config-toplevel"><span class="std std-ref">关系配置</span></a> 和基本用法。</p>
<p>大多数示例假定类似于 <a class="reference internal" href="_plain_setup.html"><span class="doc">选择的设置</span></a> 中说明的 “用户/地址” 映射设置。</p>
</div>
<p>SQLAlchemy 的一个重要部分是提供广泛的控制，以在查询时加载相关对象。所谓“相关对象”是指使用 <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> 在映射器上配置的集合或标量关联。这种行为可以在映射器构造时使用 <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> 函数的 <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship.params.lazy" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.lazy</span></code></a> 参数进行配置，也可以通过使用 <strong>ORM 加载选项</strong> 与 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> 构造一起配置。</p>
<p>关系的加载分为三类： <strong>延迟(lazy)</strong> 加载、 <strong>急切(eager)</strong> 加载和 <strong>不(no)</strong> 加载。延迟加载是指从查询返回的对象最初没有加载相关对象。当在特定对象上首次访问给定集合或引用时，将发出一个额外的 SELECT 语句，以便加载请求的集合。</p>
<p>急切加载是指从查询返回的对象已经预先加载了相关的集合或标量引用。ORM 要么通过增强通常会发出的 SELECT 语句与 JOIN 一起加载相关行，要么通过在主语句之后发出额外的 SELECT 语句一次性加载集合或标量引用来实现这一点。</p>
<p>“不”加载是指禁用给定关系的加载，即属性为空并且从不加载，或者在访问时引发错误，以防止不必要的延迟加载。</p>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">英文</label><div class="tab-content docutils container">
<div class="admonition-about-this-document admonition">
<p class="admonition-title">About this Document</p>
<p>This section presents an in-depth view of how to load related
objects.   Readers should be familiar with
<a class="reference internal" href="../relationships.html#relationship-config-toplevel"><span class="std std-ref">关系配置</span></a> and basic use.</p>
<p>Most examples here assume the “User/Address” mapping setup similar
to the one illustrated at <a class="reference internal" href="_plain_setup.html"><span class="doc">setup for selects</span></a>.</p>
</div>
<p>A big part of SQLAlchemy is providing a wide range of control over how related
objects get loaded when querying.   By “related objects” we refer to collections
or scalar associations configured on a mapper using <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>.
This behavior can be configured at mapper construction time using the
<a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship.params.lazy" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.lazy</span></code></a> parameter to the <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>
function, as well as by using <strong>ORM loader options</strong> with
the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> construct.</p>
<p>The loading of relationships falls into three categories; <strong>lazy</strong> loading,
<strong>eager</strong> loading, and <strong>no</strong> loading. Lazy loading refers to objects that are returned
from a query without the related
objects loaded at first.  When the given collection or reference is
first accessed on a particular object, an additional SELECT statement
is emitted such that the requested collection is loaded.</p>
<p>Eager loading refers to objects returned from a query with the related
collection or scalar reference already loaded up front.  The ORM
achieves this either by augmenting the SELECT statement it would normally
emit with a JOIN to load in related rows simultaneously, or by emitting
additional SELECT statements after the primary one to load collections
or scalar references at once.</p>
<p>“No” loading refers to the disabling of loading on a given relationship, either
that the attribute is empty and is just never loaded, or that it raises
an error when it is accessed, in order to guard against unwanted lazy loads.</p>
</div>
</div>
<section id="id2">
<h2>关系加载样式摘要<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p>Summary of Relationship Loading Styles</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--1-input--1" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--1">中文</label><div class="tab-content docutils container">
<p>主要的关系加载方式有：</p>
<ul class="simple">
<li><p><strong>懒加载 (lazy loading)</strong> - 可通过 <code class="docutils literal notranslate"><span class="pre">lazy='select'</span></code> 或 <a class="reference internal" href="#sqlalchemy.orm.lazyload" title="sqlalchemy.orm.lazyload"><code class="xref py py-func docutils literal notranslate"><span class="pre">lazyload()</span></code></a> 选项实现，这种加载方式会在访问属性时发出一个 SELECT 语句，懒加载每次仅加载一个对象的关联引用。懒加载是所有没有特别指示 <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship.params.lazy" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.lazy</span></code></a> 选项的 <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> 构造的 <strong>默认加载方式</strong>。懒加载的详细信息参见 <a class="reference internal" href="#lazy-loading"><span class="std std-ref">延迟加载</span></a>。</p></li>
<li><p><strong>select IN 加载 (select IN loading)</strong> - 可通过 <code class="docutils literal notranslate"><span class="pre">lazy='selectin'</span></code> 或 <a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> 选项实现，这种加载方式会发出第二个（或更多）SELECT 语句，将父对象的主键标识符组装到 IN 子句中，从而一次性加载所有相关集合或标量引用。select IN 加载的详细信息参见 <a class="reference internal" href="#selectin-eager-loading"><span class="std std-ref">选择 IN 加载</span></a>。</p></li>
<li><p><strong>连接加载 (joined loading)</strong> - 可通过 <code class="docutils literal notranslate"><span class="pre">lazy='joined'</span></code> 或 <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> 选项实现，这种加载方式会对给定的 SELECT 语句应用 JOIN，以便将相关行加载到同一结果集中。连接急加载的详细信息参见 <a class="reference internal" href="#joined-eager-loading"><span class="std std-ref">连接预/急加载</span></a>。</p></li>
<li><p><strong>异常加载 (raise loading)</strong> - 可通过 <code class="docutils literal notranslate"><span class="pre">lazy='raise'</span></code>、<code class="docutils literal notranslate"><span class="pre">lazy='raise_on_sql'</span></code> 或 <a class="reference internal" href="#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal notranslate"><span class="pre">raiseload()</span></code></a> 选项实现，这种加载方式会在通常进行懒加载时触发，但会抛出 ORM 异常，以防止应用程序进行不希望的懒加载。异常加载的介绍参见 <a class="reference internal" href="#prevent-lazy-with-raiseload"><span class="std std-ref">使用 raiseload 防止不必要的延迟加载</span></a>。</p></li>
<li><p><strong>子查询加载 (subquery loading)</strong> - 可通过 <code class="docutils literal notranslate"><span class="pre">lazy='subquery'</span></code> 或 <a class="reference internal" href="#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a> 选项实现，这种加载方式会发出第二个 SELECT 语句，该语句在子查询中重新声明原始查询，然后将该子查询与相关表连接，以便一次性加载所有相关集合或标量引用。子查询急加载的详细信息参见 <a class="reference internal" href="#subquery-eager-loading"><span class="std std-ref">子查询预/急加载</span></a>。</p></li>
<li><p><strong>仅写加载 (write only loading)</strong> - 可通过 <code class="docutils literal notranslate"><span class="pre">lazy='write_only'</span></code> 或使用 <a class="reference internal" href="../large_collections.html#sqlalchemy.orm.WriteOnlyMapped" title="sqlalchemy.orm.WriteOnlyMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyMapped</span></code></a> 注解来标注 <a class="reference internal" href="../internals.html#sqlalchemy.orm.Relationship" title="sqlalchemy.orm.Relationship"><code class="xref py py-class docutils literal notranslate"><span class="pre">Relationship</span></code></a> 对象的左侧。这种仅集合的加载方式生成一种替代的属性仪器，它永远不会隐式地从数据库加载记录，而是仅允许使用 <a class="reference internal" href="../large_collections.html#sqlalchemy.orm.WriteOnlyCollection.add" title="sqlalchemy.orm.WriteOnlyCollection.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.add()</span></code></a>、<a class="reference internal" href="../large_collections.html#sqlalchemy.orm.WriteOnlyCollection.add_all" title="sqlalchemy.orm.WriteOnlyCollection.add_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.add_all()</span></code></a> 和 <a class="reference internal" href="../large_collections.html#sqlalchemy.orm.WriteOnlyCollection.remove" title="sqlalchemy.orm.WriteOnlyCollection.remove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.remove()</span></code></a> 方法。查询集合是通过调用 <a class="reference internal" href="../large_collections.html#sqlalchemy.orm.WriteOnlyCollection.select" title="sqlalchemy.orm.WriteOnlyCollection.select"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.select()</span></code></a> 方法来执行构建的 SELECT 语句。仅写加载的详细信息参见 <a class="reference internal" href="../large_collections.html#write-only-relationship"><span class="std std-ref">只写关系</span></a>。</p></li>
<li><p><strong>动态加载 (dynamic loading)</strong> - 可通过 <code class="docutils literal notranslate"><span class="pre">lazy='dynamic'</span></code> 或使用 <a class="reference internal" href="../large_collections.html#sqlalchemy.orm.DynamicMapped" title="sqlalchemy.orm.DynamicMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">DynamicMapped</span></code></a> 注解来标注 <a class="reference internal" href="../internals.html#sqlalchemy.orm.Relationship" title="sqlalchemy.orm.Relationship"><code class="xref py py-class docutils literal notranslate"><span class="pre">Relationship</span></code></a> 对象的左侧。这是一个旧版的仅集合加载方式，它在访问集合时生成 <a class="reference internal" href="query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> 对象，从而允许对集合内容发出自定义 SQL。然而，动态加载器在某些情况下会隐式地迭代底层集合，这使得它们在管理真正的大集合时不太有用。动态加载器被 <a class="reference internal" href="../large_collections.html#write-only-relationship"><span class="std std-ref">“write only”</span></a> 集合所取代，这将防止在任何情况下隐式加载底层集合。动态加载器的详细信息参见 <a class="reference internal" href="../large_collections.html#dynamic-relationship"><span class="std std-ref">动态关系加载器</span></a>。</p></li>
</ul>
</div>
<input class="tab-input" id="tab-set--1-input--2" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--2">英文</label><div class="tab-content docutils container">
<p>The primary forms of relationship loading are:</p>
<ul class="simple">
<li><p><strong>lazy loading</strong> - available via <code class="docutils literal notranslate"><span class="pre">lazy='select'</span></code> or the <a class="reference internal" href="#sqlalchemy.orm.lazyload" title="sqlalchemy.orm.lazyload"><code class="xref py py-func docutils literal notranslate"><span class="pre">lazyload()</span></code></a> option, this is the form of loading that emits a SELECT statement at attribute access time to lazily load a related reference on a single object at a time.  Lazy loading is the <strong>default loading style</strong> for all <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> constructs that don’t otherwise indicate the <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship.params.lazy" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.lazy</span></code></a> option.  Lazy loading is detailed at <a class="reference internal" href="#lazy-loading"><span class="std std-ref">延迟加载</span></a>.</p></li>
<li><p><strong>select IN loading</strong> - available via <code class="docutils literal notranslate"><span class="pre">lazy='selectin'</span></code> or the <a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> option, this form of loading emits a second (or more) SELECT statement which assembles the primary key identifiers of the parent objects into an IN clause, so that all members of related collections / scalar references are loaded at once by primary key.  Select IN loading is detailed at <a class="reference internal" href="#selectin-eager-loading"><span class="std std-ref">选择 IN 加载</span></a>.</p></li>
<li><p><strong>joined loading</strong> - available via <code class="docutils literal notranslate"><span class="pre">lazy='joined'</span></code> or the <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> option, this form of loading applies a JOIN to the given SELECT statement so that related rows are loaded in the same result set.   Joined eager loading is detailed at <a class="reference internal" href="#joined-eager-loading"><span class="std std-ref">连接预/急加载</span></a>.</p></li>
<li><p><strong>raise loading</strong> - available via <code class="docutils literal notranslate"><span class="pre">lazy='raise'</span></code>, <code class="docutils literal notranslate"><span class="pre">lazy='raise_on_sql'</span></code>, or the <a class="reference internal" href="#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal notranslate"><span class="pre">raiseload()</span></code></a> option, this form of loading is triggered at the same time a lazy load would normally occur, except it raises an ORM exception in order to guard against the application making unwanted lazy loads. An introduction to raise loading is at <a class="reference internal" href="#prevent-lazy-with-raiseload"><span class="std std-ref">使用 raiseload 防止不必要的延迟加载</span></a>.</p></li>
<li><p><strong>subquery loading</strong> - available via <code class="docutils literal notranslate"><span class="pre">lazy='subquery'</span></code> or the <a class="reference internal" href="#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a> option, this form of loading emits a second SELECT statement which re-states the original query embedded inside of a subquery, then JOINs that subquery to the related table to be loaded to load all members of related collections / scalar references at once.  Subquery eager loading is detailed at <a class="reference internal" href="#subquery-eager-loading"><span class="std std-ref">子查询预/急加载</span></a>.</p></li>
<li><p><strong>write only loading</strong> - available via <code class="docutils literal notranslate"><span class="pre">lazy='write_only'</span></code>, or by annotating the left side of the <a class="reference internal" href="../internals.html#sqlalchemy.orm.Relationship" title="sqlalchemy.orm.Relationship"><code class="xref py py-class docutils literal notranslate"><span class="pre">Relationship</span></code></a> object using the <a class="reference internal" href="../large_collections.html#sqlalchemy.orm.WriteOnlyMapped" title="sqlalchemy.orm.WriteOnlyMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteOnlyMapped</span></code></a> annotation.   This collection-only loader style produces an alternative attribute instrumentation that never implicitly loads records from the database, instead only allowing <a class="reference internal" href="../large_collections.html#sqlalchemy.orm.WriteOnlyCollection.add" title="sqlalchemy.orm.WriteOnlyCollection.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.add()</span></code></a>, <a class="reference internal" href="../large_collections.html#sqlalchemy.orm.WriteOnlyCollection.add_all" title="sqlalchemy.orm.WriteOnlyCollection.add_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.add_all()</span></code></a> and <a class="reference internal" href="../large_collections.html#sqlalchemy.orm.WriteOnlyCollection.remove" title="sqlalchemy.orm.WriteOnlyCollection.remove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.remove()</span></code></a> methods.  Querying the collection is performed by invoking a SELECT statement which is constructed using the <a class="reference internal" href="../large_collections.html#sqlalchemy.orm.WriteOnlyCollection.select" title="sqlalchemy.orm.WriteOnlyCollection.select"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WriteOnlyCollection.select()</span></code></a> method.    Write only loading is discussed at <a class="reference internal" href="../large_collections.html#write-only-relationship"><span class="std std-ref">只写关系</span></a>.</p></li>
<li><p><strong>dynamic loading</strong> - available via <code class="docutils literal notranslate"><span class="pre">lazy='dynamic'</span></code>, or by annotating the left side of the <a class="reference internal" href="../internals.html#sqlalchemy.orm.Relationship" title="sqlalchemy.orm.Relationship"><code class="xref py py-class docutils literal notranslate"><span class="pre">Relationship</span></code></a> object using the <a class="reference internal" href="../large_collections.html#sqlalchemy.orm.DynamicMapped" title="sqlalchemy.orm.DynamicMapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">DynamicMapped</span></code></a> annotation. This is a legacy collection-only loader style which produces a <a class="reference internal" href="query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object when the collection is accessed, allowing custom SQL to be emitted against the collection’s contents. However, dynamic loaders will implicitly iterate the underlying collection in various circumstances which makes them less useful for managing truly large collections. Dynamic loaders are superseded by <a class="reference internal" href="../large_collections.html#write-only-relationship"><span class="std std-ref">“write only”</span></a> collections, which will prevent the underlying collection from being implicitly loaded under any circumstances. Dynamic loaders are discussed at <a class="reference internal" href="../large_collections.html#dynamic-relationship"><span class="std std-ref">动态关系加载器</span></a>.</p></li>
</ul>
</div>
</div>
</section>
<section id="relationship-lazy-option">
<span id="id3"></span><h2>在映射时配置加载器策略<a class="headerlink" href="#relationship-lazy-option" title="Link to this heading">¶</a></h2>
<p>Configuring Loader Strategies at Mapping Time</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--2-input--1" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--1">中文</label><div class="tab-content docutils container">
<p>可以在映射时配置某个关系的加载策略，使其在加载映射类型的对象时始终生效，前提是查询级别没有修改它的选项。这可以通过 <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship.params.lazy" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.lazy</span></code></a> 参数配置到 <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> 中；该参数的常见值包括 <code class="docutils literal notranslate"><span class="pre">select</span></code>、<code class="docutils literal notranslate"><span class="pre">selectin</span></code> 和 <code class="docutils literal notranslate"><span class="pre">joined</span></code>。</p>
<p>下面的示例说明了 <a class="reference internal" href="../basic_relationships.html#relationship-patterns-o2m"><span class="std std-ref">一对多</span></a> 中的关系示例，将 <code class="docutils literal notranslate"><span class="pre">Parent.children</span></code> 关系配置为在发出 <code class="docutils literal notranslate"><span class="pre">Parent</span></code> 对象的 SELECT 语句时使用 <a class="reference internal" href="#selectin-eager-loading"><span class="std std-ref">选择 IN 加载</span></a>：</p>
<blockquote>
<div><p>from typing import List</p>
<p>from sqlalchemy import ForeignKey
from sqlalchemy.orm import DeclarativeBase
from sqlalchemy.orm import Mapped
from sqlalchemy.orm import mapped_column
from sqlalchemy.orm import relationship</p>
<dl>
<dt>class Base(DeclarativeBase):</dt><dd><p>pass</p>
</dd>
<dt>class Parent(Base):</dt><dd><p>__tablename__ = “parent”</p>
<p>id: Mapped[int] = mapped_column(primary_key=True)
children: Mapped[List[“Child”]] = relationship(lazy=”selectin”)</p>
</dd>
<dt>class Child(Base):</dt><dd><p>__tablename__ = “child”</p>
<p>id: Mapped[int] = mapped_column(primary_key=True)
parent_id: Mapped[int] = mapped_column(ForeignKey(“parent.id”))</p>
</dd>
</dl>
</div></blockquote>
<p>在上述示例中，每当加载 <code class="docutils literal notranslate"><span class="pre">Parent</span></code> 对象的集合时，每个 <code class="docutils literal notranslate"><span class="pre">Parent</span></code> 对象的 <code class="docutils literal notranslate"><span class="pre">children</span></code> 集合也将被填充，并使用 <code class="docutils literal notranslate"><span class="pre">&quot;selectin&quot;</span></code> 加载策略发出第二个查询。</p>
<p><a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship.params.lazy" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.lazy</span></code></a> 参数的默认值是 <code class="docutils literal notranslate"><span class="pre">&quot;select&quot;</span></code> ，这表示使用 <a class="reference internal" href="#lazy-loading"><span class="std std-ref">延迟加载</span></a>。</p>
</div>
<input class="tab-input" id="tab-set--2-input--2" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--2">英文</label><div class="tab-content docutils container">
<p>The loader strategy for a particular relationship can be configured at mapping time to take place in all cases where an object of the mapped type is loaded, in the absence of any query-level options that modify it. This is configured using the <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship.params.lazy" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.lazy</span></code></a> parameter to <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>; common values for this parameter include <code class="docutils literal notranslate"><span class="pre">select</span></code>, <code class="docutils literal notranslate"><span class="pre">selectin</span></code> and <code class="docutils literal notranslate"><span class="pre">joined</span></code>.</p>
<p>The example below illustrates the relationship example at <a class="reference internal" href="../basic_relationships.html#relationship-patterns-o2m"><span class="std std-ref">一对多</span></a>, configuring the <code class="docutils literal notranslate"><span class="pre">Parent.children</span></code> relationship to use <a class="reference internal" href="#selectin-eager-loading"><span class="std std-ref">选择 IN 加载</span></a> when a SELECT statement for <code class="docutils literal notranslate"><span class="pre">Parent</span></code> objects is emitted:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForeignKey</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeclarativeBase</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">mapped_column</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">relationship</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="p">(</span><span class="n">DeclarativeBase</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Parent</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;parent&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">children</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Child&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">lazy</span><span class="o">=</span><span class="s2">&quot;selectin&quot;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Child</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;child&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">parent_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;parent.id&quot;</span><span class="p">))</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>Above, whenever a collection of <code class="docutils literal notranslate"><span class="pre">Parent</span></code> objects are loaded, each <code class="docutils literal notranslate"><span class="pre">Parent</span></code> will also have its <code class="docutils literal notranslate"><span class="pre">children</span></code> collection populated, using the <code class="docutils literal notranslate"><span class="pre">&quot;selectin&quot;</span></code> loader strategy that emits a second query.</p>
<p>The default value of the <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship.params.lazy" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.lazy</span></code></a> argument is <code class="docutils literal notranslate"><span class="pre">&quot;select&quot;</span></code>, which indicates <a class="reference internal" href="#lazy-loading"><span class="std std-ref">延迟加载</span></a>.</p>
</div>
</div>
</section>
<section id="relationship-loader-options">
<span id="id4"></span><h2>使用加载器选项进行关系加载<a class="headerlink" href="#relationship-loader-options" title="Link to this heading">¶</a></h2>
<p>Relationship Loading with Loader Options</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--3-input--1" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--1">中文</label><div class="tab-content docutils container">
<p>另一种可能更常见的配置加载策略的方式是，通过 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.options" title="sqlalchemy.sql.expression.Select.options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.options()</span></code></a> 方法在每个查询基础上为特定属性设置加载策略。使用加载器选项可以对关系加载进行非常详细的控制；最常用的加载器选项有 <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> 、<a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> 和 <a class="reference internal" href="#sqlalchemy.orm.lazyload" title="sqlalchemy.orm.lazyload"><code class="xref py py-func docutils literal notranslate"><span class="pre">lazyload()</span></code></a>。该选项接受一个类绑定的属性，指向应该被加载的特定类/属性：</p>
<blockquote>
<div><p>from sqlalchemy import select
from sqlalchemy.orm import lazyload</p>
<p># 将 children 设置为懒加载
stmt = select(Parent).options(lazyload(Parent.children))</p>
<p>from sqlalchemy.orm import joinedload</p>
<p># 将 children 设置为通过 JOIN 来急加载
stmt = select(Parent).options(joinedload(Parent.children))</p>
</div></blockquote>
<p>加载器选项还可以通过 <strong>方法链式调用</strong> 来进一步指定加载应如何发生在更深层级的属性上：</p>
<blockquote>
<div><p>from sqlalchemy import select
from sqlalchemy.orm import joinedload</p>
<dl class="simple">
<dt>stmt = select(Parent).options(</dt><dd><p>joinedload(Parent.children).subqueryload(Child.subelements)</p>
</dd>
</dl>
<p>)</p>
</div></blockquote>
<p>可以对 “懒加载” 集合应用链式加载器选项。这意味着当某个集合或关联在访问时被懒加载时，指定的选项会生效：</p>
<blockquote>
<div><p>from sqlalchemy import select
from sqlalchemy.orm import lazyload</p>
<p>stmt = select(Parent).options(lazyload(Parent.children).subqueryload(Child.subelements))</p>
</div></blockquote>
<p>如上所示，该查询将返回不包含 <code class="docutils literal notranslate"><span class="pre">children</span></code> 集合的 <code class="docutils literal notranslate"><span class="pre">Parent</span></code> 对象。当特定 <code class="docutils literal notranslate"><span class="pre">Parent</span></code> 对象的 <code class="docutils literal notranslate"><span class="pre">children</span></code> 集合首次被访问时，它将懒加载相关对象，但还会对每个 <code class="docutils literal notranslate"><span class="pre">children</span></code> 成员的 <code class="docutils literal notranslate"><span class="pre">subelements</span></code> 集合应用急加载。</p>
</div>
<input class="tab-input" id="tab-set--3-input--2" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--2">英文</label><div class="tab-content docutils container">
<p>The other, and possibly more common way to configure loading strategies is to set them up on a per-query basis against specific attributes using the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.options" title="sqlalchemy.sql.expression.Select.options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.options()</span></code></a> method.  Very detailed control over relationship loading is available using loader options; the most common are <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a>, <a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> and <a class="reference internal" href="#sqlalchemy.orm.lazyload" title="sqlalchemy.orm.lazyload"><code class="xref py py-func docutils literal notranslate"><span class="pre">lazyload()</span></code></a>.   The option accepts a class-bound attribute referring to the specific class/attribute that should be targeted:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">lazyload</span>

<span class="c1"># set children to load lazily</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Parent</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">lazyload</span><span class="p">(</span><span class="n">Parent</span><span class="o">.</span><span class="n">children</span><span class="p">))</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">joinedload</span>

<span class="c1"># set children to load eagerly with a join</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Parent</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="n">Parent</span><span class="o">.</span><span class="n">children</span><span class="p">))</span></pre></div>
</div>
<p>The loader options can also be “chained” using <strong>method chaining</strong> to specify how loading should occur further levels deep:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">joinedload</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Parent</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
    <span class="n">joinedload</span><span class="p">(</span><span class="n">Parent</span><span class="o">.</span><span class="n">children</span><span class="p">)</span><span class="o">.</span><span class="n">subqueryload</span><span class="p">(</span><span class="n">Child</span><span class="o">.</span><span class="n">subelements</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>Chained loader options can be applied against a “lazy” loaded collection. This means that when a collection or association is lazily loaded upon access, the specified option will then take effect:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">lazyload</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Parent</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">lazyload</span><span class="p">(</span><span class="n">Parent</span><span class="o">.</span><span class="n">children</span><span class="p">)</span><span class="o">.</span><span class="n">subqueryload</span><span class="p">(</span><span class="n">Child</span><span class="o">.</span><span class="n">subelements</span><span class="p">))</span></pre></div>
</div>
<p>Above, the query will return <code class="docutils literal notranslate"><span class="pre">Parent</span></code> objects without the <code class="docutils literal notranslate"><span class="pre">children</span></code> collections loaded.  When the <code class="docutils literal notranslate"><span class="pre">children</span></code> collection on a particular <code class="docutils literal notranslate"><span class="pre">Parent</span></code> object is first accessed, it will lazy load the related objects, but additionally apply eager loading to the <code class="docutils literal notranslate"><span class="pre">subelements</span></code> collection on each member of <code class="docutils literal notranslate"><span class="pre">children</span></code>.</p>
</div>
</div>
<section id="loader-option-criteria">
<span id="id5"></span><h3>向加载器选项添加条件<a class="headerlink" href="#loader-option-criteria" title="Link to this heading">¶</a></h3>
<p>Adding Criteria to loader options</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--4-input--1" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--1">中文</label><div class="tab-content docutils container">
<p>用于指示加载器选项的关系属性包括能够将额外的过滤条件添加到创建的连接的 ON 子句中，或者添加到相关的 WHERE 条件中，这取决于加载策略。可以通过 <a class="reference internal" href="../internals.html#sqlalchemy.orm.PropComparator.and_" title="sqlalchemy.orm.PropComparator.and_"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PropComparator.and_()</span></code></a> 方法来实现，该方法会将一个选项传递过去，从而将加载结果限制为给定的过滤条件：</p>
<blockquote>
<div><p>from sqlalchemy import select
from sqlalchemy.orm import lazyload</p>
<p>stmt = select(A).options(lazyload(A.bs.and_(B.id &gt; 5)))</p>
</div></blockquote>
<p>使用限制条件时，如果某个集合已经加载，它将不会被刷新；为了确保新条件生效，可以应用 <a class="reference internal" href="api.html#orm-queryguide-populate-existing"><span class="std std-ref">填充现有</span></a> 执行选项：</p>
<blockquote>
<div><p>from sqlalchemy import select
from sqlalchemy.orm import lazyload</p>
<dl class="simple">
<dt>stmt = (</dt><dd><p>select(A)
.options(lazyload(A.bs.and_(B.id &gt; 5)))
.execution_options(populate_existing=True)</p>
</dd>
</dl>
<p>)</p>
</div></blockquote>
<p>如果希望将过滤条件添加到查询中的所有实体实例中，而不管加载策略是什么，也不管它出现在加载过程的哪个阶段，可以参见 <a class="reference internal" href="api.html#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> 函数。</p>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4 版本加入.</span></p>
</div>
</div>
<input class="tab-input" id="tab-set--4-input--2" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--2">英文</label><div class="tab-content docutils container">
<p>The relationship attributes used to indicate loader options include the ability to add additional filtering criteria to the ON clause of the join that’s created, or to the WHERE criteria involved, depending on the loader strategy.  This can be achieved using the <a class="reference internal" href="../internals.html#sqlalchemy.orm.PropComparator.and_" title="sqlalchemy.orm.PropComparator.and_"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PropComparator.and_()</span></code></a> method which will pass through an option such that loaded results are limited to the given filter criteria:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">lazyload</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">lazyload</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">bs</span><span class="o">.</span><span class="n">and_</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)))</span></pre></div>
</div>
<p>When using limiting criteria, if a particular collection is already loaded it won’t be refreshed; to ensure the new criteria takes place, apply the <a class="reference internal" href="api.html#orm-queryguide-populate-existing"><span class="std std-ref">填充现有</span></a> execution option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">lazyload</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">lazyload</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">bs</span><span class="o">.</span><span class="n">and_</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)))</span>
    <span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">populate_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>In order to add filtering criteria to all occurrences of an entity throughout a query, regardless of loader strategy or where it occurs in the loading process, see the <a class="reference internal" href="api.html#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> function.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4 版本加入.</span></p>
</div>
</div>
</div>
</section>
<section id="load-options">
<span id="orm-queryguide-relationship-sub-options"></span><h3>使用 Load.options() 指定子选项<a class="headerlink" href="#load-options" title="Link to this heading">¶</a></h3>
<p>Specifying Sub-Options with Load.options()</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--5-input--1" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--1">中文</label><div class="tab-content docutils container">
<p>通过方法链式调用，每个路径链接的加载器样式都被明确指定。为了在不改变特定属性的现有加载器样式的情况下沿路径导航，可以使用 <a class="reference internal" href="#sqlalchemy.orm.defaultload" title="sqlalchemy.orm.defaultload"><code class="xref py py-func docutils literal notranslate"><span class="pre">defaultload()</span></code></a> 方法/函数：</p>
<blockquote>
<div><p>from sqlalchemy import select
from sqlalchemy.orm import defaultload</p>
<p>stmt = select(A).options(defaultload(A.atob).joinedload(B.btoc))</p>
</div></blockquote>
<p>也可以使用类似的方法一次性指定多个子选项，通过 <a class="reference internal" href="#sqlalchemy.orm.Load.options" title="sqlalchemy.orm.Load.options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Load.options()</span></code></a> 方法：</p>
<blockquote>
<div><p>from sqlalchemy import select
from sqlalchemy.orm import defaultload
from sqlalchemy.orm import joinedload</p>
<dl class="simple">
<dt>stmt = select(A).options(</dt><dd><p>defaultload(A.atob).options(joinedload(B.btoc), joinedload(B.btod))</p>
</dd>
</dl>
<p>)</p>
</div></blockquote>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="columns.html#orm-queryguide-load-only-related"><span class="std std-ref">使用 load_only() 处理相关对象和集合</span></a> - 说明了如何结合关系和面向列的加载器选项的示例。</p>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>应用于对象懒加载集合的加载器选项是 <strong>“粘性”(sticky)</strong> 的，意味着它们会持续存在于由特定对象加载的集合中，只要该对象仍然存在于内存中。例如，给定以下示例：</p>
<blockquote>
<div><p>stmt = select(Parent).options(lazyload(Parent.children).subqueryload(Child.subelements))</p>
</div></blockquote>
</div>
<p>如果通过上述查询加载的 <code class="docutils literal notranslate"><span class="pre">Parent</span></code> 对象的 <code class="docutils literal notranslate"><span class="pre">children</span></code> 集合过期（例如，当 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 对象的事务被提交或回滚，或使用了 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.expire_all" title="sqlalchemy.orm.Session.expire_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expire_all()</span></code></a>），下次访问 <code class="docutils literal notranslate"><span class="pre">Parent.children</span></code> 集合并重新加载时，<code class="docutils literal notranslate"><span class="pre">Child.subelements</span></code> 集合将再次使用子查询急加载。这种情况即使在后续查询中访问该 <code class="docutils literal notranslate"><span class="pre">Parent</span></code> 对象，并指定不同的选项时依然成立。要在不清除并重新加载对象的情况下更改现有对象的选项，必须通过联合使用 <a class="reference internal" href="api.html#orm-queryguide-populate-existing"><span class="std std-ref">填充现有</span></a> 执行选项明确设置：</p>
<blockquote>
<div><p># 更改已经加载的 Parent 对象的选项
stmt = (</p>
<blockquote>
<div><p>select(Parent)
.execution_options(populate_existing=True)
.options(lazyload(Parent.children).lazyload(Child.subelements))
.all()</p>
</div></blockquote>
<p>)</p>
</div></blockquote>
<p>如果上面加载的对象已经完全从 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 中清除（例如，垃圾回收，或者使用了 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.expunge_all" title="sqlalchemy.orm.Session.expunge_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expunge_all()</span></code></a>），那么 “粘性(sticky)” 选项也会消失，重新创建的对象在重新加载时将使用新的选项。</p>
<p>未来的 SQLAlchemy 版本可能会添加更多替代方法，用于操作已经加载的对象的加载器选项。</p>
</div>
<input class="tab-input" id="tab-set--5-input--2" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--2">英文</label><div class="tab-content docutils container">
<p>Using method chaining, the loader style of each link in the path is explicitly stated.  To navigate along a path without changing the existing loader style of a particular attribute, the <a class="reference internal" href="#sqlalchemy.orm.defaultload" title="sqlalchemy.orm.defaultload"><code class="xref py py-func docutils literal notranslate"><span class="pre">defaultload()</span></code></a> method/function may be used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultload</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">defaultload</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">atob</span><span class="p">)</span><span class="o">.</span><span class="n">joinedload</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">btoc</span><span class="p">))</span></pre></div>
</div>
<p>A similar approach can be used to specify multiple sub-options at once, using the <a class="reference internal" href="#sqlalchemy.orm.Load.options" title="sqlalchemy.orm.Load.options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Load.options()</span></code></a> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultload</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">joinedload</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
    <span class="n">defaultload</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">atob</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">btoc</span><span class="p">),</span> <span class="n">joinedload</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">btod</span><span class="p">))</span>
<span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="columns.html#orm-queryguide-load-only-related"><span class="std std-ref">使用 load_only() 处理相关对象和集合</span></a> - illustrates examples of combining relationship and column-oriented loader options.</p>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>The loader options applied to an object’s lazy-loaded collections are <strong>“sticky”</strong> to specific object instances, meaning they will persist upon collections loaded by that specific object for as long as it exists in memory.  For example, given the previous example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Parent</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">lazyload</span><span class="p">(</span><span class="n">Parent</span><span class="o">.</span><span class="n">children</span><span class="p">)</span><span class="o">.</span><span class="n">subqueryload</span><span class="p">(</span><span class="n">Child</span><span class="o">.</span><span class="n">subelements</span><span class="p">))</span></pre></div>
</div>
</div>
<p>if the <code class="docutils literal notranslate"><span class="pre">children</span></code> collection on a particular <code class="docutils literal notranslate"><span class="pre">Parent</span></code> object loaded by the above query is expired (such as when a <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> object’s transaction is committed or rolled back, or <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.expire_all" title="sqlalchemy.orm.Session.expire_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expire_all()</span></code></a> is used), when the <code class="docutils literal notranslate"><span class="pre">Parent.children</span></code> collection is next accessed in order to re-load it, the <code class="docutils literal notranslate"><span class="pre">Child.subelements</span></code> collection will again be loaded using subquery eager loading. This stays the case even if the above <code class="docutils literal notranslate"><span class="pre">Parent</span></code> object is accessed from a subsequent query that specifies a different set of options. To change the options on an existing object without expunging it and re-loading, they must be set explicitly in conjunction using the
<a class="reference internal" href="api.html#orm-queryguide-populate-existing"><span class="std std-ref">填充现有</span></a> execution option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># change the options on Parent objects that were already loaded</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">select</span><span class="p">(</span><span class="n">Parent</span><span class="p">)</span>
    <span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">populate_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">lazyload</span><span class="p">(</span><span class="n">Parent</span><span class="o">.</span><span class="n">children</span><span class="p">)</span><span class="o">.</span><span class="n">lazyload</span><span class="p">(</span><span class="n">Child</span><span class="o">.</span><span class="n">subelements</span><span class="p">))</span>
    <span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="p">)</span></pre></div>
</div>
<p>If the objects loaded above are fully cleared from the <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>, such as due to garbage collection or that <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.expunge_all" title="sqlalchemy.orm.Session.expunge_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expunge_all()</span></code></a> were used, the “sticky” options will also be gone and the newly created objects will make use of new options if loaded again.</p>
<p>A future SQLAlchemy release may add more alternatives to manipulating the loader options on already-loaded objects.</p>
</div>
</div>
</section>
</section>
<section id="lazy-loading">
<span id="id6"></span><h2>延迟加载<a class="headerlink" href="#lazy-loading" title="Link to this heading">¶</a></h2>
<p>Lazy Loading</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--6-input--1" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--1">中文</label><div class="tab-content docutils container">
<p>默认情况下，所有对象间的关系都是 <strong>懒加载</strong>。与 <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> 相关的标量或集合属性包含一个触发器，该触发器在第一次访问该属性时触发。这个触发器通常会在访问时发出 SQL 调用，以加载相关对象或对象集合：</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">spongebob</span><span class="o">.</span><span class="n">addresses</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_email_address</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_user_id</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">addresses</span>
<span class="k">WHERE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span>
<span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</div><span class="go">[&lt;Address(u&#39;spongebob@google.com&#39;)&gt;, &lt;Address(u&#39;j25@yahoo.com&#39;)&gt;]</span></pre></div>
</div>
<p>唯一不发出 SQL 的情况是简单的多对一关系，当相关对象仅通过其主键就能识别，并且该对象已经存在于当前 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 中。因此，虽然懒加载对于相关集合可能开销较大，但在加载大量对象且与相对较小的一组目标对象具有简单多对一关系的情况下，懒加载可以本地引用这些对象，而不需要像有多少个父对象就发出多少个 SELECT 语句。</p>
<p>这种“按属性访问时加载”的默认行为被称为“懒加载”或“select”加载 —— “select” 这个名字是因为在第一次访问属性时通常会发出一个 “SELECT” 语句。</p>
<p>可以通过 <a class="reference internal" href="#sqlalchemy.orm.lazyload" title="sqlalchemy.orm.lazyload"><code class="xref py py-func docutils literal notranslate"><span class="pre">lazyload()</span></code></a> 加载器选项为正常配置为其他方式的属性启用懒加载：</p>
<blockquote>
<div><p>from sqlalchemy import select
from sqlalchemy.orm import lazyload</p>
<p># 强制懒加载一个通常以其他方式加载的属性
stmt = select(User).options(lazyload(User.addresses))</p>
</div></blockquote>
</div>
<input class="tab-input" id="tab-set--6-input--2" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--2">英文</label><div class="tab-content docutils container">
<p>By default, all inter-object relationships are <strong>lazy loading</strong>. The scalar or collection attribute associated with a <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> contains a trigger which fires the first time the attribute is accessed.  This trigger typically issues a SQL call at the point of access in order to load the related object or objects:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">spongebob</span><span class="o">.</span><span class="n">addresses</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_email_address</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_user_id</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">addresses</span>
<span class="k">WHERE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span>
<span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</div><span class="go">[&lt;Address(u&#39;spongebob@google.com&#39;)&gt;, &lt;Address(u&#39;j25@yahoo.com&#39;)&gt;]</span></pre></div>
</div>
<p>The one case where SQL is not emitted is for a simple many-to-one relationship, when the related object can be identified by its primary key alone and that object is already present in the current <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>.  For this reason, while lazy loading can be expensive for related collections, in the case that one is loading lots of objects with simple many-to-ones against a relatively small set of possible target objects, lazy loading may be able to refer to these objects locally without emitting as many SELECT statements as there are parent objects.</p>
<p>This default behavior of “load upon attribute access” is known as “lazy” or “select” loading - the name “select” because a “SELECT” statement is typically emitted when the attribute is first accessed.</p>
<p>Lazy loading can be enabled for a given attribute that is normally configured in some other way using the <a class="reference internal" href="#sqlalchemy.orm.lazyload" title="sqlalchemy.orm.lazyload"><code class="xref py py-func docutils literal notranslate"><span class="pre">lazyload()</span></code></a> loader option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">lazyload</span>

<span class="c1"># force lazy loading for an attribute that is set to</span>
<span class="c1"># load some other way normally</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">lazyload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">))</span></pre></div>
</div>
</div>
</div>
<section id="raiseload">
<span id="prevent-lazy-with-raiseload"></span><h3>使用 raiseload 防止不必要的延迟加载<a class="headerlink" href="#raiseload" title="Link to this heading">¶</a></h3>
<p>Preventing unwanted lazy loads using raiseload</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--7-input--1" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--1">中文</label><div class="tab-content docutils container">
<p><a class="reference internal" href="#sqlalchemy.orm.lazyload" title="sqlalchemy.orm.lazyload"><code class="xref py py-func docutils literal notranslate"><span class="pre">lazyload()</span></code></a> 策略会产生在对象关系映射中最常见的问题之一；即 <span class="xref std std-term">N+1 问题</span>，该问题指出，对于任何 N 个加载的对象，访问它们的懒加载属性将导致发出 N+1 个 SELECT 语句。在 SQLAlchemy 中，通常解决 N+1 问题的方法是利用其非常强大的急加载系统。然而，急加载要求提前在 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> 中指定要加载的属性。对于代码可能访问那些没有急加载的属性，而又不希望进行懒加载的情况，可以使用 <a class="reference internal" href="#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal notranslate"><span class="pre">raiseload()</span></code></a> 策略来解决；此加载器策略将懒加载的行为替换为抛出信息性错误：</p>
<blockquote>
<div><p>from sqlalchemy import select
from sqlalchemy.orm import raiseload</p>
<p>stmt = select(User).options(raiseload(User.addresses))</p>
</div></blockquote>
<p>上述代码中，使用此查询加载的 <code class="docutils literal notranslate"><span class="pre">User</span></code> 对象将不会加载 <code class="docutils literal notranslate"><span class="pre">.addresses</span></code> 集合；如果稍后某些代码尝试访问此属性，将引发 ORM 异常。</p>
<p><a class="reference internal" href="#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal notranslate"><span class="pre">raiseload()</span></code></a> 可以与所谓的“通配符”说明符一起使用，表示所有关系都应该使用此策略。例如，设置仅一个属性为急加载，而其余属性都为 raise：</p>
<blockquote>
<div><p>from sqlalchemy import select
from sqlalchemy.orm import joinedload
from sqlalchemy.orm import raiseload</p>
<p>stmt = select(Order).options(joinedload(Order.items), raiseload(“*”))</p>
</div></blockquote>
<p>上述通配符将应用于 <strong>所有</strong> 关系，不仅仅是 <code class="docutils literal notranslate"><span class="pre">Order</span></code> 上的 <code class="docutils literal notranslate"><span class="pre">items</span></code>，而且还包括 <code class="docutils literal notranslate"><span class="pre">Item</span></code> 对象上的所有关系。要仅对 <code class="docutils literal notranslate"><span class="pre">Order</span></code> 对象设置 <a class="reference internal" href="#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal notranslate"><span class="pre">raiseload()</span></code></a>，可以使用 <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> 指定完整路径：</p>
<blockquote>
<div><p>from sqlalchemy import select
from sqlalchemy.orm import joinedload
from sqlalchemy.orm import Load</p>
<p>stmt = select(Order).options(joinedload(Order.items), Load(Order).raiseload(“*”))</p>
</div></blockquote>
<p>相反，要仅对 <code class="docutils literal notranslate"><span class="pre">Item</span></code> 对象设置 raise：</p>
<blockquote>
<div><p>stmt = select(Order).options(joinedload(Order.items).raiseload(“*”))</p>
</div></blockquote>
<p><a class="reference internal" href="#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal notranslate"><span class="pre">raiseload()</span></code></a> 选项仅适用于关系属性。对于面向列的属性，<a class="reference internal" href="columns.html#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> 选项支持 <a class="reference internal" href="columns.html#sqlalchemy.orm.defer.params.raiseload" title="sqlalchemy.orm.defer"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">defer.raiseload</span></code></a> 选项，功能与此相同。</p>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>“raiseload” 策略 <strong>不适用于</strong> <a class="reference internal" href="../../glossary.html#term-39"><span class="xref std std-term">工作单元</span></a> 刷新过程。这意味着，如果 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.flush" title="sqlalchemy.orm.Session.flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.flush()</span></code></a> 过程需要加载集合以完成其工作，它将在绕过任何 <a class="reference internal" href="#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal notranslate"><span class="pre">raiseload()</span></code></a> 指令的情况下进行。</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#wildcard-loader-strategies"><span class="std std-ref">通配符加载策略</span></a></p>
<p><a class="reference internal" href="columns.html#orm-queryguide-deferred-raiseload"><span class="std std-ref">使用 raiseload 防止延迟列加载</span></a></p>
</div>
</div>
<input class="tab-input" id="tab-set--7-input--2" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--2">英文</label><div class="tab-content docutils container">
<p>The <a class="reference internal" href="#sqlalchemy.orm.lazyload" title="sqlalchemy.orm.lazyload"><code class="xref py py-func docutils literal notranslate"><span class="pre">lazyload()</span></code></a> strategy produces an effect that is one of the most common issues referred to in object relational mapping; the <a class="reference internal" href="../../glossary.html#term-N-plus-one-problem"><span class="xref std std-term">N plus one problem</span></a>, which states that for any N objects loaded, accessing their lazy-loaded attributes means there will be N+1 SELECT statements emitted.  In SQLAlchemy, the usual mitigation for the N+1 problem is to make use of its very capable eager load system.  However, eager loading requires that the attributes which are to be loaded be specified with the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> up front.  The problem of code that may access other attributes that were not eagerly loaded, where lazy loading is not desired, may be addressed using the <a class="reference internal" href="#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal notranslate"><span class="pre">raiseload()</span></code></a> strategy; this loader strategy replaces the behavior of lazy loading with an informative error being raised:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">raiseload</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">raiseload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">))</span></pre></div>
</div>
<p>Above, a <code class="docutils literal notranslate"><span class="pre">User</span></code> object loaded from the above query will not have the <code class="docutils literal notranslate"><span class="pre">.addresses</span></code> collection loaded; if some code later on attempts to access this attribute, an ORM exception is raised.</p>
<p><a class="reference internal" href="#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal notranslate"><span class="pre">raiseload()</span></code></a> may be used with a so-called “wildcard” specifier to indicate that all relationships should use this strategy.  For example, to set up only one attribute as eager loading, and all the rest as raise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">joinedload</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">raiseload</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="n">Order</span><span class="o">.</span><span class="n">items</span><span class="p">),</span> <span class="n">raiseload</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">))</span></pre></div>
</div>
<p>The above wildcard will apply to <strong>all</strong> relationships not just on <code class="docutils literal notranslate"><span class="pre">Order</span></code> besides <code class="docutils literal notranslate"><span class="pre">items</span></code>, but all those on the <code class="docutils literal notranslate"><span class="pre">Item</span></code> objects as well.  To set up <a class="reference internal" href="#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal notranslate"><span class="pre">raiseload()</span></code></a> for only the <code class="docutils literal notranslate"><span class="pre">Order</span></code> objects, specify a full path with <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">joinedload</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Load</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="n">Order</span><span class="o">.</span><span class="n">items</span><span class="p">),</span> <span class="n">Load</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">raiseload</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">))</span></pre></div>
</div>
<p>Conversely, to set up the raise for just the <code class="docutils literal notranslate"><span class="pre">Item</span></code> objects:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="n">Order</span><span class="o">.</span><span class="n">items</span><span class="p">)</span><span class="o">.</span><span class="n">raiseload</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">))</span></pre></div>
</div>
<p>The <a class="reference internal" href="#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal notranslate"><span class="pre">raiseload()</span></code></a> option applies only to relationship attributes.  For column-oriented attributes, the <a class="reference internal" href="columns.html#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> option supports the <a class="reference internal" href="columns.html#sqlalchemy.orm.defer.params.raiseload" title="sqlalchemy.orm.defer"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">defer.raiseload</span></code></a> option which works in the same way.</p>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>The “raiseload” strategies <strong>do not apply</strong> within the <a class="reference internal" href="../../glossary.html#term-unit-of-work"><span class="xref std std-term">unit of work</span></a> flush process.   That means if the <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.flush" title="sqlalchemy.orm.Session.flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.flush()</span></code></a> process needs to load a collection in order to finish its work, it will do so while bypassing any <a class="reference internal" href="#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal notranslate"><span class="pre">raiseload()</span></code></a> directives.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#wildcard-loader-strategies"><span class="std std-ref">通配符加载策略</span></a></p>
<p><a class="reference internal" href="columns.html#orm-queryguide-deferred-raiseload"><span class="std std-ref">使用 raiseload 防止延迟列加载</span></a></p>
</div>
</div>
</div>
</section>
</section>
<section id="joined-eager-loading">
<span id="id7"></span><h2>连接预/急加载<a class="headerlink" href="#joined-eager-loading" title="Link to this heading">¶</a></h2>
<p>Joined Eager Loading</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--8-input--1" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--1">中文</label><div class="tab-content docutils container">
<p>连接急加载(Joined eager loading)是 SQLAlchemy ORM 中最早的急加载方式。它通过在发出的 SELECT 语句中连接一个 JOIN（默认是 LEFT OUTER JOIN），并从与父对象相同的结果集中填充目标标量/集合。</p>
<p>在映射层，这看起来像：</p>
<blockquote>
<div><dl>
<dt>class Address(Base):</dt><dd><p># …</p>
<p>user: Mapped[User] = relationship(lazy=”joined”)</p>
</dd>
</dl>
</div></blockquote>
<p>连接急加载(Joined eager loading)通常作为查询选项应用，而不是作为映射上的默认加载选项，特别是在用于集合而不是多对一引用时。可以使用 <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> 加载器选项来实现：</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">joinedload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">))</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;spongebob&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spongebob</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_email_address</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_user_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">fullname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_fullname</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">nickname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_nickname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">addresses</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[</span><span class="s1">&#39;spongebob&#39;</span><span class="p">]</span>
</div></pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>当在多对一或多对多集合的引用中使用 <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> 时，必须对返回的结果应用 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result.unique" title="sqlalchemy.engine.Result.unique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.unique()</span></code></a> 方法，该方法会根据主键去重，由于连接操作，返回的行数可能会被乘以。若未使用此方法，ORM 会引发错误。</p>
<p>这在现代 SQLAlchemy 中并不自动进行，因为它改变了结果集的行为，使得返回的 ORM 对象数量比查询通常返回的行数要少。因此，SQLAlchemy 将 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result.unique" title="sqlalchemy.engine.Result.unique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.unique()</span></code></a> 的使用明确化，以避免对返回对象在主键上去重的含糊不清。</p>
</div>
<p>默认发出的 JOIN 是 LEFT OUTER JOIN，以便允许存在不引用相关行的主对象。对于一个保证有元素的属性，比如一个多对一引用到相关对象，并且外键是 NOT NULL 的情况，可以通过使用内连接来提高查询效率；在映射层通过 <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship.params.innerjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.innerjoin</span></code></a> 标志实现：</p>
<blockquote>
<div><dl>
<dt>class Address(Base):</dt><dd><p># …</p>
<p>user_id: Mapped[int] = mapped_column(ForeignKey(“users.id”))
user: Mapped[User] = relationship(lazy=”joined”, innerjoin=True)</p>
</dd>
</dl>
</div></blockquote>
<p>在查询选项层，可以通过 <a class="reference internal" href="#sqlalchemy.orm.joinedload.params.innerjoin" title="sqlalchemy.orm.joinedload"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">joinedload.innerjoin</span></code></a> 标志实现：</p>
<blockquote>
<div><p>from sqlalchemy import select
from sqlalchemy.orm import joinedload</p>
<p>stmt = select(Address).options(joinedload(Address.user, innerjoin=True))</p>
</div></blockquote>
<p>当在一个包含外连接的链中应用时，JOIN 会进行右嵌套：</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">joinedload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
<span class="go">...     joinedload(User.addresses).joinedload(Address.widgets, innerjoin=True)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">widgets_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">widgets_1_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">widgets_1</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">widgets_1_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_email_address</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_user_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">fullname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_fullname</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">nickname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_nickname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">addresses</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">widgets</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">widgets_1</span><span class="w"> </span><span class="k">ON</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">widget_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">widgets_1</span><span class="p">.</span><span class="n">id</span>
<span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">user_id</span>
</div></pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>如果在发出 SELECT 时使用了数据库行锁定技术（即使用 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.with_for_update" title="sqlalchemy.sql.expression.Select.with_for_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.with_for_update()</span></code></a> 方法发出 SELECT..FOR UPDATE），则连接表也可能会被锁定，具体取决于所使用的后端行为。由于这个原因，不推荐在使用 SELECT..FOR UPDATE 时同时使用连接急加载。</p>
</div>
</div>
<input class="tab-input" id="tab-set--8-input--2" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--2">英文</label><div class="tab-content docutils container">
<p>Joined eager loading is the oldest style of eager loading included with the SQLAlchemy ORM.  It works by connecting a JOIN (by default a LEFT OUTER join) to the SELECT statement emitted, and populates the target scalar/collection from the same result set as that of the parent.</p>
<p>At the mapping level, this looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Address</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="n">user</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">User</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">lazy</span><span class="o">=</span><span class="s2">&quot;joined&quot;</span><span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>Joined eager loading is usually applied as an option to a query, rather than as a default loading option on the mapping, in particular when used for collections rather than many-to-one-references.   This is achieved using the <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> loader option:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">joinedload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">))</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;spongebob&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spongebob</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_email_address</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_user_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">fullname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_fullname</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">nickname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_nickname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">addresses</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[</span><span class="s1">&#39;spongebob&#39;</span><span class="p">]</span>
</div></pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>When including <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> in reference to a one-to-many or many-to-many collection, the <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result.unique" title="sqlalchemy.engine.Result.unique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.unique()</span></code></a> method must be applied to the returned result, which will uniquify the incoming rows by primary key that otherwise are multiplied out by the join. The ORM will raise an error if this is not present.</p>
<p>This is not automatic in modern SQLAlchemy, as it changes the behavior of the result set to return fewer ORM objects than the statement would normally return in terms of number of rows.  Therefore SQLAlchemy keeps the use of <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result.unique" title="sqlalchemy.engine.Result.unique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.unique()</span></code></a> explicit, so there’s no ambiguity that the returned objects are being uniqified on primary key.</p>
</div>
<p>The JOIN emitted by default is a LEFT OUTER JOIN, to allow for a lead object that does not refer to a related row.  For an attribute that is guaranteed to have an element, such as a many-to-one reference to a related object where the referencing foreign key is NOT NULL, the query can be made more efficient by using an inner join; this is available at the mapping level via the <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship.params.innerjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.innerjoin</span></code></a> flag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Address</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="n">user_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;users.id&quot;</span><span class="p">))</span>
    <span class="n">user</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">User</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">lazy</span><span class="o">=</span><span class="s2">&quot;joined&quot;</span><span class="p">,</span> <span class="n">innerjoin</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>At the query option level, via the <a class="reference internal" href="#sqlalchemy.orm.joinedload.params.innerjoin" title="sqlalchemy.orm.joinedload"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">joinedload.innerjoin</span></code></a> flag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">joinedload</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Address</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">innerjoin</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span></pre></div>
</div>
<p>The JOIN will right-nest itself when applied in a chain that includes an OUTER JOIN:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">joinedload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
<span class="go">...     joinedload(User.addresses).joinedload(Address.widgets, innerjoin=True)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">widgets_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">widgets_1_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">widgets_1</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">widgets_1_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_email_address</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_user_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">fullname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_fullname</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">nickname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_nickname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">addresses</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">widgets</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">widgets_1</span><span class="w"> </span><span class="k">ON</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">widget_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">widgets_1</span><span class="p">.</span><span class="n">id</span>
<span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">user_id</span>
</div></pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>If using database row locking techniques when emitting the SELECT, meaning the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.with_for_update" title="sqlalchemy.sql.expression.Select.with_for_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.with_for_update()</span></code></a> method is being used to emit SELECT..FOR UPDATE, the joined table may be locked as well, depending on the behavior of the backend in use.   It’s not recommended to use joined eager loading at the same time as SELECT..FOR UPDATE for this reason.</p>
</div>
</div>
</div>
<section id="zen-of-eager-loading">
<span id="id8"></span><h3>连接预加载的禅宗<a class="headerlink" href="#zen-of-eager-loading" title="Link to this heading">¶</a></h3>
<p>The Zen of Joined Eager Loading</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--9-input--1" name="tab-set--9" type="radio"><label class="tab-label" for="tab-set--9-input--1">中文</label><div class="tab-content docutils container">
<p>由于连接急加载与 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.join" title="sqlalchemy.sql.expression.Select.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join()</span></code></a> 的使用有许多相似之处，因此在何时以及如何使用它时常会产生困惑。理解两者的区别至关重要：虽然 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.join" title="sqlalchemy.sql.expression.Select.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join()</span></code></a> 用于改变查询的结果， <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> 则努力 <strong>不</strong> 改变查询的结果，而是隐藏连接的效果，只允许相关对象存在。</p>
<p>加载器策略背后的哲学是，任何一组加载方案都可以应用于特定的查询，并且 <em>结果不会改变</em> —— 只会改变完全加载相关对象和集合所需的 SQL 语句的数量。一个特定的查询可能最初使用所有的延迟加载（lazy loads）。在使用它的过程中，可能会发现某些属性或集合总是被访问，改为为这些属性或集合使用急加载（eager loading）会更高效。加载策略可以在不修改查询的情况下进行更改，结果保持不变，但发出的 SQL 语句会减少。从理论上讲（并且在实践中几乎如此），对 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> 所做的任何操作都不会基于加载策略的变化加载不同的主对象或相关对象集。</p>
<p>具体来说， <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> 是如何实现这一点的呢？它通过创建一个匿名别名来添加到查询中的 JOIN，因此这些 JOIN 不能被查询的其他部分引用。例如，下面的查询使用 <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> 来创建一个从 <code class="docutils literal notranslate"><span class="pre">users</span></code> 到 <code class="docutils literal notranslate"><span class="pre">addresses</span></code> 的 LEFT OUTER JOIN，但是对 <code class="docutils literal notranslate"><span class="pre">Address.email_address</span></code> 添加的 <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> 是无效的——因为在查询中没有命名 <code class="docutils literal notranslate"><span class="pre">Address</span></code> 实体：</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">joinedload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User)</span>
<span class="go">...     .options(joinedload(User.addresses))</span>
<span class="go">...     .filter(User.name == &quot;spongebob&quot;)</span>
<span class="go">...     .order_by(Address.email_address)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_email_address</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_user_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">fullname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_fullname</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">nickname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_nickname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">addresses</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">email_address</span><span class="w">   </span><span class="o">&lt;</span><span class="c1">-- 这个部分是错的！</span>
<span class="p">[</span><span class="s1">&#39;spongebob&#39;</span><span class="p">]</span>
</div></pre></div>
</div>
<p>上面， <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span> <span class="pre">addresses.email_address</span></code> 是无效的，因为 <code class="docutils literal notranslate"><span class="pre">addresses</span></code> 没有出现在 FROM 列表中。正确的加载 <code class="docutils literal notranslate"><span class="pre">User</span></code> 记录并按电子邮件地址排序的方法是使用 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.join" title="sqlalchemy.sql.expression.Select.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join()</span></code></a>：</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User)</span>
<span class="go">...     .join(User.addresses)</span>
<span class="go">...     .filter(User.name == &quot;spongebob&quot;)</span>
<span class="go">...     .order_by(Address.email_address)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">fullname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_fullname</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">nickname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_nickname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">addresses</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">email_address</span>
<span class="p">[</span><span class="s1">&#39;spongebob&#39;</span><span class="p">]</span>
</div></pre></div>
</div>
<p>上述语句与之前的语句不同，因为 <code class="docutils literal notranslate"><span class="pre">addresses</span></code> 的列没有被包含在结果中。我们可以将 <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> 加回来，这样就有两个连接——一个是我们排序的连接，另一个是用于匿名加载 <code class="docutils literal notranslate"><span class="pre">User.addresses</span></code> 集合的连接：</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User)</span>
<span class="go">...     .join(User.addresses)</span>
<span class="go">...     .options(joinedload(User.addresses))</span>
<span class="go">...     .filter(User.name == &quot;spongebob&quot;)</span>
<span class="go">...     .order_by(Address.email_address)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_email_address</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_user_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">fullname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_fullname</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">nickname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_nickname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">addresses</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">addresses</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">email_address</span>
<span class="p">[</span><span class="s1">&#39;spongebob&#39;</span><span class="p">]</span>
</div></pre></div>
</div>
<p>从上面可以看到，我们使用 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.join" title="sqlalchemy.sql.expression.Select.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join()</span></code></a> 来提供我们希望在后续查询标准中使用的 JOIN 子句，而使用 <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> 仅关注加载每个 <code class="docutils literal notranslate"><span class="pre">User</span></code> 结果的 <code class="docutils literal notranslate"><span class="pre">User.addresses</span></code> 集合。在这种情况下，两个连接看起来可能是多余的——确实是多余的。如果我们只想使用一个 JOIN 来同时加载集合和进行排序，我们可以使用 <a class="reference internal" href="#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> 选项，稍后在 <a class="reference internal" href="#contains-eager"><span class="std std-ref">将显式连接/语句路由到预加载的集合</span></a> 中介绍。但为了理解 <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> 的工作原理，考虑一下我们是否在 <strong>过滤</strong> 某个特定的 <code class="docutils literal notranslate"><span class="pre">Address</span></code>：</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User)</span>
<span class="go">...     .join(User.addresses)</span>
<span class="go">...     .options(joinedload(User.addresses))</span>
<span class="go">...     .filter(User.name == &quot;spongebob&quot;)</span>
<span class="go">...     .filter(Address.email_address == &quot;someaddress@foo.com&quot;)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_email_address</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_user_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">fullname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_fullname</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">nickname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_nickname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">addresses</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">addresses</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[</span><span class="s1">&#39;spongebob&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;someaddress@foo.com&#39;</span><span class="p">]</span>
</div></pre></div>
</div>
<p>上面，我们可以看到这两个 JOIN 的角色非常不同。一个将精确匹配一行，即连接 <code class="docutils literal notranslate"><span class="pre">User</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Address</span></code>，其中 <code class="docutils literal notranslate"><span class="pre">Address.email_address=='someaddress&#64;foo.com'</span></code>。另一个 LEFT OUTER JOIN 将匹配 <em>所有</em> 与 <code class="docutils literal notranslate"><span class="pre">User</span></code> 相关的 <code class="docutils literal notranslate"><span class="pre">Address</span></code> 行，仅用于填充那些返回的 <code class="docutils literal notranslate"><span class="pre">User.addresses</span></code> 集合。</p>
<p>通过将 <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> 更改为另一种加载方式，我们可以完全独立地改变集合的加载方式，而不会影响检索实际 <code class="docutils literal notranslate"><span class="pre">User</span></code> 行所使用的 SQL。下面我们将 <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> 更改为 <a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a>：</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User)</span>
<span class="go">...     .join(User.addresses)</span>
<span class="go">...     .options(selectinload(User.addresses))</span>
<span class="go">...     .filter(User.name == &quot;spongebob&quot;)</span>
<span class="go">...     .filter(Address.email_address == &quot;someaddress@foo.com&quot;)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">fullname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_fullname</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">nickname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_nickname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">addresses</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[</span><span class="s1">&#39;spongebob&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;someaddress@foo.com&#39;</span><span class="p">]</span>
<span class="o">#</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="n">selectinload</span><span class="p">()</span><span class="w"> </span><span class="err">会发出一个</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="err">语句</span>
<span class="o">#</span><span class="w"> </span><span class="err">来加载所有的地址记录</span><span class="w"> </span><span class="p">...</span>
</div></pre></div>
</div>
<p>在使用连接急加载时，如果查询包含影响外部行的修饰符（例如使用 DISTINCT、LIMIT、OFFSET 或等效操作符），完成的语句会首先被包装在一个子查询中，专门用于连接急加载的 JOIN 将应用到该子查询中。SQLAlchemy 的连接急加载不遗余力地确保它不会影响查询的最终结果，只会改变集合和相关对象的加载方式，无论查询的格式如何。</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#contains-eager"><span class="std std-ref">将显式连接/语句路由到预加载的集合</span></a> - 使用 <a class="reference internal" href="#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a></p>
</div>
</div>
<input class="tab-input" id="tab-set--9-input--2" name="tab-set--9" type="radio"><label class="tab-label" for="tab-set--9-input--2">英文</label><div class="tab-content docutils container">
<p>Since joined eager loading seems to have many resemblances to the use of <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.join" title="sqlalchemy.sql.expression.Select.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join()</span></code></a>, it often produces confusion as to when and how it should be used.   It is critical to understand the distinction that while <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.join" title="sqlalchemy.sql.expression.Select.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join()</span></code></a> is used to alter the results of a query, <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> goes through great lengths to <strong>not</strong> alter the results of the query, and instead hide the effects of the rendered join to only allow for related objects to be present.</p>
<p>The philosophy behind loader strategies is that any set of loading schemes can be applied to a particular query, and <em>the results don’t change</em> - only the number of SQL statements required to fully load related objects and collections changes. A particular query might start out using all lazy loads.   After using it in context, it might be revealed that particular attributes or collections are always accessed, and that it would be more efficient to change the loader strategy for these.   The strategy can be changed with no other modifications to the query, the results will remain identical, but fewer SQL statements would be emitted. In theory (and pretty much in practice), nothing you can do to the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> would make it load a different set of primary or related objects based on a change in loader strategy.</p>
<p>How <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> in particular achieves this result of not impacting entity rows returned in any way is that it creates an anonymous alias of the joins it adds to your query, so that they can’t be referenced by other parts of the query.   For example, the query below uses <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> to create a LEFT OUTER JOIN from <code class="docutils literal notranslate"><span class="pre">users</span></code> to <code class="docutils literal notranslate"><span class="pre">addresses</span></code>, however the <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> added against <code class="docutils literal notranslate"><span class="pre">Address.email_address</span></code> is not valid - the <code class="docutils literal notranslate"><span class="pre">Address</span></code> entity is not named in the query:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">joinedload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User)</span>
<span class="go">...     .options(joinedload(User.addresses))</span>
<span class="go">...     .filter(User.name == &quot;spongebob&quot;)</span>
<span class="go">...     .order_by(Address.email_address)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_email_address</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_user_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">fullname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_fullname</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">nickname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_nickname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">addresses</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">email_address</span><span class="w">   </span><span class="o">&lt;</span><span class="c1">-- this part is wrong !</span>
<span class="p">[</span><span class="s1">&#39;spongebob&#39;</span><span class="p">]</span>
</div></pre></div>
</div>
<p>Above, <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span> <span class="pre">addresses.email_address</span></code> is not valid since <code class="docutils literal notranslate"><span class="pre">addresses</span></code> is not in the FROM list.   The correct way to load the <code class="docutils literal notranslate"><span class="pre">User</span></code> records and order by email address is to use <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.join" title="sqlalchemy.sql.expression.Select.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join()</span></code></a>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User)</span>
<span class="go">...     .join(User.addresses)</span>
<span class="go">...     .filter(User.name == &quot;spongebob&quot;)</span>
<span class="go">...     .order_by(Address.email_address)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">fullname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_fullname</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">nickname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_nickname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">addresses</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">email_address</span>
<span class="p">[</span><span class="s1">&#39;spongebob&#39;</span><span class="p">]</span>
</div></pre></div>
</div>
<p>The statement above is of course not the same as the previous one, in that the columns from <code class="docutils literal notranslate"><span class="pre">addresses</span></code> are not included in the result at all.   We can add <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> back in, so that there are two joins - one is that which we are ordering on, the other is used anonymously to load the contents of the <code class="docutils literal notranslate"><span class="pre">User.addresses</span></code> collection:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User)</span>
<span class="go">...     .join(User.addresses)</span>
<span class="go">...     .options(joinedload(User.addresses))</span>
<span class="go">...     .filter(User.name == &quot;spongebob&quot;)</span>
<span class="go">...     .order_by(Address.email_address)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_email_address</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_user_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">fullname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_fullname</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">nickname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_nickname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">addresses</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">addresses</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">email_address</span>
<span class="p">[</span><span class="s1">&#39;spongebob&#39;</span><span class="p">]</span>
</div></pre></div>
</div>
<p>What we see above is that our usage of <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.join" title="sqlalchemy.sql.expression.Select.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join()</span></code></a> is to supply JOIN clauses we’d like to use in subsequent query criterion, whereas our usage of <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> only concerns itself with the loading of the <code class="docutils literal notranslate"><span class="pre">User.addresses</span></code> collection, for each <code class="docutils literal notranslate"><span class="pre">User</span></code> in the result. In this case, the two joins most probably appear redundant - which they are.  If we wanted to use just one JOIN for collection loading as well as ordering, we use the <a class="reference internal" href="#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> option, described in <a class="reference internal" href="#contains-eager"><span class="std std-ref">将显式连接/语句路由到预加载的集合</span></a> below.   But to see why <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> does what it does, consider if we were <strong>filtering</strong> on a particular <code class="docutils literal notranslate"><span class="pre">Address</span></code>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User)</span>
<span class="go">...     .join(User.addresses)</span>
<span class="go">...     .options(joinedload(User.addresses))</span>
<span class="go">...     .filter(User.name == &quot;spongebob&quot;)</span>
<span class="go">...     .filter(Address.email_address == &quot;someaddress@foo.com&quot;)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_email_address</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1_user_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">fullname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_fullname</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">nickname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_nickname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">addresses</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">addresses</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_1</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses_1</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[</span><span class="s1">&#39;spongebob&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;someaddress@foo.com&#39;</span><span class="p">]</span>
</div></pre></div>
</div>
<p>Above, we can see that the two JOINs have very different roles.  One will match exactly one row, that of the join of <code class="docutils literal notranslate"><span class="pre">User</span></code> and <code class="docutils literal notranslate"><span class="pre">Address</span></code> where <code class="docutils literal notranslate"><span class="pre">Address.email_address=='someaddress&#64;foo.com'</span></code>. The other LEFT OUTER JOIN will match <em>all</em> <code class="docutils literal notranslate"><span class="pre">Address</span></code> rows related to <code class="docutils literal notranslate"><span class="pre">User</span></code>, and is only used to populate the <code class="docutils literal notranslate"><span class="pre">User.addresses</span></code> collection, for those <code class="docutils literal notranslate"><span class="pre">User</span></code> objects that are returned.</p>
<p>By changing the usage of <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> to another style of loading, we can change how the collection is loaded completely independently of SQL used to retrieve the actual <code class="docutils literal notranslate"><span class="pre">User</span></code> rows we want.  Below we change <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> into <a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User)</span>
<span class="go">...     .join(User.addresses)</span>
<span class="go">...     .options(selectinload(User.addresses))</span>
<span class="go">...     .filter(User.name == &quot;spongebob&quot;)</span>
<span class="go">...     .filter(Address.email_address == &quot;someaddress@foo.com&quot;)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">fullname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_fullname</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">nickname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_nickname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">addresses</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[</span><span class="s1">&#39;spongebob&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;someaddress@foo.com&#39;</span><span class="p">]</span>
<span class="o">#</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="n">selectinload</span><span class="p">()</span><span class="w"> </span><span class="n">emits</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">order</span>
<span class="o">#</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">load</span><span class="w"> </span><span class="k">all</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="n">records</span><span class="w"> </span><span class="p">...</span>
</div></pre></div>
</div>
<p>When using joined eager loading, if the query contains a modifier that impacts the rows returned externally to the joins, such as when using DISTINCT, LIMIT, OFFSET or equivalent, the completed statement is first wrapped inside a subquery, and the joins used specifically for joined eager loading are applied to the subquery.   SQLAlchemy’s joined eager loading goes the extra mile, and then ten miles further, to absolutely ensure that it does not affect the end result of the query, only the way collections and related objects are loaded, no matter what the format of the query is.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#contains-eager"><span class="std std-ref">将显式连接/语句路由到预加载的集合</span></a> - using <a class="reference internal" href="#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a></p>
</div>
</div>
</div>
</section>
</section>
<section id="in">
<span id="selectin-eager-loading"></span><h2>选择 IN 加载<a class="headerlink" href="#in" title="Link to this heading">¶</a></h2>
<p>Select IN loading</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--10-input--1" name="tab-set--10" type="radio"><label class="tab-label" for="tab-set--10-input--1">中文</label><div class="tab-content docutils container">
<p>在大多数情况下，选择 IN 加载是急加载对象集合的最简单和高效的方式。选择 IN 急加载不可行的唯一情况是，当模型使用复合主键，并且后端数据库不支持使用 IN 的元组时，目前包括 SQL Server 在内的数据库就不支持此功能。</p>
<p>“Select IN” 急加载通过向 <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship.params.lazy" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.lazy</span></code></a> 传递 <code class="docutils literal notranslate"><span class="pre">&quot;selectin&quot;</span></code> 参数或使用 <a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> 加载器选项来提供。这种加载方式会发出一个 SELECT 语句，引用父对象的主键值，或者在多对一关系的情况下，引用子对象的主键值，放入 IN 子句中，以加载相关的关联对象：</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">selectinload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User)</span>
<span class="go">...     .options(selectinload(User.addresses))</span>
<span class="go">...     .filter(or_(User.name == &quot;spongebob&quot;, User.name == &quot;ed&quot;))</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">fullname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_fullname</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">nickname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_nickname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">(</span><span class="s1">&#39;spongebob&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ed&#39;</span><span class="p">)</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_email_address</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_user_id</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">addresses</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">)</span>
<span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span>
</div></pre></div>
</div>
<p>上面，第二个 SELECT 语句引用了 <code class="docutils literal notranslate"><span class="pre">addresses.user_id</span> <span class="pre">IN</span> <span class="pre">(5,</span> <span class="pre">7)</span></code> ，其中的 “5” 和 “7” 是之前加载的两个 <code class="docutils literal notranslate"><span class="pre">User</span></code> 对象的主键值；在一批对象完全加载后，它们的主键值被注入到第二个 SELECT 的 <code class="docutils literal notranslate"><span class="pre">IN</span></code> 子句中。由于 <code class="docutils literal notranslate"><span class="pre">User</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Address</span></code> 之间的关系具有简单的主连接条件，并且 <code class="docutils literal notranslate"><span class="pre">User</span></code> 的主键值可以从 <code class="docutils literal notranslate"><span class="pre">Address.user_id</span></code> 中派生，因此语句中没有任何连接或子查询。</p>
<p>对于简单的多对一加载，也不需要 JOIN，因为使用了父对象的外键值：</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">selectinload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Address</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">selectinload</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">user</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_email_address</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_user_id</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">addresses</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">fullname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_fullname</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">nickname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_nickname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</div></pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>这里的 “简单” 指的是 <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship.params.primaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.primaryjoin</span></code></a> 条件表示 “一” 方主键与 “多” 方的外键之间的等值比较，没有其他附加的条件。</p>
</div>
<p>选择 IN 加载也支持多对多关系，目前它会连接三个表，匹配两边的行。</p>
<p>关于这种加载方式，需要注意的几点包括：</p>
<ul class="simple">
<li><p>该策略会为最多 500 个父主键值发出一个 SELECT 语句，因为主键被渲染到 SQL 语句中的一个大的 IN 表达式中。一些数据库（如 Oracle 数据库）对 IN 表达式的大小有硬性限制，总的来说，SQL 字符串的大小不应过大。</p></li>
<li><p>由于 “selectin” 加载依赖于 IN，因此对于使用复合主键的映射，它必须使用 IN 的 “元组” 形式，即 <code class="docutils literal notranslate"><span class="pre">WHERE</span> <span class="pre">(table.column_a,</span> <span class="pre">table.column_b)</span> <span class="pre">IN</span> <span class="pre">((?,</span> <span class="pre">?),</span> <span class="pre">(?,</span> <span class="pre">?),</span> <span class="pre">(?,</span> <span class="pre">?))</span></code>。SQL Server 当前不支持这种语法，而 SQLite 至少需要版本 3.15 才能支持。SQLAlchemy 并没有特殊逻辑来提前检查哪些平台支持此语法；如果在不支持的平台上运行，数据库会立即返回错误。SQLAlchemy 直接执行 SQL 并让其失败的一个优点是，如果某个数据库开始支持此语法，它将无需对 SQLAlchemy 进行任何更改（正如 SQLite 的情况一样）。</p></li>
</ul>
</div>
<input class="tab-input" id="tab-set--10-input--2" name="tab-set--10" type="radio"><label class="tab-label" for="tab-set--10-input--2">英文</label><div class="tab-content docutils container">
<p>In most cases, selectin loading is the most simple and efficient way to eagerly load collections of objects.  The only scenario in which selectin eager loading is not feasible is when the model is using composite primary keys, and the backend database does not support tuples with IN, which currently includes SQL Server.</p>
<p>“Select IN” eager loading is provided using the <code class="docutils literal notranslate"><span class="pre">&quot;selectin&quot;</span></code> argument to <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship.params.lazy" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.lazy</span></code></a> or by using the <a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> loader option.   This style of loading emits a SELECT that refers to the primary key values of the parent object, or in the case of a many-to-one relationship to the those of the child objects, inside of an IN clause, in order to load related associations:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">selectinload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User)</span>
<span class="go">...     .options(selectinload(User.addresses))</span>
<span class="go">...     .filter(or_(User.name == &quot;spongebob&quot;, User.name == &quot;ed&quot;))</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">fullname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_fullname</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">nickname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_nickname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">(</span><span class="s1">&#39;spongebob&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ed&#39;</span><span class="p">)</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_email_address</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_user_id</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">addresses</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">)</span>
<span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span>
</div></pre></div>
</div>
<p>Above, the second SELECT refers to <code class="docutils literal notranslate"><span class="pre">addresses.user_id</span> <span class="pre">IN</span> <span class="pre">(5,</span> <span class="pre">7)</span></code>, where the “5” and “7” are the primary key values for the previous two <code class="docutils literal notranslate"><span class="pre">User</span></code> objects loaded; after a batch of objects are completely loaded, their primary key values are injected into the <code class="docutils literal notranslate"><span class="pre">IN</span></code> clause for the second SELECT. Because the relationship between <code class="docutils literal notranslate"><span class="pre">User</span></code> and <code class="docutils literal notranslate"><span class="pre">Address</span></code> has a simple primary join condition and provides that the primary key values for <code class="docutils literal notranslate"><span class="pre">User</span></code> can be derived from <code class="docutils literal notranslate"><span class="pre">Address.user_id</span></code>, the statement has no joins or subqueries at all.</p>
<p>For simple many-to-one loads, a JOIN is also not needed as the foreign key value from the parent object is used:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">selectinload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Address</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">selectinload</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">user</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_email_address</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_user_id</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">addresses</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">fullname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_fullname</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">nickname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_nickname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</div></pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>by “simple” we mean that the <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship.params.primaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.primaryjoin</span></code></a> condition expresses an equality comparison between the primary key of the “one” side and a straight foreign key of the “many” side, without any additional criteria.</p>
</div>
<p>Select IN loading also supports many-to-many relationships, where it currently will JOIN across all three tables to match rows from one side to the other.</p>
<p>Things to know about this kind of loading include:</p>
<ul class="simple">
<li><p>The strategy emits a SELECT for up to 500 parent primary key values at a time, as the primary keys are rendered into a large IN expression in the SQL statement.  Some databases like Oracle Database have a hard limit on how large an IN expression can be, and overall the size of the SQL string shouldn’t be arbitrarily large.</p></li>
<li><p>As “selectin” loading relies upon IN, for a mapping with composite primary keys, it must use the “tuple” form of IN, which looks like <code class="docutils literal notranslate"><span class="pre">WHERE</span> <span class="pre">(table.column_a,</span> <span class="pre">table.column_b)</span> <span class="pre">IN</span> <span class="pre">((?,</span> <span class="pre">?),</span> <span class="pre">(?,</span> <span class="pre">?),</span> <span class="pre">(?,</span> <span class="pre">?))</span></code>. This syntax is not currently supported on SQL Server and for SQLite requires at least version 3.15.  There is no special logic in SQLAlchemy to check ahead of time which platforms support this syntax or not; if run against a non-supporting platform, the database will return an error immediately.   An advantage to SQLAlchemy just running the SQL out for it to fail is that if a particular database does start supporting this syntax, it will work without any changes to SQLAlchemy (as was the case with SQLite).</p></li>
</ul>
</div>
</div>
</section>
<section id="subquery-eager-loading">
<span id="id9"></span><h2>子查询预/急加载<a class="headerlink" href="#subquery-eager-loading" title="Link to this heading">¶</a></h2>
<p>Subquery Eager Loading</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--11-input--1" name="tab-set--11" type="radio"><label class="tab-label" for="tab-set--11-input--1">中文</label><div class="tab-content docutils container">
<div class="admonition legacy">
<p class="admonition-title">Legacy Feature</p>
<p><a class="reference internal" href="#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a> 急加载器目前大多已经过时，已经被 <a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> 策略取代，后者设计更加简洁，功能更灵活，支持如 <a class="reference internal" href="api.html#orm-queryguide-yield-per"><span class="std std-ref">Yield Per</span></a> 等特性，并且在大多数情况下发出的 SQL 语句更为高效。由于 <a class="reference internal" href="#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a> 依赖于重新解释原始的 SELECT 语句，因此在处理非常复杂的源查询时，它可能无法高效地工作。</p>
<p><a class="reference internal" href="#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a> 仍然可能对于某些特定场景有用，尤其是在急加载包含复合主键的集合对象时，特别是在 Microsoft SQL Server 后端，后者目前仍不支持 “tuple IN” 语法。</p>
</div>
<p>子查询加载与选择 IN 急加载相似，然而发出的 SELECT 语句是从原始语句派生的，其查询结构比选择 IN 急加载更复杂。</p>
<p>子查询急加载通过向 <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship.params.lazy" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.lazy</span></code></a> 传递 <code class="docutils literal notranslate"><span class="pre">&quot;subquery&quot;</span></code> 参数或使用 <a class="reference internal" href="#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a> 加载器选项来提供。</p>
<p>子查询急加载的操作是针对每个要加载的关系发出一个第二个 SELECT 语句，这个 SELECT 语句涉及所有结果对象一次性加载。此 SELECT 语句引用了原始的 SELECT 语句，原始查询被包装在一个子查询中，以便我们检索到主对象返回的主键列表，然后将其与所有集合成员链接，以一次性加载它们：</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">subqueryload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">subqueryload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">))</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;spongebob&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">fullname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_fullname</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">nickname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_nickname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">(</span><span class="s1">&#39;spongebob&#39;</span><span class="p">,)</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_email_address</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_user_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">anon_1</span><span class="p">.</span><span class="n">users_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">anon_1_users_id</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">anon_1</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">addresses</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">anon_1</span><span class="p">.</span><span class="n">users_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">anon_1</span><span class="p">.</span><span class="n">users_id</span><span class="p">,</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">id</span>
<span class="p">(</span><span class="s1">&#39;spongebob&#39;</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>关于这种加载方式需要了解的几点包括：</p>
<ul>
<li><p>“subquery” 加载策略发出的 SELECT 语句，与 “selectin” 不同，需要使用子查询，并且会继承原始查询中存在的性能限制。子查询本身也可能会因为使用的数据库具体情况而产生性能问题。</p></li>
<li><p>“subquery” 加载要求一些特殊的排序规则才能正确工作。使用 <a class="reference internal" href="#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a> 并且查询包含限制性修饰符（如 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.limit" title="sqlalchemy.sql.expression.Select.limit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.limit()</span></code></a> 或 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.offset" title="sqlalchemy.sql.expression.Select.offset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.offset()</span></code></a>）时， <strong>应始终</strong> 使用 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.order_by" title="sqlalchemy.sql.expression.Select.order_by"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.order_by()</span></code></a> 对唯一的列（例如主键）进行排序，以确保 <a class="reference internal" href="#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a> 发出的附加查询与父查询使用相同的排序。否则，内查询可能返回错误的行：</p>
<blockquote>
<div><p># 错误，没有 ORDER BY
stmt = select(User).options(subqueryload(User.addresses).limit(1))</p>
<p># 错误，如果 User.name 不是唯一的
stmt = select(User).options(subqueryload(User.addresses)).order_by(User.name).limit(1)</p>
<p># 正确
stmt = (</p>
<blockquote>
<div><p>select(User)
.options(subqueryload(User.addresses))
.order_by(User.name, User.id)
.limit(1)</p>
</div></blockquote>
<p>)</p>
</div></blockquote>
</li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../../faq/ormconfiguration.html#faq-subqueryload-limit-sort"><span class="std std-ref">为什么建议将 ORDER BY 与 LIMIT 一起使用（尤其是与 subqueryload() 一起使用）？</span></a> - 详细示例</p>
</div>
<ul class="simple">
<li><p>“subquery” 加载在用于多层次深度的急加载时会遇到额外的性能/复杂性问题，因为子查询会被重复嵌套。</p></li>
<li><p>“subquery” 加载与 <a class="reference internal" href="api.html#orm-queryguide-yield-per"><span class="std std-ref">Yield Per</span></a> 提供的 “批处理” 加载不兼容，无论是对于集合关系还是标量关系。</p></li>
</ul>
<p>由于以上原因，应该优先选择 “selectin” 策略，而不是 “subquery”。</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#selectin-eager-loading"><span class="std std-ref">选择 IN 加载</span></a></p>
</div>
</div>
<input class="tab-input" id="tab-set--11-input--2" name="tab-set--11" type="radio"><label class="tab-label" for="tab-set--11-input--2">英文</label><div class="tab-content docutils container">
<div class="admonition legacy">
<p class="admonition-title">Legacy Feature</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a> eager loader is mostly legacy at this point, superseded by the <a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> strategy which is of much simpler design, more flexible with features such as <a class="reference internal" href="api.html#orm-queryguide-yield-per"><span class="std std-ref">Yield Per</span></a>, and emits more efficient SQL statements in most cases.   As <a class="reference internal" href="#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a> relies upon re-interpreting the original SELECT statement, it may fail to work efficiently when given very complex source queries.</p>
<p><a class="reference internal" href="#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a> may continue to be useful for the specific case of an eager loaded collection for objects that use composite primary keys, on the Microsoft SQL Server backend that continues to not have support for the “tuple IN” syntax.</p>
</div>
<p>Subquery loading is similar in operation to selectin eager loading, however the SELECT statement which is emitted is derived from the original statement, and has a more complex query structure as that of selectin eager loading.</p>
<p>Subquery eager loading is provided using the <code class="docutils literal notranslate"><span class="pre">&quot;subquery&quot;</span></code> argument to <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship.params.lazy" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.lazy</span></code></a> or by using the <a class="reference internal" href="#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a> loader option.</p>
<p>The operation of subquery eager loading is to emit a second SELECT statement for each relationship to be loaded, across all result objects at once. This SELECT statement refers to the original SELECT statement, wrapped inside of a subquery, so that we retrieve the same list of primary keys for the primary object being returned, then link that to the sum of all the collection members to load them at once:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">subqueryload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">subqueryload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">))</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;spongebob&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">fullname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_fullname</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">nickname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_nickname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">(</span><span class="s1">&#39;spongebob&#39;</span><span class="p">,)</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_email_address</span><span class="p">,</span>
<span class="w">    </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">addresses_user_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">anon_1</span><span class="p">.</span><span class="n">users_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">anon_1_users_id</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_id</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">anon_1</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">addresses</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">anon_1</span><span class="p">.</span><span class="n">users_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">anon_1</span><span class="p">.</span><span class="n">users_id</span><span class="p">,</span><span class="w"> </span><span class="n">addresses</span><span class="p">.</span><span class="n">id</span>
<span class="p">(</span><span class="s1">&#39;spongebob&#39;</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>Things to know about this kind of loading include:</p>
<ul>
<li><p>The SELECT statement emitted by the “subquery” loader strategy, unlike that of “selectin”, requires a subquery, and will inherit whatever performance limitations are present in the original query.  The subquery itself may also incur performance penalties based on the specifics of the database in use.</p></li>
<li><p>“subquery” loading imposes some special ordering requirements in order to work correctly.  A query which makes use of <a class="reference internal" href="#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a> in conjunction with a limiting modifier such as <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.limit" title="sqlalchemy.sql.expression.Select.limit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.limit()</span></code></a>, or <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.offset" title="sqlalchemy.sql.expression.Select.offset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.offset()</span></code></a> should <strong>always</strong> include <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.order_by" title="sqlalchemy.sql.expression.Select.order_by"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.order_by()</span></code></a> against unique column(s) such as the primary key, so that the additional queries emitted by <a class="reference internal" href="#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a> include the same ordering as used by the parent query.  Without it, there is a chance that the inner query could return the wrong rows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># incorrect, no ORDER BY</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">subqueryload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># incorrect if User.name is not unique</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">subqueryload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">))</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># correct</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">subqueryload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">))</span>
    <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
</li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../../faq/ormconfiguration.html#faq-subqueryload-limit-sort"><span class="std std-ref">为什么建议将 ORDER BY 与 LIMIT 一起使用（尤其是与 subqueryload() 一起使用）？</span></a> - detailed example</p>
</div>
<ul class="simple">
<li><p>“subquery” loading also incurs additional performance / complexity issues when used on a many-levels-deep eager load, as subqueries will be nested repeatedly.</p></li>
<li><p>“subquery” loading is not compatible with the “batched” loading supplied by <a class="reference internal" href="api.html#orm-queryguide-yield-per"><span class="std std-ref">Yield Per</span></a>, both for collection and scalar relationships.</p></li>
</ul>
<p>For the above reasons, the “selectin” strategy should be preferred over “subquery”.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#selectin-eager-loading"><span class="std std-ref">选择 IN 加载</span></a></p>
</div>
</div>
</div>
</section>
<section id="what-kind-of-loading">
<span id="id10"></span><h2>使用哪种加载？<a class="headerlink" href="#what-kind-of-loading" title="Link to this heading">¶</a></h2>
<p>What Kind of Loading to Use ?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--12-input--1" name="tab-set--12" type="radio"><label class="tab-label" for="tab-set--12-input--1">中文</label><div class="tab-content docutils container">
<p>通常，选择使用哪种加载方式取决于优化 SQL 执行次数、SQL 复杂度和获取数据量之间的权衡。</p>
<p><strong>一对多 / 多对多 集合</strong> - <a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> 通常是最佳的加载策略。它发出一个额外的 SELECT 语句，尽量减少使用的表数，保持原始语句不受影响，并且对任何类型的源查询都非常灵活。它的主要限制是在使用复合主键的表时，后端不支持 “tuple IN” 语法，当前包括 SQL Server 和非常旧的 SQLite 版本；所有其他支持的后端都支持该语法。</p>
<p><strong>多对一</strong> - <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> 策略是最通用的策略。在特殊情况下，如果相关值的数量非常少，<a class="reference internal" href="#sqlalchemy.orm.immediateload" title="sqlalchemy.orm.immediateload"><code class="xref py py-func docutils literal notranslate"><span class="pre">immediateload()</span></code></a> 策略也可能有用，因为该策略会从本地 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 获取对象，而不发出任何 SQL 查询，前提是相关对象已经存在。</p>
</div>
<input class="tab-input" id="tab-set--12-input--2" name="tab-set--12" type="radio"><label class="tab-label" for="tab-set--12-input--2">英文</label><div class="tab-content docutils container">
<p>Which type of loading to use typically comes down to optimizing the tradeoff between number of SQL executions, complexity of SQL emitted, and amount of data fetched.</p>
<p><strong>One to Many / Many to Many Collection</strong> - The <a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> is generally the best loading strategy to use.  It emits an additional SELECT that uses as few tables as possible, leaving the original statement unaffected, and is most flexible for any kind of originating query.   Its only major limitation is when using a table with composite primary keys on a backend that does not support “tuple IN”, which currently includes SQL Server and very old SQLite versions; all other included backends support it.</p>
<p><strong>Many to One</strong> - The <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> strategy is the most general purpose strategy. In special cases, the <a class="reference internal" href="#sqlalchemy.orm.immediateload" title="sqlalchemy.orm.immediateload"><code class="xref py py-func docutils literal notranslate"><span class="pre">immediateload()</span></code></a> strategy may also be useful, if there are a very small number of potential related values, as this strategy will fetch the object from the local <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> without emitting any SQL if the related object is already present.</p>
</div>
</div>
</section>
<section id="id11">
<h2>多态预加载<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h2>
<p>Polymorphic Eager Loading</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--13-input--1" name="tab-set--13" type="radio"><label class="tab-label" for="tab-set--13-input--1">中文</label><div class="tab-content docutils container">
<p>可以按急加载的每个基础指定多态选项。有关此方法的示例，请参阅 <a class="reference internal" href="inheritance.html#eagerloading-polymorphic-subtypes"><span class="std std-ref">即时加载多态子类型</span></a> 部分，介绍了 <a class="reference internal" href="../internals.html#sqlalchemy.orm.PropComparator.of_type" title="sqlalchemy.orm.PropComparator.of_type"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PropComparator.of_type()</span></code></a> 方法与 <a class="reference internal" href="inheritance.html#sqlalchemy.orm.with_polymorphic" title="sqlalchemy.orm.with_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_polymorphic()</span></code></a> 函数的结合使用。</p>
</div>
<input class="tab-input" id="tab-set--13-input--2" name="tab-set--13" type="radio"><label class="tab-label" for="tab-set--13-input--2">英文</label><div class="tab-content docutils container">
<p>Specification of polymorphic options on a per-eager-load basis is supported. See the section <a class="reference internal" href="inheritance.html#eagerloading-polymorphic-subtypes"><span class="std std-ref">即时加载多态子类型</span></a> for examples of the <a class="reference internal" href="../internals.html#sqlalchemy.orm.PropComparator.of_type" title="sqlalchemy.orm.PropComparator.of_type"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PropComparator.of_type()</span></code></a> method in conjunction with the <a class="reference internal" href="inheritance.html#sqlalchemy.orm.with_polymorphic" title="sqlalchemy.orm.with_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_polymorphic()</span></code></a> function.</p>
</div>
</div>
</section>
<section id="wildcard-loader-strategies">
<span id="id12"></span><h2>通配符加载策略<a class="headerlink" href="#wildcard-loader-strategies" title="Link to this heading">¶</a></h2>
<p>Wildcard Loading Strategies</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--14-input--1" name="tab-set--14" type="radio"><label class="tab-label" for="tab-set--14-input--1">中文</label><div class="tab-content docutils container">
<p>每个 <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a>、<a class="reference internal" href="#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a>、<a class="reference internal" href="#sqlalchemy.orm.lazyload" title="sqlalchemy.orm.lazyload"><code class="xref py py-func docutils literal notranslate"><span class="pre">lazyload()</span></code></a>、<a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> 和 <a class="reference internal" href="#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal notranslate"><span class="pre">raiseload()</span></code></a> 都可以用于设置特定查询的默认 <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> 加载样式，影响所有未在语句中另行指定的 <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> 映射属性。可以通过将字符串 <code class="docutils literal notranslate"><span class="pre">'*'</span></code> 作为参数传递给这些选项来启用此功能：</p>
<blockquote>
<div><p>from sqlalchemy import select
from sqlalchemy.orm import lazyload</p>
<p>stmt = select(MyClass).options(lazyload(“*”))</p>
</div></blockquote>
<p>上述代码中的 <code class="docutils literal notranslate"><span class="pre">lazyload('*')</span></code> 选项将会覆盖查询中所有 <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> 构造的 <code class="docutils literal notranslate"><span class="pre">lazy</span></code> 设置，除非这些构造使用了 <code class="docutils literal notranslate"><span class="pre">lazy='write_only'</span></code> 或 <code class="docutils literal notranslate"><span class="pre">lazy='dynamic'</span></code>。</p>
<p>如果某些关系指定了 <code class="docutils literal notranslate"><span class="pre">lazy='joined'</span></code> 或 <code class="docutils literal notranslate"><span class="pre">lazy='selectin'</span></code>，例如，使用 <code class="docutils literal notranslate"><span class="pre">lazyload('*')</span></code> 会强制所有这些关系使用 <code class="docutils literal notranslate"><span class="pre">'select'</span></code> 加载，即当每个属性被访问时发出一个 SELECT 语句。</p>
<p>此选项不会覆盖查询中声明的加载器选项，如 <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a>、<a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> 等。下面的查询仍然会对 <code class="docutils literal notranslate"><span class="pre">widget</span></code> 关系使用连接加载（joined loading）：</p>
<blockquote>
<div><p>from sqlalchemy import select
from sqlalchemy.orm import lazyload
from sqlalchemy.orm import joinedload</p>
<p>stmt = select(MyClass).options(lazyload(“*”), joinedload(MyClass.widget))</p>
</div></blockquote>
<p>虽然上述对 <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> 的指令无论是在 <a class="reference internal" href="#sqlalchemy.orm.lazyload" title="sqlalchemy.orm.lazyload"><code class="xref py py-func docutils literal notranslate"><span class="pre">lazyload()</span></code></a> 选项之前还是之后出现，都会生效，但如果多个选项中都包含了 <code class="docutils literal notranslate"><span class="pre">&quot;*&quot;</span></code>，则最后一个选项将生效。</p>
</div>
<input class="tab-input" id="tab-set--14-input--2" name="tab-set--14" type="radio"><label class="tab-label" for="tab-set--14-input--2">英文</label><div class="tab-content docutils container">
<p>Each of <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a>, <a class="reference internal" href="#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a>, <a class="reference internal" href="#sqlalchemy.orm.lazyload" title="sqlalchemy.orm.lazyload"><code class="xref py py-func docutils literal notranslate"><span class="pre">lazyload()</span></code></a>, <a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a>, and <a class="reference internal" href="#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal notranslate"><span class="pre">raiseload()</span></code></a> can be used to set the default style of <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> loading for a particular query, affecting all <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> -mapped attributes not otherwise specified in the statement.   This feature is available by passing the string <code class="docutils literal notranslate"><span class="pre">'*'</span></code> as the argument to any of these options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">lazyload</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">MyClass</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">lazyload</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">))</span></pre></div>
</div>
<p>Above, the <code class="docutils literal notranslate"><span class="pre">lazyload('*')</span></code> option will supersede the <code class="docutils literal notranslate"><span class="pre">lazy</span></code> setting of all <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> constructs in use for that query, with the exception of those that use <code class="docutils literal notranslate"><span class="pre">lazy='write_only'</span></code> or <code class="docutils literal notranslate"><span class="pre">lazy='dynamic'</span></code>.</p>
<p>If some relationships specify <code class="docutils literal notranslate"><span class="pre">lazy='joined'</span></code> or <code class="docutils literal notranslate"><span class="pre">lazy='selectin'</span></code>, for example, using <code class="docutils literal notranslate"><span class="pre">lazyload('*')</span></code> will unilaterally cause all those relationships to use <code class="docutils literal notranslate"><span class="pre">'select'</span></code> loading, e.g. emit a SELECT statement when each attribute is accessed.</p>
<p>The option does not supersede loader options stated in the query, such as <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a>, <a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a>, etc.  The query below will still use joined loading for the <code class="docutils literal notranslate"><span class="pre">widget</span></code> relationship:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">lazyload</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">joinedload</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">MyClass</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">lazyload</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">),</span> <span class="n">joinedload</span><span class="p">(</span><span class="n">MyClass</span><span class="o">.</span><span class="n">widget</span><span class="p">))</span></pre></div>
</div>
<p>While the instruction for <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> above will take place regardless of whether it appears before or after the <a class="reference internal" href="#sqlalchemy.orm.lazyload" title="sqlalchemy.orm.lazyload"><code class="xref py py-func docutils literal notranslate"><span class="pre">lazyload()</span></code></a> option, if multiple options that each included <code class="docutils literal notranslate"><span class="pre">&quot;*&quot;</span></code> were passed, the last one will take effect.</p>
</div>
</div>
<section id="orm-queryguide-relationship-per-entity-wildcard">
<span id="id13"></span><h3>每个实体通配符加载策略<a class="headerlink" href="#orm-queryguide-relationship-per-entity-wildcard" title="Link to this heading">¶</a></h3>
<p>Per-Entity Wildcard Loading Strategies</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--15-input--1" name="tab-set--15" type="radio"><label class="tab-label" for="tab-set--15-input--1">中文</label><div class="tab-content docutils container">
<p>通配符加载策略的一个变种是能够在每个实体基础上设置加载策略。例如，如果查询 <code class="docutils literal notranslate"><span class="pre">User</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Address</span></code>，我们可以通过首先应用 <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> 对象，然后指定 <code class="docutils literal notranslate"><span class="pre">*</span></code> 作为链式选项，来指示 <code class="docutils literal notranslate"><span class="pre">Address</span></code> 上的所有关系使用懒加载，同时不影响 <code class="docutils literal notranslate"><span class="pre">User</span></code> 的加载策略：</p>
<blockquote>
<div><p>from sqlalchemy import select
from sqlalchemy.orm import Load</p>
<p>stmt = select(User, Address).options(Load(Address).lazyload(“*”))</p>
</div></blockquote>
<p>上述代码中，<code class="docutils literal notranslate"><span class="pre">Address</span></code> 上的所有关系将被设置为懒加载。</p>
</div>
<input class="tab-input" id="tab-set--15-input--2" name="tab-set--15" type="radio"><label class="tab-label" for="tab-set--15-input--2">英文</label><div class="tab-content docutils container">
<p>A variant of the wildcard loader strategy is the ability to set the strategy on a per-entity basis.  For example, if querying for <code class="docutils literal notranslate"><span class="pre">User</span></code> and <code class="docutils literal notranslate"><span class="pre">Address</span></code>, we can instruct all relationships on <code class="docutils literal notranslate"><span class="pre">Address</span></code> to use lazy loading, while leaving the loader strategies for <code class="docutils literal notranslate"><span class="pre">User</span></code> unaffected, by first applying the <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> object, then specifying the <code class="docutils literal notranslate"><span class="pre">*</span></code> as a chained option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Load</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Address</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">Load</span><span class="p">(</span><span class="n">Address</span><span class="p">)</span><span class="o">.</span><span class="n">lazyload</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">))</span></pre></div>
</div>
<p>Above, all relationships on <code class="docutils literal notranslate"><span class="pre">Address</span></code> will be set to a lazy load.</p>
</div>
</div>
</section>
</section>
<section id="contains-eager">
<span id="joinedload-and-join"></span><span id="id14"></span><h2>将显式连接/语句路由到预加载的集合<a class="headerlink" href="#contains-eager" title="Link to this heading">¶</a></h2>
<p>Routing Explicit Joins/Statements into Eagerly Loaded Collections</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--16-input--1" name="tab-set--16" type="radio"><label class="tab-label" for="tab-set--16-input--1">中文</label><div class="tab-content docutils container">
<p><a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> 的行为是自动创建连接，使用匿名别名作为目标，结果会被路由到加载对象的集合和标量引用中。通常情况下，查询已经包含了表示特定集合或标量引用的必要连接，而 <code class="docutils literal notranslate"><span class="pre">joinedload</span></code> 特性所添加的连接是多余的——但你仍然希望这些集合/引用被填充。</p>
<p>为此，SQLAlchemy 提供了 <a class="reference internal" href="#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> 选项。该选项的使用方式与 <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> 相同，只不过它假定 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> 对象将显式地包含适当的连接，通常使用类似 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.join" title="sqlalchemy.sql.expression.Select.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join()</span></code></a> 的方法。下面，我们指定了 <code class="docutils literal notranslate"><span class="pre">User</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Address</span></code> 之间的连接，并额外将其作为 <code class="docutils literal notranslate"><span class="pre">User.addresses</span></code> 的急加载基础：</p>
<blockquote>
<div><p>from sqlalchemy.orm import contains_eager</p>
<p>stmt = select(User).join(User.addresses).options(contains_eager(User.addresses))</p>
</div></blockquote>
<p>如果 “急加载” 部分的语句是 “别名” 的，那么路径应该使用 <a class="reference internal" href="../internals.html#sqlalchemy.orm.PropComparator.of_type" title="sqlalchemy.orm.PropComparator.of_type"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PropComparator.of_type()</span></code></a> 来指定，这样就可以传递具体的 <a class="reference internal" href="api.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a> 构造：</p>
<div class="highlight-python+sql notranslate"><div class="highlight"><pre><span></span><span class="c1"># 使用 Address 实体的别名</span>
<span class="n">adalias</span> <span class="o">=</span> <span class="n">aliased</span><span class="p">(</span><span class="n">Address</span><span class="p">)</span>

<span class="c1"># 构建一个预期 &quot;addresses&quot; 结果的语句</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="o">.</span><span class="n">outerjoin</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">adalias</span><span class="p">))</span>
    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">contains_eager</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">adalias</span><span class="p">)))</span>
<span class="p">)</span>

<span class="c1"># 正常获取结果</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_user_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">user_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_user_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">adalias</span><span class="p">.</span><span class="n">address_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">adalias_address_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">adalias</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">adalias_user_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">adalias</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">adalias_email_address</span><span class="p">,</span>
<span class="w">    </span><span class="p">(...</span><span class="err">其他列</span><span class="p">...)</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">email_addresses</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">email_addresses_1</span>
<span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">email_addresses_1</span><span class="p">.</span><span class="n">user_id</span>
</div></pre></div>
</div>
<p>作为 <a class="reference internal" href="#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> 参数传递的路径需要是从起始实体开始的完整路径。例如，如果我们正在加载 <code class="docutils literal notranslate"><span class="pre">Users-&gt;orders-&gt;Order-&gt;items-&gt;Item</span></code>，则该选项的使用方式如下：</p>
<blockquote>
<div><p>stmt = select(User).options(contains_eager(User.orders).contains_eager(Order.items))</p>
</div></blockquote>
</div>
<input class="tab-input" id="tab-set--16-input--2" name="tab-set--16" type="radio"><label class="tab-label" for="tab-set--16-input--2">英文</label><div class="tab-content docutils container">
<p>The behavior of <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> is such that joins are created automatically, using anonymous aliases as targets, the results of which are routed into collections and scalar references on loaded objects. It is often the case that a query already includes the necessary joins which represent a particular collection or scalar reference, and the joins added by the joinedload feature are redundant - yet you’d still like the collections/references to be populated.</p>
<p>For this SQLAlchemy supplies the <a class="reference internal" href="#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> option. This option is used in the same manner as the <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> option except it is assumed that the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> object will explicitly include the appropriate joins, typically using methods like <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.join" title="sqlalchemy.sql.expression.Select.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join()</span></code></a>. Below, we specify a join between <code class="docutils literal notranslate"><span class="pre">User</span></code> and <code class="docutils literal notranslate"><span class="pre">Address</span></code> and additionally establish this as the basis for eager loading of <code class="docutils literal notranslate"><span class="pre">User.addresses</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">contains_eager</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">contains_eager</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">))</span></pre></div>
</div>
<p>If the “eager” portion of the statement is “aliased”, the path should be specified using <a class="reference internal" href="../internals.html#sqlalchemy.orm.PropComparator.of_type" title="sqlalchemy.orm.PropComparator.of_type"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PropComparator.of_type()</span></code></a>, which allows the specific <a class="reference internal" href="api.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a> construct to be passed:</p>
<div class="highlight-python+sql notranslate"><div class="highlight"><pre><span></span><span class="c1"># use an alias of the Address entity</span>
<span class="n">adalias</span> <span class="o">=</span> <span class="n">aliased</span><span class="p">(</span><span class="n">Address</span><span class="p">)</span>

<span class="c1"># construct a statement which expects the &quot;addresses&quot; results</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="o">.</span><span class="n">outerjoin</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">adalias</span><span class="p">))</span>
    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">contains_eager</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">adalias</span><span class="p">)))</span>
<span class="p">)</span>

<span class="c1"># get results normally</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_user_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">user_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">users_user_name</span><span class="p">,</span>
<span class="w">    </span><span class="n">adalias</span><span class="p">.</span><span class="n">address_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">adalias_address_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">adalias</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">adalias_user_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">adalias</span><span class="p">.</span><span class="n">email_address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">adalias_email_address</span><span class="p">,</span>
<span class="w">    </span><span class="p">(...</span><span class="n">other</span><span class="w"> </span><span class="n">columns</span><span class="p">...)</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">email_addresses</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">email_addresses_1</span>
<span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">email_addresses_1</span><span class="p">.</span><span class="n">user_id</span>
</div></pre></div>
</div>
<p>The path given as the argument to <a class="reference internal" href="#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> needs to be a full path from the starting entity. For example if we were loading <code class="docutils literal notranslate"><span class="pre">Users-&gt;orders-&gt;Order-&gt;items-&gt;Item</span></code>, the option would be used as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">contains_eager</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">orders</span><span class="p">)</span><span class="o">.</span><span class="n">contains_eager</span><span class="p">(</span><span class="n">Order</span><span class="o">.</span><span class="n">items</span><span class="p">))</span></pre></div>
</div>
</div>
</div>
<section id="id15">
<h3>使用 contains_eager() 加载自定义过滤的集合结果<a class="headerlink" href="#id15" title="Link to this heading">¶</a></h3>
<p>Using contains_eager() to load a custom-filtered collection result</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--17-input--1" name="tab-set--17" type="radio"><label class="tab-label" for="tab-set--17-input--1">中文</label><div class="tab-content docutils container">
<p>当我们使用 <a class="reference internal" href="#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> 时， <em>我们</em> 自行构建用于填充集合的 SQL。由此自然可以推导出，我们可以选择 <strong>修改</strong> 集合预期存储的值，方法是编写 SQL 来加载集合或标量属性的子集。</p>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>SQLAlchemy 现在有一种 <strong>更简单的方式来做到这一点</strong>，通过允许将 WHERE 条件直接添加到加载器选项中，如 <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> 和 <a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a>，使用 <a class="reference internal" href="../internals.html#sqlalchemy.orm.PropComparator.and_" title="sqlalchemy.orm.PropComparator.and_"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PropComparator.and_()</span></code></a>。有关示例，请参见 <a class="reference internal" href="#loader-option-criteria"><span class="std std-ref">向加载器选项添加条件</span></a> 部分。</p>
<p>如果相关集合需要使用比简单 WHERE 子句更复杂的 SQL 条件或修饰符进行查询，那么这里描述的技术仍然适用。</p>
</div>
<p>例如，我们可以加载一个 <code class="docutils literal notranslate"><span class="pre">User</span></code> 对象，并仅将特定的地址急加载到它的 <code class="docutils literal notranslate"><span class="pre">.addresses</span></code> 集合中，通过过滤联接数据并使用 <a class="reference internal" href="#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> 路由，同时使用 <a class="reference internal" href="api.html#orm-queryguide-populate-existing"><span class="std std-ref">填充现有</span></a> 来确保任何已经加载的集合会被覆盖：</p>
<blockquote>
<div><dl class="simple">
<dt>stmt = (</dt><dd><p>select(User)
.join(User.addresses)
.filter(Address.email_address.like(”<a class="reference external" href="mailto:%&#37;&#52;&#48;aol&#46;com">%<span>&#64;</span>aol<span>&#46;</span>com</a>”))
.options(contains_eager(User.addresses))
.execution_options(populate_existing=True)</p>
</dd>
</dl>
<p>)</p>
</div></blockquote>
<p>上述查询将仅加载包含至少一个 <code class="docutils literal notranslate"><span class="pre">Address</span></code> 对象（该对象的 <code class="docutils literal notranslate"><span class="pre">email</span></code> 字段包含子字符串 <code class="docutils literal notranslate"><span class="pre">'aol.com'</span></code>）的 <code class="docutils literal notranslate"><span class="pre">User</span></code> 对象； <code class="docutils literal notranslate"><span class="pre">User.addresses</span></code> 集合将 <strong>仅</strong> 包含这些 <code class="docutils literal notranslate"><span class="pre">Address</span></code> 条目，而 <strong>不</strong> 包含实际上与集合关联的其他 <code class="docutils literal notranslate"><span class="pre">Address</span></code> 条目。</p>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>在所有情况下，SQLAlchemy ORM <strong>不会覆盖已加载的属性和集合</strong>，除非明确告诉它这么做。由于存在 <a class="reference internal" href="../../glossary.html#term-identity-map"><span class="xref std std-term">identity map</span></a>，通常情况下，ORM 查询返回的对象实际上已经存在并已加载到内存中。因此，在使用 <a class="reference internal" href="#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> 以替代方式填充集合时，通常最好使用 <a class="reference internal" href="api.html#orm-queryguide-populate-existing"><span class="std std-ref">填充现有</span></a>，如上所示，以便用新数据刷新已加载的集合。<code class="docutils literal notranslate"><span class="pre">populate_existing</span></code> 选项将重置 <strong>所有</strong> 已存在的属性，包括待处理的更改，因此在使用它之前，确保所有数据已刷新。使用默认行为的 <code class="xref py py-class docutils literal notranslate"><span class="pre">_orm.Session`（包括</span> <span class="pre">:ref:`autoflush</span></code>）已足够。</p>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>我们使用 <a class="reference internal" href="#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> 加载的自定义集合不是“粘性的”；也就是说，下次加载该集合时，它将使用其通常的默认内容。如果对象已过期（默认会话设置下，当调用 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.commit" title="sqlalchemy.orm.Session.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.commit()</span></code></a>、<a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.rollback" title="sqlalchemy.orm.Session.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.rollback()</span></code></a> 方法时，或者使用 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.expire_all" title="sqlalchemy.orm.Session.expire_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expire_all()</span></code></a> 或 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.expire" title="sqlalchemy.orm.Session.expire"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expire()</span></code></a> 方法时），该集合将被重新加载。</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#loader-option-criteria"><span class="std std-ref">向加载器选项添加条件</span></a> - 现代 API，允许直接在任何关系加载器选项中使用 WHERE 条件</p>
</div>
</div>
<input class="tab-input" id="tab-set--17-input--2" name="tab-set--17" type="radio"><label class="tab-label" for="tab-set--17-input--2">英文</label><div class="tab-content docutils container">
<p>When we use <a class="reference internal" href="#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a>, <em>we</em> are constructing ourselves the SQL that will be used to populate collections.  From this, it naturally follows that we can opt to <strong>modify</strong> what values the collection is intended to store, by writing our SQL to load a subset of elements for collections or scalar attributes.</p>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>SQLAlchemy now has a <strong>much simpler way to do this</strong>, by allowing WHERE criteria to be added directly to loader options such as <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> and <a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> using <a class="reference internal" href="../internals.html#sqlalchemy.orm.PropComparator.and_" title="sqlalchemy.orm.PropComparator.and_"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PropComparator.and_()</span></code></a>.  See the section <a class="reference internal" href="#loader-option-criteria"><span class="std std-ref">向加载器选项添加条件</span></a> for examples.</p>
<p>The techniques described here still apply if the related collection is to be queried using SQL criteria or modifiers more complex than a simple WHERE clause.</p>
</div>
<p>As an example, we can load a <code class="docutils literal notranslate"><span class="pre">User</span></code> object and eagerly load only particular addresses into its <code class="docutils literal notranslate"><span class="pre">.addresses</span></code> collection by filtering the joined data, routing it using <a class="reference internal" href="#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a>, also using <a class="reference internal" href="api.html#orm-queryguide-populate-existing"><span class="std std-ref">填充现有</span></a> to ensure any already-loaded collections are overwritten:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">)</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">email_address</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&quot;%@aol.com&quot;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">contains_eager</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">))</span>
    <span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">populate_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>The above query will load only <code class="docutils literal notranslate"><span class="pre">User</span></code> objects which contain at least <code class="docutils literal notranslate"><span class="pre">Address</span></code> object that contains the substring <code class="docutils literal notranslate"><span class="pre">'aol.com'</span></code> in its <code class="docutils literal notranslate"><span class="pre">email</span></code> field; the <code class="docutils literal notranslate"><span class="pre">User.addresses</span></code> collection will contain <strong>only</strong> these <code class="docutils literal notranslate"><span class="pre">Address</span></code> entries, and <em>not</em> any other <code class="docutils literal notranslate"><span class="pre">Address</span></code> entries that are in fact associated with the collection.</p>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>In all cases, the SQLAlchemy ORM does <strong>not overwrite already loaded attributes and collections</strong> unless told to do so.   As there is an <a class="reference internal" href="../../glossary.html#term-identity-map"><span class="xref std std-term">identity map</span></a> in use, it is often the case that an ORM query is returning objects that were in fact already present and loaded in memory. Therefore, when using <a class="reference internal" href="#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> to populate a collection in an alternate way, it is usually a good idea to use <a class="reference internal" href="api.html#orm-queryguide-populate-existing"><span class="std std-ref">填充现有</span></a> as illustrated above so that an already-loaded collection is refreshed with the new data. The <code class="docutils literal notranslate"><span class="pre">populate_existing</span></code> option will reset <strong>all</strong> attributes that were already present, including pending changes, so make sure all data is flushed before using it.   Using the <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> with its default behavior of <a class="reference internal" href="../session_basics.html#session-flushing"><span class="std std-ref">autoflush</span></a> is sufficient.</p>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>The customized collection we load using <a class="reference internal" href="#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> is not “sticky”; that is, the next time this collection is loaded, it will be loaded with its usual default contents.   The collection is subject to being reloaded if the object is expired, which occurs whenever the <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.commit" title="sqlalchemy.orm.Session.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.commit()</span></code></a>, <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.rollback" title="sqlalchemy.orm.Session.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.rollback()</span></code></a> methods are used assuming default session settings, or the <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.expire_all" title="sqlalchemy.orm.Session.expire_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expire_all()</span></code></a> or <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.expire" title="sqlalchemy.orm.Session.expire"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expire()</span></code></a> methods are used.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#loader-option-criteria"><span class="std std-ref">向加载器选项添加条件</span></a> - modern API allowing WHERE criteria directly within any relationship loader option</p>
</div>
</div>
</div>
</section>
</section>
<section id="api">
<h2>关系加载器 API<a class="headerlink" href="#api" title="Link to this heading">¶</a></h2>
<p>Relationship Loader API</p>
<div class="table-wrapper longtable docutils container">
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.contains_eager"><span class="sig-name descname">contains_eager</span></a>(*keys, **kw)</p></td>
<td><p>Indicate that the given attribute should be eagerly loaded from
columns stated manually in the query.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.defaultload"><span class="sig-name descname">defaultload</span></a>(*keys)</p></td>
<td><p>Indicate an attribute should load using its predefined loader style.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.immediateload"><span class="sig-name descname">immediateload</span></a>(*keys, [recursion_depth])</p></td>
<td><p>Indicate that the given attribute should be loaded using
an immediate load with a per-attribute SELECT statement.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.joinedload"><span class="sig-name descname">joinedload</span></a>(*keys, **kw)</p></td>
<td><p>Indicate that the given attribute should be loaded using joined
eager loading.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.lazyload"><span class="sig-name descname">lazyload</span></a>(*keys)</p></td>
<td><p>Indicate that the given attribute should be loaded using “lazy”
loading.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.Load"><span class="sig-name descname">Load</span></a></p></td>
<td><p>Represents loader options which modify the state of a
ORM-enabled <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> or a legacy <a class="reference internal" href="query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> in
order to affect how various mapped attributes are loaded.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.noload"><span class="sig-name descname">noload</span></a>(*keys)</p></td>
<td><p>Indicate that the given relationship attribute should remain
unloaded.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.raiseload"><span class="sig-name descname">raiseload</span></a>(*keys, **kw)</p></td>
<td><p>Indicate that the given attribute should raise an error if accessed.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.selectinload"><span class="sig-name descname">selectinload</span></a>(*keys, [recursion_depth])</p></td>
<td><p>Indicate that the given attribute should be loaded using
SELECT IN eager loading.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.subqueryload"><span class="sig-name descname">subqueryload</span></a>(*keys)</p></td>
<td><p>Indicate that the given attribute should be loaded using
subquery eager loading.</p></td>
</tr>
</tbody>
</table>
</div>
<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.contains_eager">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">contains_eager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">keys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_AbstractLoad</span></span></span><a class="headerlink" href="#sqlalchemy.orm.contains_eager" title="Link to this definition">¶</a></dt>
<dd><p>Indicate that the given attribute should be eagerly loaded from
columns stated manually in the query.</p>
<p>This function is part of the <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> interface and supports
both method-chained and standalone operation.</p>
<p>The option is used in conjunction with an explicit join that loads
the desired rows, i.e.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sess</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Order</span><span class="o">.</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">contains_eager</span><span class="p">(</span><span class="n">Order</span><span class="o">.</span><span class="n">user</span><span class="p">))</span></pre></div>
</div>
<p>The above query would join from the <code class="docutils literal notranslate"><span class="pre">Order</span></code> entity to its related
<code class="docutils literal notranslate"><span class="pre">User</span></code> entity, and the returned <code class="docutils literal notranslate"><span class="pre">Order</span></code> objects would have the
<code class="docutils literal notranslate"><span class="pre">Order.user</span></code> attribute pre-populated.</p>
<p>It may also be used for customizing the entries in an eagerly loaded
collection; queries will normally want to use the
<a class="reference internal" href="api.html#orm-queryguide-populate-existing"><span class="std std-ref">填充现有</span></a> execution option assuming the
primary collection of parent objects may already have been loaded:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sess</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
    <span class="n">Address</span><span class="o">.</span><span class="n">email_address</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&quot;%@aol.com&quot;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">contains_eager</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">))</span><span class="o">.</span><span class="n">populate_existing</span><span class="p">()</span></pre></div>
</div>
<p>See the section <a class="reference internal" href="#contains-eager"><span class="std std-ref">将显式连接/语句路由到预加载的集合</span></a> for complete usage details.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#loading-toplevel"><span class="std std-ref">关系加载技术</span></a></p>
<p><a class="reference internal" href="#contains-eager"><span class="std std-ref">将显式连接/语句路由到预加载的集合</span></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.defaultload">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">defaultload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">keys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_AbstractLoad</span></span></span><a class="headerlink" href="#sqlalchemy.orm.defaultload" title="Link to this definition">¶</a></dt>
<dd><p>Indicate an attribute should load using its predefined loader style.</p>
<p>The behavior of this loading option is to not change the current
loading style of the attribute, meaning that the previously configured
one is used or, if no previous style was selected, the default
loading will be used.</p>
<p>This method is used to link to other loader options further into
a chain of attributes without altering the loader style of the links
along the chain.  For example, to set joined eager loading for an
element of an element:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyClass</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
    <span class="n">defaultload</span><span class="p">(</span><span class="n">MyClass</span><span class="o">.</span><span class="n">someattribute</span><span class="p">)</span><span class="o">.</span><span class="n">joinedload</span><span class="p">(</span>
        <span class="n">MyOtherClass</span><span class="o">.</span><span class="n">someotherattribute</span>
    <span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p><a class="reference internal" href="#sqlalchemy.orm.defaultload" title="sqlalchemy.orm.defaultload"><code class="xref py py-func docutils literal notranslate"><span class="pre">defaultload()</span></code></a> is also useful for setting column-level options on
a related class, namely that of <a class="reference internal" href="columns.html#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> and <a class="reference internal" href="columns.html#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span>
    <span class="n">select</span><span class="p">(</span><span class="n">MyClass</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
        <span class="n">defaultload</span><span class="p">(</span><span class="n">MyClass</span><span class="o">.</span><span class="n">someattribute</span><span class="p">)</span>
        <span class="o">.</span><span class="n">defer</span><span class="p">(</span><span class="s2">&quot;some_column&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">undefer</span><span class="p">(</span><span class="s2">&quot;some_other_column&quot;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#orm-queryguide-relationship-sub-options"><span class="std std-ref">使用 Load.options() 指定子选项</span></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.Load.options" title="sqlalchemy.orm.Load.options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Load.options()</span></code></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.immediateload">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">immediateload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">keys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recursion_depth</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_AbstractLoad</span></span></span><a class="headerlink" href="#sqlalchemy.orm.immediateload" title="Link to this definition">¶</a></dt>
<dd><p>Indicate that the given attribute should be loaded using
an immediate load with a per-attribute SELECT statement.</p>
<p>The load is achieved using the “lazyloader” strategy and does not
fire off any additional eager loaders.</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.immediateload" title="sqlalchemy.orm.immediateload"><code class="xref py py-func docutils literal notranslate"><span class="pre">immediateload()</span></code></a> option is superseded in general
by the <a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> option, which performs the same task
more efficiently by emitting a SELECT for all loaded objects.</p>
<p>This function is part of the <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> interface and supports
both method-chained and standalone operation.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.orm.immediateload.params.recursion_depth"></span><strong>recursion_depth</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.immediateload.params.recursion_depth">¶</a> – <p>optional int; when set to a positive integer
in conjunction with a self-referential relationship,
indicates “selectin” loading will continue that many levels deep
automatically until no items are found.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.immediateload.params.recursion_depth" title="sqlalchemy.orm.immediateload"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">immediateload.recursion_depth</span></code></a> option
currently supports only self-referential relationships.  There
is not yet an option to automatically traverse recursive structures
with more than one relationship involved.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>This parameter is new and experimental and should be
treated as “alpha” status</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入: </span>added
<a class="reference internal" href="#sqlalchemy.orm.immediateload.params.recursion_depth" title="sqlalchemy.orm.immediateload"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">immediateload.recursion_depth</span></code></a></p>
</div>
</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#loading-toplevel"><span class="std std-ref">关系加载技术</span></a></p>
<p><a class="reference internal" href="#selectin-eager-loading"><span class="std std-ref">选择 IN 加载</span></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.joinedload">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">joinedload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">keys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_AbstractLoad</span></span></span><a class="headerlink" href="#sqlalchemy.orm.joinedload" title="Link to this definition">¶</a></dt>
<dd><p>Indicate that the given attribute should be loaded using joined
eager loading.</p>
<p>This function is part of the <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> interface and supports
both method-chained and standalone operation.</p>
<p>examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># joined-load the &quot;orders&quot; collection on &quot;User&quot;</span>
<span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">orders</span><span class="p">))</span>

<span class="c1"># joined-load Order.items and then Item.keywords</span>
<span class="n">select</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="n">Order</span><span class="o">.</span><span class="n">items</span><span class="p">)</span><span class="o">.</span><span class="n">joinedload</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">keywords</span><span class="p">))</span>

<span class="c1"># lazily load Order.items, but when Items are loaded,</span>
<span class="c1"># joined-load the keywords collection</span>
<span class="n">select</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">lazyload</span><span class="p">(</span><span class="n">Order</span><span class="o">.</span><span class="n">items</span><span class="p">)</span><span class="o">.</span><span class="n">joinedload</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">keywords</span><span class="p">))</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.orm.joinedload.params.innerjoin"></span><strong>innerjoin</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.joinedload.params.innerjoin">¶</a> – <p>if <code class="docutils literal notranslate"><span class="pre">True</span></code>, indicates that the joined eager load
should use an inner join instead of the default of left outer join:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="n">Order</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">innerjoin</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span></pre></div>
</div>
</p>
</dd>
</dl>
<p>In order to chain multiple eager joins together where some may be
OUTER and others INNER, right-nested joins are used to link them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
    <span class="n">joinedload</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">bs</span><span class="p">,</span> <span class="n">innerjoin</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">joinedload</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="n">innerjoin</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>The above query, linking A.bs via “outer” join and B.cs via “inner”
join would render the joins as “a LEFT OUTER JOIN (b JOIN c)”. When
using older versions of SQLite (&lt; 3.7.16), this form of JOIN is
translated to use full subqueries as this syntax is otherwise not
directly supported.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">innerjoin</span></code> flag can also be stated with the term <code class="docutils literal notranslate"><span class="pre">&quot;unnested&quot;</span></code>.
This indicates that an INNER JOIN should be used, <em>unless</em> the join
is linked to a LEFT OUTER JOIN to the left, in which case it
will render as LEFT OUTER JOIN.  For example, supposing <code class="docutils literal notranslate"><span class="pre">A.bs</span></code>
is an outerjoin:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">bs</span><span class="p">)</span><span class="o">.</span><span class="n">joinedload</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="n">innerjoin</span><span class="o">=</span><span class="s2">&quot;unnested&quot;</span><span class="p">))</span></pre></div>
</div>
<p>The above join will render as “a LEFT OUTER JOIN b LEFT OUTER JOIN c”,
rather than as “a LEFT OUTER JOIN (b JOIN c)”.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>The “unnested” flag does <strong>not</strong> affect the JOIN rendered
from a many-to-many association table, e.g. a table configured as
<a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship.params.secondary" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.secondary</span></code></a>, to the target table; for
correctness of results, these joins are always INNER and are
therefore right-nested if linked to an OUTER join.</p>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>The joins produced by <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> are <strong>anonymously
aliased</strong>. The criteria by which the join proceeds cannot be
modified, nor can the ORM-enabled <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> or legacy
<a class="reference internal" href="query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> refer to these joins in any way, including
ordering. See <a class="reference internal" href="#zen-of-eager-loading"><span class="std std-ref">连接预加载的禅宗</span></a> for further detail.</p>
<p>To produce a specific SQL JOIN which is explicitly available, use
<a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.join" title="sqlalchemy.sql.expression.Select.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join()</span></code></a> and <a class="reference internal" href="query.html#sqlalchemy.orm.Query.join" title="sqlalchemy.orm.Query.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.join()</span></code></a>. To combine
explicit JOINs with eager loading of collections, use
<a class="reference internal" href="#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a>; see <a class="reference internal" href="#contains-eager"><span class="std std-ref">将显式连接/语句路由到预加载的集合</span></a>.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#loading-toplevel"><span class="std std-ref">关系加载技术</span></a></p>
<p><a class="reference internal" href="#joined-eager-loading"><span class="std std-ref">连接预/急加载</span></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.lazyload">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">lazyload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">keys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_AbstractLoad</span></span></span><a class="headerlink" href="#sqlalchemy.orm.lazyload" title="Link to this definition">¶</a></dt>
<dd><p>Indicate that the given attribute should be loaded using “lazy”
loading.</p>
<p>This function is part of the <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> interface and supports
both method-chained and standalone operation.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#loading-toplevel"><span class="std std-ref">关系加载技术</span></a></p>
<p><a class="reference internal" href="#lazy-loading"><span class="std std-ref">延迟加载</span></a></p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">Load</span></span><a class="headerlink" href="#sqlalchemy.orm.Load" title="Link to this definition">¶</a></dt>
<dd><p>Represents loader options which modify the state of a
ORM-enabled <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> or a legacy <a class="reference internal" href="query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> in
order to affect how various mapped attributes are loaded.</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> object is in most cases used implicitly behind the
scenes when one makes use of a query option like <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a>,
<a class="reference internal" href="columns.html#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a>, or similar.   It typically is not instantiated directly
except for in some very specific cases.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#orm-queryguide-relationship-per-entity-wildcard"><span class="std std-ref">每个实体通配符加载策略</span></a> - illustrates an
example where direct use of <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> may be useful</p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.orm.Load.contains_eager"><span class="sig-name descname">contains_eager()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Load.defaultload"><span class="sig-name descname">defaultload()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Load.defer"><span class="sig-name descname">defer()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Load.get_children"><span class="sig-name descname">get_children()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Load.immediateload"><span class="sig-name descname">immediateload()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Load.inherit_cache"><span class="sig-name descname">inherit_cache</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Load.joinedload"><span class="sig-name descname">joinedload()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Load.lazyload"><span class="sig-name descname">lazyload()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Load.load_only"><span class="sig-name descname">load_only()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Load.noload"><span class="sig-name descname">noload()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Load.options"><span class="sig-name descname">options()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Load.process_compile_state"><span class="sig-name descname">process_compile_state()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Load.process_compile_state_replaced_entities"><span class="sig-name descname">process_compile_state_replaced_entities()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Load.propagate_to_loaders"><span class="sig-name descname">propagate_to_loaders</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Load.raiseload"><span class="sig-name descname">raiseload()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Load.selectin_polymorphic"><span class="sig-name descname">selectin_polymorphic()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Load.selectinload"><span class="sig-name descname">selectinload()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Load.subqueryload"><span class="sig-name descname">subqueryload()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Load.undefer"><span class="sig-name descname">undefer()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Load.undefer_group"><span class="sig-name descname">undefer_group()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Load.with_expression"><span class="sig-name descname">with_expression()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load</span></code></a> (<code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.contains_eager">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">contains_eager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_AttrType</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alias</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_FromClauseArgument</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_is_chain</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_propagate_to_loaders</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.orm.Load.contains_eager" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad.contains_eager</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad</span></code></p>
</div>
<p>Produce a new <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> object with the
<a class="reference internal" href="#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> option applied.</p>
<p>See <a class="reference internal" href="#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> for usage examples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.defaultload">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">defaultload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.orm.Load.defaultload" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad.defaultload</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad</span></code></p>
</div>
<p>Produce a new <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> object with the
<a class="reference internal" href="#sqlalchemy.orm.defaultload" title="sqlalchemy.orm.defaultload"><code class="xref py py-func docutils literal notranslate"><span class="pre">defaultload()</span></code></a> option applied.</p>
<p>See <a class="reference internal" href="#sqlalchemy.orm.defaultload" title="sqlalchemy.orm.defaultload"><code class="xref py py-func docutils literal notranslate"><span class="pre">defaultload()</span></code></a> for usage examples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.defer">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">defer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raiseload</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.orm.Load.defer" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad.defer</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad</span></code></p>
</div>
<p>Produce a new <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> object with the
<a class="reference internal" href="columns.html#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> option applied.</p>
<p>See <a class="reference internal" href="columns.html#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> for usage examples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.get_children">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">get_children</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">omit_attrs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">HasTraverseInternals</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.orm.Load.get_children" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="xref py py-meth docutils literal notranslate"><span class="pre">HasTraverseInternals.get_children()</span></code> <em>method of</em> <code class="xref py py-class docutils literal notranslate"><span class="pre">HasTraverseInternals</span></code></p>
</div>
<p>Return immediate child <code class="xref py py-class docutils literal notranslate"><span class="pre">HasTraverseInternals</span></code>
elements of this <code class="xref py py-class docutils literal notranslate"><span class="pre">HasTraverseInternals</span></code>.</p>
<p>This is used for visit traversal.</p>
<p>**kw may contain flags that change the collection that is
returned, for example to return a subset of items in order to
cut down on larger traversals, or to return child items from a
different context (such as schema-level collections instead of
clause-level).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.immediateload">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">immediateload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recursion_depth</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.orm.Load.immediateload" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad.immediateload</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad</span></code></p>
</div>
<p>Produce a new <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> object with the
<a class="reference internal" href="#sqlalchemy.orm.immediateload" title="sqlalchemy.orm.immediateload"><code class="xref py py-func docutils literal notranslate"><span class="pre">immediateload()</span></code></a> option applied.</p>
<p>See <a class="reference internal" href="#sqlalchemy.orm.immediateload" title="sqlalchemy.orm.immediateload"><code class="xref py py-func docutils literal notranslate"><span class="pre">immediateload()</span></code></a> for usage examples.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.inherit_cache">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">inherit_cache</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#sqlalchemy.orm.Load.inherit_cache" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="xref py py-attr docutils literal notranslate"><span class="pre">HasCacheKey.inherit_cache</span></code> <em>attribute of</em> <a class="reference internal" href="../../core/foundation.html#sqlalchemy.sql.traversals.HasCacheKey" title="sqlalchemy.sql.cache_key.HasCacheKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">HasCacheKey</span></code></a></p>
</div>
<p>Indicate if this <a class="reference internal" href="../../core/foundation.html#sqlalchemy.sql.traversals.HasCacheKey" title="sqlalchemy.sql.traversals.HasCacheKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">HasCacheKey</span></code></a> instance should make use of the
cache key generation scheme used by its immediate superclass.</p>
<p>The attribute defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>, which indicates that a construct has
not yet taken into account whether or not its appropriate for it to
participate in caching; this is functionally equivalent to setting the
value to <code class="docutils literal notranslate"><span class="pre">False</span></code>, except that a warning is also emitted.</p>
<p>This flag can be set to <code class="docutils literal notranslate"><span class="pre">True</span></code> on a particular class, if the SQL that
corresponds to the object does not change based on attributes which
are local to this class, and not its superclass.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../../core/compiler.html#compilerext-caching"><span class="std std-ref">Enabling Caching Support for Custom Constructs</span></a> - General guideslines for setting the
<a class="reference internal" href="../../core/foundation.html#sqlalchemy.sql.traversals.HasCacheKey.inherit_cache" title="sqlalchemy.sql.traversals.HasCacheKey.inherit_cache"><code class="xref py py-attr docutils literal notranslate"><span class="pre">HasCacheKey.inherit_cache</span></code></a> attribute for third-party or user
defined SQL constructs.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.joinedload">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">joinedload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">innerjoin</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.orm.Load.joinedload" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad.joinedload</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad</span></code></p>
</div>
<p>Produce a new <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> object with the
<a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> option applied.</p>
<p>See <a class="reference internal" href="#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a> for usage examples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.lazyload">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">lazyload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.orm.Load.lazyload" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad.lazyload</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad</span></code></p>
</div>
<p>Produce a new <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> object with the
<a class="reference internal" href="#sqlalchemy.orm.lazyload" title="sqlalchemy.orm.lazyload"><code class="xref py py-func docutils literal notranslate"><span class="pre">lazyload()</span></code></a> option applied.</p>
<p>See <a class="reference internal" href="#sqlalchemy.orm.lazyload" title="sqlalchemy.orm.lazyload"><code class="xref py py-func docutils literal notranslate"><span class="pre">lazyload()</span></code></a> for usage examples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.load_only">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">load_only</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">attrs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raiseload</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.orm.Load.load_only" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad.load_only</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad</span></code></p>
</div>
<p>Produce a new <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> object with the
<a class="reference internal" href="columns.html#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> option applied.</p>
<p>See <a class="reference internal" href="columns.html#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> for usage examples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.noload">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">noload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.orm.Load.noload" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad.noload</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad</span></code></p>
</div>
<p>Produce a new <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> object with the
<a class="reference internal" href="#sqlalchemy.orm.noload" title="sqlalchemy.orm.noload"><code class="xref py py-func docutils literal notranslate"><span class="pre">noload()</span></code></a> option applied.</p>
<p>See <a class="reference internal" href="#sqlalchemy.orm.noload" title="sqlalchemy.orm.noload"><code class="xref py py-func docutils literal notranslate"><span class="pre">noload()</span></code></a> for usage examples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.options">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">options</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">opts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_AbstractLoad</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.orm.Load.options" title="Link to this definition">¶</a></dt>
<dd><p>Apply a series of options as sub-options to this
<a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a>
object.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Author</span><span class="p">)</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
    <span class="n">joinedload</span><span class="p">(</span><span class="n">Author</span><span class="o">.</span><span class="n">book</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
        <span class="n">load_only</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span> <span class="n">Book</span><span class="o">.</span><span class="n">excerpt</span><span class="p">),</span>
        <span class="n">joinedload</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">citations</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="n">Citation</span><span class="o">.</span><span class="n">author</span><span class="p">)),</span>
    <span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.orm.Load.options.params.*opts"></span><strong>*opts</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.Load.options.params.*opts">¶</a> – A series of loader option objects (ultimately
<a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> objects) which should be applied to the path
specified by this <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> object.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.defaultload" title="sqlalchemy.orm.defaultload"><code class="xref py py-func docutils literal notranslate"><span class="pre">defaultload()</span></code></a></p>
<p><a class="reference internal" href="#orm-queryguide-relationship-sub-options"><span class="std std-ref">使用 Load.options() 指定子选项</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.process_compile_state">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">process_compile_state</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">compile_state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_ORMCompileState</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.Load.process_compile_state" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad.process_compile_state</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad</span></code></p>
</div>
<p>Apply a modification to a given <code class="xref py py-class docutils literal notranslate"><span class="pre">ORMCompileState</span></code>.</p>
<p>This method is part of the implementation of a particular
<code class="xref py py-class docutils literal notranslate"><span class="pre">CompileStateOption</span></code> and is only invoked internally
when an ORM query is compiled.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.process_compile_state_replaced_entities">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">process_compile_state_replaced_entities</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">compile_state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_ORMCompileState</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapper_entities</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../core/defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><span class="pre">Sequence</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_MapperEntity</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.Load.process_compile_state_replaced_entities" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad.process_compile_state_replaced_entities</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad</span></code></p>
</div>
<p>Apply a modification to a given <code class="xref py py-class docutils literal notranslate"><span class="pre">ORMCompileState</span></code>,
given entities that were replaced by with_only_columns() or
with_entities().</p>
<p>This method is part of the implementation of a particular
<code class="xref py py-class docutils literal notranslate"><span class="pre">CompileStateOption</span></code> and is only invoked internally
when an ORM query is compiled.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4.19 版本加入.</span></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.propagate_to_loaders">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">propagate_to_loaders</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#sqlalchemy.orm.Load.propagate_to_loaders" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad.propagate_to_loaders</span></code> <em>attribute of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad</span></code></p>
</div>
<p>if True, indicate this option should be carried along
to “secondary” SELECT statements that occur for relationship
lazy loaders as well as attribute load / refresh operations.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.raiseload">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">raiseload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sql_only</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.orm.Load.raiseload" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad.raiseload</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad</span></code></p>
</div>
<p>Produce a new <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> object with the
<a class="reference internal" href="#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal notranslate"><span class="pre">raiseload()</span></code></a> option applied.</p>
<p>See <a class="reference internal" href="#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal notranslate"><span class="pre">raiseload()</span></code></a> for usage examples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.selectin_polymorphic">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">selectin_polymorphic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">classes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.orm.Load.selectin_polymorphic" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad.selectin_polymorphic</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad</span></code></p>
</div>
<p>Produce a new <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> object with the
<a class="reference internal" href="inheritance.html#sqlalchemy.orm.selectin_polymorphic" title="sqlalchemy.orm.selectin_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectin_polymorphic()</span></code></a> option applied.</p>
<p>See <a class="reference internal" href="inheritance.html#sqlalchemy.orm.selectin_polymorphic" title="sqlalchemy.orm.selectin_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectin_polymorphic()</span></code></a> for usage examples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.selectinload">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">selectinload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recursion_depth</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.orm.Load.selectinload" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad.selectinload</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad</span></code></p>
</div>
<p>Produce a new <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> object with the
<a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> option applied.</p>
<p>See <a class="reference internal" href="#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> for usage examples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.subqueryload">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">subqueryload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.orm.Load.subqueryload" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad.subqueryload</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad</span></code></p>
</div>
<p>Produce a new <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> object with the
<a class="reference internal" href="#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a> option applied.</p>
<p>See <a class="reference internal" href="#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a> for usage examples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.undefer">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">undefer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.orm.Load.undefer" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad.undefer</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad</span></code></p>
</div>
<p>Produce a new <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> object with the
<a class="reference internal" href="columns.html#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer()</span></code></a> option applied.</p>
<p>See <a class="reference internal" href="columns.html#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer()</span></code></a> for usage examples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.undefer_group">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">undefer_group</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.orm.Load.undefer_group" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad.undefer_group</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad</span></code></p>
</div>
<p>Produce a new <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> object with the
<a class="reference internal" href="columns.html#sqlalchemy.orm.undefer_group" title="sqlalchemy.orm.undefer_group"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer_group()</span></code></a> option applied.</p>
<p>See <a class="reference internal" href="columns.html#sqlalchemy.orm.undefer_group" title="sqlalchemy.orm.undefer_group"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer_group()</span></code></a> for usage examples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Load.with_expression">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Load.</span></code></a><span class="sig-name descname"><span class="pre">with_expression</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_AttrType</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expression</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_ColumnExpressionArgument</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#sqlalchemy.orm.Load.with_expression" title="Link to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad.with_expression</span></code> <em>method of</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.strategy_options._AbstractLoad</span></code></p>
</div>
<p>Produce a new <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> object with the
<a class="reference internal" href="columns.html#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> option applied.</p>
<p>See <a class="reference internal" href="columns.html#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> for usage examples.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.noload">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">noload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">keys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_AbstractLoad</span></span></span><a class="headerlink" href="#sqlalchemy.orm.noload" title="Link to this definition">¶</a></dt>
<dd><p>Indicate that the given relationship attribute should remain
unloaded.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">自 2.1 版本弃用: </span>The <a class="reference internal" href="#sqlalchemy.orm.noload" title="sqlalchemy.orm.noload"><code class="xref py py-func docutils literal notranslate"><span class="pre">noload()</span></code></a> option is deprecated and will be removed in a future release.  This option produces incorrect results by returning <code class="docutils literal notranslate"><span class="pre">None</span></code> for related items.</p>
</div>
<p>The relationship attribute will return <code class="docutils literal notranslate"><span class="pre">None</span></code> when accessed without
producing any loading effect.</p>
<p><a class="reference internal" href="#sqlalchemy.orm.noload" title="sqlalchemy.orm.noload"><code class="xref py py-func docutils literal notranslate"><span class="pre">noload()</span></code></a> applies to <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> attributes
only.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#loading-toplevel"><span class="std std-ref">关系加载技术</span></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.raiseload">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">raiseload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">keys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_AbstractLoad</span></span></span><a class="headerlink" href="#sqlalchemy.orm.raiseload" title="Link to this definition">¶</a></dt>
<dd><p>Indicate that the given attribute should raise an error if accessed.</p>
<p>A relationship attribute configured with <a class="reference internal" href="#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal notranslate"><span class="pre">raiseload()</span></code></a> will
raise an <a class="reference internal" href="../../core/exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a> upon access. The
typical way this is useful is when an application is attempting to
ensure that all relationship attributes that are accessed in a
particular context would have been already loaded via eager loading.
Instead of having to read through SQL logs to ensure lazy loads aren’t
occurring, this strategy will cause them to raise immediately.</p>
<p><a class="reference internal" href="#sqlalchemy.orm.raiseload" title="sqlalchemy.orm.raiseload"><code class="xref py py-func docutils literal notranslate"><span class="pre">raiseload()</span></code></a> applies to <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> attributes
only. In order to apply raise-on-SQL behavior to a column-based
attribute, use the <a class="reference internal" href="columns.html#sqlalchemy.orm.defer.params.raiseload" title="sqlalchemy.orm.defer"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">defer.raiseload</span></code></a> parameter on the
<a class="reference internal" href="columns.html#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> loader option.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.orm.raiseload.params.sql_only"></span><strong>sql_only</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.raiseload.params.sql_only">¶</a> – if True, raise only if the lazy load would emit SQL,
but not if it is only checking the identity map, or determining that
the related value should just be None due to missing keys. When False,
the strategy will raise for all varieties of relationship loading.</p>
</dd>
</dl>
<p>This function is part of the <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> interface and supports
both method-chained and standalone operation.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#loading-toplevel"><span class="std std-ref">关系加载技术</span></a></p>
<p><a class="reference internal" href="#prevent-lazy-with-raiseload"><span class="std std-ref">使用 raiseload 防止不必要的延迟加载</span></a></p>
<p><a class="reference internal" href="columns.html#orm-queryguide-deferred-raiseload"><span class="std std-ref">使用 raiseload 防止延迟列加载</span></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.selectinload">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">selectinload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">keys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recursion_depth</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_AbstractLoad</span></span></span><a class="headerlink" href="#sqlalchemy.orm.selectinload" title="Link to this definition">¶</a></dt>
<dd><p>Indicate that the given attribute should be loaded using
SELECT IN eager loading.</p>
<p>This function is part of the <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> interface and supports
both method-chained and standalone operation.</p>
<p>examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># selectin-load the &quot;orders&quot; collection on &quot;User&quot;</span>
<span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">selectinload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">orders</span><span class="p">))</span>

<span class="c1"># selectin-load Order.items and then Item.keywords</span>
<span class="n">select</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
    <span class="n">selectinload</span><span class="p">(</span><span class="n">Order</span><span class="o">.</span><span class="n">items</span><span class="p">)</span><span class="o">.</span><span class="n">selectinload</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">keywords</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># lazily load Order.items, but when Items are loaded,</span>
<span class="c1"># selectin-load the keywords collection</span>
<span class="n">select</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">lazyload</span><span class="p">(</span><span class="n">Order</span><span class="o">.</span><span class="n">items</span><span class="p">)</span><span class="o">.</span><span class="n">selectinload</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">keywords</span><span class="p">))</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.orm.selectinload.params.recursion_depth"></span><strong>recursion_depth</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.selectinload.params.recursion_depth">¶</a> – <p>optional int; when set to a positive integer
in conjunction with a self-referential relationship,
indicates “selectin” loading will continue that many levels deep
automatically until no items are found.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.selectinload.params.recursion_depth" title="sqlalchemy.orm.selectinload"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">selectinload.recursion_depth</span></code></a> option
currently supports only self-referential relationships.  There
is not yet an option to automatically traverse recursive structures
with more than one relationship involved.</p>
<p>Additionally, the <a class="reference internal" href="#sqlalchemy.orm.selectinload.params.recursion_depth" title="sqlalchemy.orm.selectinload"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">selectinload.recursion_depth</span></code></a>
parameter is new and experimental and should be treated as “alpha”
status for the 2.0 series.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入: </span>added
<a class="reference internal" href="#sqlalchemy.orm.selectinload.params.recursion_depth" title="sqlalchemy.orm.selectinload"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">selectinload.recursion_depth</span></code></a></p>
</div>
</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#loading-toplevel"><span class="std std-ref">关系加载技术</span></a></p>
<p><a class="reference internal" href="#selectin-eager-loading"><span class="std std-ref">选择 IN 加载</span></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.subqueryload">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">subqueryload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">keys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_AbstractLoad</span></span></span><a class="headerlink" href="#sqlalchemy.orm.subqueryload" title="Link to this definition">¶</a></dt>
<dd><p>Indicate that the given attribute should be loaded using
subquery eager loading.</p>
<p>This function is part of the <a class="reference internal" href="#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> interface and supports
both method-chained and standalone operation.</p>
<p>examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># subquery-load the &quot;orders&quot; collection on &quot;User&quot;</span>
<span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">subqueryload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">orders</span><span class="p">))</span>

<span class="c1"># subquery-load Order.items and then Item.keywords</span>
<span class="n">select</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
    <span class="n">subqueryload</span><span class="p">(</span><span class="n">Order</span><span class="o">.</span><span class="n">items</span><span class="p">)</span><span class="o">.</span><span class="n">subqueryload</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">keywords</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># lazily load Order.items, but when Items are loaded,</span>
<span class="c1"># subquery-load the keywords collection</span>
<span class="n">select</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">lazyload</span><span class="p">(</span><span class="n">Order</span><span class="o">.</span><span class="n">items</span><span class="p">)</span><span class="o">.</span><span class="n">subqueryload</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">keywords</span><span class="p">))</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#loading-toplevel"><span class="std std-ref">关系加载技术</span></a></p>
<p><a class="reference internal" href="#subquery-eager-loading"><span class="std std-ref">子查询预/急加载</span></a></p>
</div>
</dd></dl>

</section>
</section>
<aside class="topic">
<p class="topic-title">ORM Querying Guide</p>
<p>Next Query Guide Section: <a class="reference internal" href="api.html"><span class="doc">用于查询的 ORM API 功能</span></a></p>
</aside>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="api.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">用于查询的 ORM API 功能</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="columns.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">列加载选项</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                <a href="../../copyright.html">Copyright</a> &#169; 2007-2025, the SQLAlchemy authors and contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on 04/05/2025 04:00:26</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">关系加载技术</a><ul>
<li><a class="reference internal" href="#id2">关系加载样式摘要</a></li>
<li><a class="reference internal" href="#relationship-lazy-option">在映射时配置加载器策略</a></li>
<li><a class="reference internal" href="#relationship-loader-options">使用加载器选项进行关系加载</a><ul>
<li><a class="reference internal" href="#loader-option-criteria">向加载器选项添加条件</a></li>
<li><a class="reference internal" href="#load-options">使用 Load.options() 指定子选项</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lazy-loading">延迟加载</a><ul>
<li><a class="reference internal" href="#raiseload">使用 raiseload 防止不必要的延迟加载</a></li>
</ul>
</li>
<li><a class="reference internal" href="#joined-eager-loading">连接预/急加载</a><ul>
<li><a class="reference internal" href="#zen-of-eager-loading">连接预加载的禅宗</a></li>
</ul>
</li>
<li><a class="reference internal" href="#in">选择 IN 加载</a></li>
<li><a class="reference internal" href="#subquery-eager-loading">子查询预/急加载</a></li>
<li><a class="reference internal" href="#what-kind-of-loading">使用哪种加载？</a></li>
<li><a class="reference internal" href="#id11">多态预加载</a></li>
<li><a class="reference internal" href="#wildcard-loader-strategies">通配符加载策略</a><ul>
<li><a class="reference internal" href="#orm-queryguide-relationship-per-entity-wildcard">每个实体通配符加载策略</a></li>
</ul>
</li>
<li><a class="reference internal" href="#contains-eager">将显式连接/语句路由到预加载的集合</a><ul>
<li><a class="reference internal" href="#id15">使用 contains_eager() 加载自定义过滤的集合结果</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api">关系加载器 API</a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.contains_eager"><code class="docutils literal notranslate"><span class="pre">contains_eager()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.defaultload"><code class="docutils literal notranslate"><span class="pre">defaultload()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.immediateload"><code class="docutils literal notranslate"><span class="pre">immediateload()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.joinedload"><code class="docutils literal notranslate"><span class="pre">joinedload()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.lazyload"><code class="docutils literal notranslate"><span class="pre">lazyload()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load"><code class="docutils literal notranslate"><span class="pre">Load</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.contains_eager"><code class="docutils literal notranslate"><span class="pre">Load.contains_eager()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.defaultload"><code class="docutils literal notranslate"><span class="pre">Load.defaultload()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.defer"><code class="docutils literal notranslate"><span class="pre">Load.defer()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.get_children"><code class="docutils literal notranslate"><span class="pre">Load.get_children()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.immediateload"><code class="docutils literal notranslate"><span class="pre">Load.immediateload()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.inherit_cache"><code class="docutils literal notranslate"><span class="pre">Load.inherit_cache</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.joinedload"><code class="docutils literal notranslate"><span class="pre">Load.joinedload()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.lazyload"><code class="docutils literal notranslate"><span class="pre">Load.lazyload()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.load_only"><code class="docutils literal notranslate"><span class="pre">Load.load_only()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.noload"><code class="docutils literal notranslate"><span class="pre">Load.noload()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.options"><code class="docutils literal notranslate"><span class="pre">Load.options()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.process_compile_state"><code class="docutils literal notranslate"><span class="pre">Load.process_compile_state()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.process_compile_state_replaced_entities"><code class="docutils literal notranslate"><span class="pre">Load.process_compile_state_replaced_entities()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.propagate_to_loaders"><code class="docutils literal notranslate"><span class="pre">Load.propagate_to_loaders</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.raiseload"><code class="docutils literal notranslate"><span class="pre">Load.raiseload()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.selectin_polymorphic"><code class="docutils literal notranslate"><span class="pre">Load.selectin_polymorphic()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.selectinload"><code class="docutils literal notranslate"><span class="pre">Load.selectinload()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.subqueryload"><code class="docutils literal notranslate"><span class="pre">Load.subqueryload()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.undefer"><code class="docutils literal notranslate"><span class="pre">Load.undefer()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.undefer_group"><code class="docutils literal notranslate"><span class="pre">Load.undefer_group()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Load.with_expression"><code class="docutils literal notranslate"><span class="pre">Load.with_expression()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.orm.noload"><code class="docutils literal notranslate"><span class="pre">noload()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.raiseload"><code class="docutils literal notranslate"><span class="pre">raiseload()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.selectinload"><code class="docutils literal notranslate"><span class="pre">selectinload()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.subqueryload"><code class="docutils literal notranslate"><span class="pre">subqueryload()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../_static/documentation_options.js?v=2d0eb83f"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/tabs.js?v=3ee01567"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=2f3e6152"></script>
    <script src="../../_static/translations.js?v=beaddf03"></script>
    </body>
</html>