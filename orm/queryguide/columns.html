<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="索引" href="../../genindex.html" /><link rel="search" title="搜索" href="../../search.html" /><link rel="copyright" title="版权所有" href="../../copyright.html" /><link rel="next" title="关系加载技术" href="relationships.html" /><link rel="prev" title="启用 ORM 的 INSERT、UPDATE 和 DELETE 语句" href="dml.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.08.06 -->
        <title>列加载选项 - SQLAlchemy 2.1 Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/changelog.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_paramlinks.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/docs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">SQLAlchemy 2.1 Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">SQLAlchemy 2.1 Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">概述</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorial/index.html">SQLAlchemy 统一教程</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of SQLAlchemy 统一教程</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/engine.html">建立连接 - Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/dbapi_transactions.html">使用事务和DBAPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/metadata.html">使用数据库元数据</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../tutorial/data.html">处理数据</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of 处理数据</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorial/data_insert.html">使用 INSERT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorial/data_select.html">使用 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorial/data_update.html">使用 UPDATE 和 DELETE 语句</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/orm_data_manipulation.html">使用 ORM 进行数据操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/orm_related_objects.html">使用 ORM 相关对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/further_reading.html">进一步阅读</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">SQLAlchemy ORM</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of SQLAlchemy ORM</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html">ORM 快速入门</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../mapper_config.html">ORM 映射类配置</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of ORM 映射类配置</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../mapping_styles.html">ORM 映射类概述</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../declarative_mapping.html">使用声明式映射类</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of 使用声明式映射类</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../declarative_styles.html">声明式映射风格</a></li>
<li class="toctree-l4"><a class="reference internal" href="../declarative_tables.html">声明式的表配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="../declarative_config.html">使用声明式映射器配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="../declarative_mixins.html">使用 Mixins 组合映射层次结构</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../dataclasses.html">与dataclass和attrs的集成</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mapped_sql_expr.html">SQL 表达式作为映射属性</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mapped_attributes.html">更改Attribute的行为</a></li>
<li class="toctree-l3"><a class="reference internal" href="../composites.html">复合列类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="../inheritance.html">映射类继承层次结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nonstandard_mappings.html">非传统映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="../versioning.html">配置版本计数器</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mapping_api.html">类映射 API</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../scalar_mapping.html">映射 SQL 表达式</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of 映射 SQL 表达式</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../mapping_columns.html">映射表格列</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../relationships.html">关系配置</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of 关系配置</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic_relationships.html">基本关系模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../self_referential.html">邻接表关系</a></li>
<li class="toctree-l3"><a class="reference internal" href="../join_conditions.html">配置关系连接方式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../large_collections.html">使用大型集合</a></li>
<li class="toctree-l3"><a class="reference internal" href="../collection_api.html">集合自定义和 API 详细信息</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relationship_persistence.html">特殊关系的持久化模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../backref.html">使用旧版“backref”关系参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relationship_api.html">关系 API</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="index.html">ORM 查询指南</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of ORM 查询指南</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="select.html">为 ORM 映射类编写 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="inheritance.html">为继承映射编写 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="dml.html">启用 ORM 的 INSERT、UPDATE 和 DELETE 语句</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">列加载选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="relationships.html">关系加载技术</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.html">用于查询的 ORM API 功能</a></li>
<li class="toctree-l3"><a class="reference internal" href="query.html">旧式查询 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../session.html">使用会话</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of 使用会话</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../session_basics.html">会话基础知识</a></li>
<li class="toctree-l3"><a class="reference internal" href="../session_state_management.html">状态管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cascades.html">级联</a></li>
<li class="toctree-l3"><a class="reference internal" href="../session_transaction.html">事务和连接管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../persistence_techniques.html">附加持久性技术</a></li>
<li class="toctree-l3"><a class="reference internal" href="../contextual.html">上下文/线程本地会话</a></li>
<li class="toctree-l3"><a class="reference internal" href="../session_events.html">使用事件跟踪查询、对象和会话更改</a></li>
<li class="toctree-l3"><a class="reference internal" href="../session_api.html">会话 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../extending.html">事件和内部</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of 事件和内部</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../events.html">ORM 事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals.html">ORM 内部</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exceptions.html">ORM 异常</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../extensions/index.html">ORM 扩展</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of ORM 扩展</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../extensions/asyncio.html">异步 I/O (asyncio)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/associationproxy.html">关联代理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/automap.html">自动映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/baked.html">烘焙查询</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/declarative/index.html">声明式扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/mutable.html">突变追踪</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/orderinglist.html">排序列表</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/horizontal_shard.html">水平分片</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/hybrid.html">混合属性</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/indexable.html">Indexable</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/instrumentation.html">替代类检测</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html">核心和 ORM 示例</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../core/index.html">SQLAlchemy Core</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of SQLAlchemy Core</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../core/expression_api.html">SQL 语句和表达式 API</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of SQL 语句和表达式 API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../core/sqlelement.html">列元素和表达式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/operators.html">操作符参考</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/selectable.html">SELECT 和相关构造</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/dml.html">插入,更新,删除</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/functions.html">SQL 和 范型函数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/compiler.html">自定义 SQL 构造和编译扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/serializer.html">表达式序列化器扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/foundation.html">SQL 表达式语言基础构造</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/visitors.html">访问者和遍历实用程序</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../core/schema.html">Schema 定义语言</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of Schema 定义语言</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../core/metadata.html">使用元数据描述数据库</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/reflection.html">反映数据库对象</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/defaults.html">列 INSERT/UPDATE 默认值</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/constraints.html">定义约束和索引</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/ddl.html">自定义 DDL</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../core/types.html">SQL 数据类型对象</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of SQL 数据类型对象</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../core/type_basics.html">类型层次结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/custom_types.html">自定义类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/type_api.html">基本类型 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../core/engines_connections.html">Engine和Connection的使用</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of Engine和Connection的使用</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../core/engines.html">Engine 配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/connections.html">使用Engines和Connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/pooling.html">连接池</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/events.html">核心事件</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../core/api_basics.html">Core API 基础</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of Core API 基础</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../core/event.html">事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/inspection.html">运行时审查 API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/exceptions.html">Core 异常</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/internals.html">Core 内部</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dialects/index.html">Dialects</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of Dialects</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dialects/postgresql.html">PostgreSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dialects/mysql.html">MySQL 和 MariaDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dialects/sqlite.html">SQLite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dialects/oracle.html">Oracle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dialects/mssql.html">Microsoft SQL Server</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../faq/index.html">常见问题</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of 常见问题</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../faq/installation.html">安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/connections.html">连接 / 引擎</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/metadata_schema.html">元数据 / Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/sqlexpressions.html">SQL 表达式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/ormconfiguration.html">ORM 配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/performance.html">性能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/sessions.html">会话 / 查询</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/thirdparty.html">第三方包集成问题</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../errors.html">错误消息</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../changelog/index.html">变更和迁移</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of 变更和迁移</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_21.html">SQLAlchemy 2.1 有什么新功能？</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_21.html">2.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_20.html">2.0 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_14.html">1.4 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_13.html">1.3 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_12.html">1.2 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_11.html">1.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_10.html">1.0 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_09.html">0.9 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_08.html">0.8 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_07.html">0.7 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_06.html">0.6 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_05.html">0.5 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_04.html">0.4 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_03.html">0.3 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_02.html">0.2 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_01.html">0.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_20.html">SQLAlchemy 2.0 - Major Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/whatsnew_20.html">What’s New in SQLAlchemy 2.0?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_14.html">What’s New in SQLAlchemy 1.4?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_13.html">What’s New in SQLAlchemy 1.3?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_12.html">What’s New in SQLAlchemy 1.2?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_11.html">What’s New in SQLAlchemy 1.1?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_10.html">What’s New in SQLAlchemy 1.0?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_09.html">What’s New in SQLAlchemy 0.9?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_08.html">What’s New in SQLAlchemy 0.8?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_07.html">What’s New in SQLAlchemy 0.7?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_06.html">What’s New in SQLAlchemy 0.6?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_05.html">What’s new in SQLAlchemy 0.5?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_04.html">What’s new in SQLAlchemy 0.4?</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <aside class="topic">
<p class="topic-title">ORM Querying Guide</p>
<p>This page is part of the <a class="reference internal" href="index.html"><span class="doc">ORM 查询指南</span></a>.</p>
<p>Previous: <a class="reference internal" href="dml.html"><span class="doc">启用 ORM 的 INSERT、UPDATE 和 DELETE 语句</span></a>   |   Next: <a class="reference internal" href="relationships.html"><span class="doc">关系加载技术</span></a></p>
</aside>
<section id="loading-columns">
<span id="id1"></span><h1>列加载选项<a class="headerlink" href="#loading-columns" title="Link to this heading">¶</a></h1>
<p>Column Loading Options</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">中文</label><div class="tab-content docutils container">
<div class="admonition- admonition">
<p class="admonition-title">关于本文档</p>
<p>本节介绍了有关加载列的其他选项。使用的映射包括存储大字符串值的列，我们可能希望限制它们的加载时间。</p>
<p><a class="reference internal" href="_deferred_setup.html"><span class="doc">查看本页的 ORM 设置</span></a>。下面的一些示例将重新定义 <code class="docutils literal notranslate"><span class="pre">Book</span></code> 映射器以修改一些列定义。</p>
</div>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">英文</label><div class="tab-content docutils container">
<div class="admonition-about-this-document admonition">
<p class="admonition-title">About this Document</p>
<p>This section presents additional options regarding the loading of
columns.  The mappings used include columns that would store
large string values for which we may want to limit when they
are loaded.</p>
<p><a class="reference internal" href="_deferred_setup.html"><span class="doc">View the ORM setup for this page</span></a>.  Some
of the examples below will redefine the <code class="docutils literal notranslate"><span class="pre">Book</span></code> mapper to modify
some of the column definitions.</p>
</div>
</div>
</div>
<section id="orm-queryguide-column-deferral">
<span id="id2"></span><h2>使用【列延迟】限制加载哪些列<a class="headerlink" href="#orm-queryguide-column-deferral" title="Link to this heading">¶</a></h2>
<p>Limiting which Columns Load with Column Deferral</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--1-input--1" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--1">中文</label><div class="tab-content docutils container">
<p><strong>列延迟加载（Column deferral）</strong> 指的是在查询某类对象时，从 SELECT 语句中省略 ORM 映射的某些列。这种做法通常是出于性能考虑，适用于那些表中存在不常使用且可能包含大量数据的列的情况，因为在每次查询时完全加载这些列可能会非常耗时或占用大量内存。SQLAlchemy ORM 提供了多种方式来控制实体加载时列的加载方式。</p>
<p>本节中的大多数示例展示的是 <strong>ORM 加载选项（ORM loader options）</strong> 。这些是一些小型构造体，被传递给 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> 对象的 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.options" title="sqlalchemy.sql.expression.Select.options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.options()</span></code></a> 方法，在对象被编译为 SQL 字符串时由 ORM 使用。</p>
</div>
<input class="tab-input" id="tab-set--1-input--2" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--2">英文</label><div class="tab-content docutils container">
<p><strong>Column deferral</strong> refers to ORM mapped columns that are omitted from a SELECT statement when objects of that type are queried. The general rationale here is performance, in cases where tables have seldom-used columns with potentially large data values, as fully loading these columns on every query may be time and/or memory intensive. SQLAlchemy ORM offers a variety of ways to control the loading of columns when entities are loaded.</p>
<p>Most examples in this section are illustrating <strong>ORM loader options</strong>. These are small constructs that are passed to the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.options" title="sqlalchemy.sql.expression.Select.options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.options()</span></code></a> method of the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> object, which are then consumed by the ORM when the object is compiled into a SQL string.</p>
</div>
</div>
<section id="load-only">
<span id="orm-queryguide-load-only"></span><h3>使用 <code class="docutils literal notranslate"><span class="pre">load_only()</span></code> 减少加载的列<a class="headerlink" href="#load-only" title="Link to this heading">¶</a></h3>
<p>Using <code class="docutils literal notranslate"><span class="pre">load_only()</span></code> to reduce loaded columns</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--2-input--1" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--1">中文</label><div class="tab-content docutils container">
<p><a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> 加载选项是在已知只会访问少量列时，加载对象最便捷的方式。该选项接受多个类绑定的属性对象作为参数，用于指示应加载哪些列映射的属性，除了主键以外的其他列映射属性将不会被包含在获取的列中。在下面的示例中， <code class="docutils literal notranslate"><span class="pre">Book</span></code> 类包含 <code class="docutils literal notranslate"><span class="pre">.title</span></code>、 <code class="docutils literal notranslate"><span class="pre">.summary</span></code> 和 <code class="docutils literal notranslate"><span class="pre">.cover_photo</span></code> 三个列。使用 <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> 我们可以指示 ORM 仅预加载 <code class="docutils literal notranslate"><span class="pre">.title</span></code> 和 <code class="docutils literal notranslate"><span class="pre">.summary</span></code> 列:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_only</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">load_only</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">Book</span><span class="o">.</span><span class="n">summary</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">books</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">books</span><span class="p">:</span>
<span class="go">...     print(f&quot;{book.title}  {book.summary}&quot;)</span>
<span class="go">100 Years of Krabby Patties  some long summary</span>
<span class="go">Sea Catch 22  another long summary</span>
<span class="go">The Sea Grapes of Wrath  yet another summary</span>
<span class="go">A Nut Like No Other  some long summary</span>
<span class="go">Geodesic Domes: A Retrospective  another long summary</span>
<span class="go">Rocketry for Squirrels  yet another summary</span></pre></div>
</div>
<p>如上所示，SELECT 语句省略了 <code class="docutils literal notranslate"><span class="pre">.cover_photo</span></code> 列，仅包含 <code class="docutils literal notranslate"><span class="pre">.title</span></code> 和 <code class="docutils literal notranslate"><span class="pre">.summary</span></code>，以及主键列 <code class="docutils literal notranslate"><span class="pre">.id</span></code>；ORM 通常会始终获取主键列，因为这些列用于建立该行的身份标识。</p>
<p>一旦对象加载完成，对于尚未加载的属性，通常会应用 <span class="xref std std-term">lazy loading`（延迟加载）行为，也就是说，当首次访问这些属性时，会在当前事务中发出一条 SQL 语句以加载该值。如下所示，访问 `</span>.cover_photo`` 会触发一条 SELECT 语句来加载其值:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">img_data</span> <span class="o">=</span> <span class="n">books</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cover_photo</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>延迟加载始终使用对象当前处于 <span class="xref std std-term">persistent`（持久）状态所绑定的 :class:`_orm.Session</span> 来执行。如果该对象已与任何 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 分离（即处于 <a class="reference internal" href="../../glossary.html#term-detached"><span class="xref std std-term">detached</span></a> 状态），该操作会失败并引发异常。</p>
<p>作为访问时延迟加载的替代方案，还可以将延迟列配置为在访问时始终抛出具有提示信息的异常，而不管其是否已绑定 Session。在使用 <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> 构造时，可以通过 <a class="reference internal" href="#sqlalchemy.orm.load_only.params.raiseload" title="sqlalchemy.orm.load_only"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">load_only.raiseload</span></code></a> 参数来启用此行为。参见 <a class="reference internal" href="#orm-queryguide-deferred-raiseload"><span class="std std-ref">使用 raiseload 防止延迟列加载</span></a> 章节以了解背景和示例。</p>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>如其他地方所述，在使用 <a class="reference internal" href="../extensions/asyncio.html#asyncio-toplevel"><span class="std std-ref">异步 I/O (asyncio)</span></a> 时不支持延迟加载。</p>
</div>
</div>
<input class="tab-input" id="tab-set--2-input--2" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--2">英文</label><div class="tab-content docutils container">
<p>The <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> loader option is the most expedient option to use when loading objects where it is known that only a small handful of columns will be accessed. This option accepts a variable number of class-bound attribute objects indicating those column-mapped attributes that should be loaded, where all other column-mapped attributes outside of the primary key will not be part of the columns fetched . In the example below, the <code class="docutils literal notranslate"><span class="pre">Book</span></code> class contains columns <code class="docutils literal notranslate"><span class="pre">.title</span></code>, <code class="docutils literal notranslate"><span class="pre">.summary</span></code> and <code class="docutils literal notranslate"><span class="pre">.cover_photo</span></code>. Using <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> we can instruct the ORM to only load the <code class="docutils literal notranslate"><span class="pre">.title</span></code> and <code class="docutils literal notranslate"><span class="pre">.summary</span></code> columns up front:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_only</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">load_only</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">Book</span><span class="o">.</span><span class="n">summary</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">books</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">books</span><span class="p">:</span>
<span class="go">...     print(f&quot;{book.title}  {book.summary}&quot;)</span>
<span class="go">100 Years of Krabby Patties  some long summary</span>
<span class="go">Sea Catch 22  another long summary</span>
<span class="go">The Sea Grapes of Wrath  yet another summary</span>
<span class="go">A Nut Like No Other  some long summary</span>
<span class="go">Geodesic Domes: A Retrospective  another long summary</span>
<span class="go">Rocketry for Squirrels  yet another summary</span></pre></div>
</div>
<p>Above, the SELECT statement has omitted the <code class="docutils literal notranslate"><span class="pre">.cover_photo</span></code> column and included only <code class="docutils literal notranslate"><span class="pre">.title</span></code> and <code class="docutils literal notranslate"><span class="pre">.summary</span></code>, as well as the primary key column <code class="docutils literal notranslate"><span class="pre">.id</span></code>; the ORM will typically always fetch the primary key columns as these are required to establish the identity for the row.</p>
<p>Once loaded, the object will normally have <a class="reference internal" href="../../glossary.html#term-lazy-loading"><span class="xref std std-term">lazy loading</span></a> behavior applied to the remaining unloaded attributes, meaning that when any are first accessed, a SQL statement will be emitted within the current transaction in order to load the value.  Below, accessing <code class="docutils literal notranslate"><span class="pre">.cover_photo</span></code> emits a SELECT statement to load its value:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">img_data</span> <span class="o">=</span> <span class="n">books</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cover_photo</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>Lazy loads are always emitted using the <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> to which the object is in the <a class="reference internal" href="../../glossary.html#term-persistent"><span class="xref std std-term">persistent</span></a> state.  If the object is <a class="reference internal" href="../../glossary.html#term-detached"><span class="xref std std-term">detached</span></a> from any <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>, the operation fails, raising an exception.</p>
<p>As an alternative to lazy loading on access, deferred columns may also be configured to raise an informative exception when accessed, regardless of their attachment state.  When using the <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> construct, this may be indicated using the <a class="reference internal" href="#sqlalchemy.orm.load_only.params.raiseload" title="sqlalchemy.orm.load_only"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">load_only.raiseload</span></code></a> parameter. See the section <a class="reference internal" href="#orm-queryguide-deferred-raiseload"><span class="std std-ref">使用 raiseload 防止延迟列加载</span></a> for background and examples.</p>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>as noted elsewhere, lazy loading is not available when using <a class="reference internal" href="../extensions/asyncio.html#asyncio-toplevel"><span class="std std-ref">异步 I/O (asyncio)</span></a>.</p>
</div>
</div>
</div>
<section id="id3">
<h4>使用 <code class="docutils literal notranslate"><span class="pre">load_only()</span></code> 处理多个实体<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h4>
<p>Using <code class="docutils literal notranslate"><span class="pre">load_only()</span></code> with multiple entities</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--3-input--1" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--1">中文</label><div class="tab-content docutils container">
<p><a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> 的作用范围仅限于其属性列表中所指向的单个实体（当前不允许传入跨多个实体的属性列表）。在下面的示例中，给定的 <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> 选项仅应用于 <code class="docutils literal notranslate"><span class="pre">Book</span></code> 实体。被同时查询的 <code class="docutils literal notranslate"><span class="pre">User</span></code> 实体不受影响；在生成的 SELECT 语句中， <code class="docutils literal notranslate"><span class="pre">user_account</span></code> 表的所有列都会被包含，而 <code class="docutils literal notranslate"><span class="pre">book</span></code> 表中仅包含 <code class="docutils literal notranslate"><span class="pre">book.id</span></code> 和 <code class="docutils literal notranslate"><span class="pre">book.title</span></code>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">join_from</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">load_only</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">title</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span><span class="p">,</span>
<span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_1</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
</div></pre></div>
</div>
<p>如果我们希望同时对 <code class="docutils literal notranslate"><span class="pre">User</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Book</span></code> 应用 <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> 选项，则需要分别为它们设置两个独立的选项:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User, Book)</span>
<span class="go">...     .join_from(User, Book)</span>
<span class="go">...     .options(load_only(User.name), load_only(Book.title))</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_1</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
</div></pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--3-input--2" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--2">英文</label><div class="tab-content docutils container">
<p><a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> limits itself to the single entity that is referred towards in its list of attributes (passing a list of attributes that span more than a single entity is currently disallowed). In the example below, the given <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> option applies only to the <code class="docutils literal notranslate"><span class="pre">Book</span></code> entity. The <code class="docutils literal notranslate"><span class="pre">User</span></code> entity that’s also selected is not affected; within the resulting SELECT statement, all columns for <code class="docutils literal notranslate"><span class="pre">user_account</span></code> are present, whereas only <code class="docutils literal notranslate"><span class="pre">book.id</span></code> and <code class="docutils literal notranslate"><span class="pre">book.title</span></code> are present for the <code class="docutils literal notranslate"><span class="pre">book</span></code> table:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">join_from</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">load_only</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">title</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span><span class="p">,</span>
<span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_1</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
</div></pre></div>
</div>
<p>If we wanted to apply <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> options to both <code class="docutils literal notranslate"><span class="pre">User</span></code> and <code class="docutils literal notranslate"><span class="pre">Book</span></code>, we would make use of two separate options:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User, Book)</span>
<span class="go">...     .join_from(User, Book)</span>
<span class="go">...     .options(load_only(User.name), load_only(Book.title))</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_1</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
</div></pre></div>
</div>
</div>
</div>
</section>
<section id="orm-queryguide-load-only-related">
<span id="id4"></span><h4>使用 <code class="docutils literal notranslate"><span class="pre">load_only()</span></code> 处理相关对象和集合<a class="headerlink" href="#orm-queryguide-load-only-related" title="Link to this heading">¶</a></h4>
<p>Using <code class="docutils literal notranslate"><span class="pre">load_only()</span></code> on related objects and collections</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--4-input--1" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--1">中文</label><div class="tab-content docutils container">
<p>在使用 <a class="reference internal" href="relationships.html#loading-toplevel"><span class="std std-ref">relationship loaders</span></a> 控制关联对象加载时，可以使用关系加载器的 <a class="reference internal" href="relationships.html#sqlalchemy.orm.Load.load_only" title="sqlalchemy.orm.Load.load_only"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Load.load_only()</span></code></a> 方法，对子实体的列应用 <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> 规则。下面的示例中，使用 <a class="reference internal" href="relationships.html#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> 加载每个 <code class="docutils literal notranslate"><span class="pre">User</span></code> 对象关联的 <code class="docutils literal notranslate"><span class="pre">books</span></code> 集合。通过将 <a class="reference internal" href="relationships.html#sqlalchemy.orm.Load.load_only" title="sqlalchemy.orm.Load.load_only"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Load.load_only()</span></code></a> 应用于选项对象，当关系对象被加载时，生成的 SELECT 语句只会包含 <code class="docutils literal notranslate"><span class="pre">title</span></code> 列以及主键列:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">selectinload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">selectinload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">books</span><span class="p">)</span><span class="o">.</span><span class="n">load_only</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">title</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">):</span>
<span class="go">...     print(f&quot;{user.fullname}   {[b.title for b in user.books]}&quot;)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">)</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</div><span class="go">Spongebob Squarepants   [&#39;100 Years of Krabby Patties&#39;, &#39;Sea Catch 22&#39;, &#39;The Sea Grapes of Wrath&#39;]</span>
<span class="go">Sandy Cheeks   [&#39;A Nut Like No Other&#39;, &#39;Geodesic Domes: A Retrospective&#39;, &#39;Rocketry for Squirrels&#39;]</span></pre></div>
</div>
<p><a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> 也可以应用于子实体，而无需显式指定用于该关系的加载方式。如果我们不希望改变 <code class="docutils literal notranslate"><span class="pre">User.books</span></code> 的默认加载策略，但仍希望对 <code class="docutils literal notranslate"><span class="pre">Book</span></code> 应用 load only 规则，可以使用 <a class="reference internal" href="relationships.html#sqlalchemy.orm.defaultload" title="sqlalchemy.orm.defaultload"><code class="xref py py-func docutils literal notranslate"><span class="pre">defaultload()</span></code></a> 选项，它会保留关系的默认加载方式（此处为 <code class="docutils literal notranslate"><span class="pre">&quot;lazy&quot;</span></code>），并对每个 <code class="docutils literal notranslate"><span class="pre">User.books</span></code> 集合所发出的 SELECT 语句应用我们自定义的 <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> 规则:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">defaultload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">books</span><span class="p">)</span><span class="o">.</span><span class="n">load_only</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">title</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">):</span>
<span class="go">...     print(f&quot;{user.fullname}   {[b.title for b in user.books]}&quot;)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</div><span class="go">Spongebob Squarepants   [&#39;100 Years of Krabby Patties&#39;, &#39;Sea Catch 22&#39;, &#39;The Sea Grapes of Wrath&#39;]</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div><span class="go">Sandy Cheeks   [&#39;A Nut Like No Other&#39;, &#39;Geodesic Domes: A Retrospective&#39;, &#39;Rocketry for Squirrels&#39;]</span></pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--4-input--2" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--2">英文</label><div class="tab-content docutils container">
<p>When using <a class="reference internal" href="relationships.html#loading-toplevel"><span class="std std-ref">relationship loaders</span></a> to control the loading of related objects, the <a class="reference internal" href="relationships.html#sqlalchemy.orm.Load.load_only" title="sqlalchemy.orm.Load.load_only"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Load.load_only()</span></code></a> method of any relationship loader may be used to apply <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> rules to columns on the sub-entity.  In the example below, <a class="reference internal" href="relationships.html#sqlalchemy.orm.selectinload" title="sqlalchemy.orm.selectinload"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectinload()</span></code></a> is used to load the related <code class="docutils literal notranslate"><span class="pre">books</span></code> collection on each <code class="docutils literal notranslate"><span class="pre">User</span></code> object.   By applying <a class="reference internal" href="relationships.html#sqlalchemy.orm.Load.load_only" title="sqlalchemy.orm.Load.load_only"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Load.load_only()</span></code></a> to the resulting option object, when objects are loaded for the relationship, the SELECT emitted will only refer to the <code class="docutils literal notranslate"><span class="pre">title</span></code> column in addition to primary key column:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">selectinload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">selectinload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">books</span><span class="p">)</span><span class="o">.</span><span class="n">load_only</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">title</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">):</span>
<span class="go">...     print(f&quot;{user.fullname}   {[b.title for b in user.books]}&quot;)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="p">)</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</div><span class="go">Spongebob Squarepants   [&#39;100 Years of Krabby Patties&#39;, &#39;Sea Catch 22&#39;, &#39;The Sea Grapes of Wrath&#39;]</span>
<span class="go">Sandy Cheeks   [&#39;A Nut Like No Other&#39;, &#39;Geodesic Domes: A Retrospective&#39;, &#39;Rocketry for Squirrels&#39;]</span></pre></div>
</div>
<p><a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> may also be applied to sub-entities without needing to state the style of loading to use for the relationship itself.  If we didn’t want to change the default loading style of <code class="docutils literal notranslate"><span class="pre">User.books</span></code> but still apply load only rules to <code class="docutils literal notranslate"><span class="pre">Book</span></code>, we would link using the <a class="reference internal" href="relationships.html#sqlalchemy.orm.defaultload" title="sqlalchemy.orm.defaultload"><code class="xref py py-func docutils literal notranslate"><span class="pre">defaultload()</span></code></a> option, which in this case will retain the default relationship loading style of <code class="docutils literal notranslate"><span class="pre">&quot;lazy&quot;</span></code>, and applying our custom <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> rule to the SELECT statement emitted for each <code class="docutils literal notranslate"><span class="pre">User.books</span></code> collection:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">defaultload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">books</span><span class="p">)</span><span class="o">.</span><span class="n">load_only</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">title</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">):</span>
<span class="go">...     print(f&quot;{user.fullname}   {[b.title for b in user.books]}&quot;)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</div><span class="go">Spongebob Squarepants   [&#39;100 Years of Krabby Patties&#39;, &#39;Sea Catch 22&#39;, &#39;The Sea Grapes of Wrath&#39;]</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div><span class="go">Sandy Cheeks   [&#39;A Nut Like No Other&#39;, &#39;Geodesic Domes: A Retrospective&#39;, &#39;Rocketry for Squirrels&#39;]</span></pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="defer">
<span id="orm-queryguide-defer"></span><h3>使用 <code class="docutils literal notranslate"><span class="pre">defer()</span></code> 忽略特定列<a class="headerlink" href="#defer" title="Link to this heading">¶</a></h3>
<p>Using <code class="docutils literal notranslate"><span class="pre">defer()</span></code> to omit specific columns</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--5-input--1" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--1">中文</label><div class="tab-content docutils container">
<p><a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> 加载选项是一个比 <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> 更加细粒度的替代方案，它允许将某个特定列标记为“不要加载”。在下面的示例中，<a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> 被直接应用于 <code class="docutils literal notranslate"><span class="pre">.cover_photo</span></code> 列，而其他列的行为保持不变:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">defer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">owner_id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">defer</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">cover_photo</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">books</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">books</span><span class="p">:</span>
<span class="go">...     print(f&quot;{book.title}: {book.summary}&quot;)</span>
<span class="go">A Nut Like No Other: some long summary</span>
<span class="go">Geodesic Domes: A Retrospective: another long summary</span>
<span class="go">Rocketry for Squirrels: yet another summary</span></pre></div>
</div>
<p>与 <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> 一样，未加载的列默认在访问时将通过 :term:<a href="#id5"><span class="problematic" id="id6">`</span></a>lazy loading`（延迟加载）方式加载:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">img_data</span> <span class="o">=</span> <span class="n">books</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cover_photo</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>可以在一个语句中使用多个 <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> 选项来标记多个列为延迟加载。</p>
<p>同样地，<a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> 选项也支持使被延迟加载的属性在访问时抛出异常，而不是执行延迟加载。这一点在 <a class="reference internal" href="#orm-queryguide-deferred-raiseload"><span class="std std-ref">使用 raiseload 防止延迟列加载</span></a> 一节中有说明。</p>
</div>
<input class="tab-input" id="tab-set--5-input--2" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--2">英文</label><div class="tab-content docutils container">
<p>The <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> loader option is a more fine grained alternative to <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a>, which allows a single specific column to be marked as “dont load”.  In the example below, <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> is applied directly to the <code class="docutils literal notranslate"><span class="pre">.cover_photo</span></code> column, leaving the behavior of all other columns unchanged:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">defer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">owner_id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">defer</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">cover_photo</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">books</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">books</span><span class="p">:</span>
<span class="go">...     print(f&quot;{book.title}: {book.summary}&quot;)</span>
<span class="go">A Nut Like No Other: some long summary</span>
<span class="go">Geodesic Domes: A Retrospective: another long summary</span>
<span class="go">Rocketry for Squirrels: yet another summary</span></pre></div>
</div>
<p>As is the case with <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a>, unloaded columns by default will load themselves when accessed using <a class="reference internal" href="../../glossary.html#term-lazy-loading"><span class="xref std std-term">lazy loading</span></a>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">img_data</span> <span class="o">=</span> <span class="n">books</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cover_photo</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>Multiple <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> options may be used in one statement in order to mark several columns as deferred.</p>
<p>As is the case with <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a>, the <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> option also includes the ability to have a deferred attribute raise an exception on access rather than lazy loading.  This is illustrated in the section <a class="reference internal" href="#orm-queryguide-deferred-raiseload"><span class="std std-ref">使用 raiseload 防止延迟列加载</span></a>.</p>
</div>
</div>
</section>
<section id="raiseload">
<span id="orm-queryguide-deferred-raiseload"></span><h3>使用 raiseload 防止延迟列加载<a class="headerlink" href="#raiseload" title="Link to this heading">¶</a></h3>
<p>Using raiseload to prevent deferred column loads</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--6-input--1" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--1">中文</label><div class="tab-content docutils container">
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">expunge_all</span><span class="p">()</span></pre></div>
</div>
<p>当使用 <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> 或 <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> 加载选项时，被标记为延迟加载的属性在对象中默认会在首次访问时，在当前事务中发出 SELECT 语句以加载其值。通常我们希望避免这种加载发生，而是在访问属性时直接抛出异常，以表明该列不应被访问。这种情况在以下场景中很常见：某个操作已提前加载了所有需要的列，并将对象传递给视图层，如果视图层中再次访问数据库列，将会暴露出加载缺失的问题，从而可用于回退并修复预加载逻辑。</p>
<p>对于这种用途，<a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> 和 <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> 加载选项都包含一个布尔参数 <a class="reference internal" href="#sqlalchemy.orm.defer.params.raiseload" title="sqlalchemy.orm.defer"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">defer.raiseload</span></code></a>，当设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 时，将使相关属性在访问时抛出异常。下面的示例中，被延迟的 <code class="docutils literal notranslate"><span class="pre">.cover_photo</span></code> 列在访问时将被禁止:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
<span class="go">...     select(Book).options(defer(Book.cover_photo, raiseload=True)).where(Book.id == 4)</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">,)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">cover_photo</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">sqlalchemy.exc.InvalidRequestError: &#39;Book.cover_photo&#39; is not available due to raiseload=True</span></pre></div>
</div>
<p>当使用 <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> 指定一组需要加载的非延迟列时，可使用 <a class="reference internal" href="#sqlalchemy.orm.load_only.params.raiseload" title="sqlalchemy.orm.load_only"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">load_only.raiseload</span></code></a> 参数来对其余未加载列启用 <code class="docutils literal notranslate"><span class="pre">raiseload</span></code> 行为，它将应用于所有被延迟的属性:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">expunge_all</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
<span class="go">...     select(Book).options(load_only(Book.title, raiseload=True)).where(Book.id == 5)</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">,)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">summary</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">sqlalchemy.exc.InvalidRequestError: &#39;Book.summary&#39; is not available due to raiseload=True</span></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>当前尚不支持在同一语句中混用 <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> 和 <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> 来改变同一实体中某些属性的 <code class="docutils literal notranslate"><span class="pre">raiseload</span></code> 行为；这样做会产生未定义的属性加载行为。</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.defer.params.raiseload" title="sqlalchemy.orm.defer"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">defer.raiseload</span></code></a> 功能是关系型 “raiseload” 功能在列级别的版本。关于关系的 “raiseload”，请参见本指南的 <a class="reference internal" href="relationships.html#loading-toplevel"><span class="std std-ref">关系加载技术</span></a> 部分中的 <a class="reference internal" href="relationships.html#prevent-lazy-with-raiseload"><span class="std std-ref">使用 raiseload 防止不必要的延迟加载</span></a>。</p>
</div>
</div>
<input class="tab-input" id="tab-set--6-input--2" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--2">英文</label><div class="tab-content docutils container">
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">expunge_all</span><span class="p">()</span></pre></div>
</div>
<p>When using the <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> or <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> loader options, attributes marked as deferred on an object have the default behavior that when first accessed, a SELECT statement will be emitted within the current transaction in order to load their value. It is often necessary to prevent this load from occurring, and instead raise an exception when the attribute is accessed, indicating that the need to query the database for this column was not expected. A typical scenario is an operation where objects are loaded with all the columns that are known to be required for the operation to proceed, which are then passed onto a view layer. Any further SQL operations that emit within the view layer should be caught, so that the up-front loading operation can be adjusted to accommodate for that additional data up front, rather than incurring additional lazy loading.</p>
<p>For this use case the <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> and <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> options include a boolean parameter <a class="reference internal" href="#sqlalchemy.orm.defer.params.raiseload" title="sqlalchemy.orm.defer"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">defer.raiseload</span></code></a>, which when set to <code class="docutils literal notranslate"><span class="pre">True</span></code> will cause the affected attributes to raise on access.  In the example below, the deferred column <code class="docutils literal notranslate"><span class="pre">.cover_photo</span></code> will disallow attribute access:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
<span class="go">...     select(Book).options(defer(Book.cover_photo, raiseload=True)).where(Book.id == 4)</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">,)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">cover_photo</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">sqlalchemy.exc.InvalidRequestError: &#39;Book.cover_photo&#39; is not available due to raiseload=True</span></pre></div>
</div>
<p>When using <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> to name a specific set of non-deferred columns, <code class="docutils literal notranslate"><span class="pre">raiseload</span></code> behavior may be applied to the remaining columns using the <a class="reference internal" href="#sqlalchemy.orm.load_only.params.raiseload" title="sqlalchemy.orm.load_only"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">load_only.raiseload</span></code></a> parameter, which will be applied to all deferred attributes:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">expunge_all</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
<span class="go">...     select(Book).options(load_only(Book.title, raiseload=True)).where(Book.id == 5)</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">,)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">summary</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">sqlalchemy.exc.InvalidRequestError: &#39;Book.summary&#39; is not available due to raiseload=True</span></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>It is not yet possible to mix <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> and <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> options which refer to the same entity together in one statement in order to change the <code class="docutils literal notranslate"><span class="pre">raiseload</span></code> behavior of certain attributes; currently, doing so will produce undefined loading behavior of attributes.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.defer.params.raiseload" title="sqlalchemy.orm.defer"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">defer.raiseload</span></code></a> feature is the column-level version of the same “raiseload” feature that’s available for relationships. For “raiseload” with relationships, see <a class="reference internal" href="relationships.html#prevent-lazy-with-raiseload"><span class="std std-ref">使用 raiseload 防止不必要的延迟加载</span></a> in the <a class="reference internal" href="relationships.html#loading-toplevel"><span class="std std-ref">关系加载技术</span></a> section of this guide.</p>
</div>
</div>
</div>
</section>
</section>
<section id="orm-queryguide-deferred-declarative">
<span id="id7"></span><h2>在映射上配置列延迟<a class="headerlink" href="#orm-queryguide-deferred-declarative" title="Link to this heading">¶</a></h2>
<p>Configuring Column Deferral on Mappings</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--7-input--1" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--1">中文</label><div class="tab-content docutils container">
<p><a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> 的功能也可以作为映射列的默认行为启用，这对于那些不应该在每次查询中无条件加载的列来说非常合适。要进行配置，可使用 <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> 的参数 <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column.params.deferred" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.deferred</span></code></a>。以下示例展示了对 <code class="docutils literal notranslate"><span class="pre">Book</span></code> 类的映射，其中 <code class="docutils literal notranslate"><span class="pre">summary</span></code> 和 <code class="docutils literal notranslate"><span class="pre">cover_photo</span></code> 列被设置为默认延迟加载:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">Book</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="go">...     __tablename__ = &quot;book&quot;</span>
<span class="go">...     id: Mapped[int] = mapped_column(primary_key=True)</span>
<span class="go">...     owner_id: Mapped[int] = mapped_column(ForeignKey(&quot;user_account.id&quot;))</span>
<span class="go">...     title: Mapped[str]</span>
<span class="go">...     summary: Mapped[str] = mapped_column(Text, deferred=True)</span>
<span class="go">...     cover_photo: Mapped[bytes] = mapped_column(LargeBinary, deferred=True)</span>
<span class="go">...</span>
<span class="go">...     def __repr__(self) -&gt; str:</span>
<span class="go">...         return f&quot;Book(id={self.id!r}, title={self.title!r})&quot;</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>使用上述映射后，针对 <code class="docutils literal notranslate"><span class="pre">Book</span></code> 的查询将自动省略 <code class="docutils literal notranslate"><span class="pre">summary</span></code> 和 <code class="docutils literal notranslate"><span class="pre">cover_photo</span></code> 列:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">))</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>如所有延迟加载行为一样，当首次访问已加载对象上的延迟属性时，其默认行为是 <a class="reference internal" href="../../glossary.html#term-lazy-load"><span class="xref std std-term">lazy load</span></a> 其值:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">img_data</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">cover_photo</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>与 <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> 和 <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> 加载选项类似，映射器级别的延迟加载同样支持 <code class="docutils literal notranslate"><span class="pre">raiseload</span></code> 行为。此行为意味着如果语句中未提供其他加载选项，则不会懒加载这些列，而是在访问时抛出异常。这样可以配置映射，使得某些列默认不会加载，并且在没有显式加载指令的情况下也永远不会懒加载。关于如何配置和使用此行为，请参见 <a class="reference internal" href="#orm-queryguide-mapper-deferred-raiseload"><span class="std std-ref">配置映射器级“raiseload”行为</span></a> 一节。</p>
</div>
<input class="tab-input" id="tab-set--7-input--2" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--2">英文</label><div class="tab-content docutils container">
<p>The functionality of <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> is available as a default behavior for mapped columns, as may be appropriate for columns that should not be loaded unconditionally on every query. To configure, use the <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column.params.deferred" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.deferred</span></code></a> parameter of <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a>. The example below illustrates a mapping for <code class="docutils literal notranslate"><span class="pre">Book</span></code> which applies default column deferral to the <code class="docutils literal notranslate"><span class="pre">summary</span></code> and <code class="docutils literal notranslate"><span class="pre">cover_photo</span></code> columns:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">Book</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="go">...     __tablename__ = &quot;book&quot;</span>
<span class="go">...     id: Mapped[int] = mapped_column(primary_key=True)</span>
<span class="go">...     owner_id: Mapped[int] = mapped_column(ForeignKey(&quot;user_account.id&quot;))</span>
<span class="go">...     title: Mapped[str]</span>
<span class="go">...     summary: Mapped[str] = mapped_column(Text, deferred=True)</span>
<span class="go">...     cover_photo: Mapped[bytes] = mapped_column(LargeBinary, deferred=True)</span>
<span class="go">...</span>
<span class="go">...     def __repr__(self) -&gt; str:</span>
<span class="go">...         return f&quot;Book(id={self.id!r}, title={self.title!r})&quot;</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>Using the above mapping, queries against <code class="docutils literal notranslate"><span class="pre">Book</span></code> will automatically not include the <code class="docutils literal notranslate"><span class="pre">summary</span></code> and <code class="docutils literal notranslate"><span class="pre">cover_photo</span></code> columns:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">))</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>As is the case with all deferral, the default behavior when deferred attributes on the loaded object are first accessed is that they will <a class="reference internal" href="../../glossary.html#term-lazy-load"><span class="xref std std-term">lazy load</span></a> their value:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">img_data</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">cover_photo</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>As is the case with the <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> and <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> loader options, mapper level deferral also includes an option for <code class="docutils literal notranslate"><span class="pre">raiseload</span></code> behavior to occur, rather than lazy loading, when no other options are present in a statement.  This allows a mapping where certain columns will not load by default and will also never load lazily without explicit directives used in a statement.   See the section <a class="reference internal" href="#orm-queryguide-mapper-deferred-raiseload"><span class="std std-ref">配置映射器级“raiseload”行为</span></a> for background on how to configure and use this behavior.</p>
</div>
</div>
<section id="sql-deferred">
<span id="orm-queryguide-deferred-imperative"></span><h3>对命令式映射器、映射 SQL 表达式使用 <code class="docutils literal notranslate"><span class="pre">deferred()</span></code><a class="headerlink" href="#sql-deferred" title="Link to this heading">¶</a></h3>
<p>Using <code class="docutils literal notranslate"><span class="pre">deferred()</span></code> for imperative mappers, mapped SQL expressions</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--8-input--1" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--1">中文</label><div class="tab-content docutils container">
<p><a class="reference internal" href="#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal notranslate"><span class="pre">deferred()</span></code></a> 是早期版本中使用的、功能更通用的“延迟列”映射指令，早于 SQLAlchemy 中 <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> 构造的引入。</p>
<p><a class="reference internal" href="#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal notranslate"><span class="pre">deferred()</span></code></a> 在配置 ORM 映射器时使用，它接受任意 SQL 表达式或 <a class="reference internal" href="../../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> 对象。因此它适用于非声明式的 <a class="reference internal" href="../mapping_styles.html#orm-imperative-mapping"><span class="std std-ref">命令式映射</span></a>，可通过 <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.registry.map_imperatively.params.properties" title="sqlalchemy.orm.registry.map_imperatively"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">map_imperatively.properties</span></code></a> 字典传入：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Blob</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Column</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForeignKey</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Integer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">String</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Text</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">registry</span>

<span class="n">mapper_registry</span> <span class="o">=</span> <span class="n">registry</span><span class="p">()</span>

<span class="n">book_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;book&quot;</span><span class="p">,</span>
    <span class="n">mapper_registry</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">)),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;summary&quot;</span><span class="p">,</span> <span class="n">Text</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;cover_image&quot;</span><span class="p">,</span> <span class="n">Blob</span><span class="p">),</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Book</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="n">mapper_registry</span><span class="o">.</span><span class="n">map_imperatively</span><span class="p">(</span>
    <span class="n">Book</span><span class="p">,</span>
    <span class="n">book_table</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="n">deferred</span><span class="p">(</span><span class="n">book_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
        <span class="s2">&quot;cover_image&quot;</span><span class="p">:</span> <span class="n">deferred</span><span class="p">(</span><span class="n">book_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cover_image</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>当映射的 SQL 表达式应以延迟方式加载时，也可以使用 <a class="reference internal" href="#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal notranslate"><span class="pre">deferred()</span></code></a> 替代 <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_property()</span></code></a>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">deferred</span>


<span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">firstname</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">()</span>
    <span class="n">lastname</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">()</span>
    <span class="n">fullname</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">deferred</span><span class="p">(</span><span class="n">firstname</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">lastname</span><span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../mapped_sql_expr.html#mapper-column-property-sql-expressions"><span class="std std-ref">使用 column_property</span></a> - 位于 <a class="reference internal" href="../mapped_sql_expr.html#mapper-sql-expressions"><span class="std std-ref">SQL 表达式作为映射属性</span></a> 章节</p>
<p><a class="reference internal" href="../declarative_tables.html#orm-imperative-table-column-options"><span class="std std-ref">为命令式表应用加载、持久性和映射选项列</span></a> - 位于 <a class="reference internal" href="../declarative_tables.html#orm-declarative-table-config-toplevel"><span class="std std-ref">声明式的表配置</span></a> 章节</p>
</div>
</div>
<input class="tab-input" id="tab-set--8-input--2" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--2">英文</label><div class="tab-content docutils container">
<p>The <a class="reference internal" href="#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal notranslate"><span class="pre">deferred()</span></code></a> function is the earlier, more general purpose “deferred column” mapping directive that precedes the introduction of the <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> construct in SQLAlchemy.</p>
<p><a class="reference internal" href="#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal notranslate"><span class="pre">deferred()</span></code></a> is used when configuring ORM mappers, and accepts arbitrary SQL expressions or <a class="reference internal" href="../../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> objects. As such it’s suitable to be used with non-declarative <a class="reference internal" href="../mapping_styles.html#orm-imperative-mapping"><span class="std std-ref">imperative mappings</span></a>, passing it to the <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.registry.map_imperatively.params.properties" title="sqlalchemy.orm.registry.map_imperatively"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">map_imperatively.properties</span></code></a> dictionary:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Blob</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Column</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForeignKey</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Integer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">String</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Text</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">registry</span>

<span class="n">mapper_registry</span> <span class="o">=</span> <span class="n">registry</span><span class="p">()</span>

<span class="n">book_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;book&quot;</span><span class="p">,</span>
    <span class="n">mapper_registry</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">)),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;summary&quot;</span><span class="p">,</span> <span class="n">Text</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;cover_image&quot;</span><span class="p">,</span> <span class="n">Blob</span><span class="p">),</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Book</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="n">mapper_registry</span><span class="o">.</span><span class="n">map_imperatively</span><span class="p">(</span>
    <span class="n">Book</span><span class="p">,</span>
    <span class="n">book_table</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="n">deferred</span><span class="p">(</span><span class="n">book_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">summary</span><span class="p">),</span>
        <span class="s2">&quot;cover_image&quot;</span><span class="p">:</span> <span class="n">deferred</span><span class="p">(</span><span class="n">book_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cover_image</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p><a class="reference internal" href="#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal notranslate"><span class="pre">deferred()</span></code></a> may also be used in place of <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_property()</span></code></a> when mapped SQL expressions should be loaded on a deferred basis:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">deferred</span>


<span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">firstname</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">()</span>
    <span class="n">lastname</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">()</span>
    <span class="n">fullname</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">deferred</span><span class="p">(</span><span class="n">firstname</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">lastname</span><span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../mapped_sql_expr.html#mapper-column-property-sql-expressions"><span class="std std-ref">使用 column_property</span></a> - in the section <a class="reference internal" href="../mapped_sql_expr.html#mapper-sql-expressions"><span class="std std-ref">SQL 表达式作为映射属性</span></a></p>
<p><a class="reference internal" href="../declarative_tables.html#orm-imperative-table-column-options"><span class="std std-ref">为命令式表应用加载、持久性和映射选项列</span></a> - in the section <a class="reference internal" href="../declarative_tables.html#orm-declarative-table-config-toplevel"><span class="std std-ref">声明式的表配置</span></a></p>
</div>
</div>
</div>
</section>
<section id="undefer">
<h3>使用 <code class="docutils literal notranslate"><span class="pre">undefer()</span></code> “急切地” 加载延迟列<a class="headerlink" href="#undefer" title="Link to this heading">¶</a></h3>
<p>Using <code class="docutils literal notranslate"><span class="pre">undefer()</span></code> to “eagerly” load deferred columns</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--9-input--1" name="tab-set--9" type="radio"><label class="tab-label" for="tab-set--9-input--1">中文</label><div class="tab-content docutils container">
<p>对于在映射中配置为默认延迟加载的列，<a class="reference internal" href="#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer()</span></code></a> 选项可以使这些通常被延迟加载的列被“取消延迟”，也就是说，这些列将与映射中的其他列一起被立即加载。例如，我们可以对 <code class="docutils literal notranslate"><span class="pre">Book.summary</span></code> 列应用 <a class="reference internal" href="#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer()</span></code></a>，该列在前面的映射中被标记为了延迟加载:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">undefer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">undefer</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">summary</span><span class="p">)))</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>此时 <code class="docutils literal notranslate"><span class="pre">Book.summary</span></code> 列已被预加载，可以在不发出额外 SQL 的情况下访问其内容:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
<span class="go">another long summary</span></pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--9-input--2" name="tab-set--9" type="radio"><label class="tab-label" for="tab-set--9-input--2">英文</label><div class="tab-content docutils container">
<p>With columns configured on mappings to defer by default, the <a class="reference internal" href="#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer()</span></code></a> option will cause any column that is normally deferred to be undeferred, that is, to load up front with all the other columns of the mapping.   For example we may apply <a class="reference internal" href="#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer()</span></code></a> to the <code class="docutils literal notranslate"><span class="pre">Book.summary</span></code> column, which is indicated in the previous mapping as deferred:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">undefer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">undefer</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">summary</span><span class="p">)))</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Book.summary</span></code> column was now eagerly loaded, and may be accessed without additional SQL being emitted:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
<span class="go">another long summary</span></pre></div>
</div>
</div>
</div>
</section>
<section id="orm-queryguide-deferred-group">
<span id="id8"></span><h3>按组加载延迟列<a class="headerlink" href="#orm-queryguide-deferred-group" title="Link to this heading">¶</a></h3>
<p>Loading deferred columns in groups</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--10-input--1" name="tab-set--10" type="radio"><label class="tab-label" for="tab-set--10-input--1">中文</label><div class="tab-content docutils container">
<p>通常情况下，当某列通过 <code class="docutils literal notranslate"><span class="pre">mapped_column(deferred=True)</span></code> 进行映射时，当对象访问该延迟加载的属性时，将会发出一条 SQL 语句来仅加载该特定列，而不会加载其他列，即使该映射中还有其他也被标记为延迟加载的列。在常见情况下，如果该延迟属性属于一组应当一次性加载的属性，而不是为每个属性分别发出 SQL，则可以使用 <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column.params.deferred_group" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.deferred_group</span></code></a> 参数。该参数接受一个任意字符串，用于定义一个共同的列组，这些列将在访问其中任何一个时一并取消延迟加载:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">Book</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="go">...     __tablename__ = &quot;book&quot;</span>
<span class="go">...     id: Mapped[int] = mapped_column(primary_key=True)</span>
<span class="go">...     owner_id: Mapped[int] = mapped_column(ForeignKey(&quot;user_account.id&quot;))</span>
<span class="go">...     title: Mapped[str]</span>
<span class="go">...     summary: Mapped[str] = mapped_column(</span>
<span class="go">...         Text, deferred=True, deferred_group=&quot;book_attrs&quot;</span>
<span class="go">...     )</span>
<span class="go">...     cover_photo: Mapped[bytes] = mapped_column(</span>
<span class="go">...         LargeBinary, deferred=True, deferred_group=&quot;book_attrs&quot;</span>
<span class="go">...     )</span>
<span class="go">...</span>
<span class="go">...     def __repr__(self) -&gt; str:</span>
<span class="go">...         return f&quot;Book(id={self.id!r}, title={self.title!r})&quot;</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>使用上述映射，当访问 <code class="docutils literal notranslate"><span class="pre">summary</span></code> 或 <code class="docutils literal notranslate"><span class="pre">cover_photo</span></code> 任一属性时，两者将通过一条 SELECT 语句一并加载:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">))</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">img_data</span><span class="p">,</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">cover_photo</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">summary</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_summary</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div></pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--10-input--2" name="tab-set--10" type="radio"><label class="tab-label" for="tab-set--10-input--2">英文</label><div class="tab-content docutils container">
<p>Normally when a column is mapped with <code class="docutils literal notranslate"><span class="pre">mapped_column(deferred=True)</span></code>, when the deferred attribute is accessed on an object, SQL will be emitted to load only that specific column and no others, even if the mapping has other columns that are also marked as deferred. In the common case that the deferred attribute is part of a group of attributes that should all load at once, rather than emitting SQL for each attribute individually, the <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column.params.deferred_group" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.deferred_group</span></code></a> parameter may be used, which accepts an arbitrary string which will define a common group of columns to be undeferred:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">Book</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="go">...     __tablename__ = &quot;book&quot;</span>
<span class="go">...     id: Mapped[int] = mapped_column(primary_key=True)</span>
<span class="go">...     owner_id: Mapped[int] = mapped_column(ForeignKey(&quot;user_account.id&quot;))</span>
<span class="go">...     title: Mapped[str]</span>
<span class="go">...     summary: Mapped[str] = mapped_column(</span>
<span class="go">...         Text, deferred=True, deferred_group=&quot;book_attrs&quot;</span>
<span class="go">...     )</span>
<span class="go">...     cover_photo: Mapped[bytes] = mapped_column(</span>
<span class="go">...         LargeBinary, deferred=True, deferred_group=&quot;book_attrs&quot;</span>
<span class="go">...     )</span>
<span class="go">...</span>
<span class="go">...     def __repr__(self) -&gt; str:</span>
<span class="go">...         return f&quot;Book(id={self.id!r}, title={self.title!r})&quot;</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>Using the above mapping, accessing either <code class="docutils literal notranslate"><span class="pre">summary</span></code> or <code class="docutils literal notranslate"><span class="pre">cover_photo</span></code> will load both columns at once using just one SELECT statement:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">))</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">img_data</span><span class="p">,</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">cover_photo</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">summary</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_summary</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div></pre></div>
</div>
</div>
</div>
</section>
<section id="undefer-group">
<h3>使用 <code class="docutils literal notranslate"><span class="pre">undefer_group()</span></code> 按组取消延迟<a class="headerlink" href="#undefer-group" title="Link to this heading">¶</a></h3>
<p>Undeferring by group with <code class="docutils literal notranslate"><span class="pre">undefer_group()</span></code></p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--11-input--1" name="tab-set--11" type="radio"><label class="tab-label" for="tab-set--11-input--1">中文</label><div class="tab-content docutils container">
<p>如果延迟加载的列使用 <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column.params.deferred_group" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.deferred_group</span></code></a> 参数进行了配置，如前一节所介绍的那样，那么可以使用 <a class="reference internal" href="#sqlalchemy.orm.undefer_group" title="sqlalchemy.orm.undefer_group"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer_group()</span></code></a> 选项，通过传入该组的字符串名称，实现整组列的预加载（即非延迟加载）:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">undefer_group</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
<span class="go">...     select(Book).where(Book.id == 2).options(undefer_group(&quot;book_attrs&quot;))</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>此时 <code class="docutils literal notranslate"><span class="pre">summary</span></code> 和 <code class="docutils literal notranslate"><span class="pre">cover_photo</span></code> 两列都已加载，无需额外的数据库访问:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">img_data</span><span class="p">,</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">cover_photo</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">summary</span></pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--11-input--2" name="tab-set--11" type="radio"><label class="tab-label" for="tab-set--11-input--2">英文</label><div class="tab-content docutils container">
<p>If deferred columns are configured with <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column.params.deferred_group" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.deferred_group</span></code></a> as introduced in the preceding section, the entire group may be indicated to load eagerly using the <a class="reference internal" href="#sqlalchemy.orm.undefer_group" title="sqlalchemy.orm.undefer_group"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer_group()</span></code></a> option, passing the string name of the group to be eagerly loaded:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">undefer_group</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
<span class="go">...     select(Book).where(Book.id == 2).options(undefer_group(&quot;book_attrs&quot;))</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>Both <code class="docutils literal notranslate"><span class="pre">summary</span></code> and <code class="docutils literal notranslate"><span class="pre">cover_photo</span></code> are available without additional loads:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">img_data</span><span class="p">,</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">cover_photo</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">summary</span></pre></div>
</div>
</div>
</div>
</section>
<section id="id9">
<h3>对通配符取消延迟<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h3>
<p>Undeferring on wildcards</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--12-input--1" name="tab-set--12" type="radio"><label class="tab-label" for="tab-set--12-input--1">中文</label><div class="tab-content docutils container">
<p>大多数 ORM 加载选项都接受通配表达式 <code class="docutils literal notranslate"><span class="pre">&quot;*&quot;</span></code>，表示该选项应应用于所有相关属性。如果某个映射包含一系列延迟加载的列，那么可以通过使用通配符一次性取消所有列的延迟加载，无需使用组名:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">undefer</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)))</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,)</span>
</div></pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--12-input--2" name="tab-set--12" type="radio"><label class="tab-label" for="tab-set--12-input--2">英文</label><div class="tab-content docutils container">
<p>Most ORM loader options accept a wildcard expression, indicated by <code class="docutils literal notranslate"><span class="pre">&quot;*&quot;</span></code>, which indicates that the option should be applied to all relevant attributes.   If a mapping has a series of deferred columns, all such columns can be undeferred at once, without using a group name, by indicating a wildcard:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">undefer</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)))</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,)</span>
</div></pre></div>
</div>
</div>
</div>
</section>
<section id="orm-queryguide-mapper-deferred-raiseload">
<span id="id10"></span><h3>配置映射器级“raiseload”行为<a class="headerlink" href="#orm-queryguide-mapper-deferred-raiseload" title="Link to this heading">¶</a></h3>
<p>Configuring mapper-level “raiseload” behavior</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--13-input--1" name="tab-set--13" type="radio"><label class="tab-label" for="tab-set--13-input--1">中文</label><div class="tab-content docutils container">
<p>在 <a class="reference internal" href="#orm-queryguide-deferred-raiseload"><span class="std std-ref">使用 raiseload 防止延迟列加载</span></a> 中首次介绍的 “raiseload” 行为，也可以作为默认的 mapper 级别行为使用，方法是使用 <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column.params.deferred_raiseload" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.deferred_raiseload</span></code></a> 参数配置 <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a>。启用该参数后，相关列在任何情况下访问都会抛出异常，除非在查询时通过 <a class="reference internal" href="#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer()</span></code></a> 或 <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> 显式取消延迟加载:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">Book</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="go">...     __tablename__ = &quot;book&quot;</span>
<span class="go">...     id: Mapped[int] = mapped_column(primary_key=True)</span>
<span class="go">...     owner_id: Mapped[int] = mapped_column(ForeignKey(&quot;user_account.id&quot;))</span>
<span class="go">...     title: Mapped[str]</span>
<span class="go">...     summary: Mapped[str] = mapped_column(Text, deferred=True, deferred_raiseload=True)</span>
<span class="go">...     cover_photo: Mapped[bytes] = mapped_column(</span>
<span class="go">...         LargeBinary, deferred=True, deferred_raiseload=True</span>
<span class="go">...     )</span>
<span class="go">...</span>
<span class="go">...     def __repr__(self) -&gt; str:</span>
<span class="go">...         return f&quot;Book(id={self.id!r}, title={self.title!r})&quot;</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>在上述映射中，<code class="docutils literal notranslate"><span class="pre">.summary</span></code> 和 <code class="docutils literal notranslate"><span class="pre">.cover_photo</span></code> 两列默认是不可访问的:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">))</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">summary</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">sqlalchemy.exc.InvalidRequestError: &#39;Book.summary&#39; is not available due to raiseload=True</span></pre></div>
</div>
<p>只有在查询时通过 <a class="reference internal" href="#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer()</span></code></a> 或 <a class="reference internal" href="#sqlalchemy.orm.undefer_group" title="sqlalchemy.orm.undefer_group"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer_group()</span></code></a>，或较不常见的 <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> 显式指定，才能加载这些属性。以下示例中，使用 <code class="docutils literal notranslate"><span class="pre">undefer('*')</span></code> 取消所有列的延迟加载，同时通过 <a class="reference internal" href="api.html#orm-queryguide-populate-existing"><span class="std std-ref">填充现有</span></a> 强制刷新已加载对象的加载策略:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
<span class="go">...     select(Book)</span>
<span class="go">...     .where(Book.id == 2)</span>
<span class="go">...     .options(undefer(&quot;*&quot;))</span>
<span class="go">...     .execution_options(populate_existing=True)</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">summary</span>
<span class="go">&#39;another long summary&#39;</span></pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--13-input--2" name="tab-set--13" type="radio"><label class="tab-label" for="tab-set--13-input--2">英文</label><div class="tab-content docutils container">
<p>The “raiseload” behavior first introduced at <a class="reference internal" href="#orm-queryguide-deferred-raiseload"><span class="std std-ref">使用 raiseload 防止延迟列加载</span></a> may also be applied as a default mapper-level behavior, using the <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column.params.deferred_raiseload" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.deferred_raiseload</span></code></a> parameter of <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a>.  When using this parameter, the affected columns will raise on access in all cases unless explicitly “undeferred” using <a class="reference internal" href="#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer()</span></code></a> or <a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> at query time:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">Book</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="go">...     __tablename__ = &quot;book&quot;</span>
<span class="go">...     id: Mapped[int] = mapped_column(primary_key=True)</span>
<span class="go">...     owner_id: Mapped[int] = mapped_column(ForeignKey(&quot;user_account.id&quot;))</span>
<span class="go">...     title: Mapped[str]</span>
<span class="go">...     summary: Mapped[str] = mapped_column(Text, deferred=True, deferred_raiseload=True)</span>
<span class="go">...     cover_photo: Mapped[bytes] = mapped_column(</span>
<span class="go">...         LargeBinary, deferred=True, deferred_raiseload=True</span>
<span class="go">...     )</span>
<span class="go">...</span>
<span class="go">...     def __repr__(self) -&gt; str:</span>
<span class="go">...         return f&quot;Book(id={self.id!r}, title={self.title!r})&quot;</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>Using the above mapping, the <code class="docutils literal notranslate"><span class="pre">.summary</span></code> and <code class="docutils literal notranslate"><span class="pre">.cover_photo</span></code> columns are by default not loadable:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">))</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">summary</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="go">...</span>
<span class="go">sqlalchemy.exc.InvalidRequestError: &#39;Book.summary&#39; is not available due to raiseload=True</span></pre></div>
</div>
<p>Only by overriding their behavior at query time, typically using <a class="reference internal" href="#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer()</span></code></a> or <a class="reference internal" href="#sqlalchemy.orm.undefer_group" title="sqlalchemy.orm.undefer_group"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer_group()</span></code></a>, or less commonly <a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a>, may the attributes be loaded.  The example below applies <code class="docutils literal notranslate"><span class="pre">undefer('*')</span></code> to undefer all attributes, also making use of <a class="reference internal" href="api.html#orm-queryguide-populate-existing"><span class="std std-ref">填充现有</span></a> to refresh the already-loaded object’s loader options:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
<span class="go">...     select(Book)</span>
<span class="go">...     .where(Book.id == 2)</span>
<span class="go">...     .options(undefer(&quot;*&quot;))</span>
<span class="go">...     .execution_options(populate_existing=True)</span>
<span class="go">... )</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">summary</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">cover_photo</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">book</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">summary</span>
<span class="go">&#39;another long summary&#39;</span></pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="sql">
<span id="orm-queryguide-with-expression"></span><h2>将任意 SQL 表达式加载到对象上<a class="headerlink" href="#sql" title="Link to this heading">¶</a></h2>
<p>Loading Arbitrary SQL Expressions onto Objects</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--14-input--1" name="tab-set--14" type="radio"><label class="tab-label" for="tab-set--14-input--1">中文</label><div class="tab-content docutils container">
<p>如在 <a class="reference internal" href="select.html#orm-queryguide-select-columns"><span class="std std-ref">选择 ORM 实体和属性</span></a> 以及其他部分所讨论的，<a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> 构造可用于在结果集中加载任意 SQL 表达式。例如，如果我们想发出一个查询，加载 <code class="docutils literal notranslate"><span class="pre">User</span></code> 对象的同时，还统计每位 <code class="docutils literal notranslate"><span class="pre">User</span></code> 拥有多少本书，我们可以使用 <code class="docutils literal notranslate"><span class="pre">func.count(Book.id)</span></code> 将一个“计数”列添加到查询中，同时包括对 <code class="docutils literal notranslate"><span class="pre">Book</span></code> 的 JOIN 以及按所有者 ID 进行的 GROUP BY。这样将会返回 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> 对象，每行包含两个条目，一个是 <code class="docutils literal notranslate"><span class="pre">User</span></code>，另一个是 <code class="docutils literal notranslate"><span class="pre">func.count(Book.id)</span></code>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">func</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">id</span><span class="p">))</span><span class="o">.</span><span class="n">join_from</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">owner_id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span><span class="p">,</span> <span class="n">book_count</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">):</span>
<span class="go">...     print(f&quot;Username: {user.name}  Number of books: {book_count}&quot;)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span><span class="p">,</span>
<span class="k">count</span><span class="p">(</span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">count_1</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
</div><span class="go">Username: spongebob  Number of books: 3</span>
<span class="go">Username: sandy  Number of books: 3</span></pre></div>
</div>
<p>在上述示例中， <code class="docutils literal notranslate"><span class="pre">User</span></code> 实体和“图书数量”SQL 表达式是分别返回的。但一种常见用例是构造一个只返回 <code class="docutils literal notranslate"><span class="pre">User</span></code> 对象的查询，例如可以用 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.scalars" title="sqlalchemy.orm.Session.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.scalars()</span></code></a> 来遍历，并将 <code class="docutils literal notranslate"><span class="pre">func.count(Book.id)</span></code> 的结果 <em>动态地</em> 应用于每个 <code class="docutils literal notranslate"><span class="pre">User</span></code> 实例。最终结果类似于将任意 SQL 表达式映射到类上的 <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_property()</span></code></a> 的效果，不同的是表达式可以在查询时动态设置。SQLAlchemy 为这种用例提供了 <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> 加载选项，配合映射级别的 <a class="reference internal" href="#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a> 指令即可实现此功能。</p>
<p>要在查询中使用 <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a>，被映射的类必须预先使用 <a class="reference internal" href="#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a> 指令配置一个 ORM 映射属性；该指令将在类上生成一个适合接收查询时 SQL 表达式的属性。以下我们向 <code class="docutils literal notranslate"><span class="pre">User</span></code> 添加一个新属性 <code class="docutils literal notranslate"><span class="pre">User.book_count</span></code>。该属性是只读的，没有默认值；如果未填充值，在加载实例上访问时通常为 <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">query_expression</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="go">...     __tablename__ = &quot;user_account&quot;</span>
<span class="go">...     id: Mapped[int] = mapped_column(primary_key=True)</span>
<span class="go">...     name: Mapped[str]</span>
<span class="go">...     fullname: Mapped[Optional[str]]</span>
<span class="go">...     book_count: Mapped[int] = query_expression()</span>
<span class="go">...</span>
<span class="go">...     def __repr__(self) -&gt; str:</span>
<span class="go">...         return f&quot;User(id={self.id!r}, name={self.name!r}, fullname={self.fullname!r})&quot;</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>在映射中配置好 <code class="docutils literal notranslate"><span class="pre">User.book_count</span></code> 属性之后，我们就可以使用 <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> 加载选项，将一个 SQL 表达式应用到每个 <code class="docutils literal notranslate"><span class="pre">User</span></code> 实例上:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">with_expression</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User)</span>
<span class="go">...     .join_from(User, Book)</span>
<span class="go">...     .group_by(Book.owner_id)</span>
<span class="go">...     .options(with_expression(User.book_count, func.count(Book.id)))</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">):</span>
<span class="go">...     print(f&quot;Username: {user.name}  Number of books: {user.book_count}&quot;)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">count_1</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
<span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
</div><span class="go">Username: spongebob  Number of books: 3</span>
<span class="go">Username: sandy  Number of books: 3</span></pre></div>
</div>
<p>在上述示例中，我们将 <code class="docutils literal notranslate"><span class="pre">func.count(Book.id)</span></code> 表达式从 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> 的列参数中移除，转而放入 <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> 加载选项中。ORM 会将其视为一种特殊的列加载选项，动态应用于查询语句。</p>
<p>关于 <a class="reference internal" href="#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a> 映射有以下注意事项：</p>
<ul>
<li><p>如果某个对象没有通过 <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> 填充该属性，那么该属性的值将是 <code class="docutils literal notranslate"><span class="pre">None</span></code>，除非在映射中设置了 <a class="reference internal" href="#sqlalchemy.orm.query_expression.params.default_expr" title="sqlalchemy.orm.query_expression"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">query_expression.default_expr</span></code></a> 来指定默认 SQL 表达式。</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> 的值 <strong>不会填充已加载的对象</strong>，除非使用 <a class="reference internal" href="api.html#orm-queryguide-populate-existing"><span class="std std-ref">填充现有</span></a>。下面的示例是 <strong>无效</strong> 的，因为对象 <code class="docutils literal notranslate"><span class="pre">A</span></code> 已经被加载：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 加载第一个 A</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">id</span><span class="p">))</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

<span class="c1"># 使用加载选项再次加载同一个 A；表达式不会被应用</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">with_expression</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">some_expr</span><span class="p">)))</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></pre></div>
</div>
<p>若想在已加载对象上重新填充值，需要使用 <a class="reference internal" href="api.html#orm-queryguide-populate-existing"><span class="std std-ref">填充现有</span></a> 执行选项确保所有列都被重新加载：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">obj</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span>
    <span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">with_expression</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">some_expr</span><span class="p">))</span>
    <span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">populate_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></pre></div>
</div>
</li>
<li><p>一旦对象过期（通过 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.expire" title="sqlalchemy.orm.Session.expire"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expire()</span></code></a> 或 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.commit" title="sqlalchemy.orm.Session.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.commit()</span></code></a> 的 <cite>expire_on_commit</cite> 行为），<a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> 表达式 <strong>将失效</strong>。表达式与其值不再与属性绑定，之后访问会返回 <code class="docutils literal notranslate"><span class="pre">None</span></code>。</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> 作为对象加载选项，仅在 <strong>最外层查询</strong> 中生效，仅适用于完整实体的查询，不适用于任意列选择、子查询或复合语句（如 UNION）的子元素。参见下一节 <a class="reference internal" href="#orm-queryguide-with-expression-unions"><span class="std std-ref">使用 with_expression() 处理 UNION 和其他子查询</span></a> 示例。</p></li>
<li><p>被映射的属性 <strong>不能</strong> 用于查询中的其他部分，例如 WHERE 子句或 ORDER BY 子句中引用临时表达式；如下写法 <strong>无效</strong>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 无法在查询中引用 A.expr</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">with_expression</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">expr</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span>
    <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>上述 WHERE 和 ORDER BY 子句中的 <code class="docutils literal notranslate"><span class="pre">A.expr</span></code> 表达式将解析为 NULL。若要在查询中多处使用该表达式，应提前赋值为变量，然后引用变量：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 提前定义所需表达式，在查询中引用</span>
<span class="n">a_expr</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">y</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">with_expression</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">a_expr</span><span class="p">))</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">a_expr</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span>
    <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">a_expr</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
</li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> 是一个特殊选项，用于在查询时将 SQL 表达式动态应用于映射类。若要将固定 SQL 表达式配置在映射上，请参见 <a class="reference internal" href="../mapped_sql_expr.html#mapper-sql-expressions"><span class="std std-ref">SQL 表达式作为映射属性</span></a>。</p>
</div>
</div>
<input class="tab-input" id="tab-set--14-input--2" name="tab-set--14" type="radio"><label class="tab-label" for="tab-set--14-input--2">英文</label><div class="tab-content docutils container">
<p>As discussed <a class="reference internal" href="select.html#orm-queryguide-select-columns"><span class="std std-ref">选择 ORM 实体和属性</span></a> and elsewhere, the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> construct may be used to load arbitrary SQL expressions in a result set.  Such as if we wanted to issue a query that loads <code class="docutils literal notranslate"><span class="pre">User</span></code> objects, but also includes a count of how many books each <code class="docutils literal notranslate"><span class="pre">User</span></code> owned, we could use <code class="docutils literal notranslate"><span class="pre">func.count(Book.id)</span></code> to add a “count” column to a query which includes a JOIN to <code class="docutils literal notranslate"><span class="pre">Book</span></code> as well as a GROUP BY owner id.  This will yield <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects that each contain two entries, one for <code class="docutils literal notranslate"><span class="pre">User</span></code> and one for <code class="docutils literal notranslate"><span class="pre">func.count(Book.id)</span></code>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">func</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">id</span><span class="p">))</span><span class="o">.</span><span class="n">join_from</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">owner_id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span><span class="p">,</span> <span class="n">book_count</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">):</span>
<span class="go">...     print(f&quot;Username: {user.name}  Number of books: {book_count}&quot;)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span><span class="p">,</span>
<span class="k">count</span><span class="p">(</span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">count_1</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
</div><span class="go">Username: spongebob  Number of books: 3</span>
<span class="go">Username: sandy  Number of books: 3</span></pre></div>
</div>
<p>In the above example, the <code class="docutils literal notranslate"><span class="pre">User</span></code> entity and the “book count” SQL expression are returned separately. However, a popular use case is to produce a query that will yield <code class="docutils literal notranslate"><span class="pre">User</span></code> objects alone, which can be iterated for example using <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.scalars" title="sqlalchemy.orm.Session.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.scalars()</span></code></a>, where the result of the <code class="docutils literal notranslate"><span class="pre">func.count(Book.id)</span></code> SQL expression is applied <em>dynamically</em> to each <code class="docutils literal notranslate"><span class="pre">User</span></code> entity. The end result would be similar to the case where an arbitrary SQL expression were mapped to the class using <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_property()</span></code></a>, except that the SQL expression can be modified at query time. For this use case SQLAlchemy provides the <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> loader option, which when combined with the mapper level <a class="reference internal" href="#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a> directive may produce this result.</p>
<p>To apply <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> to a query, the mapped class must have pre-configured an ORM mapped attribute using the <a class="reference internal" href="#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a> directive; this directive will produce an attribute on the mapped class that is suitable for receiving query-time SQL expressions.  Below we add a new attribute <code class="docutils literal notranslate"><span class="pre">User.book_count</span></code> to <code class="docutils literal notranslate"><span class="pre">User</span></code>.  This ORM mapped attribute is read-only and has no default value; accessing it on a loaded instance will normally produce <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">query_expression</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="go">...     __tablename__ = &quot;user_account&quot;</span>
<span class="go">...     id: Mapped[int] = mapped_column(primary_key=True)</span>
<span class="go">...     name: Mapped[str]</span>
<span class="go">...     fullname: Mapped[Optional[str]]</span>
<span class="go">...     book_count: Mapped[int] = query_expression()</span>
<span class="go">...</span>
<span class="go">...     def __repr__(self) -&gt; str:</span>
<span class="go">...         return f&quot;User(id={self.id!r}, name={self.name!r}, fullname={self.fullname!r})&quot;</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>With the <code class="docutils literal notranslate"><span class="pre">User.book_count</span></code> attribute configured in our mapping, we may populate it with data from a SQL expression using the <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> loader option to apply a custom SQL expression to each <code class="docutils literal notranslate"><span class="pre">User</span></code> object as it’s loaded:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">with_expression</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User)</span>
<span class="go">...     .join_from(User, Book)</span>
<span class="go">...     .group_by(Book.owner_id)</span>
<span class="go">...     .options(with_expression(User.book_count, func.count(Book.id)))</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">):</span>
<span class="go">...     print(f&quot;Username: {user.name}  Number of books: {user.book_count}&quot;)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">count_1</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
<span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
</div><span class="go">Username: spongebob  Number of books: 3</span>
<span class="go">Username: sandy  Number of books: 3</span></pre></div>
</div>
<p>Above, we moved our <code class="docutils literal notranslate"><span class="pre">func.count(Book.id)</span></code> expression out of the columns argument of the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> construct and into the <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> loader option.  The ORM then considers this to be a special column load option that’s applied dynamically to the statement.</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a> mapping has these caveats:</p>
<ul>
<li><p>On an object where <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> were not used to populate the attribute, the attribute on an object instance will have the value <code class="docutils literal notranslate"><span class="pre">None</span></code>, unless on the mapping the <a class="reference internal" href="#sqlalchemy.orm.query_expression.params.default_expr" title="sqlalchemy.orm.query_expression"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">query_expression.default_expr</span></code></a> parameter is set to a default SQL expression.</p></li>
<li><p>The <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> value <strong>does not populate on an object that is already loaded</strong>, unless <a class="reference internal" href="api.html#orm-queryguide-populate-existing"><span class="std std-ref">填充现有</span></a> is used. The example below will <strong>not work</strong>, as the <code class="docutils literal notranslate"><span class="pre">A</span></code> object is already loaded:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># load the first A</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">id</span><span class="p">))</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

<span class="c1"># load the same A with an option; expression will **not** be applied</span>
<span class="c1"># to the already-loaded object</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">with_expression</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">some_expr</span><span class="p">)))</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></pre></div>
</div>
<p>To ensure the attribute is re-loaded on an existing object, use the <a class="reference internal" href="api.html#orm-queryguide-populate-existing"><span class="std std-ref">填充现有</span></a> execution option to ensure all columns are re-populated:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">obj</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span>
    <span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">with_expression</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">some_expr</span><span class="p">))</span>
    <span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">populate_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></pre></div>
</div>
</li>
<li><p>The <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> SQL expression <strong>is lost when the object is expired</strong>.  Once the object is expired, either via <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.expire" title="sqlalchemy.orm.Session.expire"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expire()</span></code></a> or via the expire_on_commit behavior of <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.commit" title="sqlalchemy.orm.Session.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.commit()</span></code></a>, the SQL expression and its value is no longer associated with the attribute and will return <code class="docutils literal notranslate"><span class="pre">None</span></code> on subsequent access.</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a>, as an object loading option, only takes effect on the <strong>outermost part of a query</strong> and only for a query against a full entity, and not for arbitrary column selects, within subqueries, or the elements of a compound statement such as a UNION.  See the next section <a class="reference internal" href="#orm-queryguide-with-expression-unions"><span class="std std-ref">使用 with_expression() 处理 UNION 和其他子查询</span></a> for an example.</p></li>
<li><p>The mapped attribute <strong>cannot</strong> be applied to other parts of the query, such as the WHERE clause, the ORDER BY clause, and make use of the ad-hoc expression; that is, this won’t work:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># can&#39;t refer to A.expr elsewhere in the query</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">with_expression</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">expr</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span>
    <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">A.expr</span></code> expression will resolve to NULL in the above WHERE clause and ORDER BY clause. To use the expression throughout the query, assign to a variable and use that:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># assign desired expression up front, then refer to that in</span>
<span class="c1"># the query</span>
<span class="n">a_expr</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">y</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">select</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">with_expression</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">a_expr</span><span class="p">))</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">a_expr</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span>
    <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">a_expr</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
</li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> option is a special option used to apply SQL expressions to mapped classes dynamically at query time. For ordinary fixed SQL expressions configured on mappers, see the section <a class="reference internal" href="../mapped_sql_expr.html#mapper-sql-expressions"><span class="std std-ref">SQL 表达式作为映射属性</span></a>.</p>
</div>
</div>
</div>
<section id="with-expression-union">
<span id="orm-queryguide-with-expression-unions"></span><h3>使用 <code class="docutils literal notranslate"><span class="pre">with_expression()</span></code> 处理 UNION 和其他子查询<a class="headerlink" href="#with-expression-union" title="Link to this heading">¶</a></h3>
<p>Using <code class="docutils literal notranslate"><span class="pre">with_expression()</span></code> with UNIONs, other subqueries</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--15-input--1" name="tab-set--15" type="radio"><label class="tab-label" for="tab-set--15-input--1">中文</label><div class="tab-content docutils container">
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></pre></div>
</div>
<p><a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> 构造是一个 ORM 加载选项，因此 <strong>只能应用于 SELECT 语句的最外层</strong>，即用于加载特定 ORM 实体的查询。
如果它被用于 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> 语句中，而该语句随后会作为子查询或复合语句（如 UNION）中的元素，则该选项不会生效。</p>
<p>若要在子查询中使用任意 SQL 表达式，应使用常规 Core 风格的方法添加表达式。
要将子查询派生的表达式赋值给 ORM 实体的 <a class="reference internal" href="#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a> 属性，应在 ORM 对象加载的最外层使用 <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a>，并引用子查询中的 SQL 表达式。</p>
<p>在以下示例中，两个 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> 构造分别用于 ORM 实体 <code class="docutils literal notranslate"><span class="pre">A</span></code>，并在其中添加了一个 SQL 表达式并标记为 <code class="docutils literal notranslate"><span class="pre">expr</span></code>，两者通过 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.union_all" title="sqlalchemy.sql.expression.union_all"><code class="xref py py-func docutils literal notranslate"><span class="pre">union_all()</span></code></a> 组合。然后，在最外层使用 <a class="reference internal" href="select.html#orm-queryguide-unions"><span class="std std-ref">从 UNION 和其他集合操作中选择实体</span></a> 中描述的查询技术，从该 UNION 中选择 <code class="docutils literal notranslate"><span class="pre">A</span></code> 实体，并使用 <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> 选项，将 SQL 表达式提取到新加载的 <code class="docutils literal notranslate"><span class="pre">A</span></code> 实例上:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">union_all</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User, func.count(Book.id).label(&quot;book_count&quot;))</span>
<span class="go">...     .join_from(User, Book)</span>
<span class="go">...     .where(User.name == &quot;spongebob&quot;)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User, func.count(Book.id).label(&quot;book_count&quot;))</span>
<span class="go">...     .join_from(User, Book)</span>
<span class="go">...     .where(User.name == &quot;sandy&quot;)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">union_stmt</span> <span class="o">=</span> <span class="n">union_all</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">orm_stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User)</span>
<span class="go">...     .from_statement(union_stmt)</span>
<span class="go">...     .options(with_expression(User.book_count, union_stmt.selected_columns.book_count))</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">orm_stmt</span><span class="p">):</span>
<span class="go">...     print(f&quot;Username: {user.name}  Number of books: {user.book_count}&quot;)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_count</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_count</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;spongebob&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;sandy&#39;</span><span class="p">)</span>
</div><span class="go">Username: spongebob  Number of books: 3</span>
<span class="go">Username: sandy  Number of books: 3</span></pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--15-input--2" name="tab-set--15" type="radio"><label class="tab-label" for="tab-set--15-input--2">英文</label><div class="tab-content docutils container">
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></pre></div>
</div>
<p>The <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> construct is an ORM loader option, and as such may only be applied to the outermost level of a SELECT statement which is to load a particular ORM entity.   It does not have any effect if used inside of a <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> that will then be used as a subquery or as an element within a compound statement such as a UNION.</p>
<p>In order to use arbitrary SQL expressions in subqueries, normal Core-style means of adding expressions should be used. To assemble a subquery-derived expression onto the ORM entity’s <a class="reference internal" href="#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a> attributes, <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> is used at the top layer of ORM object loading, referencing the SQL expression within the subquery.</p>
<p>In the example below, two <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> constructs are used against the ORM entity <code class="docutils literal notranslate"><span class="pre">A</span></code> with an additional SQL expression labeled in <code class="docutils literal notranslate"><span class="pre">expr</span></code>, and combined using <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.union_all" title="sqlalchemy.sql.expression.union_all"><code class="xref py py-func docutils literal notranslate"><span class="pre">union_all()</span></code></a>.  Then, at the topmost layer, the <code class="docutils literal notranslate"><span class="pre">A</span></code> entity is SELECTed from this UNION, using the querying technique described at <a class="reference internal" href="select.html#orm-queryguide-unions"><span class="std std-ref">从 UNION 和其他集合操作中选择实体</span></a>, adding an option with <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> to extract this SQL expression onto newly loaded instances of <code class="docutils literal notranslate"><span class="pre">A</span></code>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">union_all</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User, func.count(Book.id).label(&quot;book_count&quot;))</span>
<span class="go">...     .join_from(User, Book)</span>
<span class="go">...     .where(User.name == &quot;spongebob&quot;)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User, func.count(Book.id).label(&quot;book_count&quot;))</span>
<span class="go">...     .join_from(User, Book)</span>
<span class="go">...     .where(User.name == &quot;sandy&quot;)</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">union_stmt</span> <span class="o">=</span> <span class="n">union_all</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">orm_stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="go">...     select(User)</span>
<span class="go">...     .from_statement(union_stmt)</span>
<span class="go">...     .options(with_expression(User.book_count, union_stmt.selected_columns.book_count))</span>
<span class="go">... )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">orm_stmt</span><span class="p">):</span>
<span class="go">...     print(f&quot;Username: {user.name}  Number of books: {user.book_count}&quot;)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_count</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">book</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">book_count</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">book</span><span class="p">.</span><span class="n">owner_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;spongebob&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;sandy&#39;</span><span class="p">)</span>
</div><span class="go">Username: spongebob  Number of books: 3</span>
<span class="go">Username: sandy  Number of books: 3</span></pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="api">
<h2>列加载 API<a class="headerlink" href="#api" title="Link to this heading">¶</a></h2>
<p>Column Loading API</p>
<div class="table-wrapper longtable docutils container">
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.defer"><span class="sig-name descname">defer</span></a>(key, *, [raiseload])</p></td>
<td><p>Indicate that the given column-oriented attribute should be
deferred, e.g. not loaded until accessed.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.deferred"><span class="sig-name descname">deferred</span></a>(column, *additional_columns, [group, raiseload, comparator_factory, init, repr, default, default_factory, compare, kw_only, hash, active_history, expire_on_flush, info, doc])</p></td>
<td><p>Indicate a column-based mapped attribute that by default will
not load unless accessed.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.load_only"><span class="sig-name descname">load_only</span></a>(*attrs, [raiseload])</p></td>
<td><p>Indicate that for a particular entity, only the given list
of column-based attribute names should be loaded; all others will be
deferred.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.query_expression"><span class="sig-name descname">query_expression</span></a>([default_expr], *, [repr, compare, expire_on_flush, info, doc])</p></td>
<td><p>Indicate an attribute that populates from a query-time SQL expression.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.undefer"><span class="sig-name descname">undefer</span></a>(key)</p></td>
<td><p>Indicate that the given column-oriented attribute should be
undeferred, e.g. specified within the SELECT statement of the entity
as a whole.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.undefer_group"><span class="sig-name descname">undefer_group</span></a>(name)</p></td>
<td><p>Indicate that columns within the given deferred group name should be
undeferred.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.with_expression"><span class="sig-name descname">with_expression</span></a>(key, expression)</p></td>
<td><p>Apply an ad-hoc SQL expression to a “deferred expression”
attribute.</p></td>
</tr>
</tbody>
</table>
</div>
<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.defer">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">defer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raiseload</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_AbstractLoad</span></span></span><a class="headerlink" href="#sqlalchemy.orm.defer" title="Link to this definition">¶</a></dt>
<dd><p>Indicate that the given column-oriented attribute should be
deferred, e.g. not loaded until accessed.</p>
<p>This function is part of the <a class="reference internal" href="relationships.html#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> interface and supports
both method-chained and standalone operation.</p>
<p>e.g.:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">from sqlalchemy.orm import defer</span>

<span class="go">session.query(MyClass).options(</span>
<span class="go">    defer(MyClass.attribute_one), defer(MyClass.attribute_two)</span>
<span class="go">)</span></pre></div>
</div>
<p>To specify a deferred load of an attribute on a related class,
the path can be specified one token at a time, specifying the loading
style for each link along the chain.  To leave the loading style
for a link unchanged, use <a class="reference internal" href="relationships.html#sqlalchemy.orm.defaultload" title="sqlalchemy.orm.defaultload"><code class="xref py py-func docutils literal notranslate"><span class="pre">defaultload()</span></code></a>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">session.query(MyClass).options(</span>
<span class="go">    defaultload(MyClass.someattr).defer(RelatedClass.some_column)</span>
<span class="go">)</span></pre></div>
</div>
<p>Multiple deferral options related to a relationship can be bundled
at once using <a class="reference internal" href="relationships.html#sqlalchemy.orm.Load.options" title="sqlalchemy.orm.Load.options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Load.options()</span></code></a>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">select(MyClass).options(</span>
<span class="go">    defaultload(MyClass.someattr).options(</span>
<span class="go">        defer(RelatedClass.some_column),</span>
<span class="go">        defer(RelatedClass.some_other_column),</span>
<span class="go">        defer(RelatedClass.another_column),</span>
<span class="go">    )</span>
<span class="go">)</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.defer.params.key"></span><strong>key</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.defer.params.key">¶</a> – Attribute to be deferred.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.defer.params.raiseload"></span><strong>raiseload</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.defer.params.raiseload">¶</a> – raise <a class="reference internal" href="../../core/exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-class docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a> rather than
lazy loading a value when the deferred attribute is accessed. Used
to prevent unwanted SQL from being emitted.</p></li>
</ul>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4 版本加入.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#orm-queryguide-column-deferral"><span class="std std-ref">使用【列延迟】限制加载哪些列</span></a> - in the
<a class="reference internal" href="index.html#queryguide-toplevel"><span class="std std-ref">ORM 查询指南</span></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer()</span></code></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.deferred">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">deferred</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">column</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_ORMColumnExprArgument</span><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">additional_columns</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_ORMColumnExprArgument</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raiseload</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">comparator_factory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../internals.html#sqlalchemy.orm.PropComparator" title="sqlalchemy.orm.PropComparator"><span class="pre">PropComparator</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_NoArg</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">_NoArg.NO_ARG</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">repr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_NoArg</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">_NoArg.NO_ARG</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">_NoArg.NO_ARG</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_factory</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_NoArg</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">_NoArg.NO_ARG</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compare</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_NoArg</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">_NoArg.NO_ARG</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kw_only</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_NoArg</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">_NoArg.NO_ARG</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hash</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_NoArg</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">_NoArg.NO_ARG</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">active_history</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expire_on_flush</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">info</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_InfoType</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">doc</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../internals.html#sqlalchemy.orm.MappedSQLExpression" title="sqlalchemy.orm.MappedSQLExpression"><span class="pre">MappedSQLExpression</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.orm.deferred" title="Link to this definition">¶</a></dt>
<dd><p>Indicate a column-based mapped attribute that by default will
not load unless accessed.</p>
<p>When using <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a>, the same functionality as
that of <a class="reference internal" href="#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal notranslate"><span class="pre">deferred()</span></code></a> construct is provided by using the
<a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.mapped_column.params.deferred" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.deferred</span></code></a> parameter.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.deferred.params.*columns"></span><strong>*columns</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.deferred.params.*columns">¶</a> – columns to be mapped.  This is typically a single
<a class="reference internal" href="../../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> object,
however a collection is supported in order
to support multiple columns mapped under the same attribute.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.deferred.params.raiseload"></span><strong>raiseload</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.deferred.params.raiseload">¶</a> – <p>boolean, if True, indicates an exception should be raised
if the load operation is to take place.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4 版本加入.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
<p>Additional arguments are the same as that of <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_property()</span></code></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#orm-queryguide-deferred-imperative"><span class="std std-ref">对命令式映射器、映射 SQL 表达式使用 deferred()</span></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.query_expression">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">query_expression</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">default_expr:</span> <span class="pre">_ORMColumnExprArgument[_T]</span> <span class="pre">=</span> <span class="pre">&lt;sqlalchemy.sql.elements.Null</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">repr:</span> <span class="pre">Union[_NoArg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bool]</span> <span class="pre">=</span> <span class="pre">_NoArg.NO_ARG</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compare:</span> <span class="pre">Union[_NoArg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bool]</span> <span class="pre">=</span> <span class="pre">_NoArg.NO_ARG</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expire_on_flush:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">info:</span> <span class="pre">Optional[_InfoType]</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">doc:</span> <span class="pre">Optional[str]</span> <span class="pre">=</span> <span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../internals.html#sqlalchemy.orm.MappedSQLExpression" title="sqlalchemy.orm.MappedSQLExpression"><span class="pre">MappedSQLExpression</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.orm.query_expression" title="Link to this definition">¶</a></dt>
<dd><p>Indicate an attribute that populates from a query-time SQL expression.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.orm.query_expression.params.default_expr"></span><strong>default_expr</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.query_expression.params.default_expr">¶</a> – Optional SQL expression object that will be used in
all cases if not assigned later with <a class="reference internal" href="#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a>.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#orm-queryguide-with-expression"><span class="std std-ref">将任意 SQL 表达式加载到对象上</span></a> - background and usage examples</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.load_only">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">load_only</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">attrs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raiseload</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_AbstractLoad</span></span></span><a class="headerlink" href="#sqlalchemy.orm.load_only" title="Link to this definition">¶</a></dt>
<dd><p>Indicate that for a particular entity, only the given list
of column-based attribute names should be loaded; all others will be
deferred.</p>
<p>This function is part of the <a class="reference internal" href="relationships.html#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> interface and supports
both method-chained and standalone operation.</p>
<p>Example - given a class <code class="docutils literal notranslate"><span class="pre">User</span></code>, load only the <code class="docutils literal notranslate"><span class="pre">name</span></code> and
<code class="docutils literal notranslate"><span class="pre">fullname</span></code> attributes:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">session.query(User).options(load_only(User.name, User.fullname))</span></pre></div>
</div>
<p>Example - given a relationship <code class="docutils literal notranslate"><span class="pre">User.addresses</span> <span class="pre">-&gt;</span> <span class="pre">Address</span></code>, specify
subquery loading for the <code class="docutils literal notranslate"><span class="pre">User.addresses</span></code> collection, but on each
<code class="docutils literal notranslate"><span class="pre">Address</span></code> object load only the <code class="docutils literal notranslate"><span class="pre">email_address</span></code> attribute:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">session.query(User).options(</span>
<span class="go">    subqueryload(User.addresses).load_only(Address.email_address)</span>
<span class="go">)</span></pre></div>
</div>
<p>For a statement that has multiple entities,
the lead entity can be
specifically referred to using the <a class="reference internal" href="relationships.html#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> constructor:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">stmt = (</span>
<span class="go">    select(User, Address)</span>
<span class="go">    .join(User.addresses)</span>
<span class="go">    .options(</span>
<span class="go">        Load(User).load_only(User.name, User.fullname),</span>
<span class="go">        Load(Address).load_only(Address.email_address),</span>
<span class="go">    )</span>
<span class="go">)</span></pre></div>
</div>
<p>When used together with the
<a class="reference internal" href="api.html#orm-queryguide-populate-existing"><span class="std std-ref">populate_existing</span></a>
execution option only the attributes listed will be refreshed.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.load_only.params.*attrs"></span><strong>*attrs</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.load_only.params.*attrs">¶</a> – Attributes to be loaded, all others will be deferred.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.load_only.params.raiseload"></span><strong>raiseload</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.load_only.params.raiseload">¶</a> – <p>raise <a class="reference internal" href="../../core/exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-class docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a> rather than
lazy loading a value when a deferred attribute is accessed. Used
to prevent unwanted SQL from being emitted.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#orm-queryguide-column-deferral"><span class="std std-ref">使用【列延迟】限制加载哪些列</span></a> - in the
<a class="reference internal" href="index.html#queryguide-toplevel"><span class="std std-ref">ORM 查询指南</span></a></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.load_only.params.*attrs"></span><strong>*attrs</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.load_only.params.*attrs">¶</a> – Attributes to be loaded, all others will be deferred.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.load_only.params.raiseload"></span><strong>raiseload</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.load_only.params.raiseload">¶</a> – <p>raise <a class="reference internal" href="../../core/exceptions.html#sqlalchemy.exc.InvalidRequestError" title="sqlalchemy.exc.InvalidRequestError"><code class="xref py py-class docutils literal notranslate"><span class="pre">InvalidRequestError</span></code></a> rather than
lazy loading a value when a deferred attribute is accessed. Used
to prevent unwanted SQL from being emitted.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.undefer">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">undefer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'*'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_AbstractLoad</span></span></span><a class="headerlink" href="#sqlalchemy.orm.undefer" title="Link to this definition">¶</a></dt>
<dd><p>Indicate that the given column-oriented attribute should be
undeferred, e.g. specified within the SELECT statement of the entity
as a whole.</p>
<p>The column being undeferred is typically set up on the mapping as a
<a class="reference internal" href="#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal notranslate"><span class="pre">deferred()</span></code></a> attribute.</p>
<p>This function is part of the <a class="reference internal" href="relationships.html#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> interface and supports
both method-chained and standalone operation.</p>
<p>Examples:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go"># undefer two columns</span>
<span class="go">session.query(MyClass).options(</span>
<span class="go">    undefer(MyClass.col1), undefer(MyClass.col2)</span>
<span class="go">)</span>

<span class="go"># undefer all columns specific to a single class using Load + *</span>
<span class="go">session.query(MyClass, MyOtherClass).options(Load(MyClass).undefer(&quot;*&quot;))</span>

<span class="go"># undefer a column on a related object</span>
<span class="go">select(MyClass).options(defaultload(MyClass.items).undefer(MyClass.text))</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.orm.undefer.params.key"></span><strong>key</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.undefer.params.key">¶</a> – Attribute to be undeferred.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#orm-queryguide-column-deferral"><span class="std std-ref">使用【列延迟】限制加载哪些列</span></a> - in the
<a class="reference internal" href="index.html#queryguide-toplevel"><span class="std std-ref">ORM 查询指南</span></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.undefer_group" title="sqlalchemy.orm.undefer_group"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer_group()</span></code></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.undefer_group">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">undefer_group</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_AbstractLoad</span></span></span><a class="headerlink" href="#sqlalchemy.orm.undefer_group" title="Link to this definition">¶</a></dt>
<dd><p>Indicate that columns within the given deferred group name should be
undeferred.</p>
<p>The columns being undeferred are set up on the mapping as
<a class="reference internal" href="#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal notranslate"><span class="pre">deferred()</span></code></a> attributes and include a “group” name.</p>
<p>E.g:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">session.query(MyClass).options(undefer_group(&quot;large_attrs&quot;))</span></pre></div>
</div>
<p>To undefer a group of attributes on a related entity, the path can be
spelled out using relationship loader options, such as
<a class="reference internal" href="relationships.html#sqlalchemy.orm.defaultload" title="sqlalchemy.orm.defaultload"><code class="xref py py-func docutils literal notranslate"><span class="pre">defaultload()</span></code></a>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">select(MyClass).options(</span>
<span class="go">    defaultload(&quot;someattr&quot;).undefer_group(&quot;large_attrs&quot;)</span>
<span class="go">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#orm-queryguide-column-deferral"><span class="std std-ref">使用【列延迟】限制加载哪些列</span></a> - in the
<a class="reference internal" href="index.html#queryguide-toplevel"><span class="std std-ref">ORM 查询指南</span></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer()</span></code></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.with_expression">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">with_expression</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_AttrType</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expression</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_ColumnExpressionArgument</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_AbstractLoad</span></span></span><a class="headerlink" href="#sqlalchemy.orm.with_expression" title="Link to this definition">¶</a></dt>
<dd><p>Apply an ad-hoc SQL expression to a “deferred expression”
attribute.</p>
<p>This option is used in conjunction with the
<a class="reference internal" href="#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a> mapper-level construct that indicates an
attribute which should be the target of an ad-hoc SQL expression.</p>
<p>E.g.:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">stmt = select(SomeClass).options(</span>
<span class="go">    with_expression(SomeClass.x_y_expr, SomeClass.x + SomeClass.y)</span>
<span class="go">)</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.with_expression.params.key"></span><strong>key</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.with_expression.params.key">¶</a> – Attribute to be populated</p></li>
<li><p><span class="target" id="sqlalchemy.orm.with_expression.params.expr"></span><strong>expr</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.with_expression.params.expr">¶</a> – SQL expression to be applied to the attribute.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#orm-queryguide-with-expression"><span class="std std-ref">将任意 SQL 表达式加载到对象上</span></a> - background and usage
examples</p>
</div>
</dd></dl>

</section>
</section>
<aside class="topic">
<p class="topic-title">ORM Querying Guide</p>
<p>Next Query Guide Section: <a class="reference internal" href="relationships.html"><span class="doc">关系加载技术</span></a></p>
</aside>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="relationships.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">关系加载技术</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="dml.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">启用 ORM 的 INSERT、UPDATE 和 DELETE 语句</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                <a href="../../copyright.html">Copyright</a> &#169; 2007-2025, the SQLAlchemy authors and contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on 04/05/2025 04:00:26</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">列加载选项</a><ul>
<li><a class="reference internal" href="#orm-queryguide-column-deferral">使用【列延迟】限制加载哪些列</a><ul>
<li><a class="reference internal" href="#load-only">使用 <code class="docutils literal notranslate"><span class="pre">load_only()</span></code> 减少加载的列</a><ul>
<li><a class="reference internal" href="#id3">使用 <code class="docutils literal notranslate"><span class="pre">load_only()</span></code> 处理多个实体</a></li>
<li><a class="reference internal" href="#orm-queryguide-load-only-related">使用 <code class="docutils literal notranslate"><span class="pre">load_only()</span></code> 处理相关对象和集合</a></li>
</ul>
</li>
<li><a class="reference internal" href="#defer">使用 <code class="docutils literal notranslate"><span class="pre">defer()</span></code> 忽略特定列</a></li>
<li><a class="reference internal" href="#raiseload">使用 raiseload 防止延迟列加载</a></li>
</ul>
</li>
<li><a class="reference internal" href="#orm-queryguide-deferred-declarative">在映射上配置列延迟</a><ul>
<li><a class="reference internal" href="#sql-deferred">对命令式映射器、映射 SQL 表达式使用 <code class="docutils literal notranslate"><span class="pre">deferred()</span></code></a></li>
<li><a class="reference internal" href="#undefer">使用 <code class="docutils literal notranslate"><span class="pre">undefer()</span></code> “急切地” 加载延迟列</a></li>
<li><a class="reference internal" href="#orm-queryguide-deferred-group">按组加载延迟列</a></li>
<li><a class="reference internal" href="#undefer-group">使用 <code class="docutils literal notranslate"><span class="pre">undefer_group()</span></code> 按组取消延迟</a></li>
<li><a class="reference internal" href="#id9">对通配符取消延迟</a></li>
<li><a class="reference internal" href="#orm-queryguide-mapper-deferred-raiseload">配置映射器级“raiseload”行为</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sql">将任意 SQL 表达式加载到对象上</a><ul>
<li><a class="reference internal" href="#with-expression-union">使用 <code class="docutils literal notranslate"><span class="pre">with_expression()</span></code> 处理 UNION 和其他子查询</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api">列加载 API</a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.defer"><code class="docutils literal notranslate"><span class="pre">defer()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.deferred"><code class="docutils literal notranslate"><span class="pre">deferred()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.query_expression"><code class="docutils literal notranslate"><span class="pre">query_expression()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.load_only"><code class="docutils literal notranslate"><span class="pre">load_only()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.undefer"><code class="docutils literal notranslate"><span class="pre">undefer()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.undefer_group"><code class="docutils literal notranslate"><span class="pre">undefer_group()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.with_expression"><code class="docutils literal notranslate"><span class="pre">with_expression()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../_static/documentation_options.js?v=2d0eb83f"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/tabs.js?v=3ee01567"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=2f3e6152"></script>
    <script src="../../_static/translations.js?v=beaddf03"></script>
    </body>
</html>