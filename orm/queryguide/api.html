<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="索引" href="../../genindex.html" /><link rel="search" title="搜索" href="../../search.html" /><link rel="copyright" title="版权所有" href="../../copyright.html" /><link rel="next" title="旧式查询 API" href="query.html" /><link rel="prev" title="关系加载技术" href="relationships.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.08.06 -->
        <title>用于查询的 ORM API 功能 - SQLAlchemy 2.1 Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/changelog.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_paramlinks.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/docs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">SQLAlchemy 2.1 Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">SQLAlchemy 2.1 Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">概述</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorial/index.html">SQLAlchemy 统一教程</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of SQLAlchemy 统一教程</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/engine.html">建立连接 - Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/dbapi_transactions.html">使用事务和DBAPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/metadata.html">使用数据库元数据</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../tutorial/data.html">处理数据</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of 处理数据</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorial/data_insert.html">使用 INSERT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorial/data_select.html">使用 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorial/data_update.html">使用 UPDATE 和 DELETE 语句</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/orm_data_manipulation.html">使用 ORM 进行数据操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/orm_related_objects.html">使用 ORM 相关对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/further_reading.html">进一步阅读</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">SQLAlchemy ORM</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of SQLAlchemy ORM</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html">ORM 快速入门</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../mapper_config.html">ORM 映射类配置</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of ORM 映射类配置</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../mapping_styles.html">ORM 映射类概述</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../declarative_mapping.html">使用声明式映射类</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of 使用声明式映射类</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../declarative_styles.html">声明式映射风格</a></li>
<li class="toctree-l4"><a class="reference internal" href="../declarative_tables.html">声明式的表配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="../declarative_config.html">使用声明式映射器配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="../declarative_mixins.html">使用 Mixins 组合映射层次结构</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../dataclasses.html">与dataclass和attrs的集成</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mapped_sql_expr.html">SQL 表达式作为映射属性</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mapped_attributes.html">更改Attribute的行为</a></li>
<li class="toctree-l3"><a class="reference internal" href="../composites.html">复合列类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="../inheritance.html">映射类继承层次结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nonstandard_mappings.html">非传统映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="../versioning.html">配置版本计数器</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mapping_api.html">类映射 API</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../scalar_mapping.html">映射 SQL 表达式</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of 映射 SQL 表达式</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../mapping_columns.html">映射表格列</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../relationships.html">关系配置</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of 关系配置</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic_relationships.html">基本关系模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../self_referential.html">邻接表关系</a></li>
<li class="toctree-l3"><a class="reference internal" href="../join_conditions.html">配置关系连接方式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../large_collections.html">使用大型集合</a></li>
<li class="toctree-l3"><a class="reference internal" href="../collection_api.html">集合自定义和 API 详细信息</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relationship_persistence.html">特殊关系的持久化模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../backref.html">使用旧版“backref”关系参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relationship_api.html">关系 API</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="index.html">ORM 查询指南</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of ORM 查询指南</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="select.html">为 ORM 映射类编写 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="inheritance.html">为继承映射编写 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="dml.html">启用 ORM 的 INSERT、UPDATE 和 DELETE 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="columns.html">列加载选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="relationships.html">关系加载技术</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">用于查询的 ORM API 功能</a></li>
<li class="toctree-l3"><a class="reference internal" href="query.html">旧式查询 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../session.html">使用会话</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of 使用会话</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../session_basics.html">会话基础知识</a></li>
<li class="toctree-l3"><a class="reference internal" href="../session_state_management.html">状态管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cascades.html">级联</a></li>
<li class="toctree-l3"><a class="reference internal" href="../session_transaction.html">事务和连接管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../persistence_techniques.html">附加持久性技术</a></li>
<li class="toctree-l3"><a class="reference internal" href="../contextual.html">上下文/线程本地会话</a></li>
<li class="toctree-l3"><a class="reference internal" href="../session_events.html">使用事件跟踪查询、对象和会话更改</a></li>
<li class="toctree-l3"><a class="reference internal" href="../session_api.html">会话 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../extending.html">事件和内部</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of 事件和内部</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../events.html">ORM 事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../internals.html">ORM 内部</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exceptions.html">ORM 异常</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../extensions/index.html">ORM 扩展</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of ORM 扩展</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../extensions/asyncio.html">异步 I/O (asyncio)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/associationproxy.html">关联代理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/automap.html">自动映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/baked.html">烘焙查询</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/declarative/index.html">声明式扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/mutable.html">突变追踪</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/orderinglist.html">排序列表</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/horizontal_shard.html">水平分片</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/hybrid.html">混合属性</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/indexable.html">Indexable</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extensions/instrumentation.html">替代类检测</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html">核心和 ORM 示例</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../core/index.html">SQLAlchemy Core</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of SQLAlchemy Core</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../core/expression_api.html">SQL 语句和表达式 API</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of SQL 语句和表达式 API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../core/sqlelement.html">列元素和表达式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/operators.html">操作符参考</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/selectable.html">SELECT 和相关构造</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/dml.html">插入,更新,删除</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/functions.html">SQL 和 范型函数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/compiler.html">自定义 SQL 构造和编译扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/serializer.html">表达式序列化器扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/foundation.html">SQL 表达式语言基础构造</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/visitors.html">访问者和遍历实用程序</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../core/schema.html">Schema 定义语言</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of Schema 定义语言</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../core/metadata.html">使用元数据描述数据库</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/reflection.html">反映数据库对象</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/defaults.html">列 INSERT/UPDATE 默认值</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/constraints.html">定义约束和索引</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/ddl.html">自定义 DDL</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../core/types.html">SQL 数据类型对象</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of SQL 数据类型对象</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../core/type_basics.html">类型层次结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/custom_types.html">自定义类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/type_api.html">基本类型 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../core/engines_connections.html">Engine和Connection的使用</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of Engine和Connection的使用</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../core/engines.html">Engine 配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/connections.html">使用Engines和Connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/pooling.html">连接池</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/events.html">核心事件</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../core/api_basics.html">Core API 基础</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of Core API 基础</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../core/event.html">事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/inspection.html">运行时审查 API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/exceptions.html">Core 异常</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/internals.html">Core 内部</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../dialects/index.html">Dialects</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of Dialects</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dialects/postgresql.html">PostgreSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dialects/mysql.html">MySQL 和 MariaDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dialects/sqlite.html">SQLite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dialects/oracle.html">Oracle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dialects/mssql.html">Microsoft SQL Server</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../faq/index.html">常见问题</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of 常见问题</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../faq/installation.html">安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/connections.html">连接 / 引擎</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/metadata_schema.html">元数据 / Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/sqlexpressions.html">SQL 表达式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/ormconfiguration.html">ORM 配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/performance.html">性能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/sessions.html">会话 / 查询</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq/thirdparty.html">第三方包集成问题</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../errors.html">错误消息</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../changelog/index.html">变更和迁移</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of 变更和迁移</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_21.html">SQLAlchemy 2.1 有什么新功能？</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_21.html">2.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_20.html">2.0 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_14.html">1.4 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_13.html">1.3 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_12.html">1.2 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_11.html">1.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_10.html">1.0 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_09.html">0.9 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_08.html">0.8 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_07.html">0.7 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_06.html">0.6 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_05.html">0.5 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_04.html">0.4 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_03.html">0.3 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_02.html">0.2 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/changelog_01.html">0.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_20.html">SQLAlchemy 2.0 - Major Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/whatsnew_20.html">What’s New in SQLAlchemy 2.0?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_14.html">What’s New in SQLAlchemy 1.4?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_13.html">What’s New in SQLAlchemy 1.3?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_12.html">What’s New in SQLAlchemy 1.2?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_11.html">What’s New in SQLAlchemy 1.1?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_10.html">What’s New in SQLAlchemy 1.0?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_09.html">What’s New in SQLAlchemy 0.9?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_08.html">What’s New in SQLAlchemy 0.8?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_07.html">What’s New in SQLAlchemy 0.7?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_06.html">What’s New in SQLAlchemy 0.6?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_05.html">What’s new in SQLAlchemy 0.5?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog/migration_04.html">What’s new in SQLAlchemy 0.4?</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <aside class="topic">
<p class="topic-title">ORM Querying Guide</p>
<p>This page is part of the <a class="reference internal" href="index.html"><span class="doc">ORM 查询指南</span></a>.</p>
<p>Previous: <a class="reference internal" href="relationships.html"><span class="doc">关系加载技术</span></a>   |   Next: <a class="reference internal" href="query.html"><span class="doc">旧式查询 API</span></a></p>
</aside>
<section id="orm-api">
<h1>用于查询的 ORM API 功能<a class="headerlink" href="#orm-api" title="Link to this heading">¶</a></h1>
<p>ORM API Features for Querying</p>
<section id="orm">
<h2>ORM 加载器选项<a class="headerlink" href="#orm" title="Link to this heading">¶</a></h2>
<p>ORM Loader Options</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">中文</label><div class="tab-content docutils container">
<p>加载器选项是对象，当它们传递给 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.options" title="sqlalchemy.sql.expression.Select.options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.options()</span></code></a> 方法时，作用于 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> 对象或类似 SQL 结构，影响列属性和关系属性的加载。大多数加载器选项都源自 <a class="reference internal" href="relationships.html#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> 层次结构。有关使用加载器选项的完整概述，请参阅下面的链接部分。</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<ul class="simple">
<li><p><a class="reference internal" href="columns.html#loading-columns"><span class="std std-ref">列加载选项</span></a> - 详细说明影响列和 SQL 表达式映射属性加载的映射器和加载选项</p></li>
<li><p><a class="reference internal" href="relationships.html#loading-toplevel"><span class="std std-ref">关系加载技术</span></a> - 详细说明影响 <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> 映射属性加载的关系和加载选项</p></li>
</ul>
</div>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">英文</label><div class="tab-content docutils container">
<p>Loader options are objects which, when passed to the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.options" title="sqlalchemy.sql.expression.Select.options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.options()</span></code></a> method of a <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> object or similar SQL construct, affect the loading of both column and relationship-oriented attributes. The majority of loader options descend from the <a class="reference internal" href="relationships.html#sqlalchemy.orm.Load" title="sqlalchemy.orm.Load"><code class="xref py py-class docutils literal notranslate"><span class="pre">Load</span></code></a> hierarchy. For a complete overview of using loader options, see the linked sections below.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<ul class="simple">
<li><p><a class="reference internal" href="columns.html#loading-columns"><span class="std std-ref">列加载选项</span></a> - details mapper and loading options that affect how column and SQL-expression mapped attributes are loaded</p></li>
<li><p><a class="reference internal" href="relationships.html#loading-toplevel"><span class="std std-ref">关系加载技术</span></a> - details relationship and loading options that affect how <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> mapped attributes are loaded</p></li>
</ul>
</div>
</div>
</div>
</section>
<section id="orm-queryguide-execution-options">
<span id="id1"></span><h2>ORM 执行选项<a class="headerlink" href="#orm-queryguide-execution-options" title="Link to this heading">¶</a></h2>
<p>ORM Execution Options</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--1-input--1" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--1">中文</label><div class="tab-content docutils container">
<p>ORM 层级的执行选项是关键字选项，它们可以通过 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.execute.params.execution_options" title="sqlalchemy.orm.Session.execute"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.execute.execution_options</span></code></a> 参数与语句执行相关联，这是一个字典参数，接受 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 方法，如 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.execute" title="sqlalchemy.orm.Session.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code></a> 和 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.scalars" title="sqlalchemy.orm.Session.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.scalars()</span></code></a>，或者通过直接与将要调用的语句本身关联，使用 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Executable.execution_options" title="sqlalchemy.sql.expression.Executable.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Executable.execution_options()</span></code></a> 方法，该方法接受任意关键字参数。</p>
<p>ORM 层级选项与 Core 层级的执行选项不同，后者在 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Connection.execution_options" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code></a> 中有文档说明。需要注意的是，下文讨论的 ORM 选项与 Core 层级的方法 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Connection.execution_options" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code></a> 或 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Engine.execution_options" title="sqlalchemy.engine.Engine.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.execution_options()</span></code></a> <strong>不兼容</strong>；即使 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> 或 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> 与正在使用的 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 关联，这些选项也会被忽略。</p>
<p>在本节中，将使用 <code class="docutils literal notranslate"><span class="pre">_sql.Executable.execution_options</span></code> 方法样式进行示例说明。</p>
</div>
<input class="tab-input" id="tab-set--1-input--2" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--2">英文</label><div class="tab-content docutils container">
<p>ORM-level execution options are keyword options that may be associated with a statement execution using either the <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.execute.params.execution_options" title="sqlalchemy.orm.Session.execute"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.execute.execution_options</span></code></a> parameter, which is a dictionary argument accepted by <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> methods such as <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.execute" title="sqlalchemy.orm.Session.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code></a> and <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.scalars" title="sqlalchemy.orm.Session.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.scalars()</span></code></a>, or by associating them directly with the statement to be invoked itself using the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Executable.execution_options" title="sqlalchemy.sql.expression.Executable.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Executable.execution_options()</span></code></a> method, which accepts them as arbitrary keyword arguments.</p>
<p>ORM-level options are distinct from the Core level execution options documented at <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Connection.execution_options" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code></a>. It’s important to note that the ORM options discussed below are <strong>not</strong> compatible with Core level methods <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Connection.execution_options" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code></a> or <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Engine.execution_options" title="sqlalchemy.engine.Engine.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.execution_options()</span></code></a>; the options are ignored at this level, even if the <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> or <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> is associated with the <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> in use.</p>
<p>Within this section, the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Executable.execution_options" title="sqlalchemy.sql.expression.Executable.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Executable.execution_options()</span></code></a> method style will be illustrated for examples.</p>
</div>
</div>
<section id="orm-queryguide-populate-existing">
<span id="id2"></span><h3>填充现有<a class="headerlink" href="#orm-queryguide-populate-existing" title="Link to this heading">¶</a></h3>
<p>Populate Existing</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--2-input--1" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--1">中文</label><div class="tab-content docutils container">
<p><code class="docutils literal notranslate"><span class="pre">populate_existing</span></code> 执行选项确保，对于所有加载的行，对应的 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 中的实例将被完全刷新——擦除对象中现有的任何数据（包括待处理的更改），并用从结果加载的数据替换。</p>
<p>使用示例如下：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">populate_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<span class="go">{execsql}SELECT user_account.id, user_account.name, user_account.fullname</span>
<span class="go">FROM user_account</span>
<span class="go">...</span></pre></div>
</div>
<p>通常，ORM 对象只会加载一次，如果它们与后续结果行的主键匹配，则不会将该行应用于对象。这是为了保留对象上的待处理未刷新的更改，并避免刷新已存在数据的开销和复杂性。 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 假定使用高度隔离的事务模型，且在事务内期望发生变化的数据（超出本地更改）将通过显式步骤来处理，如此方法所示。</p>
<p>使用 <code class="docutils literal notranslate"><span class="pre">populate_existing</span></code>，可以刷新与查询匹配的任何对象集，并且它还允许控制关系加载器选项。例如，要刷新一个实例，同时刷新相关的对象集：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>
    <span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">populate_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">selectinload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">))</span>
<span class="p">)</span>
<span class="c1"># 将刷新所有匹配的 User 对象以及相关的</span>
<span class="c1"># Address 对象</span>
<span class="n">users</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">scalars</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">populate_existing</span></code> 的另一个使用案例是支持各种属性加载功能，这些功能可以在每个查询基础上更改属性的加载方式。适用的选项包括：</p>
<ul class="simple">
<li><p><a class="reference internal" href="columns.html#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> 选项</p></li>
<li><p><a class="reference internal" href="../internals.html#sqlalchemy.orm.PropComparator.and_" title="sqlalchemy.orm.PropComparator.and_"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PropComparator.and_()</span></code></a> 方法，可修改加载器策略加载的内容</p></li>
<li><p><a class="reference internal" href="relationships.html#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> 选项</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> 选项</p></li>
<li><p><a class="reference internal" href="columns.html#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> 选项，用于选择要刷新的属性</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">populate_existing</span></code> 执行选项等同于 <a class="reference internal" href="query.html#sqlalchemy.orm.Query.populate_existing" title="sqlalchemy.orm.Query.populate_existing"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.populate_existing()</span></code></a> 方法，适用于 <a class="reference internal" href="../../glossary.html#term-1.x-style"><span class="xref std std-term">1.x style</span></a> ORM 查询。</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../../faq/sessions.html#faq-session-identity"><span class="std std-ref">我正在使用 Session 重新加载数据，但它没有看到我在其他地方提交的更改</span></a> - 在 <a class="reference internal" href="../../faq/index.html"><span class="doc">常见问题</span></a> 中</p>
<p><a class="reference internal" href="../session_state_management.html#session-expire"><span class="std std-ref">刷新/过期</span></a> - 在 ORM <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 文档中</p>
</div>
</div>
<input class="tab-input" id="tab-set--2-input--2" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--2">英文^</label><div class="tab-content docutils container">
<p>The <code class="docutils literal notranslate"><span class="pre">populate_existing</span></code> execution option ensures that, for all rows loaded, the corresponding instances in the <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> will be fully refreshed – erasing any existing data within the objects (including pending changes) and replacing with the data loaded from the result.</p>
<p>Example use looks like:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">populate_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span>
<span class="p">...</span>
</div></pre></div>
</div>
<p>Normally, ORM objects are only loaded once, and if they are matched up to the primary key in a subsequent result row, the row is not applied to the object.  This is both to preserve pending, unflushed changes on the object as well as to avoid the overhead and complexity of refreshing data which is already there.   The <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> assumes a default working model of a highly isolated transaction, and to the degree that data is expected to change within the transaction outside of the local changes being made, those use cases would be handled using explicit steps such as this method.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">populate_existing</span></code>, any set of objects that matches a query can be refreshed, and it also allows control over relationship loader options. E.g. to refresh an instance while also refreshing a related set of objects:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>
    <span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">populate_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">selectinload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">))</span>
<span class="p">)</span>
<span class="c1"># will refresh all matching User objects as well as the related</span>
<span class="c1"># Address objects</span>
<span class="n">users</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">scalars</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div>
</div>
<p>Another use case for <code class="docutils literal notranslate"><span class="pre">populate_existing</span></code> is in support of various attribute loading features that can change how an attribute is loaded on a per-query basis.   Options for which this apply include:</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="columns.html#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> option</p></li>
<li><p>The <a class="reference internal" href="../internals.html#sqlalchemy.orm.PropComparator.and_" title="sqlalchemy.orm.PropComparator.and_"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PropComparator.and_()</span></code></a> method that can modify what a loader strategy loads</p></li>
<li><p>The <a class="reference internal" href="relationships.html#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> option</p></li>
<li><p>The <a class="reference internal" href="#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> option</p></li>
<li><p>The <a class="reference internal" href="columns.html#sqlalchemy.orm.load_only" title="sqlalchemy.orm.load_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_only()</span></code></a> option to select what attributes to refresh</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">populate_existing</span></code> execution option is equvialent to the <a class="reference internal" href="query.html#sqlalchemy.orm.Query.populate_existing" title="sqlalchemy.orm.Query.populate_existing"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.populate_existing()</span></code></a> method in <a class="reference internal" href="../../glossary.html#term-1.x-style"><span class="xref std std-term">1.x style</span></a> ORM queries.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../../faq/sessions.html#faq-session-identity"><span class="std std-ref">我正在使用 Session 重新加载数据，但它没有看到我在其他地方提交的更改</span></a> - in <a class="reference internal" href="../../faq/index.html"><span class="doc">常见问题</span></a></p>
<p><a class="reference internal" href="../session_state_management.html#session-expire"><span class="std std-ref">刷新/过期</span></a> - in the ORM <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> documentation</p>
</div>
</div>
</div>
</section>
<section id="orm-queryguide-autoflush">
<span id="id3"></span><h3>自动刷新<a class="headerlink" href="#orm-queryguide-autoflush" title="Link to this heading">¶</a></h3>
<p>Autoflush</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--3-input--1" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--1">中文</label><div class="tab-content docutils container">
<p>此选项在设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code> 时，将导致 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 不调用 “autoflush” 步骤。它相当于使用 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.no_autoflush" title="sqlalchemy.orm.Session.no_autoflush"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Session.no_autoflush</span></code></a> 上下文管理器来禁用 autoflush：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">autoflush</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<span class="go">{execsql}SELECT user_account.id, user_account.name, user_account.fullname</span>
<span class="go">FROM user_account</span>
<span class="go">...</span></pre></div>
</div>
<p>此选项也适用于启用了 ORM 的 <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.expression.Update"><code class="xref py py-class docutils literal notranslate"><span class="pre">Update</span></code></a> 和 <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.Delete" title="sqlalchemy.sql.expression.Delete"><code class="xref py py-class docutils literal notranslate"><span class="pre">Delete</span></code></a> 查询。</p>
<p><code class="docutils literal notranslate"><span class="pre">autoflush</span></code> 执行选项相当于 <a class="reference internal" href="query.html#sqlalchemy.orm.Query.autoflush" title="sqlalchemy.orm.Query.autoflush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.autoflush()</span></code></a> 方法，在 <a class="reference internal" href="../../glossary.html#term-1.x-style"><span class="xref std std-term">1.x style</span></a> ORM 查询中。</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../session_basics.html#session-flushing"><span class="std std-ref">刷新</span></a></p>
</div>
</div>
<input class="tab-input" id="tab-set--3-input--2" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--2">英文</label><div class="tab-content docutils container">
<p>This option, when passed as <code class="docutils literal notranslate"><span class="pre">False</span></code>, will cause the <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> to not invoke the “autoflush” step.  It is equivalent to using the <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.no_autoflush" title="sqlalchemy.orm.Session.no_autoflush"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Session.no_autoflush</span></code></a> context manager to disable autoflush:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">autoflush</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span>
<span class="p">...</span>
</div></pre></div>
</div>
<p>This option will also work on ORM-enabled <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.expression.Update"><code class="xref py py-class docutils literal notranslate"><span class="pre">Update</span></code></a> and <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.Delete" title="sqlalchemy.sql.expression.Delete"><code class="xref py py-class docutils literal notranslate"><span class="pre">Delete</span></code></a> queries.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">autoflush</span></code> execution option is equvialent to the <a class="reference internal" href="query.html#sqlalchemy.orm.Query.autoflush" title="sqlalchemy.orm.Query.autoflush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.autoflush()</span></code></a> method in <a class="reference internal" href="../../glossary.html#term-1.x-style"><span class="xref std std-term">1.x style</span></a> ORM queries.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../session_basics.html#session-flushing"><span class="std std-ref">刷新</span></a></p>
</div>
</div>
</div>
</section>
<section id="yield-per">
<span id="orm-queryguide-yield-per"></span><h3>使用 Yield Per 获取大量结果集<a class="headerlink" href="#yield-per" title="Link to this heading">¶</a></h3>
<p>Fetching Large Result Sets with Yield Per</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--4-input--1" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--1">中文</label><div class="tab-content docutils container">
<p><code class="docutils literal notranslate"><span class="pre">yield_per</span></code> 执行选项是一个整数值，它将导致 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> 一次只缓冲有限数量的行和/或 ORM 对象，然后再将数据提供给客户端。</p>
<p>通常，ORM 会立即获取 <strong>所有</strong> 行，为每一行构建 ORM 对象，并将这些对象组装成一个单一的缓冲区，然后将这个缓冲区传递给 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> 对象，作为返回的行的来源。这样做的理由是确保如联合急加载、结果去重和依赖身份映射保持一致状态的结果处理逻辑能够正确工作。</p>
<p><code class="docutils literal notranslate"><span class="pre">yield_per</span></code> 选项的目的是改变这种行为，使 ORM 结果集优化用于通过非常大的结果集（例如 &gt; 10K 行）进行迭代的场景，在这种情况下，用户已确定上述模式不适用。当使用 <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> 时，ORM 会将 ORM 结果批量为子集合，并在迭代 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> 对象时逐个从每个子集合中返回行，以便 Python 解释器无需声明非常大的内存区域，这既耗时又会导致过度的内存使用。该选项会影响数据库游标的使用方式，以及 ORM 构建行和对象并传递给 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> 的方式。</p>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>从上面可以得出结论， <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> 必须以可迭代的方式消费，也就是说，使用迭代方式，例如 <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">row</span> <span class="pre">in</span> <span class="pre">result</span></code> 或使用部分行方法，如 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result.fetchmany" title="sqlalchemy.engine.Result.fetchmany"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.fetchmany()</span></code></a> 或 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result.partitions" title="sqlalchemy.engine.Result.partitions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.partitions()</span></code></a>。调用 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result.all" title="sqlalchemy.engine.Result.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.all()</span></code></a> 会违背使用 <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> 的目的。</p>
</div>
<p>使用 <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> 相当于同时使用 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a> 执行选项，这会选择使用服务器端游标（如果数据库支持的话），以及在返回的 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> 对象上使用 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a> 方法，后者建立了固定的行大小，并且限制了每次构建的 ORM 对象数量。</p>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p><code class="docutils literal notranslate"><span class="pre">yield_per</span></code> 现在也可以作为 Core 执行选项使用，详细说明请参阅 <a class="reference internal" href="../../core/connections.html#engine-stream-results"><span class="std std-ref">使用服务器端游标（又称流结果）</span></a>。本节详细说明了将 <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> 作为执行选项与 ORM <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 配合使用。在这两种上下文中，该选项的行为尽可能相似。</p>
</div>
<p>在与 ORM 一起使用时， <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> 必须通过在给定语句上使用 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Executable.execution_options" title="sqlalchemy.sql.expression.Executable.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Executable.execution_options()</span></code></a> 方法，或通过将其传递给 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.execute.params.execution_options" title="sqlalchemy.orm.Session.execute"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.execute.execution_options</span></code></a> 参数（例如 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.execute" title="sqlalchemy.orm.Session.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code></a> 或其他类似的 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 方法，如 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.scalars" title="sqlalchemy.orm.Session.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.scalars()</span></code></a>）。以下是获取 ORM 对象的典型用法示例：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">yield_per</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user_obj</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">print</span><span class="p">(</span><span class="n">user_obj</span><span class="p">)</span>
<span class="go">{execsql}SELECT user_account.id, user_account.name, user_account.fullname</span>
<span class="go">FROM user_account</span>
<span class="go">[...] ()</span>
<span class="go">{stop}User(id=1, name=&#39;spongebob&#39;, fullname=&#39;Spongebob Squarepants&#39;)</span>
<span class="go">User(id=2, name=&#39;sandy&#39;, fullname=&#39;Sandy Cheeks&#39;)</span>
<span class="go">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># ... 行继续 ...</span></pre></div>
</div>
<p>上面的代码等同于以下示例，后者在 Core 层级执行选项中使用了 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a> 和 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.max_row_buffer" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.max_row_buffer</span></code></a>，并结合了 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a> 方法：</p>
<blockquote>
<div><p># 等效代码
&gt;&gt;&gt; stmt = select(User).execution_options(stream_results=True, max_row_buffer=10)
&gt;&gt;&gt; for user_obj in session.scalars(stmt).yield_per(10):
…     print(user_obj)
{execsql}SELECT user_account.id, user_account.name, user_account.fullname
FROM user_account
[…] ()
{stop}User(id=1, name=’spongebob’, fullname=’Spongebob Squarepants’)
User(id=2, name=’sandy’, fullname=’Sandy Cheeks’)
…
&gt;&gt;&gt; # … 行继续 …</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">yield_per</span></code> 也通常与 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result.partitions" title="sqlalchemy.engine.Result.partitions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.partitions()</span></code></a> 方法结合使用，该方法将按分组的分区迭代行。每个分区的大小默认为传递给 <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> 的整数值，如下所示：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">yield_per</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">partitions</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">user_obj</span> <span class="ow">in</span> <span class="n">partition</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">print</span><span class="p">(</span><span class="n">user_obj</span><span class="p">)</span>
<span class="go">{execsql}SELECT user_account.id, user_account.name, user_account.fullname</span>
<span class="go">FROM user_account</span>
<span class="go">[...] ()</span>
<span class="go">{stop}User(id=1, name=&#39;spongebob&#39;, fullname=&#39;Spongebob Squarepants&#39;)</span>
<span class="go">User(id=2, name=&#39;sandy&#39;, fullname=&#39;Sandy Cheeks&#39;)</span>
<span class="go">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># ... 行继续 ...</span></pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">yield_per</span></code> 执行选项与使用集合的 <a class="reference internal" href="relationships.html#subquery-eager-loading"><span class="std std-ref">“subquery” eager loading</span></a> 或 <a class="reference internal" href="relationships.html#joined-eager-loading"><span class="std std-ref">“joined” eager loading</span></a> 加载不兼容。当使用 <a class="reference internal" href="relationships.html#selectin-eager-loading"><span class="std std-ref">“select in” eager loading</span></a> 时，如果数据库驱动程序支持多个独立游标，它是可能兼容的。</p>
<p>此外， <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> 执行选项与 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result.unique" title="sqlalchemy.engine.Result.unique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.unique()</span></code></a> 方法不兼容；因为该方法依赖于存储所有行的完整身份集，它会必然违背使用 <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> 的目的，后者是为了处理任意大量的行。</p>
<div class="versionchanged">
<p><span class="versionmodified changed">在 1.4.6 版本发生变更: </span>当从使用 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result.unique" title="sqlalchemy.engine.Result.unique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.unique()</span></code></a> 过滤的 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> 对象中获取 ORM 行时，如果同时使用了 <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> 执行选项，将会引发异常。</p>
</div>
<p>当使用遗留的 <a class="reference internal" href="query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> 对象并采用 <a class="reference internal" href="../../glossary.html#term-1.x-style"><span class="xref std std-term">1.x style</span></a> ORM 使用时， <a class="reference internal" href="query.html#sqlalchemy.orm.Query.yield_per" title="sqlalchemy.orm.Query.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.yield_per()</span></code></a> 方法的结果与 <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> 执行选项相同。</p>
</div>
<input class="tab-input" id="tab-set--4-input--2" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--2">英文^</label><div class="tab-content docutils container">
<p>The <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> execution option is an integer value which will cause the <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> to buffer only a limited number of rows and/or ORM objects at a time, before making data available to the client.</p>
<p>Normally, the ORM will fetch <strong>all</strong> rows immediately, constructing ORM objects for each and assembling those objects into a single buffer, before passing this buffer to the <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object as a source of rows to be returned. The rationale for this behavior is to allow correct behavior for features such as joined eager loading, uniquifying of results, and the general case of result handling logic that relies upon the identity map maintaining a consistent state for every object in a result set as it is fetched.</p>
<p>The purpose of the <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> option is to change this behavior so that the ORM result set is optimized for iteration through very large result sets (e.g. &gt; 10K rows), where the user has determined that the above patterns don’t apply. When <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> is used, the ORM will instead batch ORM results into sub-collections and yield rows from each sub-collection individually as the <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object is iterated, so that the Python interpreter doesn’t need to declare very large areas of memory which is both time consuming and leads to excessive memory use. The option affects both the way the database cursor is used as well as how the ORM constructs rows and objects to be passed to the <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a>.</p>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>From the above, it follows that the <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> must be consumed in an iterable fashion, that is, using iteration such as <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">row</span> <span class="pre">in</span> <span class="pre">result</span></code> or using partial row methods such as <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result.fetchmany" title="sqlalchemy.engine.Result.fetchmany"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.fetchmany()</span></code></a> or <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result.partitions" title="sqlalchemy.engine.Result.partitions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.partitions()</span></code></a>. Calling <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result.all" title="sqlalchemy.engine.Result.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.all()</span></code></a> will defeat the purpose of using <code class="docutils literal notranslate"><span class="pre">yield_per</span></code>.</p>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> is equivalent to making use of both the <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a> execution option, which selects for server side cursors to be used by the backend if supported, and the <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a> method on the returned <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object, which establishes a fixed size of rows to be fetched as well as a corresponding limit to how many ORM objects will be constructed at once.</p>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p><code class="docutils literal notranslate"><span class="pre">yield_per</span></code> is now available as a Core execution option as well, described in detail at <a class="reference internal" href="../../core/connections.html#engine-stream-results"><span class="std std-ref">使用服务器端游标（又称流结果）</span></a>.  This section details the use of <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> as an execution option with an ORM <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>.  The option behaves as similarly as possible in both contexts.</p>
</div>
<p>When used with the ORM, <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> must be established either via the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Executable.execution_options" title="sqlalchemy.sql.expression.Executable.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Executable.execution_options()</span></code></a> method on the given statement or by passing it to the <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.execute.params.execution_options" title="sqlalchemy.orm.Session.execute"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.execute.execution_options</span></code></a> parameter of <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.execute" title="sqlalchemy.orm.Session.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code></a> or other similar <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> method such as <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session.scalars" title="sqlalchemy.orm.Session.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.scalars()</span></code></a>.  Typical use for fetching ORM objects is illustrated below:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">yield_per</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user_obj</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">):</span>
<span class="go">...     print(user_obj)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
</div><span class="go">User(id=1, name=&#39;spongebob&#39;, fullname=&#39;Spongebob Squarepants&#39;)</span>
<span class="go">User(id=2, name=&#39;sandy&#39;, fullname=&#39;Sandy Cheeks&#39;)</span>
<span class="go">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># ... rows continue ...</span></pre></div>
</div>
<p>The above code is equivalent to the example below, which uses <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a> and <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.max_row_buffer" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.max_row_buffer</span></code></a> Core-level execution options in conjunction with the <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result.yield_per" title="sqlalchemy.engine.Result.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.yield_per()</span></code></a> method of <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go"># equivalent code</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">stream_results</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_row_buffer</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user_obj</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">yield_per</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<span class="go">...     print(user_obj)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
</div><span class="go">User(id=1, name=&#39;spongebob&#39;, fullname=&#39;Spongebob Squarepants&#39;)</span>
<span class="go">User(id=2, name=&#39;sandy&#39;, fullname=&#39;Sandy Cheeks&#39;)</span>
<span class="go">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># ... rows continue ...</span></pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">yield_per</span></code> is also commonly used in combination with the <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result.partitions" title="sqlalchemy.engine.Result.partitions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.partitions()</span></code></a> method, which will iterate rows in grouped partitions. The size of each partition defaults to the integer value passed to <code class="docutils literal notranslate"><span class="pre">yield_per</span></code>, as in the below example:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">yield_per</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">partitions</span><span class="p">():</span>
<span class="go">...     for user_obj in partition:</span>
<span class="go">...         print(user_obj)</span>
<div class='show_sql'><span class="k">SELECT</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">user_account</span><span class="p">.</span><span class="n">fullname</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">user_account</span>
<span class="p">[...]</span><span class="w"> </span><span class="p">()</span>
</div><span class="go">User(id=1, name=&#39;spongebob&#39;, fullname=&#39;Spongebob Squarepants&#39;)</span>
<span class="go">User(id=2, name=&#39;sandy&#39;, fullname=&#39;Sandy Cheeks&#39;)</span>
<span class="go">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># ... rows continue ...</span></pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> execution option <strong>is not compatible</strong> with <a class="reference internal" href="relationships.html#subquery-eager-loading"><span class="std std-ref">“subquery” eager loading</span></a> loading or <a class="reference internal" href="relationships.html#joined-eager-loading"><span class="std std-ref">“joined” eager loading</span></a> when using collections. It is potentially compatible with <a class="reference internal" href="relationships.html#selectin-eager-loading"><span class="std std-ref">“select in” eager loading</span></a> , provided the database driver supports multiple, independent cursors.</p>
<p>Additionally, the <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> execution option is not compatible with the <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result.unique" title="sqlalchemy.engine.Result.unique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.unique()</span></code></a> method; as this method relies upon storing a complete set of identities for all rows, it would necessarily defeat the purpose of using <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> which is to handle an arbitrarily large number of rows.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">在 1.4.6 版本发生变更: </span>An exception is raised when ORM rows are fetched from a <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object that makes use of the <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Result.unique" title="sqlalchemy.engine.Result.unique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.unique()</span></code></a> filter, at the same time as the <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> execution option is used.</p>
</div>
<p>When using the legacy <a class="reference internal" href="query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object with <a class="reference internal" href="../../glossary.html#term-1.x-style"><span class="xref std std-term">1.x style</span></a> ORM use, the <a class="reference internal" href="query.html#sqlalchemy.orm.Query.yield_per" title="sqlalchemy.orm.Query.yield_per"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.yield_per()</span></code></a> method will have the same result as that of the <code class="docutils literal notranslate"><span class="pre">yield_per</span></code> execution option.</p>
</div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../../core/connections.html#engine-stream-results"><span class="std std-ref">使用服务器端游标（又称流结果）</span></a></p>
</div>
</section>
<section id="queryguide-identity-token">
<span id="id4"></span><h3>身份令牌<a class="headerlink" href="#queryguide-identity-token" title="Link to this heading">¶</a></h3>
<p>Identity Token</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--5-input--1" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--1">中文</label><div class="tab-content docutils container">
<div class="admonition deepalchemy">
<p class="admonition-title">Deep Alchemy</p>
<p>此选项是一个高级功能，主要用于 <a class="reference internal" href="../extensions/horizontal_shard.html#horizontal-sharding-toplevel"><span class="std std-ref">水平分片</span></a> 扩展。在典型场景中，如果需要从不同的“分片”或分区中加载具有相同主键的对象，建议优先为每个分片使用单独的 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 对象。</p>
</div>
<p>“identity token”（身份标记）是一个可以与新加载对象的 <a class="reference internal" href="../../glossary.html#term-identity-key"><span class="xref std std-term">identity key</span></a> 关联的任意值。该元素首先是为了支持进行每行“分片”的扩展而存在，在这些扩展中，对象可能从某一数据库表的多个副本中加载，这些副本之间存在主键重叠的情况。该“identity token”的主要使用者是 <a class="reference internal" href="../extensions/horizontal_shard.html#horizontal-sharding-toplevel"><span class="std std-ref">水平分片</span></a> 扩展，它提供了一个通用框架，用于在一个特定数据库表的多个“分片”之间持久化对象。</p>
<p><code class="docutils literal notranslate"><span class="pre">identity_token</span></code> 执行选项可以在每个查询的基础上使用，从而直接影响此标记。通过直接使用该选项，可以将多个具有相同主键和源表、但“身份”不同的对象实例载入同一个 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 中。</p>
<p>一个使用场景是，通过 <a class="reference internal" href="../../core/connections.html#schema-translating"><span class="std std-ref">模式名称的转换</span></a> 功能，将来自不同 schema 的同名表中的对象加入到 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 中。以下是一个映射示例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeclarativeBase</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">mapped_column</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="p">(</span><span class="n">DeclarativeBase</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyTable</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;my_table&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>上述类的默认 “schema” 名称为 <code class="docutils literal notranslate"><span class="pre">None</span></code>，意味着不会在 SQL 语句中写入 schema 限定名。然而，如果我们使用 <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.schema_translate_map" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.schema_translate_map</span></code></a> 并将 <code class="docutils literal notranslate"><span class="pre">None</span></code> 映射为其他 schema，则可以将 <code class="docutils literal notranslate"><span class="pre">MyTable</span></code> 的实例分别放入两个不同的 schema 中：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg://scott:tiger@localhost/test&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">with</span> <span class="n">Session</span><span class="p">(</span>
    <span class="n">engine</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">schema_translate_map</span><span class="o">=</span><span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="s2">&quot;test_schema&quot;</span><span class="p">})</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MyTable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;this is schema one&quot;</span><span class="p">))</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="k">with</span> <span class="n">Session</span><span class="p">(</span>
    <span class="n">engine</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">schema_translate_map</span><span class="o">=</span><span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="s2">&quot;test_schema_2&quot;</span><span class="p">})</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MyTable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;this is schema two&quot;</span><span class="p">))</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div>
</div>
<p>上面两个代码块分别创建了一个带有不同 schema translate map 的 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 对象，一个 <code class="docutils literal notranslate"><span class="pre">MyTable</span></code> 实例分别被持久化到了 <code class="docutils literal notranslate"><span class="pre">test_schema.my_table</span></code> 和 <code class="docutils literal notranslate"><span class="pre">test_schema_2.my_table</span></code> 表中。</p>
<p>上述两个 <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 对象是彼此独立的。如果我们希望在一次事务中持久化这两个对象，则需要使用 <a class="reference internal" href="../extensions/horizontal_shard.html#horizontal-sharding-toplevel"><span class="std std-ref">水平分片</span></a> 扩展来实现。</p>
<p>然而，我们可以如下所示，在一个 session 中查询这些对象：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="n">obj1</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
        <span class="n">select</span><span class="p">(</span><span class="n">MyTable</span><span class="p">)</span>
        <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">MyTable</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">.</span><span class="n">execution_options</span><span class="p">(</span>
            <span class="n">schema_translate_map</span><span class="o">=</span><span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="s2">&quot;test_schema&quot;</span><span class="p">},</span>
            <span class="n">identity_token</span><span class="o">=</span><span class="s2">&quot;test_schema&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">obj2</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
        <span class="n">select</span><span class="p">(</span><span class="n">MyTable</span><span class="p">)</span>
        <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">MyTable</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">.</span><span class="n">execution_options</span><span class="p">(</span>
            <span class="n">schema_translate_map</span><span class="o">=</span><span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="s2">&quot;test_schema_2&quot;</span><span class="p">},</span>
            <span class="n">identity_token</span><span class="o">=</span><span class="s2">&quot;test_schema_2&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span></pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">obj1</span></code> 和 <code class="docutils literal notranslate"><span class="pre">obj2</span></code> 是彼此独立的。然而，它们都引用了 <code class="docutils literal notranslate"><span class="pre">MyTable</span></code> 类的主键 id 1，但却是不同的对象。这就是 <code class="docutils literal notranslate"><span class="pre">identity_token</span></code> 的作用，可以通过检查每个对象的 <code class="xref py py-attr docutils literal notranslate"><span class="pre">InstanceState.key</span></code> 来观察这两个不同的标识：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">inspect</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span><span class="o">.</span><span class="n">key</span>
<span class="go">(&lt;class &#39;__main__.MyTable&#39;&gt;, (1,), &#39;test_schema&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="p">(</span><span class="n">obj2</span><span class="p">)</span><span class="o">.</span><span class="n">key</span>
<span class="go">(&lt;class &#39;__main__.MyTable&#39;&gt;, (1,), &#39;test_schema_2&#39;)</span></pre></div>
</div>
<p>以上逻辑在使用 <a class="reference internal" href="../extensions/horizontal_shard.html#horizontal-sharding-toplevel"><span class="std std-ref">水平分片</span></a> 扩展时会自动处理。</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.0rc1 版本加入: </span></p>
<ul class="simple">
<li><p>新增了 <code class="docutils literal notranslate"><span class="pre">identity_token</span></code> ORM 层级执行选项。</p></li>
</ul>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../examples.html#examples-sharding"><span class="std std-ref">水平分片</span></a> - 位于 <a class="reference internal" href="../examples.html#examples-toplevel"><span class="std std-ref">核心和 ORM 示例</span></a> 部分。示例脚本 <code class="docutils literal notranslate"><span class="pre">separate_schema_translates.py</span></code> 展示了上述使用场景的完整分片 API 实现。</p>
</div>
</div>
<input class="tab-input" id="tab-set--5-input--2" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--2">英文</label><div class="tab-content docutils container">
<div class="admonition deepalchemy">
<p class="admonition-title">Deep Alchemy</p>
<p>This option is an advanced-use feature mostly intended to be used with the <a class="reference internal" href="../extensions/horizontal_shard.html#horizontal-sharding-toplevel"><span class="std std-ref">水平分片</span></a> extension. For typical cases of loading objects with identical primary keys from different “shards” or partitions, consider using individual <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> objects per shard first.</p>
</div>
<p>The “identity token” is an arbitrary value that can be associated within the <a class="reference internal" href="../../glossary.html#term-identity-key"><span class="xref std std-term">identity key</span></a> of newly loaded objects.   This element exists first and foremost to support extensions which perform per-row “sharding”, where objects may be loaded from any number of replicas of a particular database table that nonetheless have overlapping primary key values. The primary consumer of “identity token” is the <a class="reference internal" href="../extensions/horizontal_shard.html#horizontal-sharding-toplevel"><span class="std std-ref">水平分片</span></a> extension, which supplies a general framework for persisting objects among multiple “shards” of a particular database table.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">identity_token</span></code> execution option may be used on a per-query basis to directly affect this token.   Using it directly, one can populate a <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> with multiple instances of an object that have the same primary key and source table, but different “identities”.</p>
<p>One such example is to populate a <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> with objects that come from same-named tables in different schemas, using the <a class="reference internal" href="../../core/connections.html#schema-translating"><span class="std std-ref">模式名称的转换</span></a> feature which can affect the choice of schema within the scope of queries.  Given a mapping as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeclarativeBase</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">mapped_column</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="p">(</span><span class="n">DeclarativeBase</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyTable</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;my_table&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>The default “schema” name for the class above is <code class="docutils literal notranslate"><span class="pre">None</span></code>, meaning, no schema qualification will be written into SQL statements.  However, if we make use of <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.schema_translate_map" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.schema_translate_map</span></code></a>, mapping <code class="docutils literal notranslate"><span class="pre">None</span></code> to an alternate schema, we can place instances of <code class="docutils literal notranslate"><span class="pre">MyTable</span></code> into two different schemas:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg://scott:tiger@localhost/test&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">with</span> <span class="n">Session</span><span class="p">(</span>
    <span class="n">engine</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">schema_translate_map</span><span class="o">=</span><span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="s2">&quot;test_schema&quot;</span><span class="p">})</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MyTable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;this is schema one&quot;</span><span class="p">))</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="k">with</span> <span class="n">Session</span><span class="p">(</span>
    <span class="n">engine</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">schema_translate_map</span><span class="o">=</span><span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="s2">&quot;test_schema_2&quot;</span><span class="p">})</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MyTable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;this is schema two&quot;</span><span class="p">))</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div>
</div>
<p>The above two blocks create a <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> object linked to a different schema translate map each time, and an instance of <code class="docutils literal notranslate"><span class="pre">MyTable</span></code> is persisted into both <code class="docutils literal notranslate"><span class="pre">test_schema.my_table</span></code> as well as <code class="docutils literal notranslate"><span class="pre">test_schema_2.my_table</span></code>.</p>
<p>The <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> objects above are independent.  If we wanted to persist both objects in one transaction, we would need to use the <a class="reference internal" href="../extensions/horizontal_shard.html#horizontal-sharding-toplevel"><span class="std std-ref">水平分片</span></a> extension to do this.</p>
<p>However, we can illustrate querying for these objects in one session as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="n">obj1</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
        <span class="n">select</span><span class="p">(</span><span class="n">MyTable</span><span class="p">)</span>
        <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">MyTable</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">.</span><span class="n">execution_options</span><span class="p">(</span>
            <span class="n">schema_translate_map</span><span class="o">=</span><span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="s2">&quot;test_schema&quot;</span><span class="p">},</span>
            <span class="n">identity_token</span><span class="o">=</span><span class="s2">&quot;test_schema&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">obj2</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
        <span class="n">select</span><span class="p">(</span><span class="n">MyTable</span><span class="p">)</span>
        <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">MyTable</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">.</span><span class="n">execution_options</span><span class="p">(</span>
            <span class="n">schema_translate_map</span><span class="o">=</span><span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="s2">&quot;test_schema_2&quot;</span><span class="p">},</span>
            <span class="n">identity_token</span><span class="o">=</span><span class="s2">&quot;test_schema_2&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span></pre></div>
</div>
<p>Both <code class="docutils literal notranslate"><span class="pre">obj1</span></code> and <code class="docutils literal notranslate"><span class="pre">obj2</span></code> are distinct from each other.  However, they both refer to primary key id 1 for the <code class="docutils literal notranslate"><span class="pre">MyTable</span></code> class, yet are distinct. This is how the <code class="docutils literal notranslate"><span class="pre">identity_token</span></code> comes into play, which we can see in the inspection of each object, where we look at <code class="xref py py-attr docutils literal notranslate"><span class="pre">InstanceState.key</span></code> to view the two distinct identity tokens:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">inspect</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="p">(</span><span class="n">obj1</span><span class="p">)</span><span class="o">.</span><span class="n">key</span>
<span class="go">(&lt;class &#39;__main__.MyTable&#39;&gt;, (1,), &#39;test_schema&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inspect</span><span class="p">(</span><span class="n">obj2</span><span class="p">)</span><span class="o">.</span><span class="n">key</span>
<span class="go">(&lt;class &#39;__main__.MyTable&#39;&gt;, (1,), &#39;test_schema_2&#39;)</span></pre></div>
</div>
<p>The above logic takes place automatically when using the <a class="reference internal" href="../extensions/horizontal_shard.html#horizontal-sharding-toplevel"><span class="std std-ref">水平分片</span></a> extension.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.0rc1 版本加入: </span></p>
<ul class="simple">
<li><p>added the <code class="docutils literal notranslate"><span class="pre">identity_token</span></code> ORM level execution option.</p></li>
</ul>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../examples.html#examples-sharding"><span class="std std-ref">水平分片</span></a> - in the <a class="reference internal" href="../examples.html#examples-toplevel"><span class="std std-ref">核心和 ORM 示例</span></a> section. See the script <code class="docutils literal notranslate"><span class="pre">separate_schema_translates.py</span></code> for a demonstration of the above use case using the full sharding API.</p>
</div>
</div>
</div>
<section id="orm-select-dml">
<span id="queryguide-inspection"></span><h4>检查启用 ORM 的 SELECT 和 DML 语句中的实体和列<a class="headerlink" href="#orm-select-dml" title="Link to this heading">¶</a></h4>
<p>Inspecting entities and columns from ORM-enabled SELECT and DML statements</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--6-input--1" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--1">中文</label><div class="tab-content docutils container">
<p><a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> 构造函数，以及 <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.insert" title="sqlalchemy.sql.expression.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a>、<a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.update" title="sqlalchemy.sql.expression.update"><code class="xref py py-func docutils literal notranslate"><span class="pre">update()</span></code></a> 和 <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.delete" title="sqlalchemy.sql.expression.delete"><code class="xref py py-func docutils literal notranslate"><span class="pre">delete()</span></code></a> 构造函数（对于后者 DML 构造，自 SQLAlchemy 1.4.33 起），都支持对创建这些语句所引用的实体进行检查，并能获取结果集中将返回的列和数据类型等信息。</p>
<p>对于一个 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> 对象，这些信息可通过其 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.column_descriptions" title="sqlalchemy.sql.expression.Select.column_descriptions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Select.column_descriptions</span></code></a> 属性获得。该属性的行为方式与传统的 <a class="reference internal" href="query.html#sqlalchemy.orm.Query.column_descriptions" title="sqlalchemy.orm.Query.column_descriptions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Query.column_descriptions</span></code></a> 属性相同。返回格式为一个字典列表，如下所示:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pprint</span><span class="w"> </span><span class="kn">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user_alias</span> <span class="o">=</span> <span class="n">aliased</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;user2&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">user_alias</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">column_descriptions</span><span class="p">)</span>
<span class="go">[{&#39;aliased&#39;: False,</span>
<span class="go">&#39;entity&#39;: &lt;class &#39;User&#39;&gt;,</span>
<span class="go">&#39;expr&#39;: &lt;class &#39;User&#39;&gt;,</span>
<span class="go">&#39;name&#39;: &#39;User&#39;,</span>
<span class="go">&#39;type&#39;: &lt;class &#39;User&#39;&gt;},</span>
<span class="go">{&#39;aliased&#39;: False,</span>
<span class="go">&#39;entity&#39;: &lt;class &#39;User&#39;&gt;,</span>
<span class="go">&#39;expr&#39;: &lt;....InstrumentedAttribute object at ...&gt;,</span>
<span class="go">&#39;name&#39;: &#39;id&#39;,</span>
<span class="go">&#39;type&#39;: Integer()},</span>
<span class="go">{&#39;aliased&#39;: True,</span>
<span class="go">&#39;entity&#39;: &lt;AliasedClass ...; User&gt;,</span>
<span class="go">&#39;expr&#39;: &lt;AliasedClass ...; User&gt;,</span>
<span class="go">&#39;name&#39;: &#39;user2&#39;,</span>
<span class="go">&#39;type&#39;: &lt;class &#39;User&#39;&gt;}]</span></pre></div>
</div>
<p>当 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.column_descriptions" title="sqlalchemy.sql.expression.Select.column_descriptions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Select.column_descriptions</span></code></a> 与非 ORM 对象（如普通的 <a class="reference internal" href="../../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> 或 <a class="reference internal" href="../../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> 对象）一起使用时，返回的条目将始终包含有关返回列的基础信息:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">user_table</span><span class="p">,</span> <span class="n">address_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">column_descriptions</span><span class="p">)</span>
<span class="go">[{&#39;expr&#39;: Column(&#39;id&#39;, Integer(), table=&lt;user_account&gt;, primary_key=True, nullable=False),</span>
<span class="go">&#39;name&#39;: &#39;id&#39;,</span>
<span class="go">&#39;type&#39;: Integer()},</span>
<span class="go">{&#39;expr&#39;: Column(&#39;name&#39;, String(), table=&lt;user_account&gt;, nullable=False),</span>
<span class="go">&#39;name&#39;: &#39;name&#39;,</span>
<span class="go">&#39;type&#39;: String()},</span>
<span class="go">{&#39;expr&#39;: Column(&#39;fullname&#39;, String(), table=&lt;user_account&gt;),</span>
<span class="go">&#39;name&#39;: &#39;fullname&#39;,</span>
<span class="go">&#39;type&#39;: String()},</span>
<span class="go">{&#39;expr&#39;: Column(&#39;id&#39;, Integer(), table=&lt;address&gt;, primary_key=True, nullable=False),</span>
<span class="go">&#39;name&#39;: &#39;id_1&#39;,</span>
<span class="go">&#39;type&#39;: Integer()}]</span></pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">在 1.4.33 版本发生变更: </span>当使用在非 ORM 启用的 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> 对象上时，<a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.column_descriptions" title="sqlalchemy.sql.expression.Select.column_descriptions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Select.column_descriptions</span></code></a> 属性现在会返回值；此前会抛出 <code class="docutils literal notranslate"><span class="pre">NotImplementedError</span></code>。</p>
</div>
<p>对于 <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.insert" title="sqlalchemy.sql.expression.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a>、<a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.update" title="sqlalchemy.sql.expression.update"><code class="xref py py-func docutils literal notranslate"><span class="pre">update()</span></code></a> 和 <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.delete" title="sqlalchemy.sql.expression.delete"><code class="xref py py-func docutils literal notranslate"><span class="pre">delete()</span></code></a> 构造函数，有两个独立的属性可用。其一是 <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.UpdateBase.entity_description" title="sqlalchemy.sql.expression.UpdateBase.entity_description"><code class="xref py py-attr docutils literal notranslate"><span class="pre">UpdateBase.entity_description</span></code></a>，该属性返回有关主 ORM 实体及该 DML 语句将影响的数据库表的信息:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">update</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">update</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;somename&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">returning</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">entity_description</span><span class="p">)</span>
<span class="go">{&#39;entity&#39;: &lt;class &#39;User&#39;&gt;,</span>
<span class="go">&#39;expr&#39;: &lt;class &#39;User&#39;&gt;,</span>
<span class="go">&#39;name&#39;: &#39;User&#39;,</span>
<span class="go">&#39;table&#39;: Table(&#39;user_account&#39;, ...),</span>
<span class="go">&#39;type&#39;: &lt;class &#39;User&#39;&gt;}</span></pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p><a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.UpdateBase.entity_description" title="sqlalchemy.sql.expression.UpdateBase.entity_description"><code class="xref py py-attr docutils literal notranslate"><span class="pre">UpdateBase.entity_description</span></code></a> 中包含的 <code class="docutils literal notranslate"><span class="pre">&quot;table&quot;</span></code> 条目表示 <strong>语句将插入、更新或删除的实际数据表</strong>，这通常 <strong>并不等同于</strong> 该类所映射的 SQL “selectable” 对象。例如，在连接表继承（joined-table inheritance）的场景中，<code class="docutils literal notranslate"><span class="pre">&quot;table&quot;</span></code> 将指代该实体对应的局部数据表。</p>
</div>
<p>另一个属性是 <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.UpdateBase.returning_column_descriptions" title="sqlalchemy.sql.expression.UpdateBase.returning_column_descriptions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">UpdateBase.returning_column_descriptions</span></code></a>，它以与 <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.column_descriptions" title="sqlalchemy.sql.expression.Select.column_descriptions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Select.column_descriptions</span></code></a> 类似的方式提供 RETURNING 子句中各列的信息:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">returning_column_descriptions</span><span class="p">)</span>
<span class="go">[{&#39;aliased&#39;: False,</span>
<span class="go">&#39;entity&#39;: &lt;class &#39;User&#39;&gt;,</span>
<span class="go">&#39;expr&#39;: &lt;sqlalchemy.orm.attributes.InstrumentedAttribute ...&gt;,</span>
<span class="go">&#39;name&#39;: &#39;id&#39;,</span>
<span class="go">&#39;type&#39;: Integer()}]</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4.33 版本加入: </span>新增了 <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.UpdateBase.entity_description" title="sqlalchemy.sql.expression.UpdateBase.entity_description"><code class="xref py py-attr docutils literal notranslate"><span class="pre">UpdateBase.entity_description</span></code></a> 和 <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.UpdateBase.returning_column_descriptions" title="sqlalchemy.sql.expression.UpdateBase.returning_column_descriptions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">UpdateBase.returning_column_descriptions</span></code></a> 属性。</p>
</div>
</div>
<input class="tab-input" id="tab-set--6-input--2" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--2">英文</label><div class="tab-content docutils container">
<p>The <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> construct, as well as the <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.insert" title="sqlalchemy.sql.expression.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a>, <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.update" title="sqlalchemy.sql.expression.update"><code class="xref py py-func docutils literal notranslate"><span class="pre">update()</span></code></a> and <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.delete" title="sqlalchemy.sql.expression.delete"><code class="xref py py-func docutils literal notranslate"><span class="pre">delete()</span></code></a> constructs (for the latter DML constructs, as of SQLAlchemy 1.4.33), all support the ability to inspect the entities in which these statements are created against, as well as the columns and datatypes that would be returned in a result set.</p>
<p>For a <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> object, this information is available from the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.column_descriptions" title="sqlalchemy.sql.expression.Select.column_descriptions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Select.column_descriptions</span></code></a> attribute. This attribute operates in the same way as the legacy <a class="reference internal" href="query.html#sqlalchemy.orm.Query.column_descriptions" title="sqlalchemy.orm.Query.column_descriptions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Query.column_descriptions</span></code></a> attribute. The format returned is a list of dictionaries:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pprint</span><span class="w"> </span><span class="kn">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user_alias</span> <span class="o">=</span> <span class="n">aliased</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;user2&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">user_alias</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">column_descriptions</span><span class="p">)</span>
<span class="go">[{&#39;aliased&#39;: False,</span>
<span class="go">&#39;entity&#39;: &lt;class &#39;User&#39;&gt;,</span>
<span class="go">&#39;expr&#39;: &lt;class &#39;User&#39;&gt;,</span>
<span class="go">&#39;name&#39;: &#39;User&#39;,</span>
<span class="go">&#39;type&#39;: &lt;class &#39;User&#39;&gt;},</span>
<span class="go">{&#39;aliased&#39;: False,</span>
<span class="go">&#39;entity&#39;: &lt;class &#39;User&#39;&gt;,</span>
<span class="go">&#39;expr&#39;: &lt;....InstrumentedAttribute object at ...&gt;,</span>
<span class="go">&#39;name&#39;: &#39;id&#39;,</span>
<span class="go">&#39;type&#39;: Integer()},</span>
<span class="go">{&#39;aliased&#39;: True,</span>
<span class="go">&#39;entity&#39;: &lt;AliasedClass ...; User&gt;,</span>
<span class="go">&#39;expr&#39;: &lt;AliasedClass ...; User&gt;,</span>
<span class="go">&#39;name&#39;: &#39;user2&#39;,</span>
<span class="go">&#39;type&#39;: &lt;class &#39;User&#39;&gt;}]</span></pre></div>
</div>
<p>When <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.column_descriptions" title="sqlalchemy.sql.expression.Select.column_descriptions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Select.column_descriptions</span></code></a> is used with non-ORM objects such as plain <a class="reference internal" href="../../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> or <a class="reference internal" href="../../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> objects, the entries will contain basic information about individual columns returned in all cases:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">user_table</span><span class="p">,</span> <span class="n">address_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">column_descriptions</span><span class="p">)</span>
<span class="go">[{&#39;expr&#39;: Column(&#39;id&#39;, Integer(), table=&lt;user_account&gt;, primary_key=True, nullable=False),</span>
<span class="go">&#39;name&#39;: &#39;id&#39;,</span>
<span class="go">&#39;type&#39;: Integer()},</span>
<span class="go">{&#39;expr&#39;: Column(&#39;name&#39;, String(), table=&lt;user_account&gt;, nullable=False),</span>
<span class="go">&#39;name&#39;: &#39;name&#39;,</span>
<span class="go">&#39;type&#39;: String()},</span>
<span class="go">{&#39;expr&#39;: Column(&#39;fullname&#39;, String(), table=&lt;user_account&gt;),</span>
<span class="go">&#39;name&#39;: &#39;fullname&#39;,</span>
<span class="go">&#39;type&#39;: String()},</span>
<span class="go">{&#39;expr&#39;: Column(&#39;id&#39;, Integer(), table=&lt;address&gt;, primary_key=True, nullable=False),</span>
<span class="go">&#39;name&#39;: &#39;id_1&#39;,</span>
<span class="go">&#39;type&#39;: Integer()}]</span></pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">在 1.4.33 版本发生变更: </span>The <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.column_descriptions" title="sqlalchemy.sql.expression.Select.column_descriptions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Select.column_descriptions</span></code></a> attribute now returns a value when used against a <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> that is not ORM-enabled.  Previously, this would raise <code class="docutils literal notranslate"><span class="pre">NotImplementedError</span></code>.</p>
</div>
<p>For <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.insert" title="sqlalchemy.sql.expression.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a>, <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.update" title="sqlalchemy.sql.expression.update"><code class="xref py py-func docutils literal notranslate"><span class="pre">update()</span></code></a> and <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.delete" title="sqlalchemy.sql.expression.delete"><code class="xref py py-func docutils literal notranslate"><span class="pre">delete()</span></code></a> constructs, there are two separate attributes. One is <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.UpdateBase.entity_description" title="sqlalchemy.sql.expression.UpdateBase.entity_description"><code class="xref py py-attr docutils literal notranslate"><span class="pre">UpdateBase.entity_description</span></code></a> which returns information about the primary ORM entity and database table which the DML construct would be affecting:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">update</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">update</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;somename&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">returning</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">entity_description</span><span class="p">)</span>
<span class="go">{&#39;entity&#39;: &lt;class &#39;User&#39;&gt;,</span>
<span class="go">&#39;expr&#39;: &lt;class &#39;User&#39;&gt;,</span>
<span class="go">&#39;name&#39;: &#39;User&#39;,</span>
<span class="go">&#39;table&#39;: Table(&#39;user_account&#39;, ...),</span>
<span class="go">&#39;type&#39;: &lt;class &#39;User&#39;&gt;}</span></pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>The <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.UpdateBase.entity_description" title="sqlalchemy.sql.expression.UpdateBase.entity_description"><code class="xref py py-attr docutils literal notranslate"><span class="pre">UpdateBase.entity_description</span></code></a> includes an entry <code class="docutils literal notranslate"><span class="pre">&quot;table&quot;</span></code> which is actually the <strong>table to be inserted, updated or deleted</strong> by the statement, which is <strong>not</strong> always the same as the SQL “selectable” to which the class may be mapped. For example, in a joined-table inheritance scenario, <code class="docutils literal notranslate"><span class="pre">&quot;table&quot;</span></code> will refer to the local table for the given entity.</p>
</div>
<p>The other is <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.UpdateBase.returning_column_descriptions" title="sqlalchemy.sql.expression.UpdateBase.returning_column_descriptions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">UpdateBase.returning_column_descriptions</span></code></a> which delivers information about the columns present in the RETURNING collection in a manner roughly similar to that of <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.column_descriptions" title="sqlalchemy.sql.expression.Select.column_descriptions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Select.column_descriptions</span></code></a>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">returning_column_descriptions</span><span class="p">)</span>
<span class="go">[{&#39;aliased&#39;: False,</span>
<span class="go">&#39;entity&#39;: &lt;class &#39;User&#39;&gt;,</span>
<span class="go">&#39;expr&#39;: &lt;sqlalchemy.orm.attributes.InstrumentedAttribute ...&gt;,</span>
<span class="go">&#39;name&#39;: &#39;id&#39;,</span>
<span class="go">&#39;type&#39;: Integer()}]</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4.33 版本加入: </span>Added the <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.UpdateBase.entity_description" title="sqlalchemy.sql.expression.UpdateBase.entity_description"><code class="xref py py-attr docutils literal notranslate"><span class="pre">UpdateBase.entity_description</span></code></a> and <a class="reference internal" href="../../core/dml.html#sqlalchemy.sql.expression.UpdateBase.returning_column_descriptions" title="sqlalchemy.sql.expression.UpdateBase.returning_column_descriptions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">UpdateBase.returning_column_descriptions</span></code></a> attributes.</p>
</div>
</div>
</div>
</section>
<section id="queryguide-additional">
<span id="id5"></span><h4>其他 ORM API 构造<a class="headerlink" href="#queryguide-additional" title="Link to this heading">¶</a></h4>
<p>Additional ORM API Constructs</p>
<div class="table-wrapper longtable docutils container">
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.aliased"><span class="sig-name descname">aliased</span></a>(element[, alias, name, flat, ...])</p></td>
<td><p>Produce an alias of the given element, usually an <a class="reference internal" href="#sqlalchemy.orm.util.AliasedClass" title="sqlalchemy.orm.util.AliasedClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedClass</span></code></a>
instance.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.util.AliasedClass"><span class="sig-name descname">AliasedClass</span></a></p></td>
<td><p>Represents an “aliased” form of a mapped class for usage with Query.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.util.AliasedInsp"><span class="sig-name descname">AliasedInsp</span></a></p></td>
<td><p>Provide an inspection interface for an
<a class="reference internal" href="#sqlalchemy.orm.util.AliasedClass" title="sqlalchemy.orm.util.AliasedClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedClass</span></code></a> object.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.Bundle"><span class="sig-name descname">Bundle</span></a></p></td>
<td><p>A grouping of SQL expressions that are returned by a <a class="reference internal" href="query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a>
under one namespace.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.join"><span class="sig-name descname">join</span></a>(left, right[, onclause, isouter, ...])</p></td>
<td><p>Produce an inner join between left and right clauses.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.outerjoin"><span class="sig-name descname">outerjoin</span></a>(left, right[, onclause, full])</p></td>
<td><p>Produce a left outer join between left and right clauses.</p></td>
</tr>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.with_loader_criteria"><span class="sig-name descname">with_loader_criteria</span></a>(entity_or_base, where_criteria[, loader_only, include_aliases, ...])</p></td>
<td><p>Add additional WHERE criteria to the load for all occurrences of
a particular entity.</p></td>
</tr>
<tr class="row-odd"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.with_parent"><span class="sig-name descname">with_parent</span></a>(instance, prop[, from_entity])</p></td>
<td><p>Create filtering criterion that relates this query’s primary entity
to the given related instance, using established
<a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>
configuration.</p></td>
</tr>
</tbody>
</table>
</div>
<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.aliased">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">aliased</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">element</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_EntityType</span><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.FromClause" title="sqlalchemy.sql.expression.FromClause"><span class="pre">FromClause</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">alias</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.FromClause" title="sqlalchemy.sql.expression.FromClause"><span class="pre">FromClause</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flat</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">adapt_on_names</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#sqlalchemy.orm.util.AliasedClass" title="sqlalchemy.orm.util.AliasedClass"><span class="pre">AliasedClass</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.FromClause" title="sqlalchemy.sql.expression.FromClause"><span class="pre">FromClause</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">AliasedType</span><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.orm.aliased" title="Link to this definition">¶</a></dt>
<dd><p>Produce an alias of the given element, usually an <a class="reference internal" href="#sqlalchemy.orm.util.AliasedClass" title="sqlalchemy.orm.util.AliasedClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedClass</span></code></a>
instance.</p>
<p>E.g.:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">my_alias = aliased(MyClass)</span>

<span class="go">stmt = select(MyClass, my_alias).filter(MyClass.id &gt; my_alias.id)</span>
<span class="go">result = session.execute(stmt)</span></pre></div>
</div>
<p>The <a class="reference internal" href="#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a> function is used to create an ad-hoc mapping of a
mapped class to a new selectable.  By default, a selectable is generated
from the normally mapped selectable (typically a <a class="reference internal" href="../../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>
) using the
<a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.FromClause.alias" title="sqlalchemy.sql.expression.FromClause.alias"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FromClause.alias()</span></code></a> method. However, <a class="reference internal" href="#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a>
can also be
used to link the class to a new <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> statement.
Also, the <a class="reference internal" href="inheritance.html#sqlalchemy.orm.with_polymorphic" title="sqlalchemy.orm.with_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_polymorphic()</span></code></a> function is a variant of
<a class="reference internal" href="#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a> that is intended to specify a so-called “polymorphic
selectable”, that corresponds to the union of several joined-inheritance
subclasses at once.</p>
<p>For convenience, the <a class="reference internal" href="#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a> function also accepts plain
<a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.FromClause" title="sqlalchemy.sql.expression.FromClause"><code class="xref py py-class docutils literal notranslate"><span class="pre">FromClause</span></code></a> constructs, such as a
<a class="reference internal" href="../../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> or
<a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> construct.   In those cases, the
<a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.FromClause.alias" title="sqlalchemy.sql.expression.FromClause.alias"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FromClause.alias()</span></code></a>
method is called on the object and the new
<a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Alias" title="sqlalchemy.sql.expression.Alias"><code class="xref py py-class docutils literal notranslate"><span class="pre">Alias</span></code></a> object returned.  The returned
<a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Alias" title="sqlalchemy.sql.expression.Alias"><code class="xref py py-class docutils literal notranslate"><span class="pre">Alias</span></code></a> is not
ORM-mapped in this case.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../../tutorial/data_select.html#tutorial-orm-entity-aliases"><span class="std std-ref">ORM 实体别名</span></a> - in the <a class="reference internal" href="../../tutorial/index.html#unified-tutorial"><span class="std std-ref">SQLAlchemy 统一教程</span></a></p>
<p><a class="reference internal" href="select.html#orm-queryguide-orm-aliases"><span class="std std-ref">选择 ORM 别名</span></a> - in the <a class="reference internal" href="index.html#queryguide-toplevel"><span class="std std-ref">ORM 查询指南</span></a></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.aliased.params.element"></span><strong>element</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.aliased.params.element">¶</a> – element to be aliased.  Is normally a mapped class,
but for convenience can also be a <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.FromClause" title="sqlalchemy.sql.expression.FromClause"><code class="xref py py-class docutils literal notranslate"><span class="pre">FromClause</span></code></a>
element.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.aliased.params.alias"></span><strong>alias</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.aliased.params.alias">¶</a> – Optional selectable unit to map the element to.  This is
usually used to link the object to a subquery, and should be an aliased
select construct as one would produce from the
<a class="reference internal" href="query.html#sqlalchemy.orm.Query.subquery" title="sqlalchemy.orm.Query.subquery"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.subquery()</span></code></a> method or
the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.subquery" title="sqlalchemy.sql.expression.Select.subquery"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.subquery()</span></code></a> or
<a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.alias" title="sqlalchemy.sql.expression.Select.alias"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.alias()</span></code></a> methods of the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a>
construct.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.aliased.params.name"></span><strong>name</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.aliased.params.name">¶</a> – optional string name to use for the alias, if not specified
by the <code class="docutils literal notranslate"><span class="pre">alias</span></code> parameter.  The name, among other things, forms the
attribute name that will be accessible via tuples returned by a
<a class="reference internal" href="query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object.  Not supported when creating aliases
of <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Join" title="sqlalchemy.sql.expression.Join"><code class="xref py py-class docutils literal notranslate"><span class="pre">Join</span></code></a> objects.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.aliased.params.flat"></span><strong>flat</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.aliased.params.flat">¶</a> – <p>Boolean, will be passed through to the
<a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.FromClause.alias" title="sqlalchemy.sql.expression.FromClause.alias"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FromClause.alias()</span></code></a> call so that aliases of
<a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Join" title="sqlalchemy.sql.expression.Join"><code class="xref py py-class docutils literal notranslate"><span class="pre">Join</span></code></a> objects will alias the individual tables
inside the join, rather than creating a subquery.  This is generally
supported by all modern databases with regards to right-nested joins
and generally produces more efficient queries.</p>
<p>When <a class="reference internal" href="#sqlalchemy.orm.aliased.params.flat" title="sqlalchemy.orm.aliased"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">aliased.flat</span></code></a> is combined with
<a class="reference internal" href="#sqlalchemy.orm.aliased.params.name" title="sqlalchemy.orm.aliased"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">aliased.name</span></code></a>, the resulting joins will alias individual
tables using a naming scheme similar to <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;_&lt;tablename&gt;</span></code>.  This
naming scheme is for visibility / debugging purposes only and the
specific scheme is subject to change without notice.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.32 版本加入: </span>added support for combining
<a class="reference internal" href="#sqlalchemy.orm.aliased.params.name" title="sqlalchemy.orm.aliased"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">aliased.name</span></code></a> with <a class="reference internal" href="#sqlalchemy.orm.aliased.params.flat" title="sqlalchemy.orm.aliased"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">aliased.flat</span></code></a>.
Previously, this would raise <code class="docutils literal notranslate"><span class="pre">NotImplementedError</span></code>.</p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.orm.aliased.params.adapt_on_names"></span><strong>adapt_on_names</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.aliased.params.adapt_on_names">¶</a> – <p>if True, more liberal “matching” will be used when
mapping the mapped columns of the ORM entity to those of the
given selectable - a name-based match will be performed if the
given selectable doesn’t otherwise have a column that corresponds
to one on the entity.  The use case for this is when associating
an entity with some derived selectable such as one that uses
aggregate functions:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">class UnitPrice(Base):</span>
<span class="go">    __tablename__ = &quot;unit_price&quot;</span>
<span class="go">    ...</span>
<span class="go">    unit_id = Column(Integer)</span>
<span class="go">    price = Column(Numeric)</span>


<span class="go">aggregated_unit_price = (</span>
<span class="go">    Session.query(func.sum(UnitPrice.price).label(&quot;price&quot;))</span>
<span class="go">    .group_by(UnitPrice.unit_id)</span>
<span class="go">    .subquery()</span>
<span class="go">)</span>

<span class="go">aggregated_unit_price = aliased(</span>
<span class="go">    UnitPrice, alias=aggregated_unit_price, adapt_on_names=True</span>
<span class="go">)</span></pre></div>
</div>
<p>Above, functions on <code class="docutils literal notranslate"><span class="pre">aggregated_unit_price</span></code> which refer to
<code class="docutils literal notranslate"><span class="pre">.price</span></code> will return the
<code class="docutils literal notranslate"><span class="pre">func.sum(UnitPrice.price).label('price')</span></code> column, as it is
matched on the name “price”.  Ordinarily, the “price” function
wouldn’t have any “column correspondence” to the actual
<code class="docutils literal notranslate"><span class="pre">UnitPrice.price</span></code> column as it is not a proxy of the original.</p>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.orm.util.AliasedClass">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.util.</span></span><span class="sig-name descname"><span class="pre">AliasedClass</span></span><a class="headerlink" href="#sqlalchemy.orm.util.AliasedClass" title="Link to this definition">¶</a></dt>
<dd><p>Represents an “aliased” form of a mapped class for usage with Query.</p>
<p>The ORM equivalent of a <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.alias" title="sqlalchemy.sql.expression.alias"><code class="xref py py-func docutils literal notranslate"><span class="pre">alias()</span></code></a>
construct, this object mimics the mapped class using a
<code class="docutils literal notranslate"><span class="pre">__getattr__</span></code> scheme and maintains a reference to a
real <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Alias" title="sqlalchemy.sql.expression.Alias"><code class="xref py py-class docutils literal notranslate"><span class="pre">Alias</span></code></a> object.</p>
<p>A primary purpose of <a class="reference internal" href="#sqlalchemy.orm.util.AliasedClass" title="sqlalchemy.orm.util.AliasedClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedClass</span></code></a> is to serve as an alternate
within a SQL statement generated by the ORM, such that an existing
mapped entity can be used in multiple contexts.   A simple example:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go"># find all pairs of users with the same name</span>
<span class="go">user_alias = aliased(User)</span>
<span class="go">session.query(User, user_alias).join(</span>
<span class="go">    (user_alias, User.id &gt; user_alias.id)</span>
<span class="go">).filter(User.name == user_alias.name)</span></pre></div>
</div>
<p><a class="reference internal" href="#sqlalchemy.orm.util.AliasedClass" title="sqlalchemy.orm.util.AliasedClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedClass</span></code></a> is also capable of mapping an existing mapped
class to an entirely new selectable, provided this selectable is column-
compatible with the existing mapped selectable, and it can also be
configured in a mapping as the target of a <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>.
See the links below for examples.</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.util.AliasedClass" title="sqlalchemy.orm.util.AliasedClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedClass</span></code></a> object is constructed typically using the
<a class="reference internal" href="#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a> function.   It also is produced with additional
configuration when using the <a class="reference internal" href="inheritance.html#sqlalchemy.orm.with_polymorphic" title="sqlalchemy.orm.with_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_polymorphic()</span></code></a> function.</p>
<p>The resulting object is an instance of <a class="reference internal" href="#sqlalchemy.orm.util.AliasedClass" title="sqlalchemy.orm.util.AliasedClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedClass</span></code></a>.
This object implements an attribute scheme which produces the
same attribute and method interface as the original mapped
class, allowing <a class="reference internal" href="#sqlalchemy.orm.util.AliasedClass" title="sqlalchemy.orm.util.AliasedClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedClass</span></code></a> to be compatible
with any attribute technique which works on the original class,
including hybrid attributes (see <a class="reference internal" href="../extensions/hybrid.html#hybrids-toplevel"><span class="std std-ref">混合属性</span></a>).</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.util.AliasedClass" title="sqlalchemy.orm.util.AliasedClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedClass</span></code></a> can be inspected for its underlying
<a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a>, aliased selectable, and other information
using <a class="reference internal" href="../../core/inspection.html#sqlalchemy.inspect" title="sqlalchemy.inspect"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect()</span></code></a>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">from sqlalchemy import inspect</span>

<span class="go">my_alias = aliased(MyClass)</span>
<span class="go">insp = inspect(my_alias)</span></pre></div>
</div>
<p>The resulting inspection object is an instance of <a class="reference internal" href="#sqlalchemy.orm.util.AliasedInsp" title="sqlalchemy.orm.util.AliasedInsp"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedInsp</span></code></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a></p>
<p><a class="reference internal" href="inheritance.html#sqlalchemy.orm.with_polymorphic" title="sqlalchemy.orm.with_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_polymorphic()</span></code></a></p>
<p><a class="reference internal" href="../join_conditions.html#relationship-aliased-class"><span class="std std-ref">与别名类的关系</span></a></p>
<p><a class="reference internal" href="../join_conditions.html#relationship-to-window-function"><span class="std std-ref">使用窗口函数的行限制关系</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.AliasedClass</span></code> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.inspection.Inspectable</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.ORMColumnsClauseRole</span></code>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.orm.util.AliasedInsp">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.util.</span></span><span class="sig-name descname"><span class="pre">AliasedInsp</span></span><a class="headerlink" href="#sqlalchemy.orm.util.AliasedInsp" title="Link to this definition">¶</a></dt>
<dd><p>Provide an inspection interface for an
<a class="reference internal" href="#sqlalchemy.orm.util.AliasedClass" title="sqlalchemy.orm.util.AliasedClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedClass</span></code></a> object.</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.util.AliasedInsp" title="sqlalchemy.orm.util.AliasedInsp"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedInsp</span></code></a> object is returned
given an <a class="reference internal" href="#sqlalchemy.orm.util.AliasedClass" title="sqlalchemy.orm.util.AliasedClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedClass</span></code></a> using the
<a class="reference internal" href="../../core/inspection.html#sqlalchemy.inspect" title="sqlalchemy.inspect"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect()</span></code></a> function:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">from sqlalchemy import inspect</span>
<span class="go">from sqlalchemy.orm import aliased</span>

<span class="go">my_alias = aliased(MyMappedClass)</span>
<span class="go">insp = inspect(my_alias)</span></pre></div>
</div>
<p>Attributes on <a class="reference internal" href="#sqlalchemy.orm.util.AliasedInsp" title="sqlalchemy.orm.util.AliasedInsp"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedInsp</span></code></a>
include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">entity</span></code> - the <a class="reference internal" href="#sqlalchemy.orm.util.AliasedClass" title="sqlalchemy.orm.util.AliasedClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedClass</span></code></a> represented.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mapper</span></code> - the <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> mapping the underlying class.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">selectable</span></code> - the <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Alias" title="sqlalchemy.sql.expression.Alias"><code class="xref py py-class docutils literal notranslate"><span class="pre">Alias</span></code></a>
construct which ultimately
represents an aliased <a class="reference internal" href="../../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> or
<a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a>
construct.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> - the name of the alias.  Also is used as the attribute
name when returned in a result tuple from <a class="reference internal" href="query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">with_polymorphic_mappers</span></code> - collection of <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a>
objects
indicating all those mappers expressed in the select construct
for the <a class="reference internal" href="#sqlalchemy.orm.util.AliasedClass" title="sqlalchemy.orm.util.AliasedClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedClass</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">polymorphic_on</span></code> - an alternate column or SQL expression which
will be used as the “discriminator” for a polymorphic load.</p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../../core/inspection.html#inspection-toplevel"><span class="std std-ref">运行时审查 API</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.AliasedInsp</span></code> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.ORMEntityColumnsClauseRole</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.ORMFromClauseRole</span></code>, <a class="reference internal" href="../../core/foundation.html#sqlalchemy.sql.traversals.HasCacheKey" title="sqlalchemy.sql.cache_key.HasCacheKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.cache_key.HasCacheKey</span></code></a>, <a class="reference internal" href="../internals.html#sqlalchemy.orm.InspectionAttr" title="sqlalchemy.orm.base.InspectionAttr"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.base.InspectionAttr</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.util.langhelpers.MemoizedSlots</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.inspection.Inspectable</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Generic</span></code>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.orm.Bundle">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">Bundle</span></span><a class="headerlink" href="#sqlalchemy.orm.Bundle" title="Link to this definition">¶</a></dt>
<dd><p>A grouping of SQL expressions that are returned by a <a class="reference internal" href="query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a>
under one namespace.</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.Bundle" title="sqlalchemy.orm.Bundle"><code class="xref py py-class docutils literal notranslate"><span class="pre">Bundle</span></code></a> essentially allows nesting of the tuple-based
results returned by a column-oriented <a class="reference internal" href="query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object.
It also
is extensible via simple subclassing, where the primary capability
to override is that of how the set of expressions should be returned,
allowing post-processing as well as custom return types, without
involving ORM identity-mapped classes.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="select.html#bundles"><span class="std std-ref">使用捆绑包对选定属性进行分组</span></a></p>
</div>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.orm.Bundle.__init__"><span class="sig-name descname">__init__()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Bundle.c"><span class="sig-name descname">c</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Bundle.columns"><span class="sig-name descname">columns</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Bundle.create_row_processor"><span class="sig-name descname">create_row_processor()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Bundle.is_aliased_class"><span class="sig-name descname">is_aliased_class</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Bundle.is_bundle"><span class="sig-name descname">is_bundle</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Bundle.is_clause_element"><span class="sig-name descname">is_clause_element</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Bundle.is_mapper"><span class="sig-name descname">is_mapper</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Bundle.label"><span class="sig-name descname">label()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.Bundle.single_entity"><span class="sig-name descname">single_entity</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.orm.Bundle" title="sqlalchemy.orm.Bundle"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.Bundle</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.ORMColumnsClauseRole</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.annotation.SupportsCloneAnnotations</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.cache_key.MemoizedHasCacheKey</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.inspection.Inspectable</span></code>, <a class="reference internal" href="../internals.html#sqlalchemy.orm.InspectionAttr" title="sqlalchemy.orm.base.InspectionAttr"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.base.InspectionAttr</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Bundle.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Bundle"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Bundle.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">exprs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_ColumnExpressionArgument</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.orm.Bundle.__init__" title="Link to this definition">¶</a></dt>
<dd><p>Construct a new <a class="reference internal" href="#sqlalchemy.orm.Bundle" title="sqlalchemy.orm.Bundle"><code class="xref py py-class docutils literal notranslate"><span class="pre">Bundle</span></code></a>.</p>
<p>e.g.:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">bn = Bundle(&quot;mybundle&quot;, MyClass.x, MyClass.y)</span>

<span class="go">for row in session.query(bn).filter(bn.c.x == 5).filter(bn.c.y == 4):</span>
<span class="go">    print(row.mybundle.x, row.mybundle.y)</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.Bundle.params.name"></span><strong>name</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.Bundle.params.name">¶</a> – name of the bundle.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.Bundle.params.*exprs"></span><strong>*exprs</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.Bundle.params.*exprs">¶</a> – columns or SQL expressions comprising the bundle.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.Bundle.params.single_entity"></span><strong>single_entity=False</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.Bundle.params.single_entity">¶</a> – if True, rows for this <a class="reference internal" href="#sqlalchemy.orm.Bundle" title="sqlalchemy.orm.Bundle"><code class="xref py py-class docutils literal notranslate"><span class="pre">Bundle</span></code></a>
can be returned as a “single entity” outside of any enclosing tuple
in the same manner as a mapped entity.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.Bundle.c">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.Bundle"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Bundle.</span></code></a><span class="sig-name descname"><span class="pre">c</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">ReadOnlyColumnCollection</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">KeyedColumnElement</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#sqlalchemy.orm.Bundle.c" title="Link to this definition">¶</a></dt>
<dd><p>An alias for <a class="reference internal" href="#sqlalchemy.orm.Bundle.columns" title="sqlalchemy.orm.Bundle.columns"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Bundle.columns</span></code></a>.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.Bundle.columns">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.Bundle"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Bundle.</span></code></a><span class="sig-name descname"><span class="pre">columns</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">ReadOnlyColumnCollection</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">KeyedColumnElement</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#sqlalchemy.orm.Bundle.columns" title="Link to this definition">¶</a></dt>
<dd><p>A namespace of SQL expressions referred to by this <a class="reference internal" href="#sqlalchemy.orm.Bundle" title="sqlalchemy.orm.Bundle"><code class="xref py py-class docutils literal notranslate"><span class="pre">Bundle</span></code></a>.</p>
<blockquote>
<div><p>e.g.:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">bn = Bundle(&quot;mybundle&quot;, MyClass.x, MyClass.y)</span>

<span class="go">q = sess.query(bn).filter(bn.c.x == 5)</span></pre></div>
</div>
<p>Nesting of bundles is also supported:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">b1 = Bundle(</span>
<span class="go">    &quot;b1&quot;,</span>
<span class="go">    Bundle(&quot;b2&quot;, MyClass.a, MyClass.b),</span>
<span class="go">    Bundle(&quot;b3&quot;, MyClass.x, MyClass.y),</span>
<span class="go">)</span>

<span class="go">q = sess.query(b1).filter(b1.c.b2.c.a == 5).filter(b1.c.b3.c.y == 9)</span></pre></div>
</div>
</div></blockquote>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.Bundle.c" title="sqlalchemy.orm.Bundle.c"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Bundle.c</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Bundle.create_row_processor">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Bundle"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Bundle.</span></code></a><span class="sig-name descname"><span class="pre">create_row_processor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><span class="pre">Select</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Unpack</span><span class="p"><span class="pre">[</span></span><span class="pre">TupleAny</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">procs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../core/defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><span class="pre">Sequence</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Unpack</span><span class="p"><span class="pre">[</span></span><span class="pre">TupleAny</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../core/defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><span class="pre">Sequence</span></a><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><span class="pre">Row</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Unpack</span><span class="p"><span class="pre">[</span></span><span class="pre">TupleAny</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.orm.Bundle.create_row_processor" title="Link to this definition">¶</a></dt>
<dd><p>Produce the “row processing” function for this <a class="reference internal" href="#sqlalchemy.orm.Bundle" title="sqlalchemy.orm.Bundle"><code class="xref py py-class docutils literal notranslate"><span class="pre">Bundle</span></code></a>.</p>
<p>May be overridden by subclasses to provide custom behaviors when
results are fetched. The method is passed the statement object and a
set of “row processor” functions at query execution time; these
processor functions when given a result row will return the individual
attribute value, which can then be adapted into any kind of return data
structure.</p>
<p>The example below illustrates replacing the usual <a class="reference internal" href="../../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>
return structure with a straight Python dictionary:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">from sqlalchemy.orm import Bundle</span>


<span class="go">class DictBundle(Bundle):</span>
<span class="go">    def create_row_processor(self, query, procs, labels):</span>
<span class="go">        &quot;Override create_row_processor to return values as dictionaries&quot;</span>

<span class="go">        def proc(row):</span>
<span class="go">            return dict(zip(labels, (proc(row) for proc in procs)))</span>

<span class="go">        return proc</span></pre></div>
</div>
<p>A result from the above <a class="reference internal" href="#sqlalchemy.orm.Bundle" title="sqlalchemy.orm.Bundle"><code class="xref py py-class docutils literal notranslate"><span class="pre">Bundle</span></code></a> will return dictionary
values:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">bn = DictBundle(&quot;mybundle&quot;, MyClass.data1, MyClass.data2)</span>
<span class="go">for row in session.execute(select(bn)).where(bn.c.data1 == &quot;d1&quot;):</span>
<span class="go">    print(row.mybundle[&quot;data1&quot;], row.mybundle[&quot;data2&quot;])</span></pre></div>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.Bundle.is_aliased_class">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.Bundle"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Bundle.</span></code></a><span class="sig-name descname"><span class="pre">is_aliased_class</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">False</span></em><a class="headerlink" href="#sqlalchemy.orm.Bundle.is_aliased_class" title="Link to this definition">¶</a></dt>
<dd><p>True if this object is an instance of <a class="reference internal" href="#sqlalchemy.orm.util.AliasedClass" title="sqlalchemy.orm.util.AliasedClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedClass</span></code></a>.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.Bundle.is_bundle">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.Bundle"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Bundle.</span></code></a><span class="sig-name descname"><span class="pre">is_bundle</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">True</span></em><a class="headerlink" href="#sqlalchemy.orm.Bundle.is_bundle" title="Link to this definition">¶</a></dt>
<dd><p>True if this object is an instance of <a class="reference internal" href="#sqlalchemy.orm.Bundle" title="sqlalchemy.orm.Bundle"><code class="xref py py-class docutils literal notranslate"><span class="pre">Bundle</span></code></a>.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.Bundle.is_clause_element">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.Bundle"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Bundle.</span></code></a><span class="sig-name descname"><span class="pre">is_clause_element</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">False</span></em><a class="headerlink" href="#sqlalchemy.orm.Bundle.is_clause_element" title="Link to this definition">¶</a></dt>
<dd><p>True if this object is an instance of
<a class="reference internal" href="../../core/foundation.html#sqlalchemy.sql.expression.ClauseElement" title="sqlalchemy.sql.expression.ClauseElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClauseElement</span></code></a>.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.Bundle.is_mapper">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.Bundle"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Bundle.</span></code></a><span class="sig-name descname"><span class="pre">is_mapper</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">False</span></em><a class="headerlink" href="#sqlalchemy.orm.Bundle.is_mapper" title="Link to this definition">¶</a></dt>
<dd><p>True if this object is an instance of <a class="reference internal" href="../mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.Bundle.label">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.Bundle"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Bundle.</span></code></a><span class="sig-name descname"><span class="pre">label</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.orm.Bundle.label" title="Link to this definition">¶</a></dt>
<dd><p>Provide a copy of this <a class="reference internal" href="#sqlalchemy.orm.Bundle" title="sqlalchemy.orm.Bundle"><code class="xref py py-class docutils literal notranslate"><span class="pre">Bundle</span></code></a> passing a new label.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.Bundle.single_entity">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.Bundle"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Bundle.</span></code></a><span class="sig-name descname"><span class="pre">single_entity</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">False</span></em><a class="headerlink" href="#sqlalchemy.orm.Bundle.single_entity" title="Link to this definition">¶</a></dt>
<dd><p>If True, queries for a single Bundle will be returned as a single
entity, rather than an element within a keyed tuple.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.with_loader_criteria">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">with_loader_criteria</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">entity_or_base</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_EntityType</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">where_criteria</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_ColumnExpressionArgument</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">_ColumnExpressionArgument</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loader_only</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_aliases</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">propagate_to_loaders</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">track_closure_variables</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">LoaderCriteriaOption</span></span></span><a class="headerlink" href="#sqlalchemy.orm.with_loader_criteria" title="Link to this definition">¶</a></dt>
<dd><p>Add additional WHERE criteria to the load for all occurrences of
a particular entity.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4 版本加入.</span></p>
</div>
<p>The <a class="reference internal" href="#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> option is intended to add
limiting criteria to a particular kind of entity in a query,
<strong>globally</strong>, meaning it will apply to the entity as it appears
in the SELECT query as well as within any subqueries, join
conditions, and relationship loads, including both eager and lazy
loaders, without the need for it to be specified in any particular
part of the query.    The rendering logic uses the same system used by
single table inheritance to ensure a certain discriminator is applied
to a table.</p>
<p>E.g., using <a class="reference internal" href="../../glossary.html#term-3"><span class="xref std std-term">2.0-style</span></a> queries, we can limit the way the
<code class="docutils literal notranslate"><span class="pre">User.addresses</span></code> collection is loaded, regardless of the kind
of loading used:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">from sqlalchemy.orm import with_loader_criteria</span>

<span class="go">stmt = select(User).options(</span>
<span class="go">    selectinload(User.addresses),</span>
<span class="go">    with_loader_criteria(Address, Address.email_address != &quot;foo&quot;),</span>
<span class="go">)</span></pre></div>
</div>
<p>Above, the “selectinload” for <code class="docutils literal notranslate"><span class="pre">User.addresses</span></code> will apply the
given filtering criteria to the WHERE clause.</p>
<p>Another example, where the filtering will be applied to the
ON clause of the join, in this example using <a class="reference internal" href="../../glossary.html#term-1.x-style"><span class="xref std std-term">1.x style</span></a>
queries:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">q = (</span>
<span class="go">    session.query(User)</span>
<span class="go">    .outerjoin(User.addresses)</span>
<span class="go">    .options(with_loader_criteria(Address, Address.email_address != &quot;foo&quot;))</span>
<span class="go">)</span></pre></div>
</div>
<p>The primary purpose of <a class="reference internal" href="#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> is to use
it in the <a class="reference internal" href="../events.html#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a> event handler
to ensure that all occurrences of a particular entity are filtered
in a certain way, such as filtering for access control roles.    It
also can be used to apply criteria to relationship loads.  In the
example below, we can apply a certain set of rules to all queries
emitted by a particular <a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">session = Session(bind=engine)</span>


<span class="go">@event.listens_for(&quot;do_orm_execute&quot;, session)</span>
<span class="go">def _add_filtering_criteria(execute_state):</span>

<span class="go">    if (</span>
<span class="go">        execute_state.is_select</span>
<span class="go">        and not execute_state.is_column_load</span>
<span class="go">        and not execute_state.is_relationship_load</span>
<span class="go">    ):</span>
<span class="go">        execute_state.statement = execute_state.statement.options(</span>
<span class="go">            with_loader_criteria(</span>
<span class="go">                SecurityRole,</span>
<span class="go">                lambda cls: cls.role.in_([&quot;some_role&quot;]),</span>
<span class="go">                include_aliases=True,</span>
<span class="go">            )</span>
<span class="go">        )</span></pre></div>
</div>
<p>In the above example, the <a class="reference internal" href="../events.html#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a>
event will intercept all queries emitted using the
<a class="reference internal" href="../session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>. For those queries which are SELECT statements
and are not attribute or relationship loads a custom
<a class="reference internal" href="#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> option is added to the query.    The
<a class="reference internal" href="#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> option will be used in the given
statement and will also be automatically propagated to all relationship
loads that descend from this query.</p>
<p>The criteria argument given is a <code class="docutils literal notranslate"><span class="pre">lambda</span></code> that accepts a <code class="docutils literal notranslate"><span class="pre">cls</span></code>
argument.  The given class will expand to include all mapped subclass
and need not itself be a mapped class.</p>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>When using <a class="reference internal" href="#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> option in
conjunction with the <a class="reference internal" href="relationships.html#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> loader option,
it’s important to note that <a class="reference internal" href="#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> only
affects the part of the query that determines what SQL is rendered
in terms of the WHERE and FROM clauses. The
<a class="reference internal" href="relationships.html#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> option does not affect the rendering of
the SELECT statement outside of the columns clause, so does not have
any interaction with the <a class="reference internal" href="#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> option.
However, the way things “work” is that <a class="reference internal" href="relationships.html#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a>
is meant to be used with a query that is already selecting from the
additional entities in some way, where
<a class="reference internal" href="#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> can apply it’s additional
criteria.</p>
<p>In the example below, assuming a mapping relationship as
<code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">-&gt;</span> <span class="pre">A.bs</span> <span class="pre">-&gt;</span> <span class="pre">B</span></code>, the given <a class="reference internal" href="#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a>
option will affect the way in which the JOIN is rendered:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">stmt = (</span>
<span class="go">    select(A)</span>
<span class="go">    .join(A.bs)</span>
<span class="go">    .options(contains_eager(A.bs), with_loader_criteria(B, B.flag == 1))</span>
<span class="go">)</span></pre></div>
</div>
<p>Above, the given <a class="reference internal" href="#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> option will
affect the ON clause of the JOIN that is specified by
<code class="docutils literal notranslate"><span class="pre">.join(A.bs)</span></code>, so is applied as expected. The
<a class="reference internal" href="relationships.html#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> option has the effect that columns from
<code class="docutils literal notranslate"><span class="pre">B</span></code> are added to the columns clause:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="n">b</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">a_id</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">flag</span><span class="p">,</span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_1</span><span class="p">,</span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="k">data</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">data_1</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">a_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">:</span><span class="n">flag_1</span></pre></div>
</div>
<p>The use of the <a class="reference internal" href="relationships.html#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> option within the above
statement has no effect on the behavior of the
<a class="reference internal" href="#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> option. If the
<a class="reference internal" href="relationships.html#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> option were omitted, the SQL would be
the same as regards the FROM and WHERE clauses, where
<a class="reference internal" href="#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> continues to add its criteria to
the ON clause of the JOIN. The addition of
<a class="reference internal" href="relationships.html#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> only affects the columns clause, in that
additional columns against <code class="docutils literal notranslate"><span class="pre">b</span></code> are added which are then consumed
by the ORM to produce <code class="docutils literal notranslate"><span class="pre">B</span></code> instances.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>The use of a lambda inside of the call to
<a class="reference internal" href="#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> is only invoked <strong>once per unique
class</strong>. Custom functions should not be invoked within this lambda.
See <a class="reference internal" href="../../core/connections.html#engine-lambda-caching"><span class="std std-ref">使用 Lambda 显著提高语句生成速度</span></a> for an overview of the “lambda SQL”
feature, which is for advanced use only.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.with_loader_criteria.params.entity_or_base"></span><strong>entity_or_base</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.with_loader_criteria.params.entity_or_base">¶</a> – a mapped class, or a class that is a super
class of a particular set of mapped classes, to which the rule
will apply.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.with_loader_criteria.params.where_criteria"></span><strong>where_criteria</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.with_loader_criteria.params.where_criteria">¶</a> – <p>a Core SQL expression that applies limiting
criteria.   This may also be a “lambda:” or Python function that
accepts a target class as an argument, when the given class is
a base with many different mapped subclasses.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>To support pickling, use a module-level Python function to
produce the SQL expression instead of a lambda or a fixed SQL
expression, which tend to not be picklable.</p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.orm.with_loader_criteria.params.include_aliases"></span><strong>include_aliases</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.with_loader_criteria.params.include_aliases">¶</a> – if True, apply the rule to <a class="reference internal" href="#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a>
constructs as well.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.with_loader_criteria.params.propagate_to_loaders"></span><strong>propagate_to_loaders</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.with_loader_criteria.params.propagate_to_loaders">¶</a> – <p>defaults to True, apply to relationship
loaders such as lazy loaders.   This indicates that the
option object itself including SQL expression is carried along with
each loaded instance.  Set to <code class="docutils literal notranslate"><span class="pre">False</span></code> to prevent the object from
being assigned to individual instances.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="../examples.html#examples-session-orm-events"><span class="std std-ref">ORM 查询事件</span></a> - includes examples of using
<a class="reference internal" href="#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a>.</p>
<p><a class="reference internal" href="../session_events.html#do-orm-execute-global-criteria"><span class="std std-ref">添加全局 WHERE / ON 条件</span></a> - basic example on how to
combine <a class="reference internal" href="#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> with the
<a class="reference internal" href="../events.html#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a> event.</p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.orm.with_loader_criteria.params.track_closure_variables"></span><strong>track_closure_variables</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.with_loader_criteria.params.track_closure_variables">¶</a> – <p>when False, closure variables inside
of a lambda expression will not be used as part of
any cache key.    This allows more complex expressions to be used
inside of a lambda expression but requires that the lambda ensures
it returns the identical SQL every time given a particular class.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4.0b2 版本加入.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.join">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">join</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">left</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_FromClauseArgument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">right</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_FromClauseArgument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">onclause</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_OnClauseArgument</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">isouter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">full</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_ORMJoin</span></span></span><a class="headerlink" href="#sqlalchemy.orm.join" title="Link to this definition">¶</a></dt>
<dd><p>Produce an inner join between left and right clauses.</p>
<p><a class="reference internal" href="#sqlalchemy.orm.join" title="sqlalchemy.orm.join"><code class="xref py py-func docutils literal notranslate"><span class="pre">join()</span></code></a> is an extension to the core join interface
provided by <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.join" title="sqlalchemy.sql.expression.join"><code class="xref py py-func docutils literal notranslate"><span class="pre">join()</span></code></a>, where the
left and right selectable may be not only core selectable
objects such as <a class="reference internal" href="../../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>, but also mapped classes or
<a class="reference internal" href="#sqlalchemy.orm.util.AliasedClass" title="sqlalchemy.orm.util.AliasedClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedClass</span></code></a> instances.   The “on” clause can
be a SQL expression or an ORM mapped attribute
referencing a configured <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>.</p>
<p><a class="reference internal" href="#sqlalchemy.orm.join" title="sqlalchemy.orm.join"><code class="xref py py-func docutils literal notranslate"><span class="pre">join()</span></code></a> is not commonly needed in modern usage,
as its functionality is encapsulated within that of the
<a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.join" title="sqlalchemy.sql.expression.Select.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join()</span></code></a> and <a class="reference internal" href="query.html#sqlalchemy.orm.Query.join" title="sqlalchemy.orm.Query.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.join()</span></code></a>
methods. which feature a
significant amount of automation beyond <a class="reference internal" href="#sqlalchemy.orm.join" title="sqlalchemy.orm.join"><code class="xref py py-func docutils literal notranslate"><span class="pre">join()</span></code></a>
by itself.  Explicit use of <a class="reference internal" href="#sqlalchemy.orm.join" title="sqlalchemy.orm.join"><code class="xref py py-func docutils literal notranslate"><span class="pre">join()</span></code></a>
with ORM-enabled SELECT statements involves use of the
<a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.select_from" title="sqlalchemy.sql.expression.Select.select_from"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.select_from()</span></code></a> method, as in:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">from sqlalchemy.orm import join</span>

<span class="go">stmt = (</span>
<span class="go">    select(User)</span>
<span class="go">    .select_from(join(User, Address, User.addresses))</span>
<span class="go">    .filter(Address.email_address == &quot;foo@bar.com&quot;)</span>
<span class="go">)</span></pre></div>
</div>
<p>In modern SQLAlchemy the above join can be written more
succinctly as:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">stmt = (</span>
<span class="go">    select(User)</span>
<span class="go">    .join(User.addresses)</span>
<span class="go">    .filter(Address.email_address == &quot;foo@bar.com&quot;)</span>
<span class="go">)</span></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>using <a class="reference internal" href="#sqlalchemy.orm.join" title="sqlalchemy.orm.join"><code class="xref py py-func docutils literal notranslate"><span class="pre">join()</span></code></a> directly may not work properly
with modern ORM options such as <a class="reference internal" href="#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a>.
It is strongly recommended to use the idiomatic join patterns
provided by methods such as <a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.join" title="sqlalchemy.sql.expression.Select.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join()</span></code></a> and
<a class="reference internal" href="../../core/selectable.html#sqlalchemy.sql.expression.Select.join_from" title="sqlalchemy.sql.expression.Select.join_from"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join_from()</span></code></a> when creating ORM joins.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="select.html#orm-queryguide-joins"><span class="std std-ref">连接</span></a> - in the <a class="reference internal" href="index.html#queryguide-toplevel"><span class="std std-ref">ORM 查询指南</span></a> for
background on idiomatic ORM join patterns</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.outerjoin">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">outerjoin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">left</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_FromClauseArgument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">right</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_FromClauseArgument</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">onclause</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_OnClauseArgument</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">full</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_ORMJoin</span></span></span><a class="headerlink" href="#sqlalchemy.orm.outerjoin" title="Link to this definition">¶</a></dt>
<dd><p>Produce a left outer join between left and right clauses.</p>
<p>This is the “outer join” version of the <a class="reference internal" href="#sqlalchemy.orm.join" title="sqlalchemy.orm.join"><code class="xref py py-func docutils literal notranslate"><span class="pre">join()</span></code></a> function,
featuring the same behavior except that an OUTER JOIN is generated.
See that function’s documentation for other usage details.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.orm.with_parent">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">with_parent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prop</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../internals.html#sqlalchemy.orm.QueryableAttribute" title="sqlalchemy.orm.attributes.QueryableAttribute"><span class="pre">attributes.QueryableAttribute</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">from_entity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_EntityType</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="../../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><span class="pre">ColumnElement</span></a><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#sqlalchemy.orm.with_parent" title="Link to this definition">¶</a></dt>
<dd><p>Create filtering criterion that relates this query’s primary entity
to the given related instance, using established
<a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>
configuration.</p>
<p>E.g.:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">stmt = select(Address).where(with_parent(some_user, User.addresses))</span></pre></div>
</div>
<p>The SQL rendered is the same as that rendered when a lazy loader
would fire off from the given parent on that attribute, meaning
that the appropriate state is taken from the parent object in
Python without the need to render joins to the parent table
in the rendered statement.</p>
<p>The given property may also make use of <a class="reference internal" href="../internals.html#sqlalchemy.orm.PropComparator.of_type" title="sqlalchemy.orm.PropComparator.of_type"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PropComparator.of_type()</span></code></a>
to indicate the left side of the criteria:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">a1 = aliased(Address)</span>
<span class="go">a2 = aliased(Address)</span>
<span class="go">stmt = select(a1, a2).where(with_parent(u1, User.addresses.of_type(a2)))</span></pre></div>
</div>
<p>The above use is equivalent to using the
<code class="xref py py-func docutils literal notranslate"><span class="pre">from_entity()</span></code> argument:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="go">a1 = aliased(Address)</span>
<span class="go">a2 = aliased(Address)</span>
<span class="go">stmt = select(a1, a2).where(</span>
<span class="go">    with_parent(u1, User.addresses, from_entity=a2)</span>
<span class="go">)</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.with_parent.params.instance"></span><strong>instance</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.with_parent.params.instance">¶</a> – An instance which has some <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.with_parent.params.property"></span><strong>property</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.with_parent.params.property">¶</a> – Class-bound attribute, which indicates
what relationship from the instance should be used to reconcile the
parent/child relationship.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.with_parent.params.from_entity"></span><strong>from_entity</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.with_parent.params.from_entity">¶</a> – Entity in which to consider as the left side.  This defaults to the
“zero” entity of the <a class="reference internal" href="query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> itself.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>
</section>
</section>
<aside class="topic">
<p class="topic-title">ORM Querying Guide</p>
<p>Next Query Guide Section: <a class="reference internal" href="query.html"><span class="doc">旧式查询 API</span></a></p>
</aside>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="query.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">旧式查询 API</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="relationships.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">关系加载技术</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                <a href="../../copyright.html">Copyright</a> &#169; 2007-2025, the SQLAlchemy authors and contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on 04/05/2025 04:00:26</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">用于查询的 ORM API 功能</a><ul>
<li><a class="reference internal" href="#orm">ORM 加载器选项</a></li>
<li><a class="reference internal" href="#orm-queryguide-execution-options">ORM 执行选项</a><ul>
<li><a class="reference internal" href="#orm-queryguide-populate-existing">填充现有</a></li>
<li><a class="reference internal" href="#orm-queryguide-autoflush">自动刷新</a></li>
<li><a class="reference internal" href="#yield-per">使用 Yield Per 获取大量结果集</a></li>
<li><a class="reference internal" href="#queryguide-identity-token">身份令牌</a><ul>
<li><a class="reference internal" href="#orm-select-dml">检查启用 ORM 的 SELECT 和 DML 语句中的实体和列</a></li>
<li><a class="reference internal" href="#queryguide-additional">其他 ORM API 构造</a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.aliased"><code class="docutils literal notranslate"><span class="pre">aliased()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.util.AliasedClass"><code class="docutils literal notranslate"><span class="pre">AliasedClass</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.util.AliasedInsp"><code class="docutils literal notranslate"><span class="pre">AliasedInsp</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Bundle"><code class="docutils literal notranslate"><span class="pre">Bundle</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.Bundle.__init__"><code class="docutils literal notranslate"><span class="pre">Bundle.__init__()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Bundle.c"><code class="docutils literal notranslate"><span class="pre">Bundle.c</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Bundle.columns"><code class="docutils literal notranslate"><span class="pre">Bundle.columns</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Bundle.create_row_processor"><code class="docutils literal notranslate"><span class="pre">Bundle.create_row_processor()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Bundle.is_aliased_class"><code class="docutils literal notranslate"><span class="pre">Bundle.is_aliased_class</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Bundle.is_bundle"><code class="docutils literal notranslate"><span class="pre">Bundle.is_bundle</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Bundle.is_clause_element"><code class="docutils literal notranslate"><span class="pre">Bundle.is_clause_element</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Bundle.is_mapper"><code class="docutils literal notranslate"><span class="pre">Bundle.is_mapper</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Bundle.label"><code class="docutils literal notranslate"><span class="pre">Bundle.label()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.Bundle.single_entity"><code class="docutils literal notranslate"><span class="pre">Bundle.single_entity</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlalchemy.orm.with_loader_criteria"><code class="docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.join"><code class="docutils literal notranslate"><span class="pre">join()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.outerjoin"><code class="docutils literal notranslate"><span class="pre">outerjoin()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.with_parent"><code class="docutils literal notranslate"><span class="pre">with_parent()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../_static/documentation_options.js?v=2d0eb83f"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/tabs.js?v=3ee01567"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=2f3e6152"></script>
    <script src="../../_static/translations.js?v=beaddf03"></script>
    </body>
</html>