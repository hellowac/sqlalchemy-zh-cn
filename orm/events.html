<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="索引" href="../genindex.html" /><link rel="search" title="搜索" href="../search.html" /><link rel="copyright" title="版权所有" href="../copyright.html" /><link rel="next" title="ORM 内部" href="internals.html" /><link rel="prev" title="事件和内部" href="extending.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.08.06 -->
        <title>ORM 事件 - SQLAlchemy 2.1 Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/changelog.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_paramlinks.css" />
    <link rel="stylesheet" type="text/css" href="../_static/docs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">SQLAlchemy 2.1 Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">SQLAlchemy 2.1 Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">概述</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorial/index.html">SQLAlchemy 统一教程</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of SQLAlchemy 统一教程</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/engine.html">建立连接 - Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/dbapi_transactions.html">使用事务和DBAPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/metadata.html">使用数据库元数据</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../tutorial/data.html">处理数据</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of 处理数据</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/data_insert.html">使用 INSERT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/data_select.html">使用 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/data_update.html">使用 UPDATE 和 DELETE 语句</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/orm_data_manipulation.html">使用 ORM 进行数据操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/orm_related_objects.html">使用 ORM 相关对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/further_reading.html">进一步阅读</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">SQLAlchemy ORM</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of SQLAlchemy ORM</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">ORM 快速入门</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="mapper_config.html">ORM 映射类配置</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of ORM 映射类配置</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="mapping_styles.html">ORM 映射类概述</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="declarative_mapping.html">使用声明式映射类</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of 使用声明式映射类</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="declarative_styles.html">声明式映射风格</a></li>
<li class="toctree-l4"><a class="reference internal" href="declarative_tables.html">声明式的表配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="declarative_config.html">使用声明式映射器配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="declarative_mixins.html">使用 Mixins 组合映射层次结构</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dataclasses.html">与dataclass和attrs的集成</a></li>
<li class="toctree-l3"><a class="reference internal" href="mapped_sql_expr.html">SQL 表达式作为映射属性</a></li>
<li class="toctree-l3"><a class="reference internal" href="mapped_attributes.html">更改Attribute的行为</a></li>
<li class="toctree-l3"><a class="reference internal" href="composites.html">复合列类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="inheritance.html">映射类继承层次结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="nonstandard_mappings.html">非传统映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="versioning.html">配置版本计数器</a></li>
<li class="toctree-l3"><a class="reference internal" href="mapping_api.html">类映射 API</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="scalar_mapping.html">映射 SQL 表达式</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of 映射 SQL 表达式</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="mapping_columns.html">映射表格列</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="relationships.html">关系配置</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of 关系配置</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="basic_relationships.html">基本关系模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="self_referential.html">邻接表关系</a></li>
<li class="toctree-l3"><a class="reference internal" href="join_conditions.html">配置关系连接方式</a></li>
<li class="toctree-l3"><a class="reference internal" href="large_collections.html">使用大型集合</a></li>
<li class="toctree-l3"><a class="reference internal" href="collection_api.html">集合自定义和 API 详细信息</a></li>
<li class="toctree-l3"><a class="reference internal" href="relationship_persistence.html">特殊关系的持久化模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="backref.html">使用旧版“backref”关系参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="relationship_api.html">关系 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="queryguide/index.html">ORM 查询指南</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of ORM 查询指南</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="queryguide/select.html">为 ORM 映射类编写 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="queryguide/inheritance.html">为继承映射编写 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="queryguide/dml.html">启用 ORM 的 INSERT、UPDATE 和 DELETE 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="queryguide/columns.html">列加载选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="queryguide/relationships.html">关系加载技术</a></li>
<li class="toctree-l3"><a class="reference internal" href="queryguide/api.html">用于查询的 ORM API 功能</a></li>
<li class="toctree-l3"><a class="reference internal" href="queryguide/query.html">旧式查询 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="session.html">使用会话</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of 使用会话</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="session_basics.html">会话基础知识</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_state_management.html">状态管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="cascades.html">级联</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_transaction.html">事务和连接管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="persistence_techniques.html">附加持久性技术</a></li>
<li class="toctree-l3"><a class="reference internal" href="contextual.html">上下文/线程本地会话</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_events.html">使用事件跟踪查询、对象和会话更改</a></li>
<li class="toctree-l3"><a class="reference internal" href="session_api.html">会话 API</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="extending.html">事件和内部</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of 事件和内部</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">ORM 事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="internals.html">ORM 内部</a></li>
<li class="toctree-l3"><a class="reference internal" href="exceptions.html">ORM 异常</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="extensions/index.html">ORM 扩展</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of ORM 扩展</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="extensions/asyncio.html">异步 I/O (asyncio)</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions/associationproxy.html">关联代理</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions/automap.html">自动映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions/baked.html">烘焙查询</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions/declarative/index.html">声明式扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions/mutable.html">突变追踪</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions/orderinglist.html">排序列表</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions/horizontal_shard.html">水平分片</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions/hybrid.html">混合属性</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions/indexable.html">Indexable</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions/instrumentation.html">替代类检测</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="examples.html">核心和 ORM 示例</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../core/index.html">SQLAlchemy Core</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of SQLAlchemy Core</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/expression_api.html">SQL 语句和表达式 API</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of SQL 语句和表达式 API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/sqlelement.html">列元素和表达式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/operators.html">操作符参考</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/selectable.html">SELECT 和相关构造</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/dml.html">插入,更新,删除</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/functions.html">SQL 和 范型函数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/compiler.html">自定义 SQL 构造和编译扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/serializer.html">表达式序列化器扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/foundation.html">SQL 表达式语言基础构造</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/visitors.html">访问者和遍历实用程序</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/schema.html">Schema 定义语言</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of Schema 定义语言</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/metadata.html">使用元数据描述数据库</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/reflection.html">反映数据库对象</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/defaults.html">列 INSERT/UPDATE 默认值</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/constraints.html">定义约束和索引</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/ddl.html">自定义 DDL</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/types.html">SQL 数据类型对象</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of SQL 数据类型对象</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/type_basics.html">类型层次结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/custom_types.html">自定义类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/type_api.html">基本类型 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/engines_connections.html">Engine和Connection的使用</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of Engine和Connection的使用</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/engines.html">Engine 配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/connections.html">使用Engines和Connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/pooling.html">连接池</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/events.html">核心事件</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/api_basics.html">Core API 基础</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of Core API 基础</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/event.html">事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/inspection.html">运行时审查 API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/exceptions.html">Core 异常</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/internals.html">Core 内部</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../dialects/index.html">Dialects</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of Dialects</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../dialects/postgresql.html">PostgreSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dialects/mysql.html">MySQL 和 MariaDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dialects/sqlite.html">SQLite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dialects/oracle.html">Oracle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dialects/mssql.html">Microsoft SQL Server</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../faq/index.html">常见问题</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of 常见问题</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../faq/installation.html">安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/connections.html">连接 / 引擎</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/metadata_schema.html">元数据 / Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/sqlexpressions.html">SQL 表达式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/ormconfiguration.html">ORM 配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/performance.html">性能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/sessions.html">会话 / 查询</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/thirdparty.html">第三方包集成问题</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../errors.html">错误消息</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../changelog/index.html">变更和迁移</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of 变更和迁移</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_21.html">SQLAlchemy 2.1 有什么新功能？</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_21.html">2.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_20.html">2.0 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_14.html">1.4 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_13.html">1.3 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_12.html">1.2 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_11.html">1.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_10.html">1.0 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_09.html">0.9 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_08.html">0.8 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_07.html">0.7 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_06.html">0.6 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_05.html">0.5 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_04.html">0.4 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_03.html">0.3 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_02.html">0.2 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/changelog_01.html">0.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_20.html">SQLAlchemy 2.0 - Major Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/whatsnew_20.html">What’s New in SQLAlchemy 2.0?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_14.html">What’s New in SQLAlchemy 1.4?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_13.html">What’s New in SQLAlchemy 1.3?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_12.html">What’s New in SQLAlchemy 1.2?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_11.html">What’s New in SQLAlchemy 1.1?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_10.html">What’s New in SQLAlchemy 1.0?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_09.html">What’s New in SQLAlchemy 0.9?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_08.html">What’s New in SQLAlchemy 0.8?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_07.html">What’s New in SQLAlchemy 0.7?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_06.html">What’s New in SQLAlchemy 0.6?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_05.html">What’s new in SQLAlchemy 0.5?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog/migration_04.html">What’s new in SQLAlchemy 0.4?</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="orm">
<span id="orm-event-toplevel"></span><h1>ORM 事件<a class="headerlink" href="#orm" title="Link to this heading">¶</a></h1>
<p>ORM Events</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">中文</label><div class="tab-content docutils container">
<p>ORM 包括多种可供订阅的钩子。</p>
<p>有关最常用 ORM 事件的介绍，请参阅 <a class="reference internal" href="session_events.html#session-events-toplevel"><span class="std std-ref">使用事件跟踪查询、对象和会话更改</span></a> 部分。事件系统的一般讨论见 <a class="reference internal" href="../core/event.html#event-toplevel"><span class="std std-ref">事件</span></a>。非 ORM 事件，例如那些关于连接和低级语句执行的事件，描述在 <a class="reference internal" href="../core/events.html#core-event-toplevel"><span class="std std-ref">核心事件</span></a>。</p>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">英文</label><div class="tab-content docutils container">
<p>The ORM includes a wide variety of hooks available for subscription.</p>
<p>For an introduction to the most commonly used ORM events, see the section
<a class="reference internal" href="session_events.html#session-events-toplevel"><span class="std std-ref">使用事件跟踪查询、对象和会话更改</span></a>.   The event system in general is discussed
at <a class="reference internal" href="../core/event.html#event-toplevel"><span class="std std-ref">事件</span></a>.  Non-ORM events such as those regarding connections
and low-level statement execution are described in <a class="reference internal" href="../core/events.html#core-event-toplevel"><span class="std std-ref">核心事件</span></a>.</p>
</div>
</div>
<section id="id1">
<h2>会话事件<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
<p>Session Events</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--1-input--1" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--1">中文</label><div class="tab-content docutils container">
<p>最基本的事件钩子可在 ORM <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 对象级别使用。这里拦截的内容类型包括：</p>
<ul class="simple">
<li><p><strong>持久化操作</strong> - 发送更改到数据库的 ORM 刷新过程可以使用在不同刷新部分触发的事件进行扩展，以增加或修改发送到数据库的数据，或在持久化发生时允许其他事情发生。有关持久化事件的详细信息，请参阅 <a class="reference internal" href="session_events.html#session-persistence-events"><span class="std std-ref">持久性事件</span></a>。</p></li>
<li><p><strong>对象生命周期事件</strong> - 当对象被添加、持久化、从会话中删除时的钩子。有关这些内容的更多信息，请参阅 <a class="reference internal" href="session_events.html#session-lifecycle-events"><span class="std std-ref">对象生命周期事件</span></a>。</p></li>
<li><p><strong>执行事件</strong> - 作为 <a class="reference internal" href="../glossary.html#term-2.0"><span class="xref std std-term">2.0 风格</span></a> 执行模型的一部分，针对 ORM 实体发出的所有 SELECT 语句以及刷新过程之外的批量 UPDATE 和 DELETE 语句均通过 <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.execute" title="sqlalchemy.orm.Session.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code></a> 方法使用 <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a> 方法拦截。有关此事件的更多信息，请参阅 <a class="reference internal" href="session_events.html#session-execute-events"><span class="std std-ref">执行事件</span></a>。</p></li>
</ul>
<p>请务必阅读 <a class="reference internal" href="session_events.html#session-events-toplevel"><span class="std std-ref">使用事件跟踪查询、对象和会话更改</span></a> 章节以了解这些事件的上下文。</p>
</div>
<input class="tab-input" id="tab-set--1-input--2" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--2">英文</label><div class="tab-content docutils container">
<p>The most basic event hooks are available at the level of the ORM
<a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> object.   The types of things that are intercepted
here include:</p>
<ul class="simple">
<li><p><strong>Persistence Operations</strong> - the ORM flush process that sends changes to the
database can be extended using events that fire off at different parts of the
flush, to augment or modify the data being sent to the database or to allow
other things to happen when persistence occurs.   Read more about persistence
events at <a class="reference internal" href="session_events.html#session-persistence-events"><span class="std std-ref">持久性事件</span></a>.</p></li>
<li><p><strong>Object lifecycle events</strong> - hooks when objects are added, persisted,
deleted from sessions.   Read more about these at
<a class="reference internal" href="session_events.html#session-lifecycle-events"><span class="std std-ref">对象生命周期事件</span></a>.</p></li>
<li><p><strong>Execution Events</strong> - Part of the <a class="reference internal" href="../glossary.html#term-2.0-style"><span class="xref std std-term">2.0 style</span></a> execution model, all
SELECT statements against ORM entities emitted, as well as bulk UPDATE
and DELETE statements outside of the flush process, are intercepted
from the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.execute" title="sqlalchemy.orm.Session.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code></a> method using the
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a> method.  Read more about this
event at <a class="reference internal" href="session_events.html#session-execute-events"><span class="std std-ref">执行事件</span></a>.</p></li>
</ul>
<p>Be sure to read the <a class="reference internal" href="session_events.html#session-events-toplevel"><span class="std std-ref">使用事件跟踪查询、对象和会话更改</span></a> chapter for context
on these events.</p>
</div>
</div>
<div class="table-wrapper longtable docutils container">
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><span class="sig-name descname">SessionEvents</span></a></p></td>
<td><p>Define events specific to <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> lifecycle.</p></td>
</tr>
</tbody>
</table>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">SessionEvents</span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents" title="Link to this definition">¶</a></dt>
<dd><p>Define events specific to <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> lifecycle.</p>
<p>e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">sessionmaker</span>


<span class="k">def</span><span class="w"> </span><span class="nf">my_before_commit</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
    <span class="n">print</span><span class="p">(</span><span class="s2">&quot;before commit!&quot;</span><span class="p">)</span>


<span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">()</span>

<span class="n">event</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">Session</span><span class="p">,</span> <span class="s2">&quot;before_commit&quot;</span><span class="p">,</span> <span class="n">my_before_commit</span><span class="p">)</span></pre></div>
</div>
<p>The <a class="reference internal" href="../core/event.html#sqlalchemy.event.listen" title="sqlalchemy.event.listen"><code class="xref py py-func docutils literal notranslate"><span class="pre">listen()</span></code></a> function will accept
<a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> objects as well as the return result
of <a class="reference internal" href="session_api.html#sqlalchemy.orm.sessionmaker" title="sqlalchemy.orm.sessionmaker"><code class="xref py py-class docutils literal notranslate"><span class="pre">sessionmaker()</span></code></a> and <a class="reference internal" href="contextual.html#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session()</span></code></a>.</p>
<p>Additionally, it accepts the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> class which
will apply listeners to all <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> instances
globally.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.params.raw"></span><strong>raw=False</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.params.raw">¶</a> – When True, the “target” argument passed
to applicable event listener functions that work on individual
objects will be the instance’s <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> management
object, rather than the mapped instance itself.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.params.restore_load_context"></span><strong>restore_load_context=False</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.params.restore_load_context">¶</a> – Applies to the
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.loaded_as_persistent" title="sqlalchemy.orm.SessionEvents.loaded_as_persistent"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.loaded_as_persistent()</span></code></a> event.  Restores the loader
context of the object when the event hook is complete, so that ongoing
eager load operations continue to target the object appropriately.  A
warning is emitted if the object is moved to a new loader context from
within this event if this flag is not set.</p></li>
</ul>
</dd>
</dl>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_attach"><span class="sig-name descname">after_attach()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_begin"><span class="sig-name descname">after_begin()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_bulk_delete"><span class="sig-name descname">after_bulk_delete()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_bulk_update"><span class="sig-name descname">after_bulk_update()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_commit"><span class="sig-name descname">after_commit()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_flush"><span class="sig-name descname">after_flush()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_flush_postexec"><span class="sig-name descname">after_flush_postexec()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_rollback"><span class="sig-name descname">after_rollback()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_soft_rollback"><span class="sig-name descname">after_soft_rollback()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_transaction_create"><span class="sig-name descname">after_transaction_create()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_transaction_end"><span class="sig-name descname">after_transaction_end()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_attach"><span class="sig-name descname">before_attach()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_commit"><span class="sig-name descname">before_commit()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_flush"><span class="sig-name descname">before_flush()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.deleted_to_detached"><span class="sig-name descname">deleted_to_detached()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.deleted_to_persistent"><span class="sig-name descname">deleted_to_persistent()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.detached_to_persistent"><span class="sig-name descname">detached_to_persistent()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.dispatch"><span class="sig-name descname">dispatch</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute"><span class="sig-name descname">do_orm_execute()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.loaded_as_persistent"><span class="sig-name descname">loaded_as_persistent()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.pending_to_persistent"><span class="sig-name descname">pending_to_persistent()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.pending_to_transient"><span class="sig-name descname">pending_to_transient()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.persistent_to_deleted"><span class="sig-name descname">persistent_to_deleted()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.persistent_to_detached"><span class="sig-name descname">persistent_to_detached()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.persistent_to_transient"><span class="sig-name descname">persistent_to_transient()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.transient_to_pending"><span class="sig-name descname">transient_to_pending()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.orm.SessionEvents" title="sqlalchemy.orm.SessionEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.event.Events</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.after_attach">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">after_attach</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.after_attach" title="Link to this definition">¶</a></dt>
<dd><p>Execute after an instance is attached to a session.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;after_attach&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_after_attach</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;after_attach&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This is called after an add, delete or merge.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>As of 0.8, this event fires off <em>after</em> the item
has been fully associated with the session, which is
different than previous releases.  For event
handlers that require the object not yet
be part of session state (such as handlers which
may autoflush while the target object is not
yet complete) consider the
new <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_attach" title="sqlalchemy.orm.SessionEvents.before_attach"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_attach()</span></code></a> event.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_attach" title="sqlalchemy.orm.SessionEvents.before_attach"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.before_attach()</span></code></a></p>
<p><a class="reference internal" href="session_events.html#session-lifecycle-events"><span class="std std-ref">对象生命周期事件</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.after_begin">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">after_begin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">transaction</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><span class="pre">SessionTransaction</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><span class="pre">Connection</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.after_begin" title="Link to this definition">¶</a></dt>
<dd><p>Execute after a transaction is begun on a connection.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;after_begin&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_after_begin</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">transaction</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;after_begin&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>This event is called within the process of the
<a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> modifying its own internal state.
To invoke SQL operations within this hook, use the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> provided to the event;
do not run SQL operations using the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>
directly.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.after_begin.params.session"></span><strong>session</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.after_begin.params.session">¶</a> – The target <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.after_begin.params.transaction"></span><strong>transaction</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.after_begin.params.transaction">¶</a> – The <a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code></a>.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.after_begin.params.connection"></span><strong>connection</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.after_begin.params.connection">¶</a> – The <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> object
which will be used for SQL statements.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_commit" title="sqlalchemy.orm.SessionEvents.before_commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.before_commit()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_commit" title="sqlalchemy.orm.SessionEvents.after_commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_commit()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_transaction_create" title="sqlalchemy.orm.SessionEvents.after_transaction_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_transaction_create()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_transaction_end" title="sqlalchemy.orm.SessionEvents.after_transaction_end"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_transaction_end()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.after_bulk_delete">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">after_bulk_delete</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">delete_context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.after_bulk_delete" title="Link to this definition">¶</a></dt>
<dd><p>Event for after the legacy <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query.delete" title="sqlalchemy.orm.Query.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.delete()</span></code></a> method
has been called.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;after_bulk_delete&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_after_bulk_delete</span><span class="p">(</span><span class="n">delete_context</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;after_bulk_delete&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<div class="admonition legacy">
<p class="admonition-title">Legacy Feature</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_bulk_delete" title="sqlalchemy.orm.SessionEvents.after_bulk_delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_bulk_delete()</span></code></a> method
is a legacy event hook as of SQLAlchemy 2.0.   The event
<strong>does not participate</strong> in <a class="reference internal" href="../glossary.html#term-2.0-style"><span class="xref std std-term">2.0 style</span></a> invocations
using <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.delete" title="sqlalchemy.sql.expression.delete"><code class="xref py py-func docutils literal notranslate"><span class="pre">delete()</span></code></a> documented at
<a class="reference internal" href="queryguide/dml.html#orm-queryguide-update-delete-where"><span class="std std-ref">使用自定义 WHERE 条件的 ORM UPDATE 和 DELETE</span></a>.  For 2.0 style use,
the <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a> hook will intercept
these calls.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.orm.SessionEvents.after_bulk_delete.params.delete_context"></span><strong>delete_context</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.after_bulk_delete.params.delete_context">¶</a> – <p>a “delete context” object which contains
details about the update, including these attributes:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">session</span></code> - the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> involved</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">query</span></code> -the <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a>
object that this update operation
was called upon.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">result</span></code> the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a>
returned as a result of the
bulk DELETE operation.</p></li>
</ul>
</div></blockquote>
</p>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">在 1.4 版本发生变更: </span>the update_context no longer has a
<code class="docutils literal notranslate"><span class="pre">QueryContext</span></code> object associated with it.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile_delete" title="sqlalchemy.orm.QueryEvents.before_compile_delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QueryEvents.before_compile_delete()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_bulk_update" title="sqlalchemy.orm.SessionEvents.after_bulk_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_bulk_update()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.after_bulk_update">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">after_bulk_update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">update_context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.after_bulk_update" title="Link to this definition">¶</a></dt>
<dd><p>Event for after the legacy <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query.update" title="sqlalchemy.orm.Query.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.update()</span></code></a> method
has been called.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;after_bulk_update&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_after_bulk_update</span><span class="p">(</span><span class="n">update_context</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;after_bulk_update&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<div class="admonition legacy">
<p class="admonition-title">Legacy Feature</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_bulk_update" title="sqlalchemy.orm.SessionEvents.after_bulk_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_bulk_update()</span></code></a> method
is a legacy event hook as of SQLAlchemy 2.0.   The event
<strong>does not participate</strong> in <a class="reference internal" href="../glossary.html#term-2.0-style"><span class="xref std std-term">2.0 style</span></a> invocations
using <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.update" title="sqlalchemy.sql.expression.update"><code class="xref py py-func docutils literal notranslate"><span class="pre">update()</span></code></a> documented at
<a class="reference internal" href="queryguide/dml.html#orm-queryguide-update-delete-where"><span class="std std-ref">使用自定义 WHERE 条件的 ORM UPDATE 和 DELETE</span></a>.  For 2.0 style use,
the <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a> hook will intercept
these calls.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.orm.SessionEvents.after_bulk_update.params.update_context"></span><strong>update_context</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.after_bulk_update.params.update_context">¶</a> – <p>an “update context” object which contains
details about the update, including these attributes:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">session</span></code> - the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> involved</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">query</span></code> -the <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a>
object that this update operation
was called upon.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">values</span></code> The “values” dictionary that was passed to
<a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query.update" title="sqlalchemy.orm.Query.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.update()</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">result</span></code> the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult" title="sqlalchemy.engine.CursorResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">CursorResult</span></code></a>
returned as a result of the
bulk UPDATE operation.</p></li>
</ul>
</div></blockquote>
</p>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">在 1.4 版本发生变更: </span>the update_context no longer has a
<code class="docutils literal notranslate"><span class="pre">QueryContext</span></code> object associated with it.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile_update" title="sqlalchemy.orm.QueryEvents.before_compile_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QueryEvents.before_compile_update()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_bulk_delete" title="sqlalchemy.orm.SessionEvents.after_bulk_delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_bulk_delete()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.after_commit">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">after_commit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.session.Session"><span class="pre">Session</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.after_commit" title="Link to this definition">¶</a></dt>
<dd><p>Execute after a commit has occurred.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;after_commit&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_after_commit</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;after_commit&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_commit" title="sqlalchemy.orm.SessionEvents.after_commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_commit()</span></code></a> hook is <em>not</em> per-flush,
that is, the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> can emit SQL to the database
many times within the scope of a transaction.
For interception of these events, use the
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_flush" title="sqlalchemy.orm.SessionEvents.before_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.before_flush()</span></code></a>,
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_flush" title="sqlalchemy.orm.SessionEvents.after_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_flush()</span></code></a>, or
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_flush_postexec" title="sqlalchemy.orm.SessionEvents.after_flush_postexec"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_flush_postexec()</span></code></a>
events.</p>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>The <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> is not in an active transaction
when the <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_commit" title="sqlalchemy.orm.SessionEvents.after_commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_commit()</span></code></a> event is invoked,
and therefore can not emit SQL.  To emit SQL corresponding to
every transaction, use the <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_commit" title="sqlalchemy.orm.SessionEvents.before_commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.before_commit()</span></code></a>
event.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.orm.SessionEvents.after_commit.params.session"></span><strong>session</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.after_commit.params.session">¶</a> – The target <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_commit" title="sqlalchemy.orm.SessionEvents.before_commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.before_commit()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_begin" title="sqlalchemy.orm.SessionEvents.after_begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_begin()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_transaction_create" title="sqlalchemy.orm.SessionEvents.after_transaction_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_transaction_create()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_transaction_end" title="sqlalchemy.orm.SessionEvents.after_transaction_end"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_transaction_end()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.after_flush">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">after_flush</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">flush_context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="internals.html#sqlalchemy.orm.UOWTransaction" title="sqlalchemy.orm.UOWTransaction"><span class="pre">UOWTransaction</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.after_flush" title="Link to this definition">¶</a></dt>
<dd><p>Execute after flush has completed, but before commit has been
called.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;after_flush&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_after_flush</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">flush_context</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;after_flush&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>Note that the session’s state is still in pre-flush, i.e. ‘new’,
‘dirty’, and ‘deleted’ lists still show pre-flush state as well
as the history settings on instance attributes.</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>This event runs after the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> has emitted
SQL to modify the database, but <strong>before</strong> it has altered its
internal state to reflect those changes, including that newly
inserted objects are placed into the identity map.  ORM operations
emitted within this event such as loads of related items
may produce new identity map entries that will immediately
be replaced, sometimes causing confusing results.  SQLAlchemy will
emit a warning for this condition as of version 1.3.9.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.after_flush.params.session"></span><strong>session</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.after_flush.params.session">¶</a> – The target <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.after_flush.params.flush_context"></span><strong>flush_context</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.after_flush.params.flush_context">¶</a> – Internal <a class="reference internal" href="internals.html#sqlalchemy.orm.UOWTransaction" title="sqlalchemy.orm.UOWTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">UOWTransaction</span></code></a> object
which handles the details of the flush.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_flush" title="sqlalchemy.orm.SessionEvents.before_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.before_flush()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_flush_postexec" title="sqlalchemy.orm.SessionEvents.after_flush_postexec"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_flush_postexec()</span></code></a></p>
<p><a class="reference internal" href="session_events.html#session-persistence-events"><span class="std std-ref">持久性事件</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.after_flush_postexec">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">after_flush_postexec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">flush_context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="internals.html#sqlalchemy.orm.UOWTransaction" title="sqlalchemy.orm.UOWTransaction"><span class="pre">UOWTransaction</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.after_flush_postexec" title="Link to this definition">¶</a></dt>
<dd><p>Execute after flush has completed, and after the post-exec
state occurs.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;after_flush_postexec&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_after_flush_postexec</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">flush_context</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;after_flush_postexec&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This will be when the ‘new’, ‘dirty’, and ‘deleted’ lists are in
their final state.  An actual commit() may or may not have
occurred, depending on whether or not the flush started its own
transaction or participated in a larger transaction.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.after_flush_postexec.params.session"></span><strong>session</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.after_flush_postexec.params.session">¶</a> – The target <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.after_flush_postexec.params.flush_context"></span><strong>flush_context</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.after_flush_postexec.params.flush_context">¶</a> – Internal <a class="reference internal" href="internals.html#sqlalchemy.orm.UOWTransaction" title="sqlalchemy.orm.UOWTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">UOWTransaction</span></code></a> object
which handles the details of the flush.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_flush" title="sqlalchemy.orm.SessionEvents.before_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.before_flush()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_flush" title="sqlalchemy.orm.SessionEvents.after_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_flush()</span></code></a></p>
<p><a class="reference internal" href="session_events.html#session-persistence-events"><span class="std std-ref">持久性事件</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.after_rollback">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">after_rollback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.session.Session"><span class="pre">Session</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.after_rollback" title="Link to this definition">¶</a></dt>
<dd><p>Execute after a real DBAPI rollback has occurred.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;after_rollback&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_after_rollback</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;after_rollback&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>Note that this event only fires when the <em>actual</em> rollback against
the database occurs - it does <em>not</em> fire each time the
<a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.rollback" title="sqlalchemy.orm.Session.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.rollback()</span></code></a> method is called, if the underlying
DBAPI transaction has already been rolled back.  In many
cases, the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> will not be in
an “active” state during this event, as the current
transaction is not valid.   To acquire a <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>
which is active after the outermost rollback has proceeded,
use the <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_soft_rollback" title="sqlalchemy.orm.SessionEvents.after_soft_rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_soft_rollback()</span></code></a> event, checking the
<a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.is_active" title="sqlalchemy.orm.Session.is_active"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Session.is_active</span></code></a> flag.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.orm.SessionEvents.after_rollback.params.session"></span><strong>session</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.after_rollback.params.session">¶</a> – The target <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.after_soft_rollback">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">after_soft_rollback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">previous_transaction</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><span class="pre">SessionTransaction</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.after_soft_rollback" title="Link to this definition">¶</a></dt>
<dd><p>Execute after any rollback has occurred, including “soft”
rollbacks that don’t actually emit at the DBAPI level.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;after_soft_rollback&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_after_soft_rollback</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">previous_transaction</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;after_soft_rollback&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This corresponds to both nested and outer rollbacks, i.e.
the innermost rollback that calls the DBAPI’s
rollback() method, as well as the enclosing rollback
calls that only pop themselves from the transaction stack.</p>
<p>The given <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> can be used to invoke SQL and
<a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.query" title="sqlalchemy.orm.Session.query"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.query()</span></code></a> operations after an outermost rollback
by first checking the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.is_active" title="sqlalchemy.orm.Session.is_active"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Session.is_active</span></code></a> flag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">Session</span><span class="p">,</span> <span class="s2">&quot;after_soft_rollback&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">do_something</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">previous_transaction</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
        <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;select * from some_table&quot;</span><span class="p">))</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.after_soft_rollback.params.session"></span><strong>session</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.after_soft_rollback.params.session">¶</a> – The target <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.after_soft_rollback.params.previous_transaction"></span><strong>previous_transaction</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.after_soft_rollback.params.previous_transaction">¶</a> – The <a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code></a>
transactional marker object which was just closed.   The current
<a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code></a> for the given <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> is
available via the <code class="xref py py-attr docutils literal notranslate"><span class="pre">Session.transaction</span></code> attribute.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.after_transaction_create">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">after_transaction_create</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">transaction</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><span class="pre">SessionTransaction</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.after_transaction_create" title="Link to this definition">¶</a></dt>
<dd><p>Execute when a new <a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code></a> is created.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;after_transaction_create&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_after_transaction_create</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;after_transaction_create&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This event differs from <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_begin" title="sqlalchemy.orm.SessionEvents.after_begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_begin()</span></code></a>
in that it occurs for each <a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code></a>
overall, as opposed to when transactions are begun
on individual database connections.  It is also invoked
for nested transactions and subtransactions, and is always
matched by a corresponding
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_transaction_end" title="sqlalchemy.orm.SessionEvents.after_transaction_end"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_transaction_end()</span></code></a> event
(assuming normal operation of the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>).</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.after_transaction_create.params.session"></span><strong>session</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.after_transaction_create.params.session">¶</a> – the target <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.after_transaction_create.params.transaction"></span><strong>transaction</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.after_transaction_create.params.transaction">¶</a> – <p>the target <a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code></a>.</p>
<p>To detect if this is the outermost
<a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code></a>, as opposed to a “subtransaction” or a
SAVEPOINT, test that the <a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction.parent" title="sqlalchemy.orm.SessionTransaction.parent"><code class="xref py py-attr docutils literal notranslate"><span class="pre">SessionTransaction.parent</span></code></a> attribute
is <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;after_transaction_create&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">after_transaction_create</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="o">...</span>  <span class="c1"># work with top-level transaction</span></pre></div>
</div>
<p>To detect if the <a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code></a> is a SAVEPOINT, use the
<a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction.nested" title="sqlalchemy.orm.SessionTransaction.nested"><code class="xref py py-attr docutils literal notranslate"><span class="pre">SessionTransaction.nested</span></code></a> attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;after_transaction_create&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">after_transaction_create</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">nested</span><span class="p">:</span>
        <span class="o">...</span>  <span class="c1"># work with SAVEPOINT transaction</span></pre></div>
</div>
</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_transaction_end" title="sqlalchemy.orm.SessionEvents.after_transaction_end"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_transaction_end()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.after_transaction_end">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">after_transaction_end</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">transaction</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><span class="pre">SessionTransaction</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.after_transaction_end" title="Link to this definition">¶</a></dt>
<dd><p>Execute when the span of a <a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code></a> ends.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;after_transaction_end&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_after_transaction_end</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;after_transaction_end&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This event differs from <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_commit" title="sqlalchemy.orm.SessionEvents.after_commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_commit()</span></code></a>
in that it corresponds to all <a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code></a>
objects in use, including those for nested transactions
and subtransactions, and is always matched by a corresponding
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_transaction_create" title="sqlalchemy.orm.SessionEvents.after_transaction_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_transaction_create()</span></code></a> event.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.after_transaction_end.params.session"></span><strong>session</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.after_transaction_end.params.session">¶</a> – the target <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.after_transaction_end.params.transaction"></span><strong>transaction</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.after_transaction_end.params.transaction">¶</a> – <p>the target <a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code></a>.</p>
<p>To detect if this is the outermost
<a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code></a>, as opposed to a “subtransaction” or a
SAVEPOINT, test that the <a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction.parent" title="sqlalchemy.orm.SessionTransaction.parent"><code class="xref py py-attr docutils literal notranslate"><span class="pre">SessionTransaction.parent</span></code></a> attribute
is <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;after_transaction_create&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">after_transaction_end</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="o">...</span>  <span class="c1"># work with top-level transaction</span></pre></div>
</div>
<p>To detect if the <a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code></a> is a SAVEPOINT, use the
<a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction.nested" title="sqlalchemy.orm.SessionTransaction.nested"><code class="xref py py-attr docutils literal notranslate"><span class="pre">SessionTransaction.nested</span></code></a> attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;after_transaction_create&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">after_transaction_end</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">nested</span><span class="p">:</span>
        <span class="o">...</span>  <span class="c1"># work with SAVEPOINT transaction</span></pre></div>
</div>
</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="session_api.html#sqlalchemy.orm.SessionTransaction" title="sqlalchemy.orm.SessionTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionTransaction</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_transaction_create" title="sqlalchemy.orm.SessionEvents.after_transaction_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_transaction_create()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.before_attach">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">before_attach</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.before_attach" title="Link to this definition">¶</a></dt>
<dd><p>Execute before an instance is attached to a session.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;before_attach&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_before_attach</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;before_attach&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This is called before an add, delete or merge causes
the object to be part of the session.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_attach" title="sqlalchemy.orm.SessionEvents.after_attach"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_attach()</span></code></a></p>
<p><a class="reference internal" href="session_events.html#session-lifecycle-events"><span class="std std-ref">对象生命周期事件</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.before_commit">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">before_commit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.session.Session"><span class="pre">Session</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.before_commit" title="Link to this definition">¶</a></dt>
<dd><p>Execute before commit is called.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;before_commit&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_before_commit</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;before_commit&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_commit" title="sqlalchemy.orm.SessionEvents.before_commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.before_commit()</span></code></a> hook is <em>not</em> per-flush,
that is, the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> can emit SQL to the database
many times within the scope of a transaction.
For interception of these events, use the
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_flush" title="sqlalchemy.orm.SessionEvents.before_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.before_flush()</span></code></a>,
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_flush" title="sqlalchemy.orm.SessionEvents.after_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_flush()</span></code></a>, or
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_flush_postexec" title="sqlalchemy.orm.SessionEvents.after_flush_postexec"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_flush_postexec()</span></code></a>
events.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.orm.SessionEvents.before_commit.params.session"></span><strong>session</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.before_commit.params.session">¶</a> – The target <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_commit" title="sqlalchemy.orm.SessionEvents.after_commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_commit()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_begin" title="sqlalchemy.orm.SessionEvents.after_begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_begin()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_transaction_create" title="sqlalchemy.orm.SessionEvents.after_transaction_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_transaction_create()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_transaction_end" title="sqlalchemy.orm.SessionEvents.after_transaction_end"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_transaction_end()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.before_flush">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">before_flush</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">flush_context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="internals.html#sqlalchemy.orm.UOWTransaction" title="sqlalchemy.orm.UOWTransaction"><span class="pre">UOWTransaction</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">instances</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><span class="pre">Sequence</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.before_flush" title="Link to this definition">¶</a></dt>
<dd><p>Execute before flush process has started.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;before_flush&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_before_flush</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">flush_context</span><span class="p">,</span> <span class="n">instances</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;before_flush&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.before_flush.params.session"></span><strong>session</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.before_flush.params.session">¶</a> – The target <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.before_flush.params.flush_context"></span><strong>flush_context</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.before_flush.params.flush_context">¶</a> – Internal <a class="reference internal" href="internals.html#sqlalchemy.orm.UOWTransaction" title="sqlalchemy.orm.UOWTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">UOWTransaction</span></code></a> object
which handles the details of the flush.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.before_flush.params.instances"></span><strong>instances</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.before_flush.params.instances">¶</a> – Usually <code class="docutils literal notranslate"><span class="pre">None</span></code>, this is the collection of
objects which can be passed to the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.flush" title="sqlalchemy.orm.Session.flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.flush()</span></code></a> method
(note this usage is deprecated).</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_flush" title="sqlalchemy.orm.SessionEvents.after_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_flush()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_flush_postexec" title="sqlalchemy.orm.SessionEvents.after_flush_postexec"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_flush_postexec()</span></code></a></p>
<p><a class="reference internal" href="session_events.html#session-persistence-events"><span class="std std-ref">持久性事件</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.deleted_to_detached">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">deleted_to_detached</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.deleted_to_detached" title="Link to this definition">¶</a></dt>
<dd><p>Intercept the “deleted to detached” transition for a specific
object.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;deleted_to_detached&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_deleted_to_detached</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;deleted_to_detached&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This event is invoked when a deleted object is evicted
from the session.   The typical case when this occurs is when
the transaction for a <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> in which the object
was deleted is committed; the object moves from the deleted
state to the detached state.</p>
<p>It is also invoked for objects that were deleted in a flush
when the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.expunge_all" title="sqlalchemy.orm.Session.expunge_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expunge_all()</span></code></a> or <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.close" title="sqlalchemy.orm.Session.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.close()</span></code></a>
events are called, as well as if the object is individually
expunged from its deleted state via <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.expunge" title="sqlalchemy.orm.Session.expunge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expunge()</span></code></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="session_events.html#session-lifecycle-events"><span class="std std-ref">对象生命周期事件</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.deleted_to_persistent">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">deleted_to_persistent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.deleted_to_persistent" title="Link to this definition">¶</a></dt>
<dd><p>Intercept the “deleted to persistent” transition for a specific
object.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;deleted_to_persistent&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_deleted_to_persistent</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;deleted_to_persistent&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This transition occurs only when an object that’s been deleted
successfully in a flush is restored due to a call to
<a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.rollback" title="sqlalchemy.orm.Session.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.rollback()</span></code></a>.   The event is not called under
any other circumstances.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="session_events.html#session-lifecycle-events"><span class="std std-ref">对象生命周期事件</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.detached_to_persistent">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">detached_to_persistent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.detached_to_persistent" title="Link to this definition">¶</a></dt>
<dd><p>Intercept the “detached to persistent” transition for a specific
object.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;detached_to_persistent&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_detached_to_persistent</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;detached_to_persistent&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This event is a specialization of the
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_attach" title="sqlalchemy.orm.SessionEvents.after_attach"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_attach()</span></code></a> event which is only invoked
for this specific transition.  It is invoked typically during the
<a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.add" title="sqlalchemy.orm.Session.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.add()</span></code></a> call, as well as during the
<a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.delete" title="sqlalchemy.orm.Session.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.delete()</span></code></a> call if the object was not previously
associated with the
<a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> (note that an object marked as “deleted” remains
in the “persistent” state until the flush proceeds).</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>If the object becomes persistent as part of a call to
<a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.delete" title="sqlalchemy.orm.Session.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.delete()</span></code></a>, the object is <strong>not</strong> yet marked as
deleted when this event is called.  To detect deleted objects,
check the <code class="docutils literal notranslate"><span class="pre">deleted</span></code> flag sent to the
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.persistent_to_detached" title="sqlalchemy.orm.SessionEvents.persistent_to_detached"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.persistent_to_detached()</span></code></a> to event after the
flush proceeds, or check the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.deleted" title="sqlalchemy.orm.Session.deleted"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Session.deleted</span></code></a> collection
within the <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_flush" title="sqlalchemy.orm.SessionEvents.before_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.before_flush()</span></code></a> event if deleted
objects need to be intercepted before the flush.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.detached_to_persistent.params.session"></span><strong>session</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.detached_to_persistent.params.session">¶</a> – target <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a></p></li>
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.detached_to_persistent.params.instance"></span><strong>instance</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.detached_to_persistent.params.instance">¶</a> – the ORM-mapped instance being operated upon.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="session_events.html#session-lifecycle-events"><span class="std std-ref">对象生命周期事件</span></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.dispatch">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">dispatch</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">_Dispatch</span><span class="p"><span class="pre">[</span></span><span class="pre">_ET</span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">&lt;sqlalchemy.event.base.SessionEventsDispatch</span> <span class="pre">object&gt;</span></em><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.dispatch" title="Link to this definition">¶</a></dt>
<dd><p>reference back to the _Dispatch class.</p>
<p>Bidirectional against _Dispatch._events</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.do_orm_execute">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">do_orm_execute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">orm_execute_state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.ORMExecuteState" title="sqlalchemy.orm.ORMExecuteState"><span class="pre">ORMExecuteState</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="Link to this definition">¶</a></dt>
<dd><p>Intercept statement executions that occur on behalf of an
ORM <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> object.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;do_orm_execute&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_do_orm_execute</span><span class="p">(</span><span class="n">orm_execute_state</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;do_orm_execute&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This event is invoked for all top-level SQL statements invoked from the
<a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.execute" title="sqlalchemy.orm.Session.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code></a> method, as well as related methods such as
<a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.scalars" title="sqlalchemy.orm.Session.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.scalars()</span></code></a> and <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.scalar" title="sqlalchemy.orm.Session.scalar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.scalar()</span></code></a>. As of
SQLAlchemy 1.4, all ORM queries that run through the
<a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.execute" title="sqlalchemy.orm.Session.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code></a> method as well as related methods
<a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.scalars" title="sqlalchemy.orm.Session.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.scalars()</span></code></a>, <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.scalar" title="sqlalchemy.orm.Session.scalar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.scalar()</span></code></a> etc.
will participate in this event.
This event hook does <strong>not</strong> apply to the queries that are
emitted internally within the ORM flush process, i.e. the
process described at <a class="reference internal" href="session_basics.html#session-flushing"><span class="std std-ref">刷新</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a> event hook
is triggered <strong>for ORM statement executions only</strong>, meaning those
invoked via the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.execute" title="sqlalchemy.orm.Session.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code></a> and similar methods on
the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> object. It does <strong>not</strong> trigger for
statements that are invoked by SQLAlchemy Core only, i.e. statements
invoked directly using <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a> or
otherwise originating from an <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> object without
any <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> involved. To intercept <strong>all</strong> SQL
executions regardless of whether the Core or ORM APIs are in use,
see the event hooks at <a class="reference internal" href="../core/events.html#sqlalchemy.events.ConnectionEvents" title="sqlalchemy.events.ConnectionEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionEvents</span></code></a>, such as
<a class="reference internal" href="../core/events.html#sqlalchemy.events.ConnectionEvents.before_execute" title="sqlalchemy.events.ConnectionEvents.before_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConnectionEvents.before_execute()</span></code></a> and
<a class="reference internal" href="../core/events.html#sqlalchemy.events.ConnectionEvents.before_cursor_execute" title="sqlalchemy.events.ConnectionEvents.before_cursor_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConnectionEvents.before_cursor_execute()</span></code></a>.</p>
<p>Also, this event hook does <strong>not</strong> apply to queries that are
emitted internally within the ORM flush process,
i.e. the process described at <a class="reference internal" href="session_basics.html#session-flushing"><span class="std std-ref">刷新</span></a>; to
intercept steps within the flush process, see the event
hooks described at <a class="reference internal" href="session_events.html#session-persistence-events"><span class="std std-ref">持久性事件</span></a> as
well as <a class="reference internal" href="session_events.html#session-persistence-mapper"><span class="std std-ref">映射器级刷新事件</span></a>.</p>
</div>
<p>This event is a <code class="docutils literal notranslate"><span class="pre">do_</span></code> event, meaning it has the capability to replace
the operation that the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.execute" title="sqlalchemy.orm.Session.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code></a> method normally
performs.  The intended use for this includes sharding and
result-caching schemes which may seek to invoke the same statement
across  multiple database connections, returning a result that is
merged from each of them, or which don’t invoke the statement at all,
instead returning data from a cache.</p>
<p>The hook intends to replace the use of the
<code class="docutils literal notranslate"><span class="pre">Query._execute_and_instances</span></code> method that could be subclassed prior
to SQLAlchemy 1.4.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.orm.SessionEvents.do_orm_execute.params.orm_execute_state"></span><strong>orm_execute_state</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute.params.orm_execute_state">¶</a> – an instance of <a class="reference internal" href="session_api.html#sqlalchemy.orm.ORMExecuteState" title="sqlalchemy.orm.ORMExecuteState"><code class="xref py py-class docutils literal notranslate"><span class="pre">ORMExecuteState</span></code></a>
which contains all information about the current execution, as well
as helper functions used to derive other commonly required
information.   See that object for details.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="session_events.html#session-execute-events"><span class="std std-ref">执行事件</span></a> - top level documentation on how
to use <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a></p>
<p><a class="reference internal" href="session_api.html#sqlalchemy.orm.ORMExecuteState" title="sqlalchemy.orm.ORMExecuteState"><code class="xref py py-class docutils literal notranslate"><span class="pre">ORMExecuteState</span></code></a> - the object passed to the
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a> event which contains
all information about the statement to be invoked.  It also
provides an interface to extend the current statement, options,
and parameters as well as an option that allows programmatic
invocation of the statement at any point.</p>
<p><a class="reference internal" href="examples.html#examples-session-orm-events"><span class="std std-ref">ORM 查询事件</span></a> - includes examples of using
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a></p>
<p><a class="reference internal" href="examples.html#examples-caching"><span class="std std-ref">Dogpile 缓存</span></a> - an example of how to integrate
Dogpile caching with the ORM <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> making use
of the <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a> event hook.</p>
<p><a class="reference internal" href="examples.html#examples-sharding"><span class="std std-ref">水平分片</span></a> - the Horizontal Sharding example /
extension relies upon the
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a> event hook to invoke a
SQL statement on multiple backends and return a merged result.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4 版本加入.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.loaded_as_persistent">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">loaded_as_persistent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.loaded_as_persistent" title="Link to this definition">¶</a></dt>
<dd><p>Intercept the “loaded as persistent” transition for a specific
object.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;loaded_as_persistent&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_loaded_as_persistent</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;loaded_as_persistent&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This event is invoked within the ORM loading process, and is invoked
very similarly to the <a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.load" title="sqlalchemy.orm.InstanceEvents.load"><code class="xref py py-meth docutils literal notranslate"><span class="pre">InstanceEvents.load()</span></code></a> event.  However,
the event here is linkable to a <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> class or instance,
rather than to a mapper or class hierarchy, and integrates
with the other session lifecycle events smoothly.  The object
is guaranteed to be present in the session’s identity map when
this event is called.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>This event is invoked within the loader process before
eager loaders may have been completed, and the object’s state may
not be complete.  Additionally, invoking row-level refresh
operations on the object will place the object into a new loader
context, interfering with the existing load context.   See the note
on <a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.load" title="sqlalchemy.orm.InstanceEvents.load"><code class="xref py py-meth docutils literal notranslate"><span class="pre">InstanceEvents.load()</span></code></a> for background on making use of the
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.params.restore_load_context" title="sqlalchemy.orm.SessionEvents"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">SessionEvents.restore_load_context</span></code></a> parameter, which
works in the same manner as that of
<a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.params.restore_load_context" title="sqlalchemy.orm.InstanceEvents"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">InstanceEvents.restore_load_context</span></code></a>, in  order to
resolve this scenario.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.loaded_as_persistent.params.session"></span><strong>session</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.loaded_as_persistent.params.session">¶</a> – target <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a></p></li>
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.loaded_as_persistent.params.instance"></span><strong>instance</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.loaded_as_persistent.params.instance">¶</a> – the ORM-mapped instance being operated upon.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="session_events.html#session-lifecycle-events"><span class="std std-ref">对象生命周期事件</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.pending_to_persistent">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">pending_to_persistent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.pending_to_persistent" title="Link to this definition">¶</a></dt>
<dd><p>Intercept the “pending to persistent”” transition for a specific
object.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;pending_to_persistent&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_pending_to_persistent</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;pending_to_persistent&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This event is invoked within the flush process, and is
similar to scanning the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.new" title="sqlalchemy.orm.Session.new"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Session.new</span></code></a> collection within
the <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_flush" title="sqlalchemy.orm.SessionEvents.after_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_flush()</span></code></a> event.  However, in this
case the object has already been moved to the persistent state
when the event is called.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.pending_to_persistent.params.session"></span><strong>session</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.pending_to_persistent.params.session">¶</a> – target <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a></p></li>
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.pending_to_persistent.params.instance"></span><strong>instance</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.pending_to_persistent.params.instance">¶</a> – the ORM-mapped instance being operated upon.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="session_events.html#session-lifecycle-events"><span class="std std-ref">对象生命周期事件</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.pending_to_transient">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">pending_to_transient</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.pending_to_transient" title="Link to this definition">¶</a></dt>
<dd><p>Intercept the “pending to transient” transition for a specific
object.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;pending_to_transient&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_pending_to_transient</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;pending_to_transient&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This less common transition occurs when an pending object that has
not been flushed is evicted from the session; this can occur
when the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.rollback" title="sqlalchemy.orm.Session.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.rollback()</span></code></a> method rolls back the transaction,
or when the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.expunge" title="sqlalchemy.orm.Session.expunge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expunge()</span></code></a> method is used.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.pending_to_transient.params.session"></span><strong>session</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.pending_to_transient.params.session">¶</a> – target <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a></p></li>
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.pending_to_transient.params.instance"></span><strong>instance</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.pending_to_transient.params.instance">¶</a> – the ORM-mapped instance being operated upon.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="session_events.html#session-lifecycle-events"><span class="std std-ref">对象生命周期事件</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.persistent_to_deleted">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">persistent_to_deleted</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.persistent_to_deleted" title="Link to this definition">¶</a></dt>
<dd><p>Intercept the “persistent to deleted” transition for a specific
object.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;persistent_to_deleted&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_persistent_to_deleted</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;persistent_to_deleted&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This event is invoked when a persistent object’s identity
is deleted from the database within a flush, however the object
still remains associated with the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> until the
transaction completes.</p>
<p>If the transaction is rolled back, the object moves again
to the persistent state, and the
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.deleted_to_persistent" title="sqlalchemy.orm.SessionEvents.deleted_to_persistent"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.deleted_to_persistent()</span></code></a> event is called.
If the transaction is committed, the object becomes detached,
which will emit the <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.deleted_to_detached" title="sqlalchemy.orm.SessionEvents.deleted_to_detached"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.deleted_to_detached()</span></code></a>
event.</p>
<p>Note that while the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.delete" title="sqlalchemy.orm.Session.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.delete()</span></code></a> method is the primary
public interface to mark an object as deleted, many objects
get deleted due to cascade rules, which are not always determined
until flush time.  Therefore, there’s no way to catch
every object that will be deleted until the flush has proceeded.
the <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.persistent_to_deleted" title="sqlalchemy.orm.SessionEvents.persistent_to_deleted"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.persistent_to_deleted()</span></code></a> event is therefore
invoked at the end of a flush.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="session_events.html#session-lifecycle-events"><span class="std std-ref">对象生命周期事件</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.persistent_to_detached">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">persistent_to_detached</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.persistent_to_detached" title="Link to this definition">¶</a></dt>
<dd><p>Intercept the “persistent to detached” transition for a specific
object.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;persistent_to_detached&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_persistent_to_detached</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;persistent_to_detached&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This event is invoked when a persistent object is evicted
from the session.  There are many conditions that cause this
to happen, including:</p>
<ul class="simple">
<li><p>using a method such as <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.expunge" title="sqlalchemy.orm.Session.expunge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expunge()</span></code></a>
or <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.close" title="sqlalchemy.orm.Session.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.close()</span></code></a></p></li>
<li><p>Calling the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.rollback" title="sqlalchemy.orm.Session.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.rollback()</span></code></a> method, when the object
was part of an INSERT statement for that session’s transaction</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.persistent_to_detached.params.session"></span><strong>session</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.persistent_to_detached.params.session">¶</a> – target <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a></p></li>
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.persistent_to_detached.params.instance"></span><strong>instance</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.persistent_to_detached.params.instance">¶</a> – the ORM-mapped instance being operated upon.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.persistent_to_detached.params.deleted"></span><strong>deleted</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.persistent_to_detached.params.deleted">¶</a> – boolean.  If True, indicates this object moved
to the detached state because it was marked as deleted and flushed.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="session_events.html#session-lifecycle-events"><span class="std std-ref">对象生命周期事件</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.persistent_to_transient">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">persistent_to_transient</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.persistent_to_transient" title="Link to this definition">¶</a></dt>
<dd><p>Intercept the “persistent to transient” transition for a specific
object.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;persistent_to_transient&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_persistent_to_transient</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;persistent_to_transient&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This less common transition occurs when an pending object that has
has been flushed is evicted from the session; this can occur
when the <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.rollback" title="sqlalchemy.orm.Session.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.rollback()</span></code></a> method rolls back the transaction.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.persistent_to_transient.params.session"></span><strong>session</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.persistent_to_transient.params.session">¶</a> – target <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a></p></li>
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.persistent_to_transient.params.instance"></span><strong>instance</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.persistent_to_transient.params.instance">¶</a> – the ORM-mapped instance being operated upon.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="session_events.html#session-lifecycle-events"><span class="std std-ref">对象生命周期事件</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.SessionEvents.transient_to_pending">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.SessionEvents.</span></code></a><span class="sig-name descname"><span class="pre">transient_to_pending</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><span class="pre">Session</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.SessionEvents.transient_to_pending" title="Link to this definition">¶</a></dt>
<dd><p>Intercept the “transient to pending” transition for a specific
object.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeSessionClassOrObject</span><span class="p">,</span> <span class="s1">&#39;transient_to_pending&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_transient_to_pending</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;transient_to_pending&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This event is a specialization of the
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_attach" title="sqlalchemy.orm.SessionEvents.after_attach"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_attach()</span></code></a> event which is only invoked
for this specific transition.  It is invoked typically during the
<a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.add" title="sqlalchemy.orm.Session.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.add()</span></code></a> call.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.transient_to_pending.params.session"></span><strong>session</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.transient_to_pending.params.session">¶</a> – target <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a></p></li>
<li><p><span class="target" id="sqlalchemy.orm.SessionEvents.transient_to_pending.params.instance"></span><strong>instance</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.SessionEvents.transient_to_pending.params.instance">¶</a> – the ORM-mapped instance being operated upon.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="session_events.html#session-lifecycle-events"><span class="std std-ref">对象生命周期事件</span></a></p>
</div>
</dd></dl>

</dd></dl>

</section>
<section id="id2">
<h2>映射器事件<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p>Mapper Events</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--2-input--1" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--1">中文</label><div class="tab-content docutils container">
<p>映射器事件钩子涵盖了与单个或多个 <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> 对象相关的事件，这些对象是将用户定义类映射到 <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> 对象的中心配置对象。在 <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> 级别发生的事情类型包括：</p>
<ul class="simple">
<li><p><strong>按对象的持久化操作</strong> - 最受欢迎的映射器钩子是单元工作钩子，例如 <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_insert" title="sqlalchemy.orm.MapperEvents.before_insert"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_insert()</span></code></a>、<a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_update" title="sqlalchemy.orm.MapperEvents.after_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.after_update()</span></code></a> 等。这些事件与更粗粒度的会话级事件（如 <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_flush" title="sqlalchemy.orm.SessionEvents.before_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.before_flush()</span></code></a>）相比，它们在刷新过程中按对象发生；尽管对象上的细粒度活动更为直接，但 <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> 功能的可用性有限。</p></li>
<li><p><strong>映射器配置事件</strong> - 另一类主要的映射器钩子是在类被映射时、映射器被最终确定时以及成组的映射器被配置为相互引用时发生的那些事件。这些事件包括在单个 <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> 级别的 <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.instrument_class" title="sqlalchemy.orm.MapperEvents.instrument_class"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.instrument_class()</span></code></a>、<a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_mapper_configured" title="sqlalchemy.orm.MapperEvents.before_mapper_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_mapper_configured()</span></code></a> 和 <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.mapper_configured" title="sqlalchemy.orm.MapperEvents.mapper_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.mapper_configured()</span></code></a>，以及在成组 <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> 对象级别的 <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_configured" title="sqlalchemy.orm.MapperEvents.before_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_configured()</span></code></a> 和 <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_configured" title="sqlalchemy.orm.MapperEvents.after_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.after_configured()</span></code></a>。</p></li>
</ul>
</div>
<input class="tab-input" id="tab-set--2-input--2" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--2">英文</label><div class="tab-content docutils container">
<p>Mapper event hooks encompass things that happen as related to individual
or multiple <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> objects, which are the central configurational
object that maps a user-defined class to a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> object.
Types of things which occur at the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> level include:</p>
<ul class="simple">
<li><p><strong>Per-object persistence operations</strong> - the most popular mapper hooks are the
unit-of-work hooks such as <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_insert" title="sqlalchemy.orm.MapperEvents.before_insert"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_insert()</span></code></a>,
<a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_update" title="sqlalchemy.orm.MapperEvents.after_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.after_update()</span></code></a>, etc.  These events are contrasted to
the more coarse grained session-level events such as
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_flush" title="sqlalchemy.orm.SessionEvents.before_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.before_flush()</span></code></a> in that they occur within the flush
process on a per-object basis; while finer grained activity on an object is
more straightforward, availability of <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> features is
limited.</p></li>
<li><p><strong>Mapper configuration events</strong> - the other major class of mapper hooks are
those which occur as a class is mapped, as a mapper is finalized, and when
sets of mappers are configured to refer to each other.  These events include
<a class="reference internal" href="#sqlalchemy.orm.MapperEvents.instrument_class" title="sqlalchemy.orm.MapperEvents.instrument_class"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.instrument_class()</span></code></a>,
<a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_mapper_configured" title="sqlalchemy.orm.MapperEvents.before_mapper_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_mapper_configured()</span></code></a> and
<a class="reference internal" href="#sqlalchemy.orm.MapperEvents.mapper_configured" title="sqlalchemy.orm.MapperEvents.mapper_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.mapper_configured()</span></code></a> at the individual
<a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> level, and  <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_configured" title="sqlalchemy.orm.MapperEvents.before_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_configured()</span></code></a>
and <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_configured" title="sqlalchemy.orm.MapperEvents.after_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.after_configured()</span></code></a> at the level of collections of
<a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> objects.</p></li>
</ul>
</div>
</div>
<div class="table-wrapper longtable docutils container">
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.MapperEvents"><span class="sig-name descname">MapperEvents</span></a></p></td>
<td><p>Define events specific to mappings.</p></td>
</tr>
</tbody>
</table>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.orm.MapperEvents">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">MapperEvents</span></span><a class="headerlink" href="#sqlalchemy.orm.MapperEvents" title="Link to this definition">¶</a></dt>
<dd><p>Define events specific to mappings.</p>
<p>e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="k">def</span><span class="w"> </span><span class="nf">my_before_insert_listener</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="c1"># execute a stored procedure upon INSERT,</span>
    <span class="c1"># apply the value to the row to be inserted</span>
    <span class="n">target</span><span class="o">.</span><span class="n">calculated_value</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="n">text</span><span class="p">(</span><span class="s2">&quot;select my_special_function(</span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">target</span><span class="o">.</span><span class="n">special_number</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span>


<span class="c1"># associate the listener function with SomeClass,</span>
<span class="c1"># to execute during the &quot;before_insert&quot; hook</span>
<span class="n">event</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s2">&quot;before_insert&quot;</span><span class="p">,</span> <span class="n">my_before_insert_listener</span><span class="p">)</span></pre></div>
</div>
<p>Available targets include:</p>
<ul class="simple">
<li><p>mapped classes</p></li>
<li><p>unmapped superclasses of mapped or to-be-mapped classes
(using the <code class="docutils literal notranslate"><span class="pre">propagate=True</span></code> flag)</p></li>
<li><p><a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> objects</p></li>
<li><p>the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> class itself indicates listening for all
mappers.</p></li>
</ul>
<p>Mapper events provide hooks into critical sections of the
mapper, including those related to object instrumentation,
object loading, and object persistence. In particular, the
persistence methods <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_insert" title="sqlalchemy.orm.MapperEvents.before_insert"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_insert()</span></code></a>,
and <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_update" title="sqlalchemy.orm.MapperEvents.before_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_update()</span></code></a> are popular
places to augment the state being persisted - however, these
methods operate with several significant restrictions. The
user is encouraged to evaluate the
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_flush" title="sqlalchemy.orm.SessionEvents.before_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.before_flush()</span></code></a> and
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_flush" title="sqlalchemy.orm.SessionEvents.after_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_flush()</span></code></a> methods as more
flexible and user-friendly hooks in which to apply
additional database state during a flush.</p>
<p>When using <a class="reference internal" href="#sqlalchemy.orm.MapperEvents" title="sqlalchemy.orm.MapperEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">MapperEvents</span></code></a>, several modifiers are
available to the <a class="reference internal" href="../core/event.html#sqlalchemy.event.listen" title="sqlalchemy.event.listen"><code class="xref py py-func docutils literal notranslate"><span class="pre">listen()</span></code></a> function.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.params.propagate"></span><strong>propagate=False</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.params.propagate">¶</a> – When True, the event listener should
be applied to all inheriting mappers and/or the mappers of
inheriting classes, as well as any
mapper which is the target of this listener.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.params.raw"></span><strong>raw=False</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.params.raw">¶</a> – When True, the “target” argument passed
to applicable event listener functions will be the
instance’s <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> management
object, rather than the mapped instance itself.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.params.retval"></span><strong>retval=False</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.params.retval">¶</a> – <p>when True, the user-defined event function
must have a return value, the purpose of which is either to
control subsequent event propagation, or to otherwise alter
the operation in progress by the mapper.   Possible return
values are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.interfaces.EXT_CONTINUE</span></code> - continue event
processing normally.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.interfaces.EXT_STOP</span></code> - cancel all subsequent
event handlers in the chain.</p></li>
<li><p>other values - the return value specified by specific listeners.</p></li>
</ul>
</p></li>
</ul>
</dd>
</dl>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_configured"><span class="sig-name descname">after_configured()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_delete"><span class="sig-name descname">after_delete()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_insert"><span class="sig-name descname">after_insert()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_mapper_constructed"><span class="sig-name descname">after_mapper_constructed()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_update"><span class="sig-name descname">after_update()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_configured"><span class="sig-name descname">before_configured()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_delete"><span class="sig-name descname">before_delete()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_insert"><span class="sig-name descname">before_insert()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_mapper_configured"><span class="sig-name descname">before_mapper_configured()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_update"><span class="sig-name descname">before_update()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.dispatch"><span class="sig-name descname">dispatch</span></a>, <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.instrument_class"><span class="sig-name descname">instrument_class()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.mapper_configured"><span class="sig-name descname">mapper_configured()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.orm.MapperEvents" title="sqlalchemy.orm.MapperEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.MapperEvents</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.event.Events</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.MapperEvents.after_configured">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.MapperEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.MapperEvents.</span></code></a><span class="sig-name descname"><span class="pre">after_configured</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.MapperEvents.after_configured" title="Link to this definition">¶</a></dt>
<dd><p>Called after a series of mappers have been configured.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s1">&#39;after_configured&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_after_configured</span><span class="p">():</span>
    <span class="s2">&quot;listen for the &#39;after_configured&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>The <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_configured" title="sqlalchemy.orm.MapperEvents.after_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.after_configured()</span></code></a> event is invoked
each time the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.configure_mappers" title="sqlalchemy.orm.configure_mappers"><code class="xref py py-func docutils literal notranslate"><span class="pre">configure_mappers()</span></code></a> function is
invoked, after the function has completed its work.
<a class="reference internal" href="mapping_api.html#sqlalchemy.orm.configure_mappers" title="sqlalchemy.orm.configure_mappers"><code class="xref py py-func docutils literal notranslate"><span class="pre">configure_mappers()</span></code></a> is typically invoked
automatically as mappings are first used, as well as each time
new mappers have been made available and new mapper use is
detected.</p>
<p>Contrast this event to the <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.mapper_configured" title="sqlalchemy.orm.MapperEvents.mapper_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.mapper_configured()</span></code></a>
event, which is called on a per-mapper basis while the configuration
operation proceeds; unlike that event, when this event is invoked,
all cross-configurations (e.g. backrefs) will also have been made
available for any mappers that were pending.
Also contrast to <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_configured" title="sqlalchemy.orm.MapperEvents.before_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_configured()</span></code></a>,
which is invoked before the series of mappers has been configured.</p>
<p>This event can <strong>only</strong> be applied to the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> class,
and not to individual mappings or
mapped classes.  It is only invoked for all mappings as a whole:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapper</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">Mapper</span><span class="p">,</span> <span class="s2">&quot;after_configured&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">():</span> <span class="o">...</span></pre></div>
</div>
<p>Theoretically this event is called once per
application, but is actually called any time new mappers
have been affected by a <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.configure_mappers" title="sqlalchemy.orm.configure_mappers"><code class="xref py py-func docutils literal notranslate"><span class="pre">configure_mappers()</span></code></a>
call.   If new mappings are constructed after existing ones have
already been used, this event will likely be called again.  To ensure
that a particular event is only called once and no further, the
<code class="docutils literal notranslate"><span class="pre">once=True</span></code> argument (new in 0.9.4) can be applied:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">mapper</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="s2">&quot;after_configured&quot;</span><span class="p">,</span> <span class="n">once</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">():</span> <span class="o">...</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_mapper_configured" title="sqlalchemy.orm.MapperEvents.before_mapper_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_mapper_configured()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.mapper_configured" title="sqlalchemy.orm.MapperEvents.mapper_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.mapper_configured()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_configured" title="sqlalchemy.orm.MapperEvents.before_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_configured()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.MapperEvents.after_delete">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.MapperEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.MapperEvents.</span></code></a><span class="sig-name descname"><span class="pre">after_delete</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mapper</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><span class="pre">Mapper</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><span class="pre">Connection</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.MapperEvents.after_delete" title="Link to this definition">¶</a></dt>
<dd><p>Receive an object instance after a DELETE statement
has been emitted corresponding to that instance.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s1">&#39;after_delete&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_after_delete</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;after_delete&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>this event <strong>only</strong> applies to the
<a class="reference internal" href="session_basics.html#session-flushing"><span class="std std-ref">session flush operation</span></a>
and does <strong>not</strong> apply to the ORM DML operations described at
<a class="reference internal" href="queryguide/dml.html#orm-expression-update-delete"><span class="std std-ref">启用 ORM 的 INSERT、UPDATE 和 DELETE 语句</span></a>.  To intercept ORM
DML events, use <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a>.</p>
</div>
<p>This event is used to emit additional SQL statements on
the given connection as well as to perform application
specific bookkeeping related to a deletion event.</p>
<p>The event is often called for a batch of objects of the
same class after their DELETE statements have been emitted at
once in a previous step.</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>Mapper-level flush events only allow <strong>very limited operations</strong>,
on attributes local to the row being operated upon only,
as well as allowing any SQL to be emitted on the given
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>.  <strong>Please read fully</strong> the notes
at <a class="reference internal" href="session_events.html#session-persistence-mapper"><span class="std std-ref">映射器级刷新事件</span></a> for guidelines on using
these methods; generally, the <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_flush" title="sqlalchemy.orm.SessionEvents.before_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.before_flush()</span></code></a>
method should be preferred for general on-flush changes.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.after_delete.params.mapper"></span><strong>mapper</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.after_delete.params.mapper">¶</a> – the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> which is the target
of this event.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.after_delete.params.connection"></span><strong>connection</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.after_delete.params.connection">¶</a> – the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> being used to
emit DELETE statements for this instance.  This
provides a handle into the current transaction on the
target database specific to this instance.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.after_delete.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.after_delete.params.target">¶</a> – the mapped instance being deleted.  If
the event is configured with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
instead be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> state-management
object associated with the instance.</p></li>
</ul>
</dd>
<dt class="field-even">返回<span class="colon">:</span></dt>
<dd class="field-even"><p>No return value is supported by this event.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="session_events.html#session-persistence-events"><span class="std std-ref">持久性事件</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.MapperEvents.after_insert">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.MapperEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.MapperEvents.</span></code></a><span class="sig-name descname"><span class="pre">after_insert</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mapper</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><span class="pre">Mapper</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><span class="pre">Connection</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.MapperEvents.after_insert" title="Link to this definition">¶</a></dt>
<dd><p>Receive an object instance after an INSERT statement
is emitted corresponding to that instance.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s1">&#39;after_insert&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_after_insert</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;after_insert&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>this event <strong>only</strong> applies to the
<a class="reference internal" href="session_basics.html#session-flushing"><span class="std std-ref">session flush operation</span></a>
and does <strong>not</strong> apply to the ORM DML operations described at
<a class="reference internal" href="queryguide/dml.html#orm-expression-update-delete"><span class="std std-ref">启用 ORM 的 INSERT、UPDATE 和 DELETE 语句</span></a>.  To intercept ORM
DML events, use <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a>.</p>
</div>
<p>This event is used to modify in-Python-only
state on the instance after an INSERT occurs, as well
as to emit additional SQL statements on the given
connection.</p>
<p>The event is often called for a batch of objects of the
same class after their INSERT statements have been
emitted at once in a previous step. In the extremely
rare case that this is not desirable, the
<a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> object can be configured with <code class="docutils literal notranslate"><span class="pre">batch=False</span></code>,
which will cause batches of instances to be broken up
into individual (and more poorly performing)
event-&gt;persist-&gt;event steps.</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>Mapper-level flush events only allow <strong>very limited operations</strong>,
on attributes local to the row being operated upon only,
as well as allowing any SQL to be emitted on the given
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>.  <strong>Please read fully</strong> the notes
at <a class="reference internal" href="session_events.html#session-persistence-mapper"><span class="std std-ref">映射器级刷新事件</span></a> for guidelines on using
these methods; generally, the <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_flush" title="sqlalchemy.orm.SessionEvents.before_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.before_flush()</span></code></a>
method should be preferred for general on-flush changes.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.after_insert.params.mapper"></span><strong>mapper</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.after_insert.params.mapper">¶</a> – the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> which is the target
of this event.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.after_insert.params.connection"></span><strong>connection</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.after_insert.params.connection">¶</a> – the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> being used to
emit INSERT statements for this instance.  This
provides a handle into the current transaction on the
target database specific to this instance.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.after_insert.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.after_insert.params.target">¶</a> – the mapped instance being persisted.  If
the event is configured with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
instead be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> state-management
object associated with the instance.</p></li>
</ul>
</dd>
<dt class="field-even">返回<span class="colon">:</span></dt>
<dd class="field-even"><p>No return value is supported by this event.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="session_events.html#session-persistence-events"><span class="std std-ref">持久性事件</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.MapperEvents.after_mapper_constructed">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.MapperEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.MapperEvents.</span></code></a><span class="sig-name descname"><span class="pre">after_mapper_constructed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mapper</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><span class="pre">Mapper</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">class_</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.MapperEvents.after_mapper_constructed" title="Link to this definition">¶</a></dt>
<dd><p>Receive a class and mapper when the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> has been
fully constructed.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s1">&#39;after_mapper_constructed&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_after_mapper_constructed</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">class_</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;after_mapper_constructed&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This event is called after the initial constructor for
<a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> completes.  This occurs after the
<a class="reference internal" href="#sqlalchemy.orm.MapperEvents.instrument_class" title="sqlalchemy.orm.MapperEvents.instrument_class"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.instrument_class()</span></code></a> event and after the
<a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> has done an initial pass of its arguments
to generate its collection of <a class="reference internal" href="internals.html#sqlalchemy.orm.MapperProperty" title="sqlalchemy.orm.MapperProperty"><code class="xref py py-class docutils literal notranslate"><span class="pre">MapperProperty</span></code></a> objects,
which are accessible via the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper.get_property" title="sqlalchemy.orm.Mapper.get_property"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Mapper.get_property()</span></code></a>
method and the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper.iterate_properties" title="sqlalchemy.orm.Mapper.iterate_properties"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Mapper.iterate_properties</span></code></a> attribute.</p>
<p>This event differs from the
<a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_mapper_configured" title="sqlalchemy.orm.MapperEvents.before_mapper_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_mapper_configured()</span></code></a> event in that it
is invoked within the constructor for <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a>, rather
than within the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.registry.configure" title="sqlalchemy.orm.registry.configure"><code class="xref py py-meth docutils literal notranslate"><span class="pre">registry.configure()</span></code></a> process.   Currently,
this event is the only one which is appropriate for handlers that
wish to create additional mapped classes in response to the
construction of this <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a>, which will be part of the
same configure step when <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.registry.configure" title="sqlalchemy.orm.registry.configure"><code class="xref py py-meth docutils literal notranslate"><span class="pre">registry.configure()</span></code></a> next runs.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0.2 版本加入.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="examples.html#examples-versioning"><span class="std std-ref">对象版本控制</span></a> - an example which illustrates the use
of the <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_mapper_configured" title="sqlalchemy.orm.MapperEvents.before_mapper_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_mapper_configured()</span></code></a>
event to create new mappers to record change-audit histories on
objects.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.MapperEvents.after_update">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.MapperEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.MapperEvents.</span></code></a><span class="sig-name descname"><span class="pre">after_update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mapper</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><span class="pre">Mapper</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><span class="pre">Connection</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.MapperEvents.after_update" title="Link to this definition">¶</a></dt>
<dd><p>Receive an object instance after an UPDATE statement
is emitted corresponding to that instance.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s1">&#39;after_update&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_after_update</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;after_update&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>this event <strong>only</strong> applies to the
<a class="reference internal" href="session_basics.html#session-flushing"><span class="std std-ref">session flush operation</span></a>
and does <strong>not</strong> apply to the ORM DML operations described at
<a class="reference internal" href="queryguide/dml.html#orm-expression-update-delete"><span class="std std-ref">启用 ORM 的 INSERT、UPDATE 和 DELETE 语句</span></a>.  To intercept ORM
DML events, use <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a>.</p>
</div>
<p>This event is used to modify in-Python-only
state on the instance after an UPDATE occurs, as well
as to emit additional SQL statements on the given
connection.</p>
<p>This method is called for all instances that are
marked as “dirty”, <em>even those which have no net changes
to their column-based attributes</em>, and for which
no UPDATE statement has proceeded. An object is marked
as dirty when any of its column-based attributes have a
“set attribute” operation called or when any of its
collections are modified. If, at update time, no
column-based attributes have any net changes, no UPDATE
statement will be issued. This means that an instance
being sent to <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_update" title="sqlalchemy.orm.MapperEvents.after_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.after_update()</span></code></a> is
<em>not</em> a guarantee that an UPDATE statement has been
issued.</p>
<p>To detect if the column-based attributes on the object have net
changes, and therefore resulted in an UPDATE statement, use
<code class="docutils literal notranslate"><span class="pre">object_session(instance).is_modified(instance,</span>
<span class="pre">include_collections=False)</span></code>.</p>
<p>The event is often called for a batch of objects of the
same class after their UPDATE statements have been emitted at
once in a previous step. In the extremely rare case that
this is not desirable, the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> can be
configured with <code class="docutils literal notranslate"><span class="pre">batch=False</span></code>, which will cause
batches of instances to be broken up into individual
(and more poorly performing) event-&gt;persist-&gt;event
steps.</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>Mapper-level flush events only allow <strong>very limited operations</strong>,
on attributes local to the row being operated upon only,
as well as allowing any SQL to be emitted on the given
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>.  <strong>Please read fully</strong> the notes
at <a class="reference internal" href="session_events.html#session-persistence-mapper"><span class="std std-ref">映射器级刷新事件</span></a> for guidelines on using
these methods; generally, the <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_flush" title="sqlalchemy.orm.SessionEvents.before_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.before_flush()</span></code></a>
method should be preferred for general on-flush changes.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.after_update.params.mapper"></span><strong>mapper</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.after_update.params.mapper">¶</a> – the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> which is the target
of this event.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.after_update.params.connection"></span><strong>connection</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.after_update.params.connection">¶</a> – the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> being used to
emit UPDATE statements for this instance.  This
provides a handle into the current transaction on the
target database specific to this instance.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.after_update.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.after_update.params.target">¶</a> – the mapped instance being persisted.  If
the event is configured with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
instead be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> state-management
object associated with the instance.</p></li>
</ul>
</dd>
<dt class="field-even">返回<span class="colon">:</span></dt>
<dd class="field-even"><p>No return value is supported by this event.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="session_events.html#session-persistence-events"><span class="std std-ref">持久性事件</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.MapperEvents.before_configured">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.MapperEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.MapperEvents.</span></code></a><span class="sig-name descname"><span class="pre">before_configured</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.MapperEvents.before_configured" title="Link to this definition">¶</a></dt>
<dd><p>Called before a series of mappers have been configured.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s1">&#39;before_configured&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_before_configured</span><span class="p">():</span>
    <span class="s2">&quot;listen for the &#39;before_configured&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>The <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_configured" title="sqlalchemy.orm.MapperEvents.before_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_configured()</span></code></a> event is invoked
each time the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.configure_mappers" title="sqlalchemy.orm.configure_mappers"><code class="xref py py-func docutils literal notranslate"><span class="pre">configure_mappers()</span></code></a> function is
invoked, before the function has done any of its work.
<a class="reference internal" href="mapping_api.html#sqlalchemy.orm.configure_mappers" title="sqlalchemy.orm.configure_mappers"><code class="xref py py-func docutils literal notranslate"><span class="pre">configure_mappers()</span></code></a> is typically invoked
automatically as mappings are first used, as well as each time
new mappers have been made available and new mapper use is
detected.</p>
<p>This event can <strong>only</strong> be applied to the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> class,
and not to individual mappings or mapped classes. It is only invoked
for all mappings as a whole:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapper</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">Mapper</span><span class="p">,</span> <span class="s2">&quot;before_configured&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">():</span> <span class="o">...</span></pre></div>
</div>
<p>Contrast this event to <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_configured" title="sqlalchemy.orm.MapperEvents.after_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.after_configured()</span></code></a>,
which is invoked after the series of mappers has been configured,
as well as <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_mapper_configured" title="sqlalchemy.orm.MapperEvents.before_mapper_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_mapper_configured()</span></code></a>
and <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.mapper_configured" title="sqlalchemy.orm.MapperEvents.mapper_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.mapper_configured()</span></code></a>, which are both invoked
on a per-mapper basis.</p>
<p>Theoretically this event is called once per
application, but is actually called any time new mappers
are to be affected by a <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.configure_mappers" title="sqlalchemy.orm.configure_mappers"><code class="xref py py-func docutils literal notranslate"><span class="pre">configure_mappers()</span></code></a>
call.   If new mappings are constructed after existing ones have
already been used, this event will likely be called again.  To ensure
that a particular event is only called once and no further, the
<code class="docutils literal notranslate"><span class="pre">once=True</span></code> argument (new in 0.9.4) can be applied:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">mapper</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="s2">&quot;before_configured&quot;</span><span class="p">,</span> <span class="n">once</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">go</span><span class="p">():</span> <span class="o">...</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_mapper_configured" title="sqlalchemy.orm.MapperEvents.before_mapper_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_mapper_configured()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.mapper_configured" title="sqlalchemy.orm.MapperEvents.mapper_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.mapper_configured()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_configured" title="sqlalchemy.orm.MapperEvents.after_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.after_configured()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.MapperEvents.before_delete">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.MapperEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.MapperEvents.</span></code></a><span class="sig-name descname"><span class="pre">before_delete</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mapper</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><span class="pre">Mapper</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><span class="pre">Connection</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.MapperEvents.before_delete" title="Link to this definition">¶</a></dt>
<dd><p>Receive an object instance before a DELETE statement
is emitted corresponding to that instance.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s1">&#39;before_delete&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_before_delete</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;before_delete&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>this event <strong>only</strong> applies to the
<a class="reference internal" href="session_basics.html#session-flushing"><span class="std std-ref">session flush operation</span></a>
and does <strong>not</strong> apply to the ORM DML operations described at
<a class="reference internal" href="queryguide/dml.html#orm-expression-update-delete"><span class="std std-ref">启用 ORM 的 INSERT、UPDATE 和 DELETE 语句</span></a>.  To intercept ORM
DML events, use <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a>.</p>
</div>
<p>This event is used to emit additional SQL statements on
the given connection as well as to perform application
specific bookkeeping related to a deletion event.</p>
<p>The event is often called for a batch of objects of the
same class before their DELETE statements are emitted at
once in a later step.</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>Mapper-level flush events only allow <strong>very limited operations</strong>,
on attributes local to the row being operated upon only,
as well as allowing any SQL to be emitted on the given
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>.  <strong>Please read fully</strong> the notes
at <a class="reference internal" href="session_events.html#session-persistence-mapper"><span class="std std-ref">映射器级刷新事件</span></a> for guidelines on using
these methods; generally, the <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_flush" title="sqlalchemy.orm.SessionEvents.before_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.before_flush()</span></code></a>
method should be preferred for general on-flush changes.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.before_delete.params.mapper"></span><strong>mapper</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.before_delete.params.mapper">¶</a> – the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> which is the target
of this event.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.before_delete.params.connection"></span><strong>connection</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.before_delete.params.connection">¶</a> – the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> being used to
emit DELETE statements for this instance.  This
provides a handle into the current transaction on the
target database specific to this instance.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.before_delete.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.before_delete.params.target">¶</a> – the mapped instance being deleted.  If
the event is configured with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
instead be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> state-management
object associated with the instance.</p></li>
</ul>
</dd>
<dt class="field-even">返回<span class="colon">:</span></dt>
<dd class="field-even"><p>No return value is supported by this event.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="session_events.html#session-persistence-events"><span class="std std-ref">持久性事件</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.MapperEvents.before_insert">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.MapperEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.MapperEvents.</span></code></a><span class="sig-name descname"><span class="pre">before_insert</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mapper</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><span class="pre">Mapper</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><span class="pre">Connection</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.MapperEvents.before_insert" title="Link to this definition">¶</a></dt>
<dd><p>Receive an object instance before an INSERT statement
is emitted corresponding to that instance.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s1">&#39;before_insert&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_before_insert</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;before_insert&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>this event <strong>only</strong> applies to the
<a class="reference internal" href="session_basics.html#session-flushing"><span class="std std-ref">session flush operation</span></a>
and does <strong>not</strong> apply to the ORM DML operations described at
<a class="reference internal" href="queryguide/dml.html#orm-expression-update-delete"><span class="std std-ref">启用 ORM 的 INSERT、UPDATE 和 DELETE 语句</span></a>.  To intercept ORM
DML events, use <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a>.</p>
</div>
<p>This event is used to modify local, non-object related
attributes on the instance before an INSERT occurs, as well
as to emit additional SQL statements on the given
connection.</p>
<p>The event is often called for a batch of objects of the
same class before their INSERT statements are emitted at
once in a later step. In the extremely rare case that
this is not desirable, the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> object can be
configured with <code class="docutils literal notranslate"><span class="pre">batch=False</span></code>, which will cause
batches of instances to be broken up into individual
(and more poorly performing) event-&gt;persist-&gt;event
steps.</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>Mapper-level flush events only allow <strong>very limited operations</strong>,
on attributes local to the row being operated upon only,
as well as allowing any SQL to be emitted on the given
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>.  <strong>Please read fully</strong> the notes
at <a class="reference internal" href="session_events.html#session-persistence-mapper"><span class="std std-ref">映射器级刷新事件</span></a> for guidelines on using
these methods; generally, the <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_flush" title="sqlalchemy.orm.SessionEvents.before_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.before_flush()</span></code></a>
method should be preferred for general on-flush changes.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.before_insert.params.mapper"></span><strong>mapper</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.before_insert.params.mapper">¶</a> – the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> which is the target
of this event.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.before_insert.params.connection"></span><strong>connection</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.before_insert.params.connection">¶</a> – the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> being used to
emit INSERT statements for this instance.  This
provides a handle into the current transaction on the
target database specific to this instance.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.before_insert.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.before_insert.params.target">¶</a> – the mapped instance being persisted.  If
the event is configured with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
instead be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> state-management
object associated with the instance.</p></li>
</ul>
</dd>
<dt class="field-even">返回<span class="colon">:</span></dt>
<dd class="field-even"><p>No return value is supported by this event.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="session_events.html#session-persistence-events"><span class="std std-ref">持久性事件</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.MapperEvents.before_mapper_configured">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.MapperEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.MapperEvents.</span></code></a><span class="sig-name descname"><span class="pre">before_mapper_configured</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mapper</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><span class="pre">Mapper</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">class_</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.MapperEvents.before_mapper_configured" title="Link to this definition">¶</a></dt>
<dd><p>Called right before a specific mapper is to be configured.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s1">&#39;before_mapper_configured&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_before_mapper_configured</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">class_</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;before_mapper_configured&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This event is intended to allow a specific mapper to be skipped during
the configure step, by returning the <code class="xref py py-attr docutils literal notranslate"><span class="pre">interfaces.EXT_SKIP</span></code>
symbol which indicates to the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.configure_mappers" title="sqlalchemy.orm.configure_mappers"><code class="xref py py-func docutils literal notranslate"><span class="pre">configure_mappers()</span></code></a> call that this
particular mapper (or hierarchy of mappers, if <code class="docutils literal notranslate"><span class="pre">propagate=True</span></code> is
used) should be skipped in the current configuration run. When one or
more mappers are skipped, the “new mappers” flag will remain set,
meaning the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.configure_mappers" title="sqlalchemy.orm.configure_mappers"><code class="xref py py-func docutils literal notranslate"><span class="pre">configure_mappers()</span></code></a> function will continue to be
called when mappers are used, to continue to try to configure all
available mappers.</p>
<p>In comparison to the other configure-level events,
<a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_configured" title="sqlalchemy.orm.MapperEvents.before_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_configured()</span></code></a>,
<a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_configured" title="sqlalchemy.orm.MapperEvents.after_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.after_configured()</span></code></a>, and
<a class="reference internal" href="#sqlalchemy.orm.MapperEvents.mapper_configured" title="sqlalchemy.orm.MapperEvents.mapper_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.mapper_configured()</span></code></a>, the
<a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_mapper_configured" title="sqlalchemy.orm.MapperEvents.before_mapper_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_mapper_configured()</span></code></a> event provides for a
meaningful return value when it is registered with the <code class="docutils literal notranslate"><span class="pre">retval=True</span></code>
parameter.</p>
<p>e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">EXT_SKIP</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="n">DontConfigureBase</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span>
    <span class="n">DontConfigureBase</span><span class="p">,</span>
    <span class="s2">&quot;before_mapper_configured&quot;</span><span class="p">,</span>
    <span class="n">retval</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">propagate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">dont_configure</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">EXT_SKIP</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_configured" title="sqlalchemy.orm.MapperEvents.before_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_configured()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_configured" title="sqlalchemy.orm.MapperEvents.after_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.after_configured()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.mapper_configured" title="sqlalchemy.orm.MapperEvents.mapper_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.mapper_configured()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.MapperEvents.before_update">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.MapperEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.MapperEvents.</span></code></a><span class="sig-name descname"><span class="pre">before_update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mapper</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><span class="pre">Mapper</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><span class="pre">Connection</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.MapperEvents.before_update" title="Link to this definition">¶</a></dt>
<dd><p>Receive an object instance before an UPDATE statement
is emitted corresponding to that instance.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s1">&#39;before_update&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_before_update</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;before_update&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>this event <strong>only</strong> applies to the
<a class="reference internal" href="session_basics.html#session-flushing"><span class="std std-ref">session flush operation</span></a>
and does <strong>not</strong> apply to the ORM DML operations described at
<a class="reference internal" href="queryguide/dml.html#orm-expression-update-delete"><span class="std std-ref">启用 ORM 的 INSERT、UPDATE 和 DELETE 语句</span></a>.  To intercept ORM
DML events, use <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a>.</p>
</div>
<p>This event is used to modify local, non-object related
attributes on the instance before an UPDATE occurs, as well
as to emit additional SQL statements on the given
connection.</p>
<p>This method is called for all instances that are
marked as “dirty”, <em>even those which have no net changes
to their column-based attributes</em>. An object is marked
as dirty when any of its column-based attributes have a
“set attribute” operation called or when any of its
collections are modified. If, at update time, no
column-based attributes have any net changes, no UPDATE
statement will be issued. This means that an instance
being sent to <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_update" title="sqlalchemy.orm.MapperEvents.before_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_update()</span></code></a> is
<em>not</em> a guarantee that an UPDATE statement will be
issued, although you can affect the outcome here by
modifying attributes so that a net change in value does
exist.</p>
<p>To detect if the column-based attributes on the object have net
changes, and will therefore generate an UPDATE statement, use
<code class="docutils literal notranslate"><span class="pre">object_session(instance).is_modified(instance,</span>
<span class="pre">include_collections=False)</span></code>.</p>
<p>The event is often called for a batch of objects of the
same class before their UPDATE statements are emitted at
once in a later step. In the extremely rare case that
this is not desirable, the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> can be
configured with <code class="docutils literal notranslate"><span class="pre">batch=False</span></code>, which will cause
batches of instances to be broken up into individual
(and more poorly performing) event-&gt;persist-&gt;event
steps.</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>Mapper-level flush events only allow <strong>very limited operations</strong>,
on attributes local to the row being operated upon only,
as well as allowing any SQL to be emitted on the given
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>.  <strong>Please read fully</strong> the notes
at <a class="reference internal" href="session_events.html#session-persistence-mapper"><span class="std std-ref">映射器级刷新事件</span></a> for guidelines on using
these methods; generally, the <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_flush" title="sqlalchemy.orm.SessionEvents.before_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.before_flush()</span></code></a>
method should be preferred for general on-flush changes.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.before_update.params.mapper"></span><strong>mapper</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.before_update.params.mapper">¶</a> – the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> which is the target
of this event.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.before_update.params.connection"></span><strong>connection</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.before_update.params.connection">¶</a> – the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> being used to
emit UPDATE statements for this instance.  This
provides a handle into the current transaction on the
target database specific to this instance.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.before_update.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.before_update.params.target">¶</a> – the mapped instance being persisted.  If
the event is configured with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
instead be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> state-management
object associated with the instance.</p></li>
</ul>
</dd>
<dt class="field-even">返回<span class="colon">:</span></dt>
<dd class="field-even"><p>No return value is supported by this event.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="session_events.html#session-persistence-events"><span class="std std-ref">持久性事件</span></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.MapperEvents.dispatch">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.MapperEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.MapperEvents.</span></code></a><span class="sig-name descname"><span class="pre">dispatch</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">_Dispatch</span><span class="p"><span class="pre">[</span></span><span class="pre">_ET</span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">&lt;sqlalchemy.event.base.MapperEventsDispatch</span> <span class="pre">object&gt;</span></em><a class="headerlink" href="#sqlalchemy.orm.MapperEvents.dispatch" title="Link to this definition">¶</a></dt>
<dd><p>reference back to the _Dispatch class.</p>
<p>Bidirectional against _Dispatch._events</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.MapperEvents.instrument_class">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.MapperEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.MapperEvents.</span></code></a><span class="sig-name descname"><span class="pre">instrument_class</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mapper</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><span class="pre">Mapper</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">class_</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.MapperEvents.instrument_class" title="Link to this definition">¶</a></dt>
<dd><p>Receive a class when the mapper is first constructed,
before instrumentation is applied to the mapped class.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s1">&#39;instrument_class&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_instrument_class</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">class_</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;instrument_class&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This event is the earliest phase of mapper construction.
Most attributes of the mapper are not yet initialized.   To
receive an event within initial mapper construction where basic
state is available such as the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper.attrs" title="sqlalchemy.orm.Mapper.attrs"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Mapper.attrs</span></code></a> collection,
the <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_mapper_constructed" title="sqlalchemy.orm.MapperEvents.after_mapper_constructed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.after_mapper_constructed()</span></code></a> event may
be a better choice.</p>
<p>This listener can either be applied to the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a>
class overall, or to any un-mapped class which serves as a base
for classes that will be mapped (using the <code class="docutils literal notranslate"><span class="pre">propagate=True</span></code> flag):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">Base</span><span class="p">,</span> <span class="s2">&quot;instrument_class&quot;</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">on_new_class</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">cls_</span><span class="p">):</span>
    <span class="s2">&quot;...&quot;</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.instrument_class.params.mapper"></span><strong>mapper</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.instrument_class.params.mapper">¶</a> – the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> which is the target
of this event.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.instrument_class.params.class_"></span><strong>class_</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.instrument_class.params.class_">¶</a> – the mapped class.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_mapper_constructed" title="sqlalchemy.orm.MapperEvents.after_mapper_constructed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.after_mapper_constructed()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.MapperEvents.mapper_configured">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.MapperEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.MapperEvents.</span></code></a><span class="sig-name descname"><span class="pre">mapper_configured</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mapper</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><span class="pre">Mapper</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">class_</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.MapperEvents.mapper_configured" title="Link to this definition">¶</a></dt>
<dd><p>Called when a specific mapper has completed its own configuration
within the scope of the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.configure_mappers" title="sqlalchemy.orm.configure_mappers"><code class="xref py py-func docutils literal notranslate"><span class="pre">configure_mappers()</span></code></a> call.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s1">&#39;mapper_configured&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_mapper_configured</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">class_</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;mapper_configured&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>The <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.mapper_configured" title="sqlalchemy.orm.MapperEvents.mapper_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.mapper_configured()</span></code></a> event is invoked
for each mapper that is encountered when the
<a class="reference internal" href="mapping_api.html#sqlalchemy.orm.configure_mappers" title="sqlalchemy.orm.configure_mappers"><code class="xref py py-func docutils literal notranslate"><span class="pre">configure_mappers()</span></code></a> function proceeds through the current
list of not-yet-configured mappers.
<a class="reference internal" href="mapping_api.html#sqlalchemy.orm.configure_mappers" title="sqlalchemy.orm.configure_mappers"><code class="xref py py-func docutils literal notranslate"><span class="pre">configure_mappers()</span></code></a> is typically invoked
automatically as mappings are first used, as well as each time
new mappers have been made available and new mapper use is
detected.</p>
<p>When the event is called, the mapper should be in its final
state, but <strong>not including backrefs</strong> that may be invoked from
other mappers; they might still be pending within the
configuration operation.    Bidirectional relationships that
are instead configured via the
<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.back_populates" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.back_populates</span></code></a> argument
<em>will</em> be fully available, since this style of relationship does not
rely upon other possibly-not-configured mappers to know that they
exist.</p>
<p>For an event that is guaranteed to have <strong>all</strong> mappers ready
to go including backrefs that are defined only on other
mappings, use the <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_configured" title="sqlalchemy.orm.MapperEvents.after_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.after_configured()</span></code></a>
event; this event invokes only after all known mappings have been
fully configured.</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.MapperEvents.mapper_configured" title="sqlalchemy.orm.MapperEvents.mapper_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.mapper_configured()</span></code></a> event, unlike
<a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_configured" title="sqlalchemy.orm.MapperEvents.before_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_configured()</span></code></a> or
<a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_configured" title="sqlalchemy.orm.MapperEvents.after_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.after_configured()</span></code></a>,
is called for each mapper/class individually, and the mapper is
passed to the event itself.  It also is called exactly once for
a particular mapper.  The event is therefore useful for
configurational steps that benefit from being invoked just once
on a specific mapper basis, which don’t require that “backref”
configurations are necessarily ready yet.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.mapper_configured.params.mapper"></span><strong>mapper</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.mapper_configured.params.mapper">¶</a> – the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> which is the target
of this event.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.MapperEvents.mapper_configured.params.class_"></span><strong>class_</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.MapperEvents.mapper_configured.params.class_">¶</a> – the mapped class.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_configured" title="sqlalchemy.orm.MapperEvents.before_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_configured()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_configured" title="sqlalchemy.orm.MapperEvents.after_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.after_configured()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_mapper_configured" title="sqlalchemy.orm.MapperEvents.before_mapper_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.before_mapper_configured()</span></code></a></p>
</div>
</dd></dl>

</dd></dl>

</section>
<section id="id3">
<h2>实例事件<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<p>Instance Events</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--3-input--1" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--1">中文</label><div class="tab-content docutils container">
<p>实例事件专注于 ORM 映射实例的构造，包括当它们被实例化为 <a class="reference internal" href="../glossary.html#term-transient"><span class="xref std std-term">transient</span></a> 对象时，当它们从数据库加载并成为 <a class="reference internal" href="../glossary.html#term-persistent"><span class="xref std std-term">persistent</span></a> 对象时，以及当数据库刷新或过期操作发生在对象上时。</p>
</div>
<input class="tab-input" id="tab-set--3-input--2" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--2">英文</label><div class="tab-content docutils container">
<p>Instance events are focused on the construction of ORM mapped instances,
including when they are instantiated as <a class="reference internal" href="../glossary.html#term-transient"><span class="xref std std-term">transient</span></a> objects,
when they are loaded from the database and become <a class="reference internal" href="../glossary.html#term-persistent"><span class="xref std std-term">persistent</span></a> objects,
as well as when database refresh or expiration operations occur on the object.</p>
</div>
</div>
<div class="table-wrapper longtable docutils container">
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents"><span class="sig-name descname">InstanceEvents</span></a></p></td>
<td><p>Define events specific to object lifecycle.</p></td>
</tr>
</tbody>
</table>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.orm.InstanceEvents">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">InstanceEvents</span></span><a class="headerlink" href="#sqlalchemy.orm.InstanceEvents" title="Link to this definition">¶</a></dt>
<dd><p>Define events specific to object lifecycle.</p>
<p>e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="k">def</span><span class="w"> </span><span class="nf">my_load_listener</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">print</span><span class="p">(</span><span class="s2">&quot;on load!&quot;</span><span class="p">)</span>


<span class="n">event</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="n">my_load_listener</span><span class="p">)</span></pre></div>
</div>
<p>Available targets include:</p>
<ul class="simple">
<li><p>mapped classes</p></li>
<li><p>unmapped superclasses of mapped or to-be-mapped classes
(using the <code class="docutils literal notranslate"><span class="pre">propagate=True</span></code> flag)</p></li>
<li><p><a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> objects</p></li>
<li><p>the <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> class itself indicates listening for all
mappers.</p></li>
</ul>
<p>Instance events are closely related to mapper events, but
are more specific to the instance and its instrumentation,
rather than its system of persistence.</p>
<p>When using <a class="reference internal" href="#sqlalchemy.orm.InstanceEvents" title="sqlalchemy.orm.InstanceEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceEvents</span></code></a>, several modifiers are
available to the <a class="reference internal" href="../core/event.html#sqlalchemy.event.listen" title="sqlalchemy.event.listen"><code class="xref py py-func docutils literal notranslate"><span class="pre">listen()</span></code></a> function.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.params.propagate"></span><strong>propagate=False</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.params.propagate">¶</a> – When True, the event listener should
be applied to all inheriting classes as well as the
class which is the target of this listener.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.params.raw"></span><strong>raw=False</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.params.raw">¶</a> – When True, the “target” argument passed
to applicable event listener functions will be the
instance’s <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> management
object, rather than the mapped instance itself.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.params.restore_load_context"></span><strong>restore_load_context=False</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.params.restore_load_context">¶</a> – Applies to the
<a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.load" title="sqlalchemy.orm.InstanceEvents.load"><code class="xref py py-meth docutils literal notranslate"><span class="pre">InstanceEvents.load()</span></code></a> and <a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.refresh" title="sqlalchemy.orm.InstanceEvents.refresh"><code class="xref py py-meth docutils literal notranslate"><span class="pre">InstanceEvents.refresh()</span></code></a>
events.  Restores the loader context of the object when the event
hook is complete, so that ongoing eager load operations continue
to target the object appropriately.  A warning is emitted if the
object is moved to a new loader context from within one of these
events if this flag is not set.</p></li>
</ul>
</dd>
</dl>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.dispatch"><span class="sig-name descname">dispatch</span></a>, <a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.expire"><span class="sig-name descname">expire()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.init"><span class="sig-name descname">init()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.init_failure"><span class="sig-name descname">init_failure()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.load"><span class="sig-name descname">load()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.pickle"><span class="sig-name descname">pickle()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.refresh"><span class="sig-name descname">refresh()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.refresh_flush"><span class="sig-name descname">refresh_flush()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.unpickle"><span class="sig-name descname">unpickle()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.orm.InstanceEvents" title="sqlalchemy.orm.InstanceEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.InstanceEvents</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.event.Events</span></code>)</p>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.InstanceEvents.dispatch">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.InstanceEvents.</span></code></a><span class="sig-name descname"><span class="pre">dispatch</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">_Dispatch</span><span class="p"><span class="pre">[</span></span><span class="pre">_ET</span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">&lt;sqlalchemy.event.base.InstanceEventsDispatch</span> <span class="pre">object&gt;</span></em><a class="headerlink" href="#sqlalchemy.orm.InstanceEvents.dispatch" title="Link to this definition">¶</a></dt>
<dd><p>reference back to the _Dispatch class.</p>
<p>Bidirectional against _Dispatch._events</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.InstanceEvents.expire">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.InstanceEvents.</span></code></a><span class="sig-name descname"><span class="pre">expire</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attrs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.InstanceEvents.expire" title="Link to this definition">¶</a></dt>
<dd><p>Receive an object instance after its attributes or some subset
have been expired.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s1">&#39;expire&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_expire</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;expire&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>‘keys’ is a list of attribute names.  If None, the entire
state was expired.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.expire.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.expire.params.target">¶</a> – the mapped instance.  If
the event is configured with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
instead be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> state-management
object associated with the instance.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.expire.params.attrs"></span><strong>attrs</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.expire.params.attrs">¶</a> – sequence of attribute
names which were expired, or None if all attributes were
expired.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.InstanceEvents.init">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.InstanceEvents.</span></code></a><span class="sig-name descname"><span class="pre">init</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.InstanceEvents.init" title="Link to this definition">¶</a></dt>
<dd><p>Receive an instance when its constructor is called.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s1">&#39;init&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_init</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;init&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This method is only called during a userland construction of
an object, in conjunction with the object’s constructor, e.g.
its <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method.  It is not called when an object is
loaded from the database; see the <a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.load" title="sqlalchemy.orm.InstanceEvents.load"><code class="xref py py-meth docutils literal notranslate"><span class="pre">InstanceEvents.load()</span></code></a>
event in order to intercept a database load.</p>
<p>The event is called before the actual <code class="docutils literal notranslate"><span class="pre">__init__</span></code> constructor
of the object is called.  The <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> dictionary may be
modified in-place in order to affect what is passed to
<code class="docutils literal notranslate"><span class="pre">__init__</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.init.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.init.params.target">¶</a> – the mapped instance.  If
the event is configured with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
instead be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> state-management
object associated with the instance.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.init.params.args"></span><strong>args</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.init.params.args">¶</a> – positional arguments passed to the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method.
This is passed as a tuple and is currently immutable.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.init.params.kwargs"></span><strong>kwargs</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.init.params.kwargs">¶</a> – keyword arguments passed to the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method.
This structure <em>can</em> be altered in place.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.init_failure" title="sqlalchemy.orm.InstanceEvents.init_failure"><code class="xref py py-meth docutils literal notranslate"><span class="pre">InstanceEvents.init_failure()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.load" title="sqlalchemy.orm.InstanceEvents.load"><code class="xref py py-meth docutils literal notranslate"><span class="pre">InstanceEvents.load()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.InstanceEvents.init_failure">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.InstanceEvents.</span></code></a><span class="sig-name descname"><span class="pre">init_failure</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.InstanceEvents.init_failure" title="Link to this definition">¶</a></dt>
<dd><p>Receive an instance when its constructor has been called,
and raised an exception.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s1">&#39;init_failure&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_init_failure</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;init_failure&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This method is only called during a userland construction of
an object, in conjunction with the object’s constructor, e.g.
its <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method. It is not called when an object is loaded
from the database.</p>
<p>The event is invoked after an exception raised by the <code class="docutils literal notranslate"><span class="pre">__init__</span></code>
method is caught.  After the event
is invoked, the original exception is re-raised outwards, so that
the construction of the object still raises an exception.   The
actual exception and stack trace raised should be present in
<code class="docutils literal notranslate"><span class="pre">sys.exc_info()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.init_failure.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.init_failure.params.target">¶</a> – the mapped instance.  If
the event is configured with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
instead be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> state-management
object associated with the instance.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.init_failure.params.args"></span><strong>args</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.init_failure.params.args">¶</a> – positional arguments that were passed to the <code class="docutils literal notranslate"><span class="pre">__init__</span></code>
method.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.init_failure.params.kwargs"></span><strong>kwargs</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.init_failure.params.kwargs">¶</a> – keyword arguments that were passed to the <code class="docutils literal notranslate"><span class="pre">__init__</span></code>
method.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.init" title="sqlalchemy.orm.InstanceEvents.init"><code class="xref py py-meth docutils literal notranslate"><span class="pre">InstanceEvents.init()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.load" title="sqlalchemy.orm.InstanceEvents.load"><code class="xref py py-meth docutils literal notranslate"><span class="pre">InstanceEvents.load()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.InstanceEvents.load">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.InstanceEvents.</span></code></a><span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="internals.html#sqlalchemy.orm.QueryContext" title="sqlalchemy.orm.QueryContext"><span class="pre">QueryContext</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.InstanceEvents.load" title="Link to this definition">¶</a></dt>
<dd><p>Receive an object instance after it has been created via
<code class="docutils literal notranslate"><span class="pre">__new__</span></code>, and after initial attribute population has
occurred.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s1">&#39;load&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_load</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;load&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This typically occurs when the instance is created based on
incoming result rows, and is only called once for that
instance’s lifetime.</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>During a result-row load, this event is invoked when the
first row received for this instance is processed.  When using
eager loading with collection-oriented attributes, the additional
rows that are to be loaded / processed in order to load subsequent
collection items have not occurred yet.   This has the effect
both that collections will not be fully loaded, as well as that
if an operation occurs within this event handler that emits
another database load operation for the object, the “loading
context” for the object can change and interfere with the
existing eager loaders still in progress.</p>
<p>Examples of what can cause the “loading context” to change within
the event handler include, but are not necessarily limited to:</p>
<ul class="simple">
<li><p>accessing deferred attributes that weren’t part of the row,
will trigger an “undefer” operation and refresh the object</p></li>
<li><p>accessing attributes on a joined-inheritance subclass that
weren’t part of the row, will trigger a refresh operation.</p></li>
</ul>
<p>As of SQLAlchemy 1.3.14, a warning is emitted when this occurs. The
<a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.params.restore_load_context" title="sqlalchemy.orm.InstanceEvents"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">InstanceEvents.restore_load_context</span></code></a> option may  be
used on the event to prevent this warning; this will ensure that
the existing loading context is maintained for the object after the
event is called:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="n">restore_load_context</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">on_load</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">some_unloaded_attribute</span></pre></div>
</div>
</div>
<p>The <a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.load" title="sqlalchemy.orm.InstanceEvents.load"><code class="xref py py-meth docutils literal notranslate"><span class="pre">InstanceEvents.load()</span></code></a> event is also available in a
class-method decorator format called <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.reconstructor" title="sqlalchemy.orm.reconstructor"><code class="xref py py-func docutils literal notranslate"><span class="pre">reconstructor()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.load.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.load.params.target">¶</a> – the mapped instance.  If
the event is configured with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
instead be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> state-management
object associated with the instance.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.load.params.context"></span><strong>context</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.load.params.context">¶</a> – the <a class="reference internal" href="internals.html#sqlalchemy.orm.QueryContext" title="sqlalchemy.orm.QueryContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueryContext</span></code></a> corresponding to the
current <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> in progress.  This argument may be
<code class="docutils literal notranslate"><span class="pre">None</span></code> if the load does not correspond to a <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a>,
such as during <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session.merge" title="sqlalchemy.orm.Session.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.merge()</span></code></a>.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="mapping_styles.html#mapped-class-load-events"><span class="std std-ref">在加载过程中维护非映射状态</span></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.init" title="sqlalchemy.orm.InstanceEvents.init"><code class="xref py py-meth docutils literal notranslate"><span class="pre">InstanceEvents.init()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.refresh" title="sqlalchemy.orm.InstanceEvents.refresh"><code class="xref py py-meth docutils literal notranslate"><span class="pre">InstanceEvents.refresh()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.loaded_as_persistent" title="sqlalchemy.orm.SessionEvents.loaded_as_persistent"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.loaded_as_persistent()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.InstanceEvents.pickle">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.InstanceEvents.</span></code></a><span class="sig-name descname"><span class="pre">pickle</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_InstanceDict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.InstanceEvents.pickle" title="Link to this definition">¶</a></dt>
<dd><p>Receive an object instance when its associated state is
being pickled.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s1">&#39;pickle&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_pickle</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">state_dict</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;pickle&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.pickle.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.pickle.params.target">¶</a> – the mapped instance.  If
the event is configured with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
instead be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> state-management
object associated with the instance.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.pickle.params.state_dict"></span><strong>state_dict</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.pickle.params.state_dict">¶</a> – the dictionary returned by
<code class="xref py py-class docutils literal notranslate"><span class="pre">__getstate__</span></code>, containing the state
to be pickled.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.InstanceEvents.refresh">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.InstanceEvents.</span></code></a><span class="sig-name descname"><span class="pre">refresh</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="internals.html#sqlalchemy.orm.QueryContext" title="sqlalchemy.orm.QueryContext"><span class="pre">QueryContext</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">attrs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.InstanceEvents.refresh" title="Link to this definition">¶</a></dt>
<dd><p>Receive an object instance after one or more attributes have
been refreshed from a query.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s1">&#39;refresh&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_refresh</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;refresh&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>Contrast this to the <a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.load" title="sqlalchemy.orm.InstanceEvents.load"><code class="xref py py-meth docutils literal notranslate"><span class="pre">InstanceEvents.load()</span></code></a> method, which
is invoked when the object is first loaded from a query.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>This event is invoked within the loader process before
eager loaders may have been completed, and the object’s state may
not be complete.  Additionally, invoking row-level refresh
operations on the object will place the object into a new loader
context, interfering with the existing load context.   See the note
on <a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.load" title="sqlalchemy.orm.InstanceEvents.load"><code class="xref py py-meth docutils literal notranslate"><span class="pre">InstanceEvents.load()</span></code></a> for background on making use of the
<a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.params.restore_load_context" title="sqlalchemy.orm.InstanceEvents"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">InstanceEvents.restore_load_context</span></code></a> parameter, in
order to resolve this scenario.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.refresh.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.refresh.params.target">¶</a> – the mapped instance.  If
the event is configured with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
instead be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> state-management
object associated with the instance.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.refresh.params.context"></span><strong>context</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.refresh.params.context">¶</a> – the <a class="reference internal" href="internals.html#sqlalchemy.orm.QueryContext" title="sqlalchemy.orm.QueryContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueryContext</span></code></a> corresponding to the
current <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> in progress.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.refresh.params.attrs"></span><strong>attrs</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.refresh.params.attrs">¶</a> – sequence of attribute names which
were populated, or None if all column-mapped, non-deferred
attributes were populated.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="mapping_styles.html#mapped-class-load-events"><span class="std std-ref">在加载过程中维护非映射状态</span></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.load" title="sqlalchemy.orm.InstanceEvents.load"><code class="xref py py-meth docutils literal notranslate"><span class="pre">InstanceEvents.load()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.InstanceEvents.refresh_flush">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.InstanceEvents.</span></code></a><span class="sig-name descname"><span class="pre">refresh_flush</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flush_context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="internals.html#sqlalchemy.orm.UOWTransaction" title="sqlalchemy.orm.UOWTransaction"><span class="pre">UOWTransaction</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">attrs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.InstanceEvents.refresh_flush" title="Link to this definition">¶</a></dt>
<dd><p>Receive an object instance after one or more attributes that
contain a column-level default or onupdate handler have been refreshed
during persistence of the object’s state.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s1">&#39;refresh_flush&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_refresh_flush</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">flush_context</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;refresh_flush&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This event is the same as <a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.refresh" title="sqlalchemy.orm.InstanceEvents.refresh"><code class="xref py py-meth docutils literal notranslate"><span class="pre">InstanceEvents.refresh()</span></code></a> except
it is invoked within the unit of work flush process, and includes
only non-primary-key columns that have column level default or
onupdate handlers, including Python callables as well as server side
defaults and triggers which may be fetched via the RETURNING clause.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>While the <a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.refresh_flush" title="sqlalchemy.orm.InstanceEvents.refresh_flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">InstanceEvents.refresh_flush()</span></code></a> event is triggered
for an object that was INSERTed as well as for an object that was
UPDATEd, the event is geared primarily  towards the UPDATE process;
it is mostly an internal artifact that INSERT actions can also
trigger this event, and note that <strong>primary key columns for an
INSERTed row are explicitly omitted</strong> from this event.  In order to
intercept the newly INSERTed state of an object, the
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.pending_to_persistent" title="sqlalchemy.orm.SessionEvents.pending_to_persistent"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.pending_to_persistent()</span></code></a> and
<a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_insert" title="sqlalchemy.orm.MapperEvents.after_insert"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MapperEvents.after_insert()</span></code></a> are better choices.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.refresh_flush.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.refresh_flush.params.target">¶</a> – the mapped instance.  If
the event is configured with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
instead be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> state-management
object associated with the instance.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.refresh_flush.params.flush_context"></span><strong>flush_context</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.refresh_flush.params.flush_context">¶</a> – Internal <a class="reference internal" href="internals.html#sqlalchemy.orm.UOWTransaction" title="sqlalchemy.orm.UOWTransaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">UOWTransaction</span></code></a> object
which handles the details of the flush.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.refresh_flush.params.attrs"></span><strong>attrs</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.refresh_flush.params.attrs">¶</a> – sequence of attribute names which
were populated.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="mapping_styles.html#mapped-class-load-events"><span class="std std-ref">在加载过程中维护非映射状态</span></a></p>
<p><a class="reference internal" href="persistence_techniques.html#orm-server-defaults"><span class="std std-ref">获取服务器生成的默认值</span></a></p>
<p><a class="reference internal" href="../core/defaults.html#metadata-defaults-toplevel"><span class="std std-ref">列 INSERT/UPDATE 默认值</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.InstanceEvents.unpickle">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.InstanceEvents.</span></code></a><span class="sig-name descname"><span class="pre">unpickle</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_InstanceDict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.InstanceEvents.unpickle" title="Link to this definition">¶</a></dt>
<dd><p>Receive an object instance after its associated state has
been unpickled.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="s1">&#39;unpickle&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_unpickle</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">state_dict</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;unpickle&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.unpickle.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.unpickle.params.target">¶</a> – the mapped instance.  If
the event is configured with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
instead be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> state-management
object associated with the instance.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.InstanceEvents.unpickle.params.state_dict"></span><strong>state_dict</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.InstanceEvents.unpickle.params.state_dict">¶</a> – the dictionary sent to
<code class="xref py py-class docutils literal notranslate"><span class="pre">__setstate__</span></code>, containing the state
dictionary which was pickled.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="orm-attribute-events">
<span id="id4"></span><h2>属性事件<a class="headerlink" href="#orm-attribute-events" title="Link to this heading">¶</a></h2>
<p>Attribute Events</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--4-input--1" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--1">中文</label><div class="tab-content docutils container">
<p>属性事件在 ORM 映射对象的各个属性上发生变化时触发。这些事件构成了诸如 <a class="reference internal" href="mapped_attributes.html#simple-validators"><span class="std std-ref">自定义验证函数</span></a> 以及 <a class="reference internal" href="backref.html#relationships-backref"><span class="std std-ref">反向引用处理程序</span></a> 等功能的基础。</p>
</div>
<input class="tab-input" id="tab-set--4-input--2" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--2">英文</label><div class="tab-content docutils container">
<p>Attribute events are triggered as things occur on individual attributes of
ORM mapped objects.  These events form the basis for things like
<a class="reference internal" href="mapped_attributes.html#simple-validators"><span class="std std-ref">custom validation functions</span></a> as well as
<a class="reference internal" href="backref.html#relationships-backref"><span class="std std-ref">backref handlers</span></a>.</p>
</div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="mapped_attributes.html#mapping-attributes-toplevel"><span class="std std-ref">更改Attribute的行为</span></a></p>
</div>
<div class="table-wrapper longtable docutils container">
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents"><span class="sig-name descname">AttributeEvents</span></a></p></td>
<td><p>Define events for object attributes.</p></td>
</tr>
</tbody>
</table>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.orm.AttributeEvents">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">AttributeEvents</span></span><a class="headerlink" href="#sqlalchemy.orm.AttributeEvents" title="Link to this definition">¶</a></dt>
<dd><p>Define events for object attributes.</p>
<p>These are typically defined on the class-bound descriptor for the
target class.</p>
<p>For example, to register a listener that will receive the
<a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.append" title="sqlalchemy.orm.AttributeEvents.append"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AttributeEvents.append()</span></code></a> event:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">MyClass</span><span class="o">.</span><span class="n">collection</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_append_listener</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">initiator</span><span class="p">):</span>
    <span class="n">print</span><span class="p">(</span><span class="s2">&quot;received append event for target: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target</span><span class="p">)</span></pre></div>
</div>
<p>Listeners have the option to return a possibly modified version of the
value, when the <a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.params.retval" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">AttributeEvents.retval</span></code></a> flag is passed to
<a class="reference internal" href="../core/event.html#sqlalchemy.event.listen" title="sqlalchemy.event.listen"><code class="xref py py-func docutils literal notranslate"><span class="pre">listen()</span></code></a> or <a class="reference internal" href="../core/event.html#sqlalchemy.event.listens_for" title="sqlalchemy.event.listens_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">listens_for()</span></code></a>, such as below,
illustrated using the <a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.set" title="sqlalchemy.orm.AttributeEvents.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AttributeEvents.set()</span></code></a> event:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">validate_phone</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">oldvalue</span><span class="p">,</span> <span class="n">initiator</span><span class="p">):</span>
    <span class="s2">&quot;Strip non-numeric characters from a phone number&quot;</span>

    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\D&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<span class="c1"># setup listener on UserContact.phone attribute, instructing</span>
<span class="c1"># it to use the return value</span>
<span class="n">listen</span><span class="p">(</span><span class="n">UserContact</span><span class="o">.</span><span class="n">phone</span><span class="p">,</span> <span class="s2">&quot;set&quot;</span><span class="p">,</span> <span class="n">validate_phone</span><span class="p">,</span> <span class="n">retval</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></pre></div>
</div>
<p>A validation function like the above can also raise an exception
such as <code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code> to halt the operation.</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.params.propagate" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">AttributeEvents.propagate</span></code></a> flag is also important when
applying listeners to mapped classes that also have mapped subclasses,
as when using mapper inheritance patterns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">MySuperClass</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="s2">&quot;set&quot;</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_set</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">initiator</span><span class="p">):</span>
    <span class="n">print</span><span class="p">(</span><span class="s2">&quot;value set: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target</span><span class="p">)</span></pre></div>
</div>
<p>The full list of modifiers available to the <a class="reference internal" href="../core/event.html#sqlalchemy.event.listen" title="sqlalchemy.event.listen"><code class="xref py py-func docutils literal notranslate"><span class="pre">listen()</span></code></a>
and <a class="reference internal" href="../core/event.html#sqlalchemy.event.listens_for" title="sqlalchemy.event.listens_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">listens_for()</span></code></a> functions are below.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.params.active_history"></span><strong>active_history=False</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.params.active_history">¶</a> – When True, indicates that the
“set” event would like to receive the “old” value being
replaced unconditionally, even if this requires firing off
database loads. Note that <code class="docutils literal notranslate"><span class="pre">active_history</span></code> can also be
set directly via <a class="reference internal" href="mapping_api.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_property()</span></code></a> and
<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.params.propagate"></span><strong>propagate=False</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.params.propagate">¶</a> – When True, the listener function will
be established not just for the class attribute given, but
for attributes of the same name on all current subclasses
of that class, as well as all future subclasses of that
class, using an additional listener that listens for
instrumentation events.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.params.raw"></span><strong>raw=False</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.params.raw">¶</a> – When True, the “target” argument to the
event will be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> management
object, rather than the mapped instance itself.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.params.retval"></span><strong>retval=False</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.params.retval">¶</a> – when True, the user-defined event
listening must return the “value” argument from the
function.  This gives the listening function the opportunity
to change the value that is ultimately used for a “set”
or “append” event.</p></li>
</ul>
</dd>
</dl>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.append"><span class="sig-name descname">append()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.append_wo_mutation"><span class="sig-name descname">append_wo_mutation()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.bulk_replace"><span class="sig-name descname">bulk_replace()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.dispatch"><span class="sig-name descname">dispatch</span></a>, <a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.dispose_collection"><span class="sig-name descname">dispose_collection()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.init_collection"><span class="sig-name descname">init_collection()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.init_scalar"><span class="sig-name descname">init_scalar()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.modified"><span class="sig-name descname">modified()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.remove"><span class="sig-name descname">remove()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.set"><span class="sig-name descname">set()</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.orm.AttributeEvents" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.AttributeEvents</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.event.Events</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.AttributeEvents.append">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.AttributeEvents.</span></code></a><span class="sig-name descname"><span class="pre">append</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_T</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initiator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Event</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">EventConstants</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">EventConstants.NO_KEY</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_T</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.AttributeEvents.append" title="Link to this definition">¶</a></dt>
<dd><p>Receive a collection append event.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="o">.</span><span class="n">some_attribute</span><span class="p">,</span> <span class="s1">&#39;append&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_append</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">initiator</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;append&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>The append event is invoked for each element as it is appended
to the collection.  This occurs for single-item appends as well
as for a “bulk replace” operation.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.append.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.append.params.target">¶</a> – the object instance receiving the event.
If the listener is registered with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> object.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.append.params.value"></span><strong>value</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.append.params.value">¶</a> – the value being appended.  If this listener
is registered with <code class="docutils literal notranslate"><span class="pre">retval=True</span></code>, the listener
function must return this value, or a new value which
replaces it.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.append.params.initiator"></span><strong>initiator</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.append.params.initiator">¶</a> – An instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">Event</span></code>
representing the initiation of the event.  May be modified
from its original value by backref handlers in order to control
chained event propagation, as well as be inspected for information
about the source of the event.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.append.params.key"></span><strong>key</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.append.params.key">¶</a> – <p>When the event is established using the
<a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.params.include_key" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">AttributeEvents.include_key</span></code></a> parameter set to
True, this will be the key used in the operation, such as
<code class="docutils literal notranslate"><span class="pre">collection[some_key_or_index]</span> <span class="pre">=</span> <span class="pre">value</span></code>.
The parameter is not passed
to the event at all if the the
<a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.params.include_key" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">AttributeEvents.include_key</span></code></a>
was not used to set up the event; this is to allow backwards
compatibility with existing event handlers that don’t include the
<code class="docutils literal notranslate"><span class="pre">key</span></code> parameter.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
</p></li>
</ul>
</dd>
<dt class="field-even">返回<span class="colon">:</span></dt>
<dd class="field-even"><p>if the event was registered with <code class="docutils literal notranslate"><span class="pre">retval=True</span></code>,
the given value, or a new effective value, should be returned.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">AttributeEvents</span></code></a> - background on listener options such
as propagation to subclasses.</p>
<p><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.bulk_replace" title="sqlalchemy.orm.AttributeEvents.bulk_replace"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AttributeEvents.bulk_replace()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.AttributeEvents.append_wo_mutation">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.AttributeEvents.</span></code></a><span class="sig-name descname"><span class="pre">append_wo_mutation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_T</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initiator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Event</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">EventConstants</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">EventConstants.NO_KEY</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.AttributeEvents.append_wo_mutation" title="Link to this definition">¶</a></dt>
<dd><p>Receive a collection append event where the collection was not
actually mutated.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="o">.</span><span class="n">some_attribute</span><span class="p">,</span> <span class="s1">&#39;append_wo_mutation&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_append_wo_mutation</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">initiator</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;append_wo_mutation&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This event differs from <a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.append" title="sqlalchemy.orm.AttributeEvents.append"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AttributeEvents.append()</span></code></a> in that
it is fired off for de-duplicating collections such as sets and
dictionaries, when the object already exists in the target collection.
The event does not have a return value and the identity of the
given object cannot be changed.</p>
<p>The event is used for cascading objects into a <a class="reference internal" href="session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>
when the collection has already been mutated via a backref event.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.append_wo_mutation.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.append_wo_mutation.params.target">¶</a> – the object instance receiving the event.
If the listener is registered with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> object.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.append_wo_mutation.params.value"></span><strong>value</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.append_wo_mutation.params.value">¶</a> – the value that would be appended if the object did not
already exist in the collection.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.append_wo_mutation.params.initiator"></span><strong>initiator</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.append_wo_mutation.params.initiator">¶</a> – An instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">Event</span></code>
representing the initiation of the event.  May be modified
from its original value by backref handlers in order to control
chained event propagation, as well as be inspected for information
about the source of the event.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.append_wo_mutation.params.key"></span><strong>key</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.append_wo_mutation.params.key">¶</a> – <p>When the event is established using the
<a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.params.include_key" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">AttributeEvents.include_key</span></code></a> parameter set to
True, this will be the key used in the operation, such as
<code class="docutils literal notranslate"><span class="pre">collection[some_key_or_index]</span> <span class="pre">=</span> <span class="pre">value</span></code>.
The parameter is not passed
to the event at all if the the
<a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.params.include_key" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">AttributeEvents.include_key</span></code></a>
was not used to set up the event; this is to allow backwards
compatibility with existing event handlers that don’t include the
<code class="docutils literal notranslate"><span class="pre">key</span></code> parameter.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
</p></li>
</ul>
</dd>
<dt class="field-even">返回<span class="colon">:</span></dt>
<dd class="field-even"><p>No return value is defined for this event.</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4.15 版本加入.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.AttributeEvents.bulk_replace">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.AttributeEvents.</span></code></a><span class="sig-name descname"><span class="pre">bulk_replace</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">values</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">_T</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initiator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Event</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">EventConstants</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.AttributeEvents.bulk_replace" title="Link to this definition">¶</a></dt>
<dd><p>Receive a collection ‘bulk replace’ event.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="o">.</span><span class="n">some_attribute</span><span class="p">,</span> <span class="s1">&#39;bulk_replace&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_bulk_replace</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">initiator</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;bulk_replace&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This event is invoked for a sequence of values as they are incoming
to a bulk collection set operation, which can be
modified in place before the values are treated as ORM objects.
This is an “early hook” that runs before the bulk replace routine
attempts to reconcile which objects are already present in the
collection and which are being removed by the net replace operation.</p>
<p>It is typical that this method be combined with use of the
<a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.append" title="sqlalchemy.orm.AttributeEvents.append"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AttributeEvents.append()</span></code></a> event.    When using both of these
events, note that a bulk replace operation will invoke
the <a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.append" title="sqlalchemy.orm.AttributeEvents.append"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AttributeEvents.append()</span></code></a> event for all new items,
even after <a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.bulk_replace" title="sqlalchemy.orm.AttributeEvents.bulk_replace"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AttributeEvents.bulk_replace()</span></code></a> has been invoked
for the collection as a whole.  In order to determine if an
<a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.append" title="sqlalchemy.orm.AttributeEvents.append"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AttributeEvents.append()</span></code></a> event is part of a bulk replace,
use the symbol <code class="xref py py-attr docutils literal notranslate"><span class="pre">attributes.OP_BULK_REPLACE</span></code> to test the
incoming initiator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm.attributes</span><span class="w"> </span><span class="kn">import</span> <span class="n">OP_BULK_REPLACE</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeObject</span><span class="o">.</span><span class="n">collection</span><span class="p">,</span> <span class="s2">&quot;bulk_replace&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">process_collection</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">initiator</span><span class="p">):</span>
    <span class="n">values</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">_make_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeObject</span><span class="o">.</span><span class="n">collection</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">retval</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">process_collection</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">initiator</span><span class="p">):</span>
    <span class="c1"># make sure bulk_replace didn&#39;t already do it</span>
    <span class="k">if</span> <span class="n">initiator</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">initiator</span><span class="o">.</span><span class="n">op</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">OP_BULK_REPLACE</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_make_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.bulk_replace.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.bulk_replace.params.target">¶</a> – the object instance receiving the event.
If the listener is registered with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> object.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.bulk_replace.params.value"></span><strong>value</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.bulk_replace.params.value">¶</a> – a sequence (e.g. a list) of the values being set.  The
handler can modify this list in place.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.bulk_replace.params.initiator"></span><strong>initiator</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.bulk_replace.params.initiator">¶</a> – An instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">Event</span></code>
representing the initiation of the event.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.bulk_replace.params.keys"></span><strong>keys</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.bulk_replace.params.keys">¶</a> – <p>When the event is established using the
<a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.params.include_key" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">AttributeEvents.include_key</span></code></a> parameter set to
True, this will be the sequence of keys used in the operation,
typically only for a dictionary update.  The parameter is not passed
to the event at all if the the
<a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.params.include_key" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">AttributeEvents.include_key</span></code></a>
was not used to set up the event; this is to allow backwards
compatibility with existing event handlers that don’t include the
<code class="docutils literal notranslate"><span class="pre">key</span></code> parameter.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">AttributeEvents</span></code></a> - background on listener options such
as propagation to subclasses.</p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.AttributeEvents.dispatch">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.AttributeEvents.</span></code></a><span class="sig-name descname"><span class="pre">dispatch</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">_Dispatch</span><span class="p"><span class="pre">[</span></span><span class="pre">_ET</span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">&lt;sqlalchemy.event.base.AttributeEventsDispatch</span> <span class="pre">object&gt;</span></em><a class="headerlink" href="#sqlalchemy.orm.AttributeEvents.dispatch" title="Link to this definition">¶</a></dt>
<dd><p>reference back to the _Dispatch class.</p>
<p>Bidirectional against _Dispatch._events</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.AttributeEvents.dispose_collection">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.AttributeEvents.</span></code></a><span class="sig-name descname"><span class="pre">dispose_collection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Collection</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection_adapter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="collection_api.html#sqlalchemy.orm.collections.CollectionAdapter" title="sqlalchemy.orm.collections.CollectionAdapter"><span class="pre">CollectionAdapter</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.AttributeEvents.dispose_collection" title="Link to this definition">¶</a></dt>
<dd><p>Receive a ‘collection dispose’ event.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="o">.</span><span class="n">some_attribute</span><span class="p">,</span> <span class="s1">&#39;dispose_collection&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_dispose_collection</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">collection</span><span class="p">,</span> <span class="n">collection_adapter</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;dispose_collection&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This event is triggered for a collection-based attribute when
a collection is replaced, that is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">u1</span><span class="o">.</span><span class="n">addresses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>

<span class="n">u1</span><span class="o">.</span><span class="n">addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">a2</span><span class="p">,</span> <span class="n">a3</span><span class="p">]</span>  <span class="c1"># &lt;- old collection is disposed</span></pre></div>
</div>
<p>The old collection received will contain its previous contents.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">AttributeEvents</span></code></a> - background on listener options such
as propagation to subclasses.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.AttributeEvents.init_collection">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.AttributeEvents.</span></code></a><span class="sig-name descname"><span class="pre">init_collection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><span class="pre">Collection</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection_adapter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="collection_api.html#sqlalchemy.orm.collections.CollectionAdapter" title="sqlalchemy.orm.collections.CollectionAdapter"><span class="pre">CollectionAdapter</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.AttributeEvents.init_collection" title="Link to this definition">¶</a></dt>
<dd><p>Receive a ‘collection init’ event.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="o">.</span><span class="n">some_attribute</span><span class="p">,</span> <span class="s1">&#39;init_collection&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_init_collection</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">collection</span><span class="p">,</span> <span class="n">collection_adapter</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;init_collection&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This event is triggered for a collection-based attribute, when
the initial “empty collection” is first generated for a blank
attribute, as well as for when the collection is replaced with
a new one, such as via a set event.</p>
<p>E.g., given that <code class="docutils literal notranslate"><span class="pre">User.addresses</span></code> is a relationship-based
collection, the event is triggered here:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">u1</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
<span class="n">u1</span><span class="o">.</span><span class="n">addresses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>  <span class="c1">#  &lt;- new collection</span></pre></div>
</div>
<p>and also during replace operations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">u1</span><span class="o">.</span><span class="n">addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">a2</span><span class="p">,</span> <span class="n">a3</span><span class="p">]</span>  <span class="c1">#  &lt;- new collection</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.init_collection.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.init_collection.params.target">¶</a> – the object instance receiving the event.
If the listener is registered with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> object.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.init_collection.params.collection"></span><strong>collection</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.init_collection.params.collection">¶</a> – the new collection.  This will always be generated
from what was specified as
<a class="reference internal" href="relationship_api.html#sqlalchemy.orm.relationship.params.collection_class" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.collection_class</span></code></a>, and will always
be empty.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.init_collection.params.collection_adapter"></span><strong>collection_adapter</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.init_collection.params.collection_adapter">¶</a> – the <a class="reference internal" href="collection_api.html#sqlalchemy.orm.collections.CollectionAdapter" title="sqlalchemy.orm.collections.CollectionAdapter"><code class="xref py py-class docutils literal notranslate"><span class="pre">CollectionAdapter</span></code></a> that will
mediate internal access to the collection.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">AttributeEvents</span></code></a> - background on listener options such
as propagation to subclasses.</p>
<p><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.init_scalar" title="sqlalchemy.orm.AttributeEvents.init_scalar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AttributeEvents.init_scalar()</span></code></a> - “scalar” version of this
event.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.AttributeEvents.init_scalar">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.AttributeEvents.</span></code></a><span class="sig-name descname"><span class="pre">init_scalar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_T</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dict_</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.AttributeEvents.init_scalar" title="Link to this definition">¶</a></dt>
<dd><p>Receive a scalar “init” event.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="o">.</span><span class="n">some_attribute</span><span class="p">,</span> <span class="s1">&#39;init_scalar&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_init_scalar</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dict_</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;init_scalar&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This event is invoked when an uninitialized, unpersisted scalar
attribute is accessed, e.g. read:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">my_object</span><span class="o">.</span><span class="n">some_attribute</span></pre></div>
</div>
<p>The ORM’s default behavior when this occurs for an un-initialized
attribute is to return the value <code class="docutils literal notranslate"><span class="pre">None</span></code>; note this differs from
Python’s usual behavior of raising <code class="docutils literal notranslate"><span class="pre">AttributeError</span></code>.    The
event here can be used to customize what value is actually returned,
with the assumption that the event listener would be mirroring
a default generator that is configured on the Core
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>
object as well.</p>
<p>Since a default generator on a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>
might also produce
a changing value such as a timestamp, the
<a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.init_scalar" title="sqlalchemy.orm.AttributeEvents.init_scalar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AttributeEvents.init_scalar()</span></code></a>
event handler can also be used to <strong>set</strong> the newly returned value, so
that a Core-level default generation function effectively fires off
only once, but at the moment the attribute is accessed on the
non-persisted object.   Normally, no change to the object’s state
is made when an uninitialized attribute is accessed (much older
SQLAlchemy versions did in fact change the object’s state).</p>
<p>If a default generator on a column returned a particular constant,
a handler might be used as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SOME_CONSTANT</span> <span class="o">=</span> <span class="mf">3.1415926</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="n">some_attribute</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Numeric</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">SOME_CONSTANT</span><span class="p">)</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span>
    <span class="n">MyClass</span><span class="o">.</span><span class="n">some_attribute</span><span class="p">,</span> <span class="s2">&quot;init_scalar&quot;</span><span class="p">,</span> <span class="n">retval</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_init_some_attribute</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">dict_</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">dict_</span><span class="p">[</span><span class="s2">&quot;some_attribute&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SOME_CONSTANT</span>
    <span class="k">return</span> <span class="n">SOME_CONSTANT</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>Above, we initialize the attribute <code class="docutils literal notranslate"><span class="pre">MyClass.some_attribute</span></code> to the
value of <code class="docutils literal notranslate"><span class="pre">SOME_CONSTANT</span></code>.   The above code includes the following
features:</p>
<ul class="simple">
<li><p>By setting the value <code class="docutils literal notranslate"><span class="pre">SOME_CONSTANT</span></code> in the given <code class="docutils literal notranslate"><span class="pre">dict_</span></code>,
we indicate that this value is to be persisted to the database.
This supersedes the use of <code class="docutils literal notranslate"><span class="pre">SOME_CONSTANT</span></code> in the default generator
for the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>.  The <code class="docutils literal notranslate"><span class="pre">active_column_defaults.py</span></code>
example given at <a class="reference internal" href="examples.html#examples-instrumentation"><span class="std std-ref">属性检测</span></a> illustrates using
the same approach for a changing default, e.g. a timestamp
generator.    In this particular example, it is not strictly
necessary to do this since <code class="docutils literal notranslate"><span class="pre">SOME_CONSTANT</span></code> would be part of the
INSERT statement in either case.</p></li>
<li><p>By establishing the <code class="docutils literal notranslate"><span class="pre">retval=True</span></code> flag, the value we return
from the function will be returned by the attribute getter.
Without this flag, the event is assumed to be a passive observer
and the return value of our function is ignored.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">propagate=True</span></code> flag is significant if the mapped class
includes inheriting subclasses, which would also make use of this
event listener.  Without this flag, an inheriting subclass will
not use our event handler.</p></li>
</ul>
<p>In the above example, the attribute set event
<a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.set" title="sqlalchemy.orm.AttributeEvents.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AttributeEvents.set()</span></code></a> as well as the related validation feature
provided by <a class="reference internal" href="mapped_attributes.html#sqlalchemy.orm.validates" title="sqlalchemy.orm.validates"><code class="xref py py-obj docutils literal notranslate"><span class="pre">validates</span></code></a> is <strong>not</strong> invoked when we apply our
value to the given <code class="docutils literal notranslate"><span class="pre">dict_</span></code>.  To have these events to invoke in
response to our newly generated value, apply the value to the given
object as a normal attribute set operation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SOME_CONSTANT</span> <span class="o">=</span> <span class="mf">3.1415926</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span>
    <span class="n">MyClass</span><span class="o">.</span><span class="n">some_attribute</span><span class="p">,</span> <span class="s2">&quot;init_scalar&quot;</span><span class="p">,</span> <span class="n">retval</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_init_some_attribute</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">dict_</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="c1"># will also fire off attribute set events</span>
    <span class="n">target</span><span class="o">.</span><span class="n">some_attribute</span> <span class="o">=</span> <span class="n">SOME_CONSTANT</span>
    <span class="k">return</span> <span class="n">SOME_CONSTANT</span></pre></div>
</div>
<p>When multiple listeners are set up, the generation of the value
is “chained” from one listener to the next by passing the value
returned by the previous listener that specifies <code class="docutils literal notranslate"><span class="pre">retval=True</span></code>
as the <code class="docutils literal notranslate"><span class="pre">value</span></code> argument of the next listener.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.init_scalar.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.init_scalar.params.target">¶</a> – the object instance receiving the event.
If the listener is registered with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> object.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.init_scalar.params.value"></span><strong>value</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.init_scalar.params.value">¶</a> – the value that is to be returned before this event
listener were invoked.  This value begins as the value <code class="docutils literal notranslate"><span class="pre">None</span></code>,
however will be the return value of the previous event handler
function if multiple listeners are present.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.init_scalar.params.dict_"></span><strong>dict_</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.init_scalar.params.dict_">¶</a> – the attribute dictionary of this mapped object.
This is normally the <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> of the object, but in all cases
represents the destination that the attribute system uses to get
at the actual value of this attribute.  Placing the value in this
dictionary has the effect that the value will be used in the
INSERT statement generated by the unit of work.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.init_collection" title="sqlalchemy.orm.AttributeEvents.init_collection"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AttributeEvents.init_collection()</span></code></a> - collection version
of this event</p>
<p><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">AttributeEvents</span></code></a> - background on listener options such
as propagation to subclasses.</p>
<p><a class="reference internal" href="examples.html#examples-instrumentation"><span class="std std-ref">属性检测</span></a> - see the
<code class="docutils literal notranslate"><span class="pre">active_column_defaults.py</span></code> example.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.AttributeEvents.modified">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.AttributeEvents.</span></code></a><span class="sig-name descname"><span class="pre">modified</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initiator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Event</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.AttributeEvents.modified" title="Link to this definition">¶</a></dt>
<dd><p>Receive a ‘modified’ event.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="o">.</span><span class="n">some_attribute</span><span class="p">,</span> <span class="s1">&#39;modified&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_modified</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">initiator</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;modified&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>This event is triggered when the <a class="reference internal" href="session_api.html#sqlalchemy.orm.attributes.flag_modified" title="sqlalchemy.orm.attributes.flag_modified"><code class="xref py py-func docutils literal notranslate"><span class="pre">flag_modified()</span></code></a>
function is used to trigger a modify event on an attribute without
any specific value being set.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.modified.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.modified.params.target">¶</a> – the object instance receiving the event.
If the listener is registered with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> object.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.modified.params.initiator"></span><strong>initiator</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.modified.params.initiator">¶</a> – An instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">Event</span></code>
representing the initiation of the event.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">AttributeEvents</span></code></a> - background on listener options such
as propagation to subclasses.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.AttributeEvents.remove">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.AttributeEvents.</span></code></a><span class="sig-name descname"><span class="pre">remove</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_T</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initiator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Event</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">EventConstants</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">EventConstants.NO_KEY</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.AttributeEvents.remove" title="Link to this definition">¶</a></dt>
<dd><p>Receive a collection remove event.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="o">.</span><span class="n">some_attribute</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_remove</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">initiator</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;remove&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.remove.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.remove.params.target">¶</a> – the object instance receiving the event.
If the listener is registered with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> object.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.remove.params.value"></span><strong>value</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.remove.params.value">¶</a> – the value being removed.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.remove.params.initiator"></span><strong>initiator</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.remove.params.initiator">¶</a> – An instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">Event</span></code>
representing the initiation of the event.  May be modified
from its original value by backref handlers in order to control
chained event propagation.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.remove.params.key"></span><strong>key</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.remove.params.key">¶</a> – <p>When the event is established using the
<a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.params.include_key" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">AttributeEvents.include_key</span></code></a> parameter set to
True, this will be the key used in the operation, such as
<code class="docutils literal notranslate"><span class="pre">del</span> <span class="pre">collection[some_key_or_index]</span></code>.  The parameter is not passed
to the event at all if the the
<a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.params.include_key" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">AttributeEvents.include_key</span></code></a>
was not used to set up the event; this is to allow backwards
compatibility with existing event handlers that don’t include the
<code class="docutils literal notranslate"><span class="pre">key</span></code> parameter.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 2.0 版本加入.</span></p>
</div>
</p></li>
</ul>
</dd>
<dt class="field-even">返回<span class="colon">:</span></dt>
<dd class="field-even"><p>No return value is defined for this event.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">AttributeEvents</span></code></a> - background on listener options such
as propagation to subclasses.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.AttributeEvents.set">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.AttributeEvents.</span></code></a><span class="sig-name descname"><span class="pre">set</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_T</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">oldvalue</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_T</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initiator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Event</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.AttributeEvents.set" title="Link to this definition">¶</a></dt>
<dd><p>Receive a scalar set event.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeClass</span><span class="o">.</span><span class="n">some_attribute</span><span class="p">,</span> <span class="s1">&#39;set&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_set</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">oldvalue</span><span class="p">,</span> <span class="n">initiator</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;set&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.set.params.target"></span><strong>target</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.set.params.target">¶</a> – the object instance receiving the event.
If the listener is registered with <code class="docutils literal notranslate"><span class="pre">raw=True</span></code>, this will
be the <a class="reference internal" href="internals.html#sqlalchemy.orm.InstanceState" title="sqlalchemy.orm.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a> object.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.set.params.value"></span><strong>value</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.set.params.value">¶</a> – the value being set.  If this listener
is registered with <code class="docutils literal notranslate"><span class="pre">retval=True</span></code>, the listener
function must return this value, or a new value which
replaces it.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.set.params.oldvalue"></span><strong>oldvalue</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.set.params.oldvalue">¶</a> – the previous value being replaced.  This
may also be the symbol <code class="docutils literal notranslate"><span class="pre">NEVER_SET</span></code> or <code class="docutils literal notranslate"><span class="pre">NO_VALUE</span></code>.
If the listener is registered with <code class="docutils literal notranslate"><span class="pre">active_history=True</span></code>,
the previous value of the attribute will be loaded from
the database if the existing value is currently unloaded
or expired.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.AttributeEvents.set.params.initiator"></span><strong>initiator</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.AttributeEvents.set.params.initiator">¶</a> – An instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">Event</span></code>
representing the initiation of the event.  May be modified
from its original value by backref handlers in order to control
chained event propagation.</p></li>
</ul>
</dd>
<dt class="field-even">返回<span class="colon">:</span></dt>
<dd class="field-even"><p>if the event was registered with <code class="docutils literal notranslate"><span class="pre">retval=True</span></code>,
the given value, or a new effective value, should be returned.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents" title="sqlalchemy.orm.AttributeEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">AttributeEvents</span></code></a> - background on listener options such
as propagation to subclasses.</p>
</div>
</dd></dl>

</dd></dl>

</section>
<section id="id5">
<h2>查询事件<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h2>
<p>Query Events</p>
<div class="table-wrapper longtable docutils container">
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.QueryEvents"><span class="sig-name descname">QueryEvents</span></a></p></td>
<td><p>Represent events within the construction of a <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a>
object.</p></td>
</tr>
</tbody>
</table>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.orm.QueryEvents">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">QueryEvents</span></span><a class="headerlink" href="#sqlalchemy.orm.QueryEvents" title="Link to this definition">¶</a></dt>
<dd><p>Represent events within the construction of a <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a>
object.</p>
<div class="admonition legacy">
<p class="admonition-title">Legacy Feature</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.QueryEvents" title="sqlalchemy.orm.QueryEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueryEvents</span></code></a> event methods are legacy
as of SQLAlchemy 2.0, and only apply to direct use of the
<a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object. They are not used for <a class="reference internal" href="../glossary.html#term-2.0-style"><span class="xref std std-term">2.0 style</span></a>
statements. For events to intercept and modify 2.0 style ORM use,
use the <a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a> hook.</p>
</div>
<p>The <a class="reference internal" href="#sqlalchemy.orm.QueryEvents" title="sqlalchemy.orm.QueryEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueryEvents</span></code></a> hooks are now superseded by the
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a> event hook.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile"><span class="sig-name descname">before_compile()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile_delete"><span class="sig-name descname">before_compile_delete()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile_update"><span class="sig-name descname">before_compile_update()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.QueryEvents.dispatch"><span class="sig-name descname">dispatch</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.orm.QueryEvents" title="sqlalchemy.orm.QueryEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.QueryEvents</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.event.Events</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.QueryEvents.before_compile">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.QueryEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.QueryEvents.</span></code></a><span class="sig-name descname"><span class="pre">before_compile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.query.Query"><span class="pre">Query</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.QueryEvents.before_compile" title="Link to this definition">¶</a></dt>
<dd><p>Receive the <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a>
object before it is composed into a
core <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> object.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeQuery</span><span class="p">,</span> <span class="s1">&#39;before_compile&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_before_compile</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;before_compile&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<div class="deprecated">
<p><span class="versionmodified deprecated">自 1.4 版本弃用: </span>The <a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile" title="sqlalchemy.orm.QueryEvents.before_compile"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QueryEvents.before_compile()</span></code></a> event
is superseded by the much more capable
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a> hook.   In version 1.4,
the <a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile" title="sqlalchemy.orm.QueryEvents.before_compile"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QueryEvents.before_compile()</span></code></a> event is <strong>no longer
used</strong> for ORM-level attribute loads, such as loads of deferred
or expired attributes as well as relationship loaders.   See the
new examples in <a class="reference internal" href="examples.html#examples-session-orm-events"><span class="std std-ref">ORM 查询事件</span></a> which
illustrate new ways of intercepting and modifying ORM queries
for the most common purpose of adding arbitrary filter criteria.</p>
</div>
<p>This event is intended to allow changes to the query given:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">Query</span><span class="p">,</span> <span class="s2">&quot;before_compile&quot;</span><span class="p">,</span> <span class="n">retval</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">no_deleted</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">column_descriptions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">User</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;entity&quot;</span><span class="p">]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">deleted</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">query</span></pre></div>
</div>
<p>The event should normally be listened with the <code class="docutils literal notranslate"><span class="pre">retval=True</span></code>
parameter set, so that the modified query may be returned.</p>
<p>The <a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile" title="sqlalchemy.orm.QueryEvents.before_compile"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QueryEvents.before_compile()</span></code></a> event by default
will disallow “baked” queries from caching a query, if the event
hook returns a new <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object.
This affects both direct
use of the baked query extension as well as its operation within
lazy loaders and eager loaders for relationships.  In order to
re-establish the query being cached, apply the event adding the
<code class="docutils literal notranslate"><span class="pre">bake_ok</span></code> flag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">Query</span><span class="p">,</span> <span class="s2">&quot;before_compile&quot;</span><span class="p">,</span> <span class="n">retval</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bake_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_event</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">column_descriptions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">User</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;entity&quot;</span><span class="p">]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">deleted</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">query</span></pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">bake_ok</span></code> is set to True, the event hook will only be invoked
once, and not called for subsequent invocations of a particular query
that is being cached.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile_update" title="sqlalchemy.orm.QueryEvents.before_compile_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QueryEvents.before_compile_update()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile_delete" title="sqlalchemy.orm.QueryEvents.before_compile_delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QueryEvents.before_compile_delete()</span></code></a></p>
<p><a class="reference internal" href="extensions/baked.html#baked-with-before-compile"><span class="std std-ref">使用 before_compile 事件</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.QueryEvents.before_compile_delete">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.QueryEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.QueryEvents.</span></code></a><span class="sig-name descname"><span class="pre">before_compile_delete</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.query.Query"><span class="pre">Query</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">delete_context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BulkDelete</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.QueryEvents.before_compile_delete" title="Link to this definition">¶</a></dt>
<dd><p>Allow modifications to the <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object within
<a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query.delete" title="sqlalchemy.orm.Query.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.delete()</span></code></a>.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeQuery</span><span class="p">,</span> <span class="s1">&#39;before_compile_delete&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_before_compile_delete</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">delete_context</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;before_compile_delete&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<div class="deprecated">
<p><span class="versionmodified deprecated">自 1.4 版本弃用: </span>The <a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile_delete" title="sqlalchemy.orm.QueryEvents.before_compile_delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QueryEvents.before_compile_delete()</span></code></a>
event is superseded by the much more capable
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a> hook.</p>
</div>
<p>Like the <a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile" title="sqlalchemy.orm.QueryEvents.before_compile"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QueryEvents.before_compile()</span></code></a> event, this event
should be configured with <code class="docutils literal notranslate"><span class="pre">retval=True</span></code>, and the modified
<a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object returned, as in</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">Query</span><span class="p">,</span> <span class="s2">&quot;before_compile_delete&quot;</span><span class="p">,</span> <span class="n">retval</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">no_deleted</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">delete_context</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">column_descriptions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">User</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;entity&quot;</span><span class="p">]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">deleted</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">query</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.QueryEvents.before_compile_delete.params.query"></span><strong>query</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile_delete.params.query">¶</a> – a <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> instance; this is also
the <code class="docutils literal notranslate"><span class="pre">.query</span></code> attribute of the given “delete context”
object.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.QueryEvents.before_compile_delete.params.delete_context"></span><strong>delete_context</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile_delete.params.delete_context">¶</a> – a “delete context” object which is
the same kind of object as described in
<code class="xref py py-paramref docutils literal notranslate"><span class="pre">QueryEvents.after_bulk_delete.delete_context</span></code>.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile" title="sqlalchemy.orm.QueryEvents.before_compile"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QueryEvents.before_compile()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile_update" title="sqlalchemy.orm.QueryEvents.before_compile_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QueryEvents.before_compile_update()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.QueryEvents.before_compile_update">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.QueryEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.QueryEvents.</span></code></a><span class="sig-name descname"><span class="pre">before_compile_update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.query.Query"><span class="pre">Query</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_context</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">BulkUpdate</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.QueryEvents.before_compile_update" title="Link to this definition">¶</a></dt>
<dd><p>Allow modifications to the <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object within
<a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query.update" title="sqlalchemy.orm.Query.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.update()</span></code></a>.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeQuery</span><span class="p">,</span> <span class="s1">&#39;before_compile_update&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_before_compile_update</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">update_context</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;before_compile_update&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<div class="deprecated">
<p><span class="versionmodified deprecated">自 1.4 版本弃用: </span>The <a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile_update" title="sqlalchemy.orm.QueryEvents.before_compile_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QueryEvents.before_compile_update()</span></code></a>
event is superseded by the much more capable
<a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute" title="sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a> hook.</p>
</div>
<p>Like the <a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile" title="sqlalchemy.orm.QueryEvents.before_compile"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QueryEvents.before_compile()</span></code></a> event, if the event
is to be used to alter the <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object, it should
be configured with <code class="docutils literal notranslate"><span class="pre">retval=True</span></code>, and the modified
<a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object returned, as in</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">Query</span><span class="p">,</span> <span class="s2">&quot;before_compile_update&quot;</span><span class="p">,</span> <span class="n">retval</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">no_deleted</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">update_context</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">column_descriptions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">User</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;entity&quot;</span><span class="p">]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">deleted</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>

            <span class="n">update_context</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span>
                <span class="n">datetime</span><span class="o">.</span><span class="n">UTC</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">query</span></pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">.values</span></code> dictionary of the “update context” object can also
be modified in place as illustrated above.</p>
<dl class="field-list simple">
<dt class="field-odd">参数<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.orm.QueryEvents.before_compile_update.params.query"></span><strong>query</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile_update.params.query">¶</a> – a <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> instance; this is also
the <code class="docutils literal notranslate"><span class="pre">.query</span></code> attribute of the given “update context”
object.</p></li>
<li><p><span class="target" id="sqlalchemy.orm.QueryEvents.before_compile_update.params.update_context"></span><strong>update_context</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile_update.params.update_context">¶</a> – an “update context” object which is
the same kind of object as described in
<code class="xref py py-paramref docutils literal notranslate"><span class="pre">QueryEvents.after_bulk_update.update_context</span></code>.
The object has a <code class="docutils literal notranslate"><span class="pre">.values</span></code> attribute in an UPDATE context which is
the dictionary of parameters passed to <a class="reference internal" href="queryguide/query.html#sqlalchemy.orm.Query.update" title="sqlalchemy.orm.Query.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.update()</span></code></a>.
This
dictionary can be modified to alter the VALUES clause of the
resulting UPDATE statement.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile" title="sqlalchemy.orm.QueryEvents.before_compile"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QueryEvents.before_compile()</span></code></a></p>
<p><a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile_delete" title="sqlalchemy.orm.QueryEvents.before_compile_delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QueryEvents.before_compile_delete()</span></code></a></p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.QueryEvents.dispatch">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.QueryEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.QueryEvents.</span></code></a><span class="sig-name descname"><span class="pre">dispatch</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">_Dispatch</span><span class="p"><span class="pre">[</span></span><span class="pre">_ET</span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">&lt;sqlalchemy.event.base.QueryEventsDispatch</span> <span class="pre">object&gt;</span></em><a class="headerlink" href="#sqlalchemy.orm.QueryEvents.dispatch" title="Link to this definition">¶</a></dt>
<dd><p>reference back to the _Dispatch class.</p>
<p>Bidirectional against _Dispatch._events</p>
</dd></dl>

</dd></dl>

</section>
<section id="id6">
<h2>仪表事件<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h2>
<p>Instrumentation Events</p>
<p id="module-sqlalchemy.orm.instrumentation">Defines SQLAlchemy’s system of class instrumentation.</p>
<p>This module is usually not directly visible to user applications, but
defines a large part of the ORM’s interactivity.</p>
<p>instrumentation.py deals with registration of end-user classes
for state tracking.   It interacts closely with state.py
and attributes.py which establish per-instance and per-class-attribute
instrumentation, respectively.</p>
<p>The class instrumentation system can be customized on a per-class
or global basis using the <a class="reference internal" href="extensions/instrumentation.html#module-sqlalchemy.ext.instrumentation" title="sqlalchemy.ext.instrumentation"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlalchemy.ext.instrumentation</span></code></a>
module, which provides the means to build and specify
alternate instrumentation forms.</p>
<div class="table-wrapper longtable docutils container">
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="autosummary-name"><p><a class="reference internal" href="#sqlalchemy.orm.InstrumentationEvents"><span class="sig-name descname">InstrumentationEvents</span></a></p></td>
<td><p>Events related to class instrumentation events.</p></td>
</tr>
</tbody>
</table>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.orm.InstrumentationEvents">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.orm.</span></span><span class="sig-name descname"><span class="pre">InstrumentationEvents</span></span><a class="headerlink" href="#sqlalchemy.orm.InstrumentationEvents" title="Link to this definition">¶</a></dt>
<dd><p>Events related to class instrumentation events.</p>
<p>The listeners here support being established against
any new style class, that is any object that is a subclass
of ‘type’.  Events will then be fired off for events
against that class.  If the “propagate=True” flag is passed
to event.listen(), the event will fire off for subclasses
of that class as well.</p>
<p>The Python <code class="docutils literal notranslate"><span class="pre">type</span></code> builtin is also accepted as a target,
which when used has the effect of events being emitted
for all classes.</p>
<p>Note the “propagate” flag here is defaulted to <code class="docutils literal notranslate"><span class="pre">True</span></code>,
unlike the other class level events where it defaults
to <code class="docutils literal notranslate"><span class="pre">False</span></code>.  This means that new subclasses will also
be the subject of these events, when a listener
is established on a superclass.</p>
<div class="class-members docutils container">
<p><strong>Members</strong></p>
<p><a class="reference internal" href="#sqlalchemy.orm.InstrumentationEvents.attribute_instrument"><span class="sig-name descname">attribute_instrument()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.InstrumentationEvents.class_instrument"><span class="sig-name descname">class_instrument()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.InstrumentationEvents.class_uninstrument"><span class="sig-name descname">class_uninstrument()</span></a>, <a class="reference internal" href="#sqlalchemy.orm.InstrumentationEvents.dispatch"><span class="sig-name descname">dispatch</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.orm.InstrumentationEvents" title="sqlalchemy.orm.InstrumentationEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.InstrumentationEvents</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.event.Events</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.InstrumentationEvents.attribute_instrument">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.InstrumentationEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.InstrumentationEvents.</span></code></a><span class="sig-name descname"><span class="pre">attribute_instrument</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cls</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="internals.html#sqlalchemy.orm.ClassManager" title="sqlalchemy.orm.ClassManager"><span class="pre">ClassManager</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_KT</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inst</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_O</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.InstrumentationEvents.attribute_instrument" title="Link to this definition">¶</a></dt>
<dd><p>Called when an attribute is instrumented.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeBaseClass</span><span class="p">,</span> <span class="s1">&#39;attribute_instrument&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_attribute_instrument</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">inst</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;attribute_instrument&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.InstrumentationEvents.class_instrument">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.InstrumentationEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.InstrumentationEvents.</span></code></a><span class="sig-name descname"><span class="pre">class_instrument</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cls</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="internals.html#sqlalchemy.orm.ClassManager" title="sqlalchemy.orm.ClassManager"><span class="pre">ClassManager</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.InstrumentationEvents.class_instrument" title="Link to this definition">¶</a></dt>
<dd><p>Called after the given class is instrumented.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeBaseClass</span><span class="p">,</span> <span class="s1">&#39;class_instrument&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_class_instrument</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;class_instrument&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>To get at the <a class="reference internal" href="internals.html#sqlalchemy.orm.ClassManager" title="sqlalchemy.orm.ClassManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClassManager</span></code></a>, use
<code class="xref py py-func docutils literal notranslate"><span class="pre">manager_of_class()</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.orm.InstrumentationEvents.class_uninstrument">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.orm.InstrumentationEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.InstrumentationEvents.</span></code></a><span class="sig-name descname"><span class="pre">class_uninstrument</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cls</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="internals.html#sqlalchemy.orm.ClassManager" title="sqlalchemy.orm.ClassManager"><span class="pre">ClassManager</span></a><span class="p"><span class="pre">[</span></span><span class="pre">_O</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#sqlalchemy.orm.InstrumentationEvents.class_uninstrument" title="Link to this definition">¶</a></dt>
<dd><p>Called before the given class is uninstrumented.</p>
<div class="event-signatures docutils container">
<p>Example argument forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">event</span>


<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">SomeBaseClass</span><span class="p">,</span> <span class="s1">&#39;class_uninstrument&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">receive_class_uninstrument</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="s2">&quot;listen for the &#39;class_uninstrument&#39; event&quot;</span>

    <span class="c1"># ... (event handling logic) ...</span></pre></div>
</div>
</div>
<p>To get at the <a class="reference internal" href="internals.html#sqlalchemy.orm.ClassManager" title="sqlalchemy.orm.ClassManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClassManager</span></code></a>, use
<code class="xref py py-func docutils literal notranslate"><span class="pre">manager_of_class()</span></code>.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.orm.InstrumentationEvents.dispatch">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.orm.InstrumentationEvents"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.InstrumentationEvents.</span></code></a><span class="sig-name descname"><span class="pre">dispatch</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">_Dispatch</span><span class="p"><span class="pre">[</span></span><span class="pre">_ET</span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">&lt;sqlalchemy.event.base.InstrumentationEventsDispatch</span> <span class="pre">object&gt;</span></em><a class="headerlink" href="#sqlalchemy.orm.InstrumentationEvents.dispatch" title="Link to this definition">¶</a></dt>
<dd><p>reference back to the _Dispatch class.</p>
<p>Bidirectional against _Dispatch._events</p>
</dd></dl>

</dd></dl>

</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="internals.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">ORM 内部</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="extending.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">事件和内部</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                <a href="../copyright.html">Copyright</a> &#169; 2007-2025, the SQLAlchemy authors and contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on 04/05/2025 04:00:26</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">ORM 事件</a><ul>
<li><a class="reference internal" href="#id1">会话事件</a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents"><code class="docutils literal notranslate"><span class="pre">SessionEvents</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_attach"><code class="docutils literal notranslate"><span class="pre">SessionEvents.after_attach()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_begin"><code class="docutils literal notranslate"><span class="pre">SessionEvents.after_begin()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_bulk_delete"><code class="docutils literal notranslate"><span class="pre">SessionEvents.after_bulk_delete()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_bulk_update"><code class="docutils literal notranslate"><span class="pre">SessionEvents.after_bulk_update()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_commit"><code class="docutils literal notranslate"><span class="pre">SessionEvents.after_commit()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_flush"><code class="docutils literal notranslate"><span class="pre">SessionEvents.after_flush()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_flush_postexec"><code class="docutils literal notranslate"><span class="pre">SessionEvents.after_flush_postexec()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_rollback"><code class="docutils literal notranslate"><span class="pre">SessionEvents.after_rollback()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_soft_rollback"><code class="docutils literal notranslate"><span class="pre">SessionEvents.after_soft_rollback()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_transaction_create"><code class="docutils literal notranslate"><span class="pre">SessionEvents.after_transaction_create()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.after_transaction_end"><code class="docutils literal notranslate"><span class="pre">SessionEvents.after_transaction_end()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_attach"><code class="docutils literal notranslate"><span class="pre">SessionEvents.before_attach()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_commit"><code class="docutils literal notranslate"><span class="pre">SessionEvents.before_commit()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.before_flush"><code class="docutils literal notranslate"><span class="pre">SessionEvents.before_flush()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.deleted_to_detached"><code class="docutils literal notranslate"><span class="pre">SessionEvents.deleted_to_detached()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.deleted_to_persistent"><code class="docutils literal notranslate"><span class="pre">SessionEvents.deleted_to_persistent()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.detached_to_persistent"><code class="docutils literal notranslate"><span class="pre">SessionEvents.detached_to_persistent()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.dispatch"><code class="docutils literal notranslate"><span class="pre">SessionEvents.dispatch</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.do_orm_execute"><code class="docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.loaded_as_persistent"><code class="docutils literal notranslate"><span class="pre">SessionEvents.loaded_as_persistent()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.pending_to_persistent"><code class="docutils literal notranslate"><span class="pre">SessionEvents.pending_to_persistent()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.pending_to_transient"><code class="docutils literal notranslate"><span class="pre">SessionEvents.pending_to_transient()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.persistent_to_deleted"><code class="docutils literal notranslate"><span class="pre">SessionEvents.persistent_to_deleted()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.persistent_to_detached"><code class="docutils literal notranslate"><span class="pre">SessionEvents.persistent_to_detached()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.persistent_to_transient"><code class="docutils literal notranslate"><span class="pre">SessionEvents.persistent_to_transient()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.SessionEvents.transient_to_pending"><code class="docutils literal notranslate"><span class="pre">SessionEvents.transient_to_pending()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id2">映射器事件</a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.MapperEvents"><code class="docutils literal notranslate"><span class="pre">MapperEvents</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_configured"><code class="docutils literal notranslate"><span class="pre">MapperEvents.after_configured()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_delete"><code class="docutils literal notranslate"><span class="pre">MapperEvents.after_delete()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_insert"><code class="docutils literal notranslate"><span class="pre">MapperEvents.after_insert()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_mapper_constructed"><code class="docutils literal notranslate"><span class="pre">MapperEvents.after_mapper_constructed()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.after_update"><code class="docutils literal notranslate"><span class="pre">MapperEvents.after_update()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_configured"><code class="docutils literal notranslate"><span class="pre">MapperEvents.before_configured()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_delete"><code class="docutils literal notranslate"><span class="pre">MapperEvents.before_delete()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_insert"><code class="docutils literal notranslate"><span class="pre">MapperEvents.before_insert()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_mapper_configured"><code class="docutils literal notranslate"><span class="pre">MapperEvents.before_mapper_configured()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.before_update"><code class="docutils literal notranslate"><span class="pre">MapperEvents.before_update()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.dispatch"><code class="docutils literal notranslate"><span class="pre">MapperEvents.dispatch</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.instrument_class"><code class="docutils literal notranslate"><span class="pre">MapperEvents.instrument_class()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.MapperEvents.mapper_configured"><code class="docutils literal notranslate"><span class="pre">MapperEvents.mapper_configured()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id3">实例事件</a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents"><code class="docutils literal notranslate"><span class="pre">InstanceEvents</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.dispatch"><code class="docutils literal notranslate"><span class="pre">InstanceEvents.dispatch</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.expire"><code class="docutils literal notranslate"><span class="pre">InstanceEvents.expire()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.init"><code class="docutils literal notranslate"><span class="pre">InstanceEvents.init()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.init_failure"><code class="docutils literal notranslate"><span class="pre">InstanceEvents.init_failure()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.load"><code class="docutils literal notranslate"><span class="pre">InstanceEvents.load()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.pickle"><code class="docutils literal notranslate"><span class="pre">InstanceEvents.pickle()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.refresh"><code class="docutils literal notranslate"><span class="pre">InstanceEvents.refresh()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.refresh_flush"><code class="docutils literal notranslate"><span class="pre">InstanceEvents.refresh_flush()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.InstanceEvents.unpickle"><code class="docutils literal notranslate"><span class="pre">InstanceEvents.unpickle()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#orm-attribute-events">属性事件</a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents"><code class="docutils literal notranslate"><span class="pre">AttributeEvents</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.append"><code class="docutils literal notranslate"><span class="pre">AttributeEvents.append()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.append_wo_mutation"><code class="docutils literal notranslate"><span class="pre">AttributeEvents.append_wo_mutation()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.bulk_replace"><code class="docutils literal notranslate"><span class="pre">AttributeEvents.bulk_replace()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.dispatch"><code class="docutils literal notranslate"><span class="pre">AttributeEvents.dispatch</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.dispose_collection"><code class="docutils literal notranslate"><span class="pre">AttributeEvents.dispose_collection()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.init_collection"><code class="docutils literal notranslate"><span class="pre">AttributeEvents.init_collection()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.init_scalar"><code class="docutils literal notranslate"><span class="pre">AttributeEvents.init_scalar()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.modified"><code class="docutils literal notranslate"><span class="pre">AttributeEvents.modified()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.remove"><code class="docutils literal notranslate"><span class="pre">AttributeEvents.remove()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.AttributeEvents.set"><code class="docutils literal notranslate"><span class="pre">AttributeEvents.set()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id5">查询事件</a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.QueryEvents"><code class="docutils literal notranslate"><span class="pre">QueryEvents</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile"><code class="docutils literal notranslate"><span class="pre">QueryEvents.before_compile()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile_delete"><code class="docutils literal notranslate"><span class="pre">QueryEvents.before_compile_delete()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.QueryEvents.before_compile_update"><code class="docutils literal notranslate"><span class="pre">QueryEvents.before_compile_update()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.QueryEvents.dispatch"><code class="docutils literal notranslate"><span class="pre">QueryEvents.dispatch</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id6">仪表事件</a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.InstrumentationEvents"><code class="docutils literal notranslate"><span class="pre">InstrumentationEvents</span></code></a><ul>
<li><a class="reference internal" href="#sqlalchemy.orm.InstrumentationEvents.attribute_instrument"><code class="docutils literal notranslate"><span class="pre">InstrumentationEvents.attribute_instrument()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.InstrumentationEvents.class_instrument"><code class="docutils literal notranslate"><span class="pre">InstrumentationEvents.class_instrument()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.InstrumentationEvents.class_uninstrument"><code class="docutils literal notranslate"><span class="pre">InstrumentationEvents.class_uninstrument()</span></code></a></li>
<li><a class="reference internal" href="#sqlalchemy.orm.InstrumentationEvents.dispatch"><code class="docutils literal notranslate"><span class="pre">InstrumentationEvents.dispatch</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=2d0eb83f"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=2f3e6152"></script>
    <script src="../_static/translations.js?v=beaddf03"></script>
    </body>
</html>