<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="索引" href="../genindex.html" /><link rel="search" title="搜索" href="../search.html" /><link rel="copyright" title="版权所有" href="../copyright.html" /><link rel="next" title="What’s new in SQLAlchemy 0.4?" href="migration_04.html" /><link rel="prev" title="What’s New in SQLAlchemy 0.6?" href="migration_06.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.08.06 -->
        <title>What’s new in SQLAlchemy 0.5? - SQLAlchemy 2.1 Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/changelog.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_paramlinks.css" />
    <link rel="stylesheet" type="text/css" href="../_static/docs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">SQLAlchemy 2.1 Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">SQLAlchemy 2.1 Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">概述</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorial/index.html">SQLAlchemy 统一教程</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of SQLAlchemy 统一教程</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/engine.html">建立连接 - Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/dbapi_transactions.html">使用事务和DBAPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/metadata.html">使用数据库元数据</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../tutorial/data.html">处理数据</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of 处理数据</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/data_insert.html">使用 INSERT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/data_select.html">使用 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/data_update.html">使用 UPDATE 和 DELETE 语句</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/orm_data_manipulation.html">使用 ORM 进行数据操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/orm_related_objects.html">使用 ORM 相关对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/further_reading.html">进一步阅读</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../orm/index.html">SQLAlchemy ORM</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of SQLAlchemy ORM</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../orm/quickstart.html">ORM 快速入门</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../orm/mapper_config.html">ORM 映射类配置</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of ORM 映射类配置</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../orm/mapping_styles.html">ORM 映射类概述</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../orm/declarative_mapping.html">使用声明式映射类</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of 使用声明式映射类</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../orm/declarative_styles.html">声明式映射风格</a></li>
<li class="toctree-l4"><a class="reference internal" href="../orm/declarative_tables.html">声明式的表配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="../orm/declarative_config.html">使用声明式映射器配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="../orm/declarative_mixins.html">使用 Mixins 组合映射层次结构</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../orm/dataclasses.html">与dataclass和attrs的集成</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/mapped_sql_expr.html">SQL 表达式作为映射属性</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/mapped_attributes.html">更改Attribute的行为</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/composites.html">复合列类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/inheritance.html">映射类继承层次结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/nonstandard_mappings.html">非传统映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/versioning.html">配置版本计数器</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/mapping_api.html">类映射 API</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../orm/scalar_mapping.html">映射 SQL 表达式</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of 映射 SQL 表达式</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../orm/mapping_columns.html">映射表格列</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../orm/relationships.html">关系配置</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of 关系配置</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../orm/basic_relationships.html">基本关系模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/self_referential.html">邻接表关系</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/join_conditions.html">配置关系连接方式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/large_collections.html">使用大型集合</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/collection_api.html">集合自定义和 API 详细信息</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/relationship_persistence.html">特殊关系的持久化模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/backref.html">使用旧版“backref”关系参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/relationship_api.html">关系 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../orm/queryguide/index.html">ORM 查询指南</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of ORM 查询指南</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/select.html">为 ORM 映射类编写 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/inheritance.html">为继承映射编写 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/dml.html">启用 ORM 的 INSERT、UPDATE 和 DELETE 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/columns.html">列加载选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/relationships.html">关系加载技术</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/api.html">用于查询的 ORM API 功能</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/query.html">旧式查询 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../orm/session.html">使用会话</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of 使用会话</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../orm/session_basics.html">会话基础知识</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/session_state_management.html">状态管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/cascades.html">级联</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/session_transaction.html">事务和连接管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/persistence_techniques.html">附加持久性技术</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/contextual.html">上下文/线程本地会话</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/session_events.html">使用事件跟踪查询、对象和会话更改</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/session_api.html">会话 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../orm/extending.html">事件和内部</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of 事件和内部</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../orm/events.html">ORM 事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/internals.html">ORM 内部</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/exceptions.html">ORM 异常</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../orm/extensions/index.html">ORM 扩展</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of ORM 扩展</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/asyncio.html">异步 I/O (asyncio)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/associationproxy.html">关联代理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/automap.html">自动映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/baked.html">烘焙查询</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/declarative/index.html">声明式扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/mutable.html">突变追踪</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/orderinglist.html">排序列表</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/horizontal_shard.html">水平分片</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/hybrid.html">混合属性</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/indexable.html">Indexable</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/instrumentation.html">替代类检测</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../orm/examples.html">核心和 ORM 示例</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../core/index.html">SQLAlchemy Core</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of SQLAlchemy Core</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/expression_api.html">SQL 语句和表达式 API</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of SQL 语句和表达式 API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/sqlelement.html">列元素和表达式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/operators.html">操作符参考</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/selectable.html">SELECT 和相关构造</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/dml.html">插入,更新,删除</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/functions.html">SQL 和 范型函数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/compiler.html">自定义 SQL 构造和编译扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/serializer.html">表达式序列化器扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/foundation.html">SQL 表达式语言基础构造</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/visitors.html">访问者和遍历实用程序</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/schema.html">Schema 定义语言</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of Schema 定义语言</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/metadata.html">使用元数据描述数据库</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/reflection.html">反映数据库对象</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/defaults.html">列 INSERT/UPDATE 默认值</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/constraints.html">定义约束和索引</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/ddl.html">自定义 DDL</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/types.html">SQL 数据类型对象</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of SQL 数据类型对象</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/type_basics.html">类型层次结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/custom_types.html">自定义类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/type_api.html">基本类型 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/engines_connections.html">Engine和Connection的使用</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of Engine和Connection的使用</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/engines.html">Engine 配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/connections.html">使用Engines和Connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/pooling.html">连接池</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/events.html">核心事件</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/api_basics.html">Core API 基础</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of Core API 基础</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/event.html">事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/inspection.html">运行时审查 API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/exceptions.html">Core 异常</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/internals.html">Core 内部</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../dialects/index.html">Dialects</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of Dialects</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../dialects/postgresql.html">PostgreSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dialects/mysql.html">MySQL 和 MariaDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dialects/sqlite.html">SQLite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dialects/oracle.html">Oracle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dialects/mssql.html">Microsoft SQL Server</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../faq/index.html">常见问题</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of 常见问题</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../faq/installation.html">安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/connections.html">连接 / 引擎</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/metadata_schema.html">元数据 / Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/sqlexpressions.html">SQL 表达式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/ormconfiguration.html">ORM 配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/performance.html">性能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/sessions.html">会话 / 查询</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/thirdparty.html">第三方包集成问题</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../errors.html">错误消息</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">变更和迁移</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of 变更和迁移</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="migration_21.html">SQLAlchemy 2.1 有什么新功能？</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_21.html">2.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_20.html">2.0 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_14.html">1.4 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_13.html">1.3 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_12.html">1.2 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_11.html">1.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_10.html">1.0 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_09.html">0.9 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_08.html">0.8 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_07.html">0.7 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_06.html">0.6 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_05.html">0.5 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_04.html">0.4 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_03.html">0.3 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_02.html">0.2 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_01.html">0.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_20.html">SQLAlchemy 2.0 - Major Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew_20.html">What’s New in SQLAlchemy 2.0?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_14.html">What’s New in SQLAlchemy 1.4?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_13.html">What’s New in SQLAlchemy 1.3?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_12.html">What’s New in SQLAlchemy 1.2?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_11.html">What’s New in SQLAlchemy 1.1?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_10.html">What’s New in SQLAlchemy 1.0?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_09.html">What’s New in SQLAlchemy 0.9?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_08.html">What’s New in SQLAlchemy 0.8?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_07.html">What’s New in SQLAlchemy 0.7?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_06.html">What’s New in SQLAlchemy 0.6?</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">What’s new in SQLAlchemy 0.5?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_04.html">What’s new in SQLAlchemy 0.4?</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="what-s-new-in-sqlalchemy-0-5">
<h1>What’s new in SQLAlchemy 0.5?<a class="headerlink" href="#what-s-new-in-sqlalchemy-0-5" title="Link to this heading">¶</a></h1>
<div class="admonition-about-this-document admonition">
<p class="admonition-title">About this Document</p>
<p>This document describes changes between SQLAlchemy version 0.4,
last released October 12, 2008, and SQLAlchemy version 0.5,
last released January 16, 2010.</p>
<p>Document date: August 4, 2009</p>
</div>
<p>This guide documents API changes which affect users
migrating their applications from the 0.4 series of
SQLAlchemy to 0.5.   It’s also recommended for those working
from  <a class="reference external" href="https://oreilly.com/catalog/9780596516147/">Essential SQLAlchemy</a>, which only
covers 0.4 and seems to even have some old 0.3isms in it.
Note that SQLAlchemy 0.5 removes many behaviors which were
deprecated throughout the span of the 0.4 series, and also
deprecates more behaviors specific to 0.4.</p>
<section id="major-documentation-changes">
<h2>Major Documentation Changes<a class="headerlink" href="#major-documentation-changes" title="Link to this heading">¶</a></h2>
<p>Some sections of the documentation have been completely
rewritten and can serve as an introduction to new ORM
features.  The <code class="docutils literal notranslate"><span class="pre">Query</span></code> and <code class="docutils literal notranslate"><span class="pre">Session</span></code> objects in
particular have some distinct differences in API and
behavior which fundamentally change many of the basic ways
things are done, particularly with regards to constructing
highly customized ORM queries and dealing with stale session
state, commits and rollbacks.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.sqlalchemy.org/docs/05/ormtutorial.html">ORM Tutorial</a></p></li>
<li><p><a class="reference external" href="https://www.sqlalchemy.org/docs/05/session.html">Session Documentation</a></p></li>
</ul>
</section>
<section id="deprecations-source">
<h2>Deprecations Source<a class="headerlink" href="#deprecations-source" title="Link to this heading">¶</a></h2>
<p>Another source of information is documented within a series
of unit tests illustrating up to date usages of some common
<code class="docutils literal notranslate"><span class="pre">Query</span></code> patterns; this file can be viewed at
[source:sqlalchemy/trunk/test/orm/test_deprecations.py].</p>
</section>
<section id="requirements-changes">
<h2>Requirements Changes<a class="headerlink" href="#requirements-changes" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Python 2.4 or higher is required.  The SQLAlchemy 0.4 line
is the last version with Python 2.3 support.</p></li>
</ul>
</section>
<section id="object-relational-mapping">
<h2>Object Relational Mapping<a class="headerlink" href="#object-relational-mapping" title="Link to this heading">¶</a></h2>
<ul>
<li><p><strong>Column level expressions within Query.</strong> - as detailed
in the <a class="reference external" href="https://www.sqlalchemy.org/docs/05/ormtutorial.html">tutorial</a>,
<code class="docutils literal notranslate"><span class="pre">Query</span></code> has the capability to create specific SELECT
statements, not just those against full rows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s2">&quot;numaddresses&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">Address</span>
<span class="p">)</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></pre></div>
</div>
<p>The tuples returned by any multi-column/entity query are
<em>named</em>’ tuples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="p">(</span>
    <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s2">&quot;numaddresses&quot;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Address</span><span class="p">)</span>
    <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="p">):</span>
    <span class="n">print</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">numaddresses</span><span class="p">)</span></pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Query</span></code> has a <code class="docutils literal notranslate"><span class="pre">statement</span></code> accessor, as well as a
<code class="docutils literal notranslate"><span class="pre">subquery()</span></code> method which allow <code class="docutils literal notranslate"><span class="pre">Query</span></code> to be used to
create more complex combinations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subq</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Keyword</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s2">&quot;keyword_id&quot;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Keyword</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">in_</span><span class="p">([</span><span class="s2">&quot;beans&quot;</span><span class="p">,</span> <span class="s2">&quot;carrots&quot;</span><span class="p">]))</span>
    <span class="o">.</span><span class="n">subquery</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">recipes</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Recipe</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
    <span class="n">exists</span><span class="p">()</span>
    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Recipe</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">recipe_keywords</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">recipe_id</span><span class="p">)</span>
    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">recipe_keywords</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">keyword_id</span> <span class="o">==</span> <span class="n">subq</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">keyword_id</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
</li>
<li><p><strong>Explicit ORM aliases are recommended for aliased joins</strong>
- The <code class="docutils literal notranslate"><span class="pre">aliased()</span></code> function produces an “alias” of a
class, which allows fine-grained control of aliases in
conjunction with ORM queries.  While a table-level alias
(i.e. <code class="docutils literal notranslate"><span class="pre">table.alias()</span></code>) is still usable, an ORM level
alias retains the semantics of the ORM mapped object which
is significant for inheritance mappings, options, and
other scenarios.  E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Friend</span> <span class="o">=</span> <span class="n">aliased</span><span class="p">(</span><span class="n">Person</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Person</span><span class="p">,</span> <span class="n">Friend</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">Friend</span><span class="p">,</span> <span class="n">Person</span><span class="o">.</span><span class="n">friends</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div>
</div>
</li>
<li><p><strong>query.join() greatly enhanced.</strong> - You can now specify
the target and ON clause for a join in multiple ways.   A
target class alone can be provided where SQLA will attempt
to form a join to it via foreign key in the same way as
<code class="docutils literal notranslate"><span class="pre">table.join(someothertable)</span></code>.  A target and an explicit
ON condition can be provided, where the ON condition can
be a <code class="docutils literal notranslate"><span class="pre">relation()</span></code> name, an actual class descriptor, or a
SQL expression.  Or the old way of just a <code class="docutils literal notranslate"><span class="pre">relation()</span></code>
name or class descriptor works too.   See the ORM tutorial
which has several examples.</p></li>
<li><p><strong>Declarative is recommended for applications which don’t
require (and don’t prefer) abstraction between tables and
mappers</strong> - The [/docs/05/reference/ext/declarative.html
Declarative] module, which is used to combine the
expression of <code class="docutils literal notranslate"><span class="pre">Table</span></code>, <code class="docutils literal notranslate"><span class="pre">mapper()</span></code>, and user defined
class objects together, is highly recommended as it
simplifies application configuration, ensures the “one
mapper per class” pattern, and allows the full range of
configuration available to distinct <code class="docutils literal notranslate"><span class="pre">mapper()</span></code> calls.
Separate <code class="docutils literal notranslate"><span class="pre">mapper()</span></code> and <code class="docutils literal notranslate"><span class="pre">Table</span></code> usage is now referred
to as “classical SQLAlchemy usage” and of course is freely
mixable with declarative.</p></li>
<li><p><strong>The .c. attribute has been removed</strong> from classes (i.e.
<code class="docutils literal notranslate"><span class="pre">MyClass.c.somecolumn</span></code>).  As is the case in 0.4, class-
level properties are usable as query elements, i.e.
<code class="docutils literal notranslate"><span class="pre">Class.c.propname</span></code> is now superseded by
<code class="docutils literal notranslate"><span class="pre">Class.propname</span></code>, and the <code class="docutils literal notranslate"><span class="pre">c</span></code> attribute continues to
remain on <code class="docutils literal notranslate"><span class="pre">Table</span></code> objects where they indicate the
namespace of <code class="docutils literal notranslate"><span class="pre">Column</span></code> objects present on the table.</p>
<p>To get at the Table for a mapped class (if you didn’t keep
it around already):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">class_mapper</span><span class="p">(</span><span class="n">someclass</span><span class="p">)</span><span class="o">.</span><span class="n">mapped_table</span></pre></div>
</div>
<p>Iterate through columns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="p">:</span>
    <span class="n">print</span><span class="p">(</span><span class="n">col</span><span class="p">)</span></pre></div>
</div>
<p>Work with a specific column:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">somecolumn</span></pre></div>
</div>
<p>The class-bound descriptors support the full set of Column
operators as well as the documented relation-oriented
operators like <code class="docutils literal notranslate"><span class="pre">has()</span></code>, <code class="docutils literal notranslate"><span class="pre">any()</span></code>, <code class="docutils literal notranslate"><span class="pre">contains()</span></code>, etc.</p>
<p>The reason for the hard removal of <code class="docutils literal notranslate"><span class="pre">.c.</span></code> is that in 0.5,
class-bound descriptors carry potentially different
meaning, as well as information regarding class mappings,
versus plain <code class="docutils literal notranslate"><span class="pre">Column</span></code> objects - and there are use cases
where you’d specifically want to use one or the other.
Generally, using class-bound descriptors invokes a set of
mapping/polymorphic aware translations, and using table-
bound columns does not.  In 0.4, these translations were
applied across the board to all expressions, but 0.5
differentiates completely between columns and mapped
descriptors, only applying translations to the latter.  So
in many cases, particularly when dealing with joined table
inheritance configurations as well as when using
<code class="docutils literal notranslate"><span class="pre">query(&lt;columns&gt;)</span></code>, <code class="docutils literal notranslate"><span class="pre">Class.propname</span></code> and
<code class="docutils literal notranslate"><span class="pre">table.c.colname</span></code> are not interchangeable.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">session.query(users.c.id,</span> <span class="pre">users.c.name)</span></code>
is different versus <code class="docutils literal notranslate"><span class="pre">session.query(User.id,</span> <span class="pre">User.name)</span></code>;
in the latter case, the <code class="docutils literal notranslate"><span class="pre">Query</span></code> is aware of the mapper
in use and further mapper-specific operations like
<code class="docutils literal notranslate"><span class="pre">query.join(&lt;propname&gt;)</span></code>, <code class="docutils literal notranslate"><span class="pre">query.with_parent()</span></code> etc.
may be used, but in the former case cannot.  Additionally,
in polymorphic inheritance scenarios, the class-bound
descriptors refer to the columns present in the
polymorphic selectable in use, not necessarily the table
column which directly corresponds to the descriptor.  For
example, a set of classes related by joined-table
inheritance to the <code class="docutils literal notranslate"><span class="pre">person</span></code> table along the
<code class="docutils literal notranslate"><span class="pre">person_id</span></code> column of each table will all have their
<code class="docutils literal notranslate"><span class="pre">Class.person_id</span></code> attribute mapped to the <code class="docutils literal notranslate"><span class="pre">person_id</span></code>
column in <code class="docutils literal notranslate"><span class="pre">person</span></code>, and not their subclass table.
Version 0.4 would map this behavior onto table-bound
<code class="docutils literal notranslate"><span class="pre">Column</span></code> objects automatically.  In 0.5, this automatic
conversion has been removed, so that you in fact <em>can</em> use
table-bound columns as a means to override the
translations which occur with polymorphic querying; this
allows <code class="docutils literal notranslate"><span class="pre">Query</span></code> to be able to create optimized selects
among joined-table or concrete-table inheritance setups,
as well as portable subqueries, etc.</p>
</li>
<li><p><strong>Session Now Synchronizes Automatically with
Transactions.</strong> Session now synchronizes against the
transaction automatically by default, including autoflush
and autoexpire.  A transaction is present at all times
unless disabled using the <code class="docutils literal notranslate"><span class="pre">autocommit</span></code> option.  When all
three flags are set to their default, the Session recovers
gracefully after rollbacks and it’s very difficult to get
stale data into the session.  See the new Session
documentation for details.</p></li>
<li><p><strong>Implicit Order By Is Removed</strong>.  This will impact ORM
users who rely upon SA’s “implicit ordering” behavior,
which states that all Query objects which don’t have an
<code class="docutils literal notranslate"><span class="pre">order_by()</span></code> will ORDER BY the “id” or “oid” column of
the primary mapped table, and all lazy/eagerly loaded
collections apply a similar ordering.   In 0.5, automatic
ordering must be explicitly configured on <code class="docutils literal notranslate"><span class="pre">mapper()</span></code> and
<code class="docutils literal notranslate"><span class="pre">relation()</span></code> objects (if desired), or otherwise when
using <code class="docutils literal notranslate"><span class="pre">Query</span></code>.</p>
<p>To convert an 0.4 mapping to 0.5, such that its ordering
behavior will be extremely similar to 0.4 or previous, use
the <code class="docutils literal notranslate"><span class="pre">order_by</span></code> setting on <code class="docutils literal notranslate"><span class="pre">mapper()</span></code> and
<code class="docutils literal notranslate"><span class="pre">relation()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mapper</span><span class="p">(</span>
    <span class="n">User</span><span class="p">,</span>
    <span class="n">users</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;addresses&quot;</span><span class="p">:</span> <span class="n">relation</span><span class="p">(</span><span class="n">Address</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="n">addresses</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)},</span>
    <span class="n">order_by</span><span class="o">=</span><span class="n">users</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<span class="p">)</span></pre></div>
</div>
<p>To set ordering on a backref, use the <code class="docutils literal notranslate"><span class="pre">backref()</span></code>
function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;keywords&quot;</span><span class="p">:</span> <span class="n">relation</span><span class="p">(</span>
    <span class="n">Keyword</span><span class="p">,</span>
    <span class="n">secondary</span><span class="o">=</span><span class="n">item_keywords</span><span class="p">,</span>
    <span class="n">order_by</span><span class="o">=</span><span class="n">keywords</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
    <span class="n">backref</span><span class="o">=</span><span class="n">backref</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="n">items</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
<span class="p">)</span></pre></div>
</div>
<p>Using declarative ?  To help with the new <code class="docutils literal notranslate"><span class="pre">order_by</span></code>
requirement, <code class="docutils literal notranslate"><span class="pre">order_by</span></code> and friends can now be set using
strings which are evaluated in Python later on (this works
<strong>only</strong> with declarative, not plain mappers):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="p">(</span><span class="n">MyDeclarativeBase</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="s2">&quot;addresses&quot;</span><span class="p">:</span> <span class="n">relation</span><span class="p">(</span><span class="s2">&quot;Address&quot;</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="s2">&quot;Address.id&quot;</span><span class="p">)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>It’s generally a good idea to set <code class="docutils literal notranslate"><span class="pre">order_by</span></code> on
<code class="docutils literal notranslate"><span class="pre">relation()s</span></code> which load list-based collections of
items, since that ordering cannot otherwise be affected.
Other than that, the best practice is to use
<code class="docutils literal notranslate"><span class="pre">Query.order_by()</span></code> to control ordering of the primary
entities being loaded.</p>
</li>
<li><p><strong>Session is now
autoflush=True/autoexpire=True/autocommit=False.</strong> - To
set it up, just call <code class="docutils literal notranslate"><span class="pre">sessionmaker()</span></code> with no arguments.
The name <code class="docutils literal notranslate"><span class="pre">transactional=True</span></code> is now
<code class="docutils literal notranslate"><span class="pre">autocommit=False</span></code>.  Flushes occur upon each query
issued (disable with <code class="docutils literal notranslate"><span class="pre">autoflush=False</span></code>), within each
<code class="docutils literal notranslate"><span class="pre">commit()</span></code> (as always), and before each
<code class="docutils literal notranslate"><span class="pre">begin_nested()</span></code> (so rolling back to the SAVEPOINT is
meaningful).   All objects are expired after each
<code class="docutils literal notranslate"><span class="pre">commit()</span></code> and after each <code class="docutils literal notranslate"><span class="pre">rollback()</span></code>.  After
rollback, pending objects are expunged, deleted objects
move back to persistent.  These defaults work together
very nicely and there’s really no more need for old
techniques like <code class="docutils literal notranslate"><span class="pre">clear()</span></code> (which is renamed to
<code class="docutils literal notranslate"><span class="pre">expunge_all()</span></code> as well).</p>
<p>P.S.:  sessions are now reusable after a <code class="docutils literal notranslate"><span class="pre">rollback()</span></code>.
Scalar and collection attribute changes, adds and deletes
are all rolled back.</p>
</li>
<li><p><strong>session.add() replaces session.save(), session.update(),
session.save_or_update().</strong> - the
<code class="docutils literal notranslate"><span class="pre">session.add(someitem)</span></code> and <code class="docutils literal notranslate"><span class="pre">session.add_all([list</span> <span class="pre">of</span>
<span class="pre">items])</span></code> methods replace <code class="docutils literal notranslate"><span class="pre">save()</span></code>, <code class="docutils literal notranslate"><span class="pre">update()</span></code>, and
<code class="docutils literal notranslate"><span class="pre">save_or_update()</span></code>.  Those methods will remain
deprecated throughout 0.5.</p></li>
<li><p><strong>backref configuration made less verbose.</strong> - The
<code class="docutils literal notranslate"><span class="pre">backref()</span></code> function now uses the <code class="docutils literal notranslate"><span class="pre">primaryjoin</span></code> and
<code class="docutils literal notranslate"><span class="pre">secondaryjoin</span></code> arguments of the forwards-facing
<code class="docutils literal notranslate"><span class="pre">relation()</span></code> when they are not explicitly stated.  It’s
no longer necessary to specify
<code class="docutils literal notranslate"><span class="pre">primaryjoin</span></code>/<code class="docutils literal notranslate"><span class="pre">secondaryjoin</span></code> in both directions
separately.</p></li>
<li><p><strong>Simplified polymorphic options.</strong> - The ORM’s
“polymorphic load” behavior has been simplified.  In 0.4,
mapper() had an argument called <code class="docutils literal notranslate"><span class="pre">polymorphic_fetch</span></code>
which could be configured as <code class="docutils literal notranslate"><span class="pre">select</span></code> or <code class="docutils literal notranslate"><span class="pre">deferred</span></code>.
This option is removed; the mapper will now just defer any
columns which were not present in the SELECT statement.
The actual SELECT statement used is controlled by the
<code class="docutils literal notranslate"><span class="pre">with_polymorphic</span></code> mapper argument (which is also in 0.4
and replaces <code class="docutils literal notranslate"><span class="pre">select_table</span></code>), as well as the
<code class="docutils literal notranslate"><span class="pre">with_polymorphic()</span></code> method on <code class="docutils literal notranslate"><span class="pre">Query</span></code> (also in 0.4).</p>
<p>An improvement to the deferred loading of inheriting
classes is that the mapper now produces the “optimized”
version of the SELECT statement in all cases; that is, if
class B inherits from A, and several attributes only
present on class B have been expired, the refresh
operation will only include B’s table in the SELECT
statement and will not JOIN to A.</p>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">execute()</span></code> method on <code class="docutils literal notranslate"><span class="pre">Session</span></code> converts plain
strings into <code class="docutils literal notranslate"><span class="pre">text()</span></code> constructs, so that bind
parameters may all be specified as “:bindname” without
needing to call <code class="docutils literal notranslate"><span class="pre">text()</span></code> explicitly.  If “raw” SQL is
desired here, use <code class="docutils literal notranslate"><span class="pre">session.connection().execute(&quot;raw</span>
<span class="pre">text&quot;)</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">session.Query().iterate_instances()</span></code> has been renamed
to just <code class="docutils literal notranslate"><span class="pre">instances()</span></code>. The old <code class="docutils literal notranslate"><span class="pre">instances()</span></code> method
returning a list instead of an iterator no longer exists.
If you were relying on that behavior, you should use
<code class="docutils literal notranslate"><span class="pre">list(your_query.instances())</span></code>.</p></li>
</ul>
</section>
<section id="extending-the-orm">
<h2>Extending the ORM<a class="headerlink" href="#extending-the-orm" title="Link to this heading">¶</a></h2>
<p>In 0.5 we’re moving forward with more ways to modify and
extend the ORM.  Heres a summary:</p>
<ul class="simple">
<li><p><strong>MapperExtension.</strong> - This is the classic extension
class, which remains.   Methods which should rarely be
needed are <code class="docutils literal notranslate"><span class="pre">create_instance()</span></code> and
<code class="docutils literal notranslate"><span class="pre">populate_instance()</span></code>.  To control the initialization of
an object when it’s loaded from the database, use the
<code class="docutils literal notranslate"><span class="pre">reconstruct_instance()</span></code> method, or more easily the
<code class="docutils literal notranslate"><span class="pre">&#64;reconstructor</span></code> decorator described in the
documentation.</p></li>
<li><p><strong>SessionExtension.</strong> - This is an easy to use extension
class for session events.  In particular, it provides
<code class="docutils literal notranslate"><span class="pre">before_flush()</span></code>, <code class="docutils literal notranslate"><span class="pre">after_flush()</span></code> and
<code class="docutils literal notranslate"><span class="pre">after_flush_postexec()</span></code> methods.  This usage is
recommended over <code class="docutils literal notranslate"><span class="pre">MapperExtension.before_XXX</span></code> in many
cases since within <code class="docutils literal notranslate"><span class="pre">before_flush()</span></code> you can modify the
flush plan of the session freely, something which cannot
be done from within <code class="docutils literal notranslate"><span class="pre">MapperExtension</span></code>.</p></li>
<li><p><strong>AttributeExtension.</strong> - This class is now part of the
public API, and allows the interception of userland events
on attributes, including attribute set and delete
operations, and collection appends and removes.  It also
allows the value to be set or appended to be modified.
The <code class="docutils literal notranslate"><span class="pre">&#64;validates</span></code> decorator, described in the
documentation, provides a quick way to mark any mapped
attributes as being “validated” by a particular class
method.</p></li>
<li><p><strong>Attribute Instrumentation Customization.</strong> - An API is
provided for ambitious efforts to entirely replace
SQLAlchemy’s attribute instrumentation, or just to augment
it in some cases.  This API was produced for the purposes
of the Trellis toolkit, but is available as a public API.
Some examples are provided in the distribution in the
<code class="docutils literal notranslate"><span class="pre">/examples/custom_attributes</span></code> directory.</p></li>
</ul>
</section>
<section id="schema-types">
<h2>Schema/Types<a class="headerlink" href="#schema-types" title="Link to this heading">¶</a></h2>
<ul>
<li><p><strong>String with no length no longer generates TEXT, it
generates VARCHAR</strong> - The <code class="docutils literal notranslate"><span class="pre">String</span></code> type no longer
magically converts into a <code class="docutils literal notranslate"><span class="pre">Text</span></code> type when specified
with no length.  This only has an effect when CREATE TABLE
is issued, as it will issue <code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code> with no length
parameter, which is not valid on many (but not all)
databases.  To create a TEXT (or CLOB, i.e. unbounded
string) column, use the <code class="docutils literal notranslate"><span class="pre">Text</span></code> type.</p></li>
<li><p><strong>PickleType() with mutable=True requires an __eq__()
method</strong> - The <code class="docutils literal notranslate"><span class="pre">PickleType</span></code> type needs to compare values
when mutable=True.  The method of comparing
<code class="docutils literal notranslate"><span class="pre">pickle.dumps()</span></code> is inefficient and unreliable.  If an
incoming object does not implement <code class="docutils literal notranslate"><span class="pre">__eq__()</span></code> and is
also not <code class="docutils literal notranslate"><span class="pre">None</span></code>, the <code class="docutils literal notranslate"><span class="pre">dumps()</span></code> comparison is used but
a warning is raised.  For types which implement
<code class="docutils literal notranslate"><span class="pre">__eq__()</span></code> which includes all dictionaries, lists, etc.,
comparison will use <code class="docutils literal notranslate"><span class="pre">==</span></code> and is now reliable by default.</p></li>
<li><p><strong>convert_bind_param() and convert_result_value() methods
of TypeEngine/TypeDecorator are removed.</strong> - The O’Reilly
book unfortunately documented these methods even though
they were deprecated post 0.3.   For a user-defined type
which subclasses <code class="docutils literal notranslate"><span class="pre">TypeEngine</span></code>, the <code class="docutils literal notranslate"><span class="pre">bind_processor()</span></code>
and <code class="docutils literal notranslate"><span class="pre">result_processor()</span></code> methods should be used for
bind/result processing.  Any user defined type, whether
extending <code class="docutils literal notranslate"><span class="pre">TypeEngine</span></code> or <code class="docutils literal notranslate"><span class="pre">TypeDecorator</span></code>, which uses
the old 0.3 style can be easily adapted to the new style
using the following adapter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">AdaptOldConvertMethods</span><span class="p">(</span><span class="n">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A mixin which adapts 0.3-style convert_bind_param and</span>
<span class="sd">    convert_result_value methods</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bind_processor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">convert</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_bind_param</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">convert</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">result_processor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">convert</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_result_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">convert</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert_result_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert_bind_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>To use the above mixin:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyType</span><span class="p">(</span><span class="n">AdaptOldConvertMethods</span><span class="p">,</span> <span class="n">TypeEngine</span><span class="p">):</span> <span class="o">...</span></pre><div class="code-non-annotations-key"></div></div>
</div>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">quote</span></code> flag on <code class="docutils literal notranslate"><span class="pre">Column</span></code> and <code class="docutils literal notranslate"><span class="pre">Table</span></code> as well as
the <code class="docutils literal notranslate"><span class="pre">quote_schema</span></code> flag on <code class="docutils literal notranslate"><span class="pre">Table</span></code> now control quoting
both positively and negatively.  The default is <code class="docutils literal notranslate"><span class="pre">None</span></code>,
meaning let regular quoting rules take effect. When
<code class="docutils literal notranslate"><span class="pre">True</span></code>, quoting is forced on.  When <code class="docutils literal notranslate"><span class="pre">False</span></code>, quoting
is forced off.</p></li>
<li><p>Column <code class="docutils literal notranslate"><span class="pre">DEFAULT</span></code> value DDL can now be more conveniently
specified with <code class="docutils literal notranslate"><span class="pre">Column(...,</span> <span class="pre">server_default='val')</span></code>,
deprecating <code class="docutils literal notranslate"><span class="pre">Column(...,</span> <span class="pre">PassiveDefault('val'))</span></code>.
<code class="docutils literal notranslate"><span class="pre">default=</span></code> is now exclusively for Python-initiated
default values, and can coexist with server_default.  A
new <code class="docutils literal notranslate"><span class="pre">server_default=FetchedValue()</span></code> replaces the
<code class="docutils literal notranslate"><span class="pre">PassiveDefault('')</span></code> idiom for marking columns as
subject to influence from external triggers and has no DDL
side effects.</p></li>
<li><p>SQLite’s <code class="docutils literal notranslate"><span class="pre">DateTime</span></code>, <code class="docutils literal notranslate"><span class="pre">Time</span></code> and <code class="docutils literal notranslate"><span class="pre">Date</span></code> types now
<strong>only accept datetime objects, not strings</strong> as bind
parameter input.  If you’d like to create your own
“hybrid” type which accepts strings and returns results as
date objects (from whatever format you’d like), create a
<code class="docutils literal notranslate"><span class="pre">TypeDecorator</span></code> that builds on <code class="docutils literal notranslate"><span class="pre">String</span></code>.  If you only
want string-based dates, just use <code class="docutils literal notranslate"><span class="pre">String</span></code>.</p></li>
<li><p>Additionally, the <code class="docutils literal notranslate"><span class="pre">DateTime</span></code> and <code class="docutils literal notranslate"><span class="pre">Time</span></code> types, when
used with SQLite, now represent the “microseconds” field
of the Python <code class="docutils literal notranslate"><span class="pre">datetime.datetime</span></code> object in the same
manner as <code class="docutils literal notranslate"><span class="pre">str(datetime)</span></code> - as fractional seconds, not a
count of microseconds.  That is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">125</span><span class="p">)</span>  <span class="c1"># 125 usec</span>

<span class="c1"># old way</span>
<span class="s2">&quot;2008-06-27 12:00:00.125&quot;</span>

<span class="c1"># new way</span>
<span class="s2">&quot;2008-06-27 12:00:00.000125&quot;</span></pre></div>
</div>
<p>So if an existing SQLite file-based database intends to be
used across 0.4 and 0.5, you either have to upgrade the
datetime columns to store the new format (NOTE: please
test this, I’m pretty sure its correct):</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">mytable</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">somedatecol</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="n">substr</span><span class="p">(</span><span class="n">somedatecol</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">substr</span><span class="p">((</span><span class="n">substr</span><span class="p">(</span><span class="n">somedatecol</span><span class="p">,</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000000</span><span class="p">),</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">);</span></pre></div>
</div>
<p>or, enable “legacy” mode as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.databases.sqlite</span><span class="w"> </span><span class="kn">import</span> <span class="n">DateTimeMixin</span>

<span class="n">DateTimeMixin</span><span class="o">.</span><span class="n">__legacy_microseconds__</span> <span class="o">=</span> <span class="kc">True</span></pre></div>
</div>
</li>
</ul>
</section>
<section id="connection-pool-no-longer-threadlocal-by-default">
<h2>Connection Pool no longer threadlocal by default<a class="headerlink" href="#connection-pool-no-longer-threadlocal-by-default" title="Link to this heading">¶</a></h2>
<p>0.4 has an unfortunate default setting of
“pool_threadlocal=True”, leading to surprise behavior when,
for example, using multiple Sessions within a single thread.
This flag is now off in 0.5.   To re-enable 0.4’s behavior,
specify <code class="docutils literal notranslate"><span class="pre">pool_threadlocal=True</span></code> to <code class="docutils literal notranslate"><span class="pre">create_engine()</span></code>, or
alternatively use the “threadlocal” strategy via
<code class="docutils literal notranslate"><span class="pre">strategy=&quot;threadlocal&quot;</span></code>.</p>
</section>
<section id="args-accepted-args-no-longer-accepted">
<h2>*args Accepted, *args No Longer Accepted<a class="headerlink" href="#args-accepted-args-no-longer-accepted" title="Link to this heading">¶</a></h2>
<p>The policy with <code class="docutils literal notranslate"><span class="pre">method(\*args)</span></code> vs. <code class="docutils literal notranslate"><span class="pre">method([args])</span></code>
is, if the method accepts a variable-length set of items
which represent a fixed structure, it takes <code class="docutils literal notranslate"><span class="pre">\*args</span></code>.  If
the method accepts a variable-length set of items that are
data-driven, it takes <code class="docutils literal notranslate"><span class="pre">[args]</span></code>.</p>
<ul>
<li><p>The various Query.options() functions <code class="docutils literal notranslate"><span class="pre">eagerload()</span></code>,
<code class="docutils literal notranslate"><span class="pre">eagerload_all()</span></code>, <code class="docutils literal notranslate"><span class="pre">lazyload()</span></code>, <code class="docutils literal notranslate"><span class="pre">contains_eager()</span></code>,
<code class="docutils literal notranslate"><span class="pre">defer()</span></code>, <code class="docutils literal notranslate"><span class="pre">undefer()</span></code> all accept variable-length
<code class="docutils literal notranslate"><span class="pre">\*keys</span></code> as their argument now, which allows a path to
be formulated using descriptors, ie.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">eagerload_all</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">orders</span><span class="p">,</span> <span class="n">Order</span><span class="o">.</span><span class="n">items</span><span class="p">,</span> <span class="n">Item</span><span class="o">.</span><span class="n">keywords</span><span class="p">))</span></pre></div>
</div>
<p>A single array argument is still accepted for backwards
compatibility.</p>
</li>
<li><p>Similarly, the <code class="docutils literal notranslate"><span class="pre">Query.join()</span></code> and <code class="docutils literal notranslate"><span class="pre">Query.outerjoin()</span></code>
methods accept a variable length *args, with a single
array accepted for backwards compatibility:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;orders&quot;</span><span class="p">,</span> <span class="s2">&quot;items&quot;</span><span class="p">)</span>
<span class="n">query</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">orders</span><span class="p">,</span> <span class="n">Order</span><span class="o">.</span><span class="n">items</span><span class="p">)</span></pre></div>
</div>
</li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">in_()</span></code> method on columns and similar only accepts a
list argument now.  It no longer accepts <code class="docutils literal notranslate"><span class="pre">\*args</span></code>.</p></li>
</ul>
</section>
<section id="removed">
<h2>Removed<a class="headerlink" href="#removed" title="Link to this heading">¶</a></h2>
<ul>
<li><p><strong>entity_name</strong> - This feature was always problematic and
rarely used.  0.5’s more deeply fleshed out use cases
revealed further issues with <code class="docutils literal notranslate"><span class="pre">entity_name</span></code> which led to
its removal.  If different mappings are required for a
single class, break the class into separate subclasses and
map them separately.  An example of this is at
[wiki:UsageRecipes/EntityName].  More information
regarding rationale is described at https://groups.google.c
om/group/sqlalchemy/browse_thread/thread/9e23a0641a88b96d?
hl=en .</p></li>
<li><p><strong>get()/load() cleanup</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">load()</span></code> method has been removed.  Its
functionality was kind of arbitrary and basically copied
from Hibernate, where it’s also not a particularly
meaningful method.</p>
<p>To get equivalent functionality:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">)</span><span class="o">.</span><span class="n">populate_existing</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span></pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Session.get(cls,</span> <span class="pre">id)</span></code> and <code class="docutils literal notranslate"><span class="pre">Session.load(cls,</span> <span class="pre">id)</span></code>
have been removed.  <code class="docutils literal notranslate"><span class="pre">Session.get()</span></code> is redundant vs.
<code class="docutils literal notranslate"><span class="pre">session.query(cls).get(id)</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">MapperExtension.get()</span></code> is also removed (as is
<code class="docutils literal notranslate"><span class="pre">MapperExtension.load()</span></code>).  To override the
functionality of <code class="docutils literal notranslate"><span class="pre">Query.get()</span></code>, use a subclass:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyQuery</span><span class="p">(</span><span class="n">Query</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ident</span><span class="p">):</span> <span class="o">...</span>


<span class="n">session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">query_cls</span><span class="o">=</span><span class="n">MyQuery</span><span class="p">)()</span>

<span class="n">ad1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Address</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.relation()</span></code></p>
<p>The following deprecated keyword arguments have been
removed:</p>
<p>foreignkey, association, private, attributeext, is_backref</p>
<p>In particular, <code class="docutils literal notranslate"><span class="pre">attributeext</span></code> is replaced with
<code class="docutils literal notranslate"><span class="pre">extension</span></code> - the <code class="docutils literal notranslate"><span class="pre">AttributeExtension</span></code> class is now in
the public API.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">session.Query()</span></code></p>
<p>The following deprecated functions have been removed:</p>
<p>list, scalar, count_by, select_whereclause, get_by,
select_by, join_by, selectfirst, selectone, select,
execute, select_statement, select_text, join_to, join_via,
selectfirst_by, selectone_by, apply_max, apply_min,
apply_avg, apply_sum</p>
<p>Additionally, the <code class="docutils literal notranslate"><span class="pre">id</span></code> keyword argument to <code class="docutils literal notranslate"><span class="pre">join()</span></code>,
<code class="docutils literal notranslate"><span class="pre">outerjoin()</span></code>, <code class="docutils literal notranslate"><span class="pre">add_entity()</span></code> and <code class="docutils literal notranslate"><span class="pre">add_column()</span></code> has
been removed.  To target table aliases in <code class="docutils literal notranslate"><span class="pre">Query</span></code> to
result columns, use the <code class="docutils literal notranslate"><span class="pre">aliased</span></code> construct:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">aliased</span>

<span class="n">address_alias</span> <span class="o">=</span> <span class="n">aliased</span><span class="p">(</span><span class="n">Address</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">address_alias</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">address_alias</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">())</span></pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.Mapper</span></code></p>
<ul class="simple">
<li><p>instances()</p></li>
<li><p>get_session() - this method was not very noticeable, but
had the effect of associating lazy loads with a
particular session even if the parent object was
entirely detached, when an extension such as
<code class="docutils literal notranslate"><span class="pre">scoped_session()</span></code> or the old <code class="docutils literal notranslate"><span class="pre">SessionContextExt</span></code>
was used.  It’s possible that some applications which
relied upon this behavior will no longer work as
expected;  but the better programming practice here is
to always ensure objects are present within sessions if
database access from their attributes are required.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">mapper(MyClass,</span> <span class="pre">mytable)</span></code></p>
<p>Mapped classes no are longer instrumented with a “c” class
attribute; e.g. <code class="docutils literal notranslate"><span class="pre">MyClass.c</span></code></p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.collections</span></code></p>
<p>The _prepare_instrumentation alias for
prepare_instrumentation has been removed.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm</span></code></p>
<p>Removed the <code class="docutils literal notranslate"><span class="pre">EXT_PASS</span></code> alias of <code class="docutils literal notranslate"><span class="pre">EXT_CONTINUE</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlalchemy.engine</span></code></p>
<p>The alias from <code class="docutils literal notranslate"><span class="pre">DefaultDialect.preexecute_sequences</span></code> to
<code class="docutils literal notranslate"><span class="pre">.preexecute_pk_sequences</span></code> has been removed.</p>
<p>The deprecated engine_descriptors() function has been
removed.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlalchemy.ext.activemapper</span></code></p>
<p>Module removed.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlalchemy.ext.assignmapper</span></code></p>
<p>Module removed.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlalchemy.ext.associationproxy</span></code></p>
<p>Pass-through of keyword args on the proxy’s
<code class="docutils literal notranslate"><span class="pre">.append(item,</span> <span class="pre">\**kw)</span></code> has been removed and is now
simply <code class="docutils literal notranslate"><span class="pre">.append(item)</span></code></p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlalchemy.ext.selectresults</span></code>,
<code class="docutils literal notranslate"><span class="pre">sqlalchemy.mods.selectresults</span></code></p>
<p>Modules removed.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlalchemy.ext.declarative</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">declared_synonym()</span></code> removed.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlalchemy.ext.sessioncontext</span></code></p>
<p>Module removed.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlalchemy.log</span></code></p>
<p>The <code class="docutils literal notranslate"><span class="pre">SADeprecationWarning</span></code> alias to
<code class="docutils literal notranslate"><span class="pre">sqlalchemy.exc.SADeprecationWarning</span></code> has been removed.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlalchemy.exc</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">exc.AssertionError</span></code> has been removed and usage replaced
by the Python built-in of the same name.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlalchemy.databases.mysql</span></code></p>
<p>The deprecated <code class="docutils literal notranslate"><span class="pre">get_version_info</span></code> dialect method has
been removed.</p>
</li>
</ul>
</section>
<section id="renamed-or-moved">
<h2>Renamed or Moved<a class="headerlink" href="#renamed-or-moved" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlalchemy.exceptions</span></code> is now <code class="docutils literal notranslate"><span class="pre">sqlalchemy.exc</span></code></p>
<p>The module may still be imported under the old name until
0.6.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">FlushError</span></code>, <code class="docutils literal notranslate"><span class="pre">ConcurrentModificationError</span></code>,
<code class="docutils literal notranslate"><span class="pre">UnmappedColumnError</span></code> -&gt; sqlalchemy.orm.exc</p>
<p>These exceptions moved to the orm package.  Importing
‘sqlalchemy.orm’ will install aliases in sqlalchemy.exc
for compatibility until 0.6.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlalchemy.logging</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">sqlalchemy.log</span></code></p>
<p>This internal module was renamed.  No longer needs to be
special cased when packaging SA with py2app and similar
tools that scan imports.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">session.Query().iterate_instances()</span></code> -&gt;
<code class="docutils literal notranslate"><span class="pre">session.Query().instances()</span></code>.</p></li>
</ul>
</section>
<section id="deprecated">
<h2>Deprecated<a class="headerlink" href="#deprecated" title="Link to this heading">¶</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Session.save()</span></code>, <code class="docutils literal notranslate"><span class="pre">Session.update()</span></code>,
<code class="docutils literal notranslate"><span class="pre">Session.save_or_update()</span></code></p>
<p>All three replaced by <code class="docutils literal notranslate"><span class="pre">Session.add()</span></code></p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlalchemy.PassiveDefault</span></code></p>
<p>Use <code class="docutils literal notranslate"><span class="pre">Column(server_default=...)</span></code> Translates to
sqlalchemy.DefaultClause() under the hood.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">session.Query().iterate_instances()</span></code>. It has been
renamed to <code class="docutils literal notranslate"><span class="pre">instances()</span></code>.</p></li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="migration_04.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">What’s new in SQLAlchemy 0.4?</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="migration_06.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">What’s New in SQLAlchemy 0.6?</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                <a href="../copyright.html">Copyright</a> &#169; 2007-2025, the SQLAlchemy authors and contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on 04/05/2025 04:00:26</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">What’s new in SQLAlchemy 0.5?</a><ul>
<li><a class="reference internal" href="#major-documentation-changes">Major Documentation Changes</a></li>
<li><a class="reference internal" href="#deprecations-source">Deprecations Source</a></li>
<li><a class="reference internal" href="#requirements-changes">Requirements Changes</a></li>
<li><a class="reference internal" href="#object-relational-mapping">Object Relational Mapping</a></li>
<li><a class="reference internal" href="#extending-the-orm">Extending the ORM</a></li>
<li><a class="reference internal" href="#schema-types">Schema/Types</a></li>
<li><a class="reference internal" href="#connection-pool-no-longer-threadlocal-by-default">Connection Pool no longer threadlocal by default</a></li>
<li><a class="reference internal" href="#args-accepted-args-no-longer-accepted">*args Accepted, *args No Longer Accepted</a></li>
<li><a class="reference internal" href="#removed">Removed</a></li>
<li><a class="reference internal" href="#renamed-or-moved">Renamed or Moved</a></li>
<li><a class="reference internal" href="#deprecated">Deprecated</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=2d0eb83f"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=2f3e6152"></script>
    <script src="../_static/translations.js?v=beaddf03"></script>
    </body>
</html>