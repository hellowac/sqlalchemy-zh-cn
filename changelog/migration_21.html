<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="索引" href="../genindex.html" /><link rel="search" title="搜索" href="../search.html" /><link rel="copyright" title="版权所有" href="../copyright.html" /><link rel="next" title="2.1 Changelog" href="changelog_21.html" /><link rel="prev" title="变更和迁移" href="index.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.08.06 -->
        <title>SQLAlchemy 2.1 有什么新功能？ - SQLAlchemy 2.1 Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/changelog.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_paramlinks.css" />
    <link rel="stylesheet" type="text/css" href="../_static/docs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">SQLAlchemy 2.1 Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">SQLAlchemy 2.1 Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">概述</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorial/index.html">SQLAlchemy 统一教程</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of SQLAlchemy 统一教程</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/engine.html">建立连接 - Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/dbapi_transactions.html">使用事务和DBAPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/metadata.html">使用数据库元数据</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../tutorial/data.html">处理数据</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of 处理数据</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/data_insert.html">使用 INSERT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/data_select.html">使用 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/data_update.html">使用 UPDATE 和 DELETE 语句</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/orm_data_manipulation.html">使用 ORM 进行数据操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/orm_related_objects.html">使用 ORM 相关对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/further_reading.html">进一步阅读</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../orm/index.html">SQLAlchemy ORM</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of SQLAlchemy ORM</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../orm/quickstart.html">ORM 快速入门</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../orm/mapper_config.html">ORM 映射类配置</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of ORM 映射类配置</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../orm/mapping_styles.html">ORM 映射类概述</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../orm/declarative_mapping.html">使用声明式映射类</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of 使用声明式映射类</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../orm/declarative_styles.html">声明式映射风格</a></li>
<li class="toctree-l4"><a class="reference internal" href="../orm/declarative_tables.html">声明式的表配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="../orm/declarative_config.html">使用声明式映射器配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="../orm/declarative_mixins.html">使用 Mixins 组合映射层次结构</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../orm/dataclasses.html">与dataclass和attrs的集成</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/mapped_sql_expr.html">SQL 表达式作为映射属性</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/mapped_attributes.html">更改Attribute的行为</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/composites.html">复合列类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/inheritance.html">映射类继承层次结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/nonstandard_mappings.html">非传统映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/versioning.html">配置版本计数器</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/mapping_api.html">类映射 API</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../orm/scalar_mapping.html">映射 SQL 表达式</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of 映射 SQL 表达式</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../orm/mapping_columns.html">映射表格列</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../orm/relationships.html">关系配置</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of 关系配置</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../orm/basic_relationships.html">基本关系模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/self_referential.html">邻接表关系</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/join_conditions.html">配置关系连接方式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/large_collections.html">使用大型集合</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/collection_api.html">集合自定义和 API 详细信息</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/relationship_persistence.html">特殊关系的持久化模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/backref.html">使用旧版“backref”关系参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/relationship_api.html">关系 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../orm/queryguide/index.html">ORM 查询指南</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of ORM 查询指南</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/select.html">为 ORM 映射类编写 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/inheritance.html">为继承映射编写 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/dml.html">启用 ORM 的 INSERT、UPDATE 和 DELETE 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/columns.html">列加载选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/relationships.html">关系加载技术</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/api.html">用于查询的 ORM API 功能</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/queryguide/query.html">旧式查询 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../orm/session.html">使用会话</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of 使用会话</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../orm/session_basics.html">会话基础知识</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/session_state_management.html">状态管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/cascades.html">级联</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/session_transaction.html">事务和连接管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/persistence_techniques.html">附加持久性技术</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/contextual.html">上下文/线程本地会话</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/session_events.html">使用事件跟踪查询、对象和会话更改</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/session_api.html">会话 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../orm/extending.html">事件和内部</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of 事件和内部</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../orm/events.html">ORM 事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/internals.html">ORM 内部</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/exceptions.html">ORM 异常</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../orm/extensions/index.html">ORM 扩展</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of ORM 扩展</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/asyncio.html">异步 I/O (asyncio)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/associationproxy.html">关联代理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/automap.html">自动映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/baked.html">烘焙查询</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/declarative/index.html">声明式扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/mutable.html">突变追踪</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/orderinglist.html">排序列表</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/horizontal_shard.html">水平分片</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/hybrid.html">混合属性</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/indexable.html">Indexable</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orm/extensions/instrumentation.html">替代类检测</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../orm/examples.html">核心和 ORM 示例</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../core/index.html">SQLAlchemy Core</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of SQLAlchemy Core</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/expression_api.html">SQL 语句和表达式 API</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of SQL 语句和表达式 API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/sqlelement.html">列元素和表达式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/operators.html">操作符参考</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/selectable.html">SELECT 和相关构造</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/dml.html">插入,更新,删除</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/functions.html">SQL 和 范型函数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/compiler.html">自定义 SQL 构造和编译扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/serializer.html">表达式序列化器扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/foundation.html">SQL 表达式语言基础构造</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/visitors.html">访问者和遍历实用程序</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/schema.html">Schema 定义语言</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of Schema 定义语言</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/metadata.html">使用元数据描述数据库</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/reflection.html">反映数据库对象</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/defaults.html">列 INSERT/UPDATE 默认值</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/constraints.html">定义约束和索引</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/ddl.html">自定义 DDL</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/types.html">SQL 数据类型对象</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of SQL 数据类型对象</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/type_basics.html">类型层次结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/custom_types.html">自定义类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/type_api.html">基本类型 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/engines_connections.html">Engine和Connection的使用</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of Engine和Connection的使用</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/engines.html">Engine 配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/connections.html">使用Engines和Connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/pooling.html">连接池</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/events.html">核心事件</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../core/api_basics.html">Core API 基础</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of Core API 基础</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../core/event.html">事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/inspection.html">运行时审查 API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/exceptions.html">Core 异常</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core/internals.html">Core 内部</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../dialects/index.html">Dialects</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of Dialects</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../dialects/postgresql.html">PostgreSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dialects/mysql.html">MySQL 和 MariaDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dialects/sqlite.html">SQLite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dialects/oracle.html">Oracle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dialects/mssql.html">Microsoft SQL Server</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../faq/index.html">常见问题</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of 常见问题</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../faq/installation.html">安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/connections.html">连接 / 引擎</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/metadata_schema.html">元数据 / Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/sqlexpressions.html">SQL 表达式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/ormconfiguration.html">ORM 配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/performance.html">性能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/sessions.html">会话 / 查询</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/thirdparty.html">第三方包集成问题</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../errors.html">错误消息</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">变更和迁移</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of 变更和迁移</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">SQLAlchemy 2.1 有什么新功能？</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_21.html">2.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_20.html">2.0 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_14.html">1.4 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_13.html">1.3 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_12.html">1.2 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_11.html">1.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_10.html">1.0 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_09.html">0.9 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_08.html">0.8 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_07.html">0.7 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_06.html">0.6 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_05.html">0.5 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_04.html">0.4 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_03.html">0.3 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_02.html">0.2 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog_01.html">0.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_20.html">SQLAlchemy 2.0 - Major Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew_20.html">What’s New in SQLAlchemy 2.0?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_14.html">What’s New in SQLAlchemy 1.4?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_13.html">What’s New in SQLAlchemy 1.3?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_12.html">What’s New in SQLAlchemy 1.2?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_11.html">What’s New in SQLAlchemy 1.1?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_10.html">What’s New in SQLAlchemy 1.0?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_09.html">What’s New in SQLAlchemy 0.9?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_08.html">What’s New in SQLAlchemy 0.8?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_07.html">What’s New in SQLAlchemy 0.7?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_06.html">What’s New in SQLAlchemy 0.6?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_05.html">What’s new in SQLAlchemy 0.5?</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_04.html">What’s new in SQLAlchemy 0.4?</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="sqlalchemy-2-1">
<span id="whatsnew-21-toplevel"></span><h1>SQLAlchemy 2.1 有什么新功能？<a class="headerlink" href="#sqlalchemy-2-1" title="Link to this heading">¶</a></h1>
<p>What’s New in SQLAlchemy 2.1?</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">中文</label><div class="tab-content docutils container">
<div class="admonition- admonition">
<p class="admonition-title">关于此文档</p>
<p>本文档描述了 SQLAlchemy 2.0 版和 2.1 版之间的变化。</p>
</div>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">英文</label><div class="tab-content docutils container">
<div class="admonition-about-this-document admonition">
<p class="admonition-title">About this Document</p>
<p>This document describes changes between SQLAlchemy version 2.0 and
version 2.1.</p>
</div>
</div>
</div>
<section id="row-tuple">
<span id="change-10635"></span><h2><code class="docutils literal notranslate"><span class="pre">Row</span></code> 现在直接表示单个列类型，无需 <code class="docutils literal notranslate"><span class="pre">Tuple</span></code><a class="headerlink" href="#row-tuple" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Row</span></code> now represents individual column types directly without <code class="docutils literal notranslate"><span class="pre">Tuple</span></code></p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--1-input--1" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--1">中文</label><div class="tab-content docutils container">
<p>SQLAlchemy 2.0 在所有组件中实现了广泛的 <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a> 类型，包括新的功能，即行返回语句（如 <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a>）能够跟踪各个列的类型，然后将其传递到执行阶段，再传递到 <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> 对象，然后传递到各个 <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> 对象。在 <a class="reference internal" href="whatsnew_20.html#change-result-typing-20"><span class="std std-ref">SQL Expression / Statement / Result Set Typing</span></a> 中描述，这种方法解决了语句 / 行类型的几个问题，但有些问题仍然无法解决。在 2.1 中，其中一个问题，即各个列类型需要打包成一个 <code class="docutils literal notranslate"><span class="pre">typing.Tuple</span></code>，现在通过新的 <span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0646/"><strong>PEP 646</strong></a> 集成解决了，这允许类似元组的类型实际上不被类型化为 <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p>在 SQLAlchemy 2.0 中，类似于以下的语句:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">String</span><span class="p">))</span></pre></div>
</div>
<p>将被类型化为:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Select</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">int</span><span class="p">,</span> <span class="n">str</span><span class="p">]]</span></pre></div>
</div>
<p>在 2.1 中，现在被类型化为:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Select</span><span class="p">[</span><span class="n">int</span><span class="p">,</span> <span class="n">str</span><span class="p">]</span></pre></div>
</div>
<p>执行 <code class="docutils literal notranslate"><span class="pre">stmt</span></code> 时，<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> 和 <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> 对象将分别被类型化为 <code class="docutils literal notranslate"><span class="pre">Result[int,</span> <span class="pre">str]</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Row[int,</span> <span class="pre">str]</span></code>。不再需要使用 <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row._t" title="sqlalchemy.engine.Row._t"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Row._t</span></code></a> 将其类型化为真正的 <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>，项目可以迁移离开这种模式。</p>
<p>Mypy 用户需要使用 <strong>Mypy 1.7 或更高版本</strong> 才能使用 pep-646 集成。</p>
</div>
<input class="tab-input" id="tab-set--1-input--2" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--2">英文</label><div class="tab-content docutils container">
<p>SQLAlchemy 2.0 implemented a broad array of <span class="target" id="index-2"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a> typing throughout
all components, including a new ability for row-returning statements such
as <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> to maintain track of individual column types, which
were then passed through the execution phase onto the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a>
object and then to the individual <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> objects.   Described
at <a class="reference internal" href="whatsnew_20.html#change-result-typing-20"><span class="std std-ref">SQL Expression / Statement / Result Set Typing</span></a>, this approach solved several issues
with statement / row typing, but some remained unsolvable.  In 2.1, one
of those issues, that the individual column types needed to be packaged
into a <code class="docutils literal notranslate"><span class="pre">typing.Tuple</span></code>, is now resolved using new <span class="target" id="index-3"></span><a class="pep reference external" href="https://peps.python.org/pep-0646/"><strong>PEP 646</strong></a> integration,
which allows for tuple-like types that are not actually typed as <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>.</p>
<p>In SQLAlchemy 2.0, a statement such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">String</span><span class="p">))</span></pre></div>
</div>
<p>Would be typed as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Select</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">int</span><span class="p">,</span> <span class="n">str</span><span class="p">]]</span></pre></div>
</div>
<p>In 2.1, it’s now typed as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Select</span><span class="p">[</span><span class="n">int</span><span class="p">,</span> <span class="n">str</span><span class="p">]</span></pre></div>
</div>
<p>When executing <code class="docutils literal notranslate"><span class="pre">stmt</span></code>, the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> and <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>
objects will be typed as <code class="docutils literal notranslate"><span class="pre">Result[int,</span> <span class="pre">str]</span></code> and <code class="docutils literal notranslate"><span class="pre">Row[int,</span> <span class="pre">str]</span></code>, respectively.
The prior workaround using <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row._t" title="sqlalchemy.engine.Row._t"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Row._t</span></code></a> to type as a real <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>
is no longer needed and projects can migrate off this pattern.</p>
<p>Mypy users will need to make use of <strong>Mypy 1.7 or greater</strong> for pep-646
integration to be available.</p>
</div>
</div>
<section id="id1">
<h3>限制<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
<p>Limitations</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--2-input--1" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--1">中文</label><div class="tab-content docutils container">
<p>尚未通过 pep-646 或任何其他 pep 解决的问题是，将 <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> 等类中的任意数量的表达式映射到行对象，而无需在类型注释中明确说明每个参数的位置。为了解决这个问题，SQLAlchemy 使用自动 “stub 生成” 工具来生成不同数量的位置参数到类似 <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> 的构造的硬编码映射，以解析为单个 <code class="docutils literal notranslate"><span class="pre">Unpack[]</span></code> 表达式（在 SQLAlchemy 2.0 中，这种生成产生了 <code class="docutils literal notranslate"><span class="pre">Tuple[]</span></code> 注释）。这意味着在 <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> 对象中将有任意数量的特定列表达式进行类型化，而不会将剩余表达式恢复为 <code class="docutils literal notranslate"><span class="pre">Any</span></code>；对于 <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a>，当前是十个表达式，对于使用 <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.returning" title="sqlalchemy.sql.expression.Insert.returning"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.returning()</span></code></a> 的 DML 表达式（如 <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.insert" title="sqlalchemy.sql.expression.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a>），是八个表达式。如果提出了一个提供 <code class="docutils literal notranslate"><span class="pre">Map</span></code> 操作符给 pep-646 的新 pep，这个限制可以被解除。<a class="footnote-reference brackets" href="#id4" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> 最初，错误地认为这个限制完全阻止了 pep-646 的使用，然而，<code class="docutils literal notranslate"><span class="pre">Unpack</span></code> 构造实际上取代了在 2.0 中使用 <code class="docutils literal notranslate"><span class="pre">Tuple</span></code> 所做的一切。</p>
<p>一个额外的限制是没有提出解决方案，即 <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> 上的基于名称的属性无法自动进行类型化，因此这些属性继续被类型化为 <code class="docutils literal notranslate"><span class="pre">Any</span></code> （例如，对于上述示例中的 <code class="docutils literal notranslate"><span class="pre">row.x</span></code> 和 <code class="docutils literal notranslate"><span class="pre">row.y</span></code>）。使用当前的语言特性，这只能通过一个显式的基于类的构造来解决，该构造允许在前面组合一个具有显式字段的显式 <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a>，这将是冗长且非自动的。</p>
</div>
<input class="tab-input" id="tab-set--2-input--2" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--2">英文</label><div class="tab-content docutils container">
<p>Not yet solved by pep-646 or any other pep is the ability for an arbitrary
number of expressions within <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> and others to be mapped to
row objects, without stating each argument position explicitly within typing
annotations.   To work around this issue, SQLAlchemy makes use of automated
“stub generation” tools to generate hardcoded mappings of different numbers of
positional arguments to constructs like <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> to resolve to
individual <code class="docutils literal notranslate"><span class="pre">Unpack[]</span></code> expressions (in SQLAlchemy 2.0, this generation
produced <code class="docutils literal notranslate"><span class="pre">Tuple[]</span></code> annotations instead).  This means that there are arbitrary
limits on how many specific column expressions will be typed within the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> object, without restoring to <code class="docutils literal notranslate"><span class="pre">Any</span></code> for remaining
expressions; for <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a>, it’s currently ten expressions, and
for DML expressions like <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.insert" title="sqlalchemy.sql.expression.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a> that use <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.returning" title="sqlalchemy.sql.expression.Insert.returning"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.returning()</span></code></a>,
it’s eight.    If and when a new pep that provides a <code class="docutils literal notranslate"><span class="pre">Map</span></code> operator
to pep-646 is proposed, this limitation can be lifted. <a class="footnote-reference brackets" href="#id4" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>  Originally, it was
mistakenly assumed that this limitation prevented pep-646 from being usable at all,
however, the <code class="docutils literal notranslate"><span class="pre">Unpack</span></code> construct does in fact replace everything that
was done using <code class="docutils literal notranslate"><span class="pre">Tuple</span></code> in 2.0.</p>
<p>An additional limitation for which there is no proposed solution is that
there’s no way for the name-based attributes on <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> to be
automatically typed, so these continue to be typed as <code class="docutils literal notranslate"><span class="pre">Any</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">row.x</span></code>
and <code class="docutils literal notranslate"><span class="pre">row.y</span></code> for the above example).   With current language features,
this could only be fixed by having an explicit class-based construct that
allows one to compose an explicit <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> with explicit fields
up front, which would be verbose and not automatic.</p>
</div>
</div>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id4" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id2">1</a>,<a role="doc-backlink" href="#id3">2</a>)</span>
<p><a class="reference external" href="https://github.com/python/typing/discussions/1001#discussioncomment-1897813">https://github.com/python/typing/discussions/1001#discussioncomment-1897813</a></p>
</aside>
</aside>
<p><a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10635">#10635</a></p>
</section>
</section>
<section id="asynciogreenlet">
<span id="change-10197"></span><h2>Asyncio“greenlet”依赖项不再默认安装<a class="headerlink" href="#asynciogreenlet" title="Link to this heading">¶</a></h2>
<p>Asyncio “greenlet” dependency no longer installs by default</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--3-input--1" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--1">中文</label><div class="tab-content docutils container">
<p>SQLAlchemy 1.4 和 2.0 使用一个复杂的表达式来确定 <code class="docutils literal notranslate"><span class="pre">greenlet</span></code> 依赖项是否可以从 pypi 使用预构建的 wheel 安装，而不是从源代码构建。这是因为在某些平台上，从源代码构建 <code class="docutils literal notranslate"><span class="pre">greenlet</span></code> 并不总是简单的。</p>
<p>这种方法的缺点包括：SQLAlchemy 需要准确跟踪在 pypi 上发布的 <code class="docutils literal notranslate"><span class="pre">greenlet</span></code> 版本；设置表达式导致了一些包管理工具（如 <code class="docutils literal notranslate"><span class="pre">poetry</span></code>）的问题；即使不使用 asyncio 扩展，也无法 <strong>不</strong> 安装 <code class="docutils literal notranslate"><span class="pre">greenlet</span></code>，尽管这完全可行。</p>
<p>通过将 <code class="docutils literal notranslate"><span class="pre">greenlet</span></code> 完全放在 <code class="docutils literal notranslate"><span class="pre">[asyncio]</span></code> 目标中，这些问题都得到了解决。唯一的缺点是 asyncio 扩展的用户需要注意这个额外的安装依赖项。</p>
</div>
<input class="tab-input" id="tab-set--3-input--2" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--2">英文</label><div class="tab-content docutils container">
<p>SQLAlchemy 1.4 and 2.0 used a complex expression to determine if the
<code class="docutils literal notranslate"><span class="pre">greenlet</span></code> dependency, needed by the <a class="reference internal" href="../orm/extensions/asyncio.html#asyncio-toplevel"><span class="std std-ref">asyncio</span></a>
extension, could be installed from pypi using a pre-built wheel instead
of having to build from source.   This because the source build of <code class="docutils literal notranslate"><span class="pre">greenlet</span></code>
is not always trivial on some platforms.</p>
<p>Disadvantages to this approach included that SQLAlchemy needed to track
exactly which versions of <code class="docutils literal notranslate"><span class="pre">greenlet</span></code> were published as wheels on pypi;
the setup expression led to problems with some package management tools
such as <code class="docutils literal notranslate"><span class="pre">poetry</span></code>; it was not possible to install SQLAlchemy <strong>without</strong>
<code class="docutils literal notranslate"><span class="pre">greenlet</span></code> being installed, even though this is completely feasible
if the asyncio extension is not used.</p>
<p>These problems are all solved by keeping <code class="docutils literal notranslate"><span class="pre">greenlet</span></code> entirely within the
<code class="docutils literal notranslate"><span class="pre">[asyncio]</span></code> target.  The only downside is that users of the asyncio extension
need to be aware of this extra installation dependency.</p>
</div>
</div>
<p><a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10197">#10197</a></p>
</section>
<section id="orm-back-populates">
<span id="change-10050"></span><h2>ORM 关系允许调用 back_populates<a class="headerlink" href="#orm-back-populates" title="Link to this heading">¶</a></h2>
<p>ORM Relationship allows callable for back_populates</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--4-input--1" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--1">中文</label><div class="tab-content docutils container">
<p>为了帮助生成更符合 IDE 级别的 linting 和类型检查的代码，<a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.back_populates" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.back_populates</span></code></a> 参数现在接受直接引用类绑定属性以及执行相同操作的 lambdas:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># 使用 lambda: 直接链接到 B.a</span>
    <span class="n">bs</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">list</span><span class="p">[</span><span class="n">B</span><span class="p">]]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">back_populates</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">B</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">a_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;a.id&quot;</span><span class="p">))</span>

    <span class="c1"># A.bs 已经存在，因此可以直接链接</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">A</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">back_populates</span><span class="o">=</span><span class="n">A</span><span class="o">.</span><span class="n">bs</span><span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
</div>
<input class="tab-input" id="tab-set--4-input--2" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--2">英文</label><div class="tab-content docutils container">
<p>To help produce code that is more amenable to IDE-level linting and type
checking, the <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.back_populates" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.back_populates</span></code></a> parameter now
accepts both direct references to a class-bound attribute as well as
lambdas which do the same:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># use a lambda: to link to B.a directly when it exists</span>
    <span class="n">bs</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">list</span><span class="p">[</span><span class="n">B</span><span class="p">]]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">back_populates</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">B</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">a_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;a.id&quot;</span><span class="p">))</span>

    <span class="c1"># A.bs already exists, so can link directly</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">A</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">back_populates</span><span class="o">=</span><span class="n">A</span><span class="o">.</span><span class="n">bs</span><span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10050">#10050</a></p>
</section>
<section id="orm-dict-default">
<span id="change-12168"></span><h2>ORM 映射数据类不再在 <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> 中填充隐式 <code class="docutils literal notranslate"><span class="pre">default</span></code><a class="headerlink" href="#orm-dict-default" title="Link to this heading">¶</a></h2>
<p>ORM Mapped Dataclasses no longer populate implicit <code class="docutils literal notranslate"><span class="pre">default</span></code> in <code class="docutils literal notranslate"><span class="pre">__dict__</span></code></p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--5-input--1" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--1">中文</label><div class="tab-content docutils container">
<p>此行为更改解决了在 2.0 版本中引入的 SQLAlchemy 的 <a class="reference internal" href="../orm/dataclasses.html#orm-declarative-native-dataclasses"><span class="std std-ref">声明式Dataclass映射</span></a> 功能的广泛报告的问题。SQLAlchemy ORM 一直具有一种行为，即 ORM 映射类上的特定属性将具有不同的行为，具体取决于它是否具有已设置的值，包括该值是否为 <code class="docutils literal notranslate"><span class="pre">None</span></code>，与该属性根本没有设置的情况不同。当引入声明数据类映射时，<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.default" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.default</span></code></a> 参数引入了一种新功能，即在生成的 <code class="docutils literal notranslate"><span class="pre">__init__</span></code> 方法中设置数据类级别的默认值。这不幸地破坏了各种流行的工作流程，其中最突出的是使用外键值创建 ORM 对象来代替多对一引用:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="p">(</span><span class="n">MappedAsDataclass</span><span class="p">,</span> <span class="n">DeclarativeBase</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Parent</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;parent&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">related_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;child.id&quot;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">related</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Child</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Child</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;child&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>在上述映射中，为 <code class="docutils literal notranslate"><span class="pre">Parent</span></code> 生成的 <code class="docutils literal notranslate"><span class="pre">__init__</span></code> 方法在 Python 代码中看起来像这样:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">related_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="o">...</span></pre></div>
</div>
<p>这意味着仅使用 <code class="docutils literal notranslate"><span class="pre">related_id</span></code> 创建新的 <code class="docutils literal notranslate"><span class="pre">Parent</span></code> 将在 <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> 中填充 <code class="docutils literal notranslate"><span class="pre">related_id</span></code> 和 <code class="docutils literal notranslate"><span class="pre">related</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2.0 行为；由于存在 related=None，将为 related_id 插入 NULL</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">Parent</span><span class="p">(</span><span class="n">related_id</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p1</span><span class="o">.</span><span class="vm">__dict__</span>
<span class="p">{</span><span class="s1">&#39;related_id&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;related&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_sa_instance_state&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">}</span></pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">related</span></code> 的 <code class="docutils literal notranslate"><span class="pre">None</span></code> 值意味着 SQLAlchemy 更倾向于不存在的相关 <code class="docutils literal notranslate"><span class="pre">Child</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">related_id</span></code> 的现有值，该值将被丢弃，并且将为 <code class="docutils literal notranslate"><span class="pre">related_id</span></code> 插入 <code class="docutils literal notranslate"><span class="pre">NULL</span></code>。</p>
<p>在新的行为中， <code class="docutils literal notranslate"><span class="pre">__init__</span></code> 方法如下例所示，使用一个特殊的常量 <code class="docutils literal notranslate"><span class="pre">DONT_SET</span></code> 表示应忽略 <code class="docutils literal notranslate"><span class="pre">related</span></code> 的不存在值。这使类的行为更接近于 SQLAlchemy ORM 映射类的传统操作方式:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">related_id</span><span class="o">=</span><span class="n">DONT_SET</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="n">DONT_SET</span><span class="p">):</span> <span class="o">...</span></pre></div>
</div>
<p>然后我们得到一个 <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> 设置，它将遵循预期的行为，省略 <code class="docutils literal notranslate"><span class="pre">related</span></code> 并稍后运行一个 INSERT，带有 <code class="docutils literal notranslate"><span class="pre">related_id=5</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2.1 行为；将为 related_id 插入 5</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">Parent</span><span class="p">(</span><span class="n">related_id</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p1</span><span class="o">.</span><span class="vm">__dict__</span>
<span class="p">{</span><span class="s1">&#39;related_id&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;_sa_instance_state&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">}</span></pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--5-input--2" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--2">英文</label><div class="tab-content docutils container">
<p>This behavioral change addresses a widely reported issue with SQLAlchemy’s
<a class="reference internal" href="../orm/dataclasses.html#orm-declarative-native-dataclasses"><span class="std std-ref">声明式Dataclass映射</span></a> feature that was introduced in 2.0.
SQLAlchemy ORM has always featured a behavior where a particular attribute on
an ORM mapped class will have different behaviors depending on if it has an
actively set value, including if that value is <code class="docutils literal notranslate"><span class="pre">None</span></code>, versus if the
attribute is not set at all.  When Declarative Dataclass Mapping was introduced, the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.default" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.default</span></code></a> parameter introduced a new capability
which is to set up a dataclass-level default to be present in the generated
<code class="docutils literal notranslate"><span class="pre">__init__</span></code> method. This had the unfortunate side effect of breaking various
popular workflows, the most prominent of which is creating an ORM object with
the foreign key value in lieu of a many-to-one reference:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="p">(</span><span class="n">MappedAsDataclass</span><span class="p">,</span> <span class="n">DeclarativeBase</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Parent</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;parent&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">related_id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;child.id&quot;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">related</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Child</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Child</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;child&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>In the above mapping, the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method generated for <code class="docutils literal notranslate"><span class="pre">Parent</span></code>
would in Python code look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">related_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="o">...</span></pre></div>
</div>
<p>This means that creating a new <code class="docutils literal notranslate"><span class="pre">Parent</span></code> with <code class="docutils literal notranslate"><span class="pre">related_id</span></code> only would populate
both <code class="docutils literal notranslate"><span class="pre">related_id</span></code> and <code class="docutils literal notranslate"><span class="pre">related</span></code> in <code class="docutils literal notranslate"><span class="pre">__dict__</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2.0 behavior; will INSERT NULL for related_id due to the presence</span>
<span class="c1"># of related=None</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">Parent</span><span class="p">(</span><span class="n">related_id</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p1</span><span class="o">.</span><span class="vm">__dict__</span>
<span class="p">{</span><span class="s1">&#39;related_id&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;related&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;_sa_instance_state&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">}</span></pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">None</span></code> value for <code class="docutils literal notranslate"><span class="pre">'related'</span></code> means that SQLAlchemy favors the non-present
related <code class="docutils literal notranslate"><span class="pre">Child</span></code> over the present value for <code class="docutils literal notranslate"><span class="pre">'related_id'</span></code>, which would be
discarded, and <code class="docutils literal notranslate"><span class="pre">NULL</span></code> would be inserted for <code class="docutils literal notranslate"><span class="pre">'related_id'</span></code> instead.</p>
<p>In the new behavior, the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method instead looks like the example below,
using a special constant <code class="docutils literal notranslate"><span class="pre">DONT_SET</span></code> indicating a non-present value for <code class="docutils literal notranslate"><span class="pre">'related'</span></code>
should be ignored.  This allows the class to behave more closely to how
SQLAlchemy ORM mapped classes traditionally operate:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">related_id</span><span class="o">=</span><span class="n">DONT_SET</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="n">DONT_SET</span><span class="p">):</span> <span class="o">...</span></pre></div>
</div>
<p>We then get a <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> setup that will follow the expected behavior of
omitting <code class="docutils literal notranslate"><span class="pre">related</span></code> from <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> and later running an INSERT with
<code class="docutils literal notranslate"><span class="pre">related_id=5</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2.1 behavior; will INSERT 5 for related_id</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">Parent</span><span class="p">(</span><span class="n">related_id</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p1</span><span class="o">.</span><span class="vm">__dict__</span>
<span class="p">{</span><span class="s1">&#39;related_id&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;_sa_instance_state&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">}</span></pre></div>
</div>
</div>
</div>
<section id="dict">
<h3>数据类默认值通过描述符而不是 __dict__ 传递<a class="headerlink" href="#dict" title="Link to this heading">¶</a></h3>
<p>Dataclass defaults are delivered via descriptor instead of __dict__</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--6-input--1" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--1">中文</label><div class="tab-content docutils container">
<p>上述行为更进一步，即为了支持除 <code class="docutils literal notranslate"><span class="pre">None</span></code> 之外的默认值，数据类级别默认值（即使用 <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.default" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.default</span></code></a>、<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.column_property.params.default" title="sqlalchemy.orm.column_property"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">column_property.default</span></code></a> 或 <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.deferred.params.default" title="sqlalchemy.orm.deferred"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">deferred.default</span></code></a> 参数设置的默认值）通过 SQLAlchemy 的属性系统中的机制在 Python <a class="reference internal" href="../glossary.html#term-descriptor"><span class="xref std std-term">descriptor</span></a> 级别传递，通常情况下这些机制会为未填充的列返回 <code class="docutils literal notranslate"><span class="pre">None</span></code>，因此即使默认值未填充到 <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> 中，当访问该属性时仍会传递默认值。这种行为基于 Python 数据类本身在为包含 <code class="docutils literal notranslate"><span class="pre">init=False</span></code> 的字段指示默认值时的操作。</p>
<p>在下面的示例中，一个不可变默认值 <code class="docutils literal notranslate"><span class="pre">&quot;default_status&quot;</span></code> 被应用于名为 <code class="docutils literal notranslate"><span class="pre">status</span></code> 的列:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="p">(</span><span class="n">MappedAsDataclass</span><span class="p">,</span> <span class="n">DeclarativeBase</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SomeObject</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;parent&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">status</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;default_status&quot;</span><span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>在上述映射中，不带参数构造 <code class="docutils literal notranslate"><span class="pre">SomeObject</span></code> 将不会在 <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> 中传递任何值，但会通过描述符传递默认值:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 对象构造时没有 ``status`` 的值</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">SomeObject</span><span class="p">()</span>

<span class="c1"># 默认值不会放在 ``__dict__`` 中</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s1</span><span class="o">.</span><span class="vm">__dict__</span>
<span class="p">{</span><span class="s1">&#39;_sa_instance_state&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">}</span>

<span class="c1"># 但默认值通过描述符在对象级别传递</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s1</span><span class="o">.</span><span class="n">status</span>
<span class="s1">&#39;default_status&#39;</span>

<span class="c1"># 值仍然未填充到 ``__dict__`` 中</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s1</span><span class="o">.</span><span class="vm">__dict__</span>
<span class="p">{</span><span class="s1">&#39;_sa_instance_state&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">}</span></pre></div>
</div>
<p>传递给 <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.default" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.default</span></code></a> 的值也会像以前一样分配给底层 <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> 的 <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column.params.default" title="sqlalchemy.schema.Column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Column.default</span></code></a> 参数，在那里它作为 INSERT 语句的 Python 级默认值。因此，尽管 <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> 中从未填充对象的默认值，但 INSERT 仍然在参数集中包含该值。这本质上修改了声明数据类映射系统，使其更像传统的 ORM 映射类，其中“默认值”仅表示列级默认值。</p>
</div>
<input class="tab-input" id="tab-set--6-input--2" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--2">英文</label><div class="tab-content docutils container">
<p>The above behavior goes a step further, which is that in order to
honor default values that are something other than <code class="docutils literal notranslate"><span class="pre">None</span></code>, the value of the
dataclass-level default (i.e. set using any of the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.default" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.default</span></code></a>,
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.column_property.params.default" title="sqlalchemy.orm.column_property"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">column_property.default</span></code></a>, or <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.deferred.params.default" title="sqlalchemy.orm.deferred"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">deferred.default</span></code></a>
parameters) is directed to be delivered at the
Python <a class="reference internal" href="../glossary.html#term-descriptor"><span class="xref std std-term">descriptor</span></a> level using mechanisms in SQLAlchemy’s attribute
system that normally return <code class="docutils literal notranslate"><span class="pre">None</span></code> for un-popualted columns, so that even though the default is not
populated into <code class="docutils literal notranslate"><span class="pre">__dict__</span></code>, it’s still delivered when the attribute is
accessed.  This behavior is based on what Python dataclasses itself does
when a default is indicated for a field that also includes <code class="docutils literal notranslate"><span class="pre">init=False</span></code>.</p>
<p>In the example below, an immutable default <code class="docutils literal notranslate"><span class="pre">&quot;default_status&quot;</span></code>
is applied to a column called <code class="docutils literal notranslate"><span class="pre">status</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="p">(</span><span class="n">MappedAsDataclass</span><span class="p">,</span> <span class="n">DeclarativeBase</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SomeObject</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;parent&quot;</span>

    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">status</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;default_status&quot;</span><span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>In the above mapping, constructing <code class="docutils literal notranslate"><span class="pre">SomeObject</span></code> with no parameters will
deliver no values inside of <code class="docutils literal notranslate"><span class="pre">__dict__</span></code>, but will deliver the default
value via descriptor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># object is constructed with no value for ``status``</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">SomeObject</span><span class="p">()</span>

<span class="c1"># the default value is not placed in ``__dict__``</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s1</span><span class="o">.</span><span class="vm">__dict__</span>
<span class="p">{</span><span class="s1">&#39;_sa_instance_state&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">}</span>

<span class="c1"># but the default value is delivered at the object level via descriptor</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s1</span><span class="o">.</span><span class="n">status</span>
<span class="s1">&#39;default_status&#39;</span>

<span class="c1"># the value still remains unpopulated in ``__dict__``</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s1</span><span class="o">.</span><span class="vm">__dict__</span>
<span class="p">{</span><span class="s1">&#39;_sa_instance_state&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">}</span></pre></div>
</div>
<p>The value passed
as <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.default" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.default</span></code></a> is also assigned as was the
case before to the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column.params.default" title="sqlalchemy.schema.Column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Column.default</span></code></a> parameter of the
underlying <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>, where it takes
place as a Python-level default for INSERT statements.  So while <code class="docutils literal notranslate"><span class="pre">__dict__</span></code>
is never populated with the default value on the object, the INSERT
still includes the value in the parameter set.  This essentially modifies
the Declarative Dataclass Mapping system to work more like traditional
ORM mapped classes, where a “default” means just that, a column level
default.</p>
</div>
</div>
</section>
<section id="init">
<h3>即使没有 init，也可以在对象上访问数据类默认值<a class="headerlink" href="#init" title="Link to this heading">¶</a></h3>
<p>Dataclass defaults are accessible on objects even without init</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--7-input--1" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--1">中文</label><div class="tab-content docutils container">
<p>由于新行为以类似于 Python 数据类在 <code class="docutils literal notranslate"><span class="pre">init=False</span></code> 时的方式使用描述符，因此新功能也实现了这种行为。这是一种全新的行为，其中 ORM 映射类可以为字段提供默认值，即使它们根本不是 <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> 方法的一部分。在下面的映射中， <code class="docutils literal notranslate"><span class="pre">status</span></code> 字段配置为 <code class="docutils literal notranslate"><span class="pre">init=False</span></code>，这意味着它根本不是构造函数的一部分:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="p">(</span><span class="n">MappedAsDataclass</span><span class="p">,</span> <span class="n">DeclarativeBase</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SomeObject</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;parent&quot;</span>
    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;default_status&quot;</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>当我们不带参数构造 <code class="docutils literal notranslate"><span class="pre">SomeObject()</span></code> 时，默认值可以通过描述符访问实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">so</span> <span class="o">=</span> <span class="n">SomeObject</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">so</span><span class="o">.</span><span class="n">status</span>
<span class="go">default_status</span></pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--7-input--2" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--2">英文</label><div class="tab-content docutils container">
<p>As the new behavior makes use of descriptors in a similar way as Python
dataclasses do themselves when <code class="docutils literal notranslate"><span class="pre">init=False</span></code>, the new feature implements
this behavior as well.   This is an all new behavior where an ORM mapped
class can deliver a default value for fields even if they are not part of
the <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> method at all.  In the mapping below, the <code class="docutils literal notranslate"><span class="pre">status</span></code>
field is configured with <code class="docutils literal notranslate"><span class="pre">init=False</span></code>, meaning it’s not part of the
constructor at all:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="p">(</span><span class="n">MappedAsDataclass</span><span class="p">,</span> <span class="n">DeclarativeBase</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SomeObject</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;parent&quot;</span>
    <span class="n">id</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;default_status&quot;</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>When we construct <code class="docutils literal notranslate"><span class="pre">SomeObject()</span></code> with no arguments, the default is accessible
on the instance, delivered via descriptor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">so</span> <span class="o">=</span> <span class="n">SomeObject</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">so</span><span class="o">.</span><span class="n">status</span>
<span class="go">default_status</span></pre></div>
</div>
</div>
</div>
</section>
<section id="id5">
<h3>相关更改<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h3>
<p>Related Changes</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--8-input--1" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--1">中文</label><div class="tab-content docutils container">
<p>此更改包括以下 API 变更：</p>
<ul class="simple">
<li><p>当存在 <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.default" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.default</span></code></a> 参数时，仅接受值 <code class="docutils literal notranslate"><span class="pre">None</span></code>，并且仅在关系最终是多对一关系或建立 <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.uselist" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.uselist</span></code></a> 为 <code class="docutils literal notranslate"><span class="pre">False</span></code> 时才被接受。</p></li>
<li><p><a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.default" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.default</span></code></a> 和 <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.insert_default" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.insert_default</span></code></a> 参数是互斥的，一次只能传递一个。这两个参数在 <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> 级别的行为是等效的，但在声明数据类映射级别，只有 <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.default" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.default</span></code></a> 实际上通过描述符访问设置数据类级别的默认值；使用 <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.insert_default" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.insert_default</span></code></a> 将使对象属性在实例上默认值为 <code class="docutils literal notranslate"><span class="pre">None</span></code>，直到插入发生，这与传统 ORM 映射类的工作方式相同。</p></li>
</ul>
</div>
<input class="tab-input" id="tab-set--8-input--2" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--2">英文</label><div class="tab-content docutils container">
<p>This change includes the following API changes:</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.default" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.default</span></code></a> parameter, when present, only
accepts a value of <code class="docutils literal notranslate"><span class="pre">None</span></code>, and is only accepted when the relationship is
ultimately a many-to-one relationship or one that establishes
<a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.uselist" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.uselist</span></code></a> as <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p>The <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.default" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.default</span></code></a> and <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.insert_default" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.insert_default</span></code></a>
parameters are mutually exclusive, and only one may be passed at a time.
The behavior of the two parameters is equivalent at the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>
level, however at the Declarative Dataclass Mapping level, only
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.default" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.default</span></code></a> actually sets the dataclass-level
default with descriptor access; using <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.insert_default" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.insert_default</span></code></a>
will have the effect of the object attribute defaulting to <code class="docutils literal notranslate"><span class="pre">None</span></code> on the
instance until the INSERT takes place, in the same way it works on traditional
ORM mapped classes.</p></li>
</ul>
</div>
</div>
<p><a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12168">#12168</a></p>
</section>
</section>
<section id="url-stringify-parse-url">
<span id="change-11234"></span><h2>URL stringify 和 parse 现在支持“数据库”部分的 URL 转义<a class="headerlink" href="#url-stringify-parse-url" title="Link to this heading">¶</a></h2>
<p>URL stringify and parse now supports URL escaping for the “database” portion</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--9-input--1" name="tab-set--9" type="radio"><label class="tab-label" for="tab-set--9-input--1">中文</label><div class="tab-content docutils container">
<p>包含 URL 转义字符的数据库部分的 URL 现在将解析这些转义字符:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_url</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">=</span> <span class="n">make_url</span><span class="p">(</span><span class="s2">&quot;driver://user:pass@host/database</span><span class="si">%3F</span><span class="s2">name&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span><span class="o">.</span><span class="n">database</span>
<span class="go">&#39;database?name&#39;</span></pre></div>
</div>
<p>以前，这些字符不会被解码:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># pre-2.1 行为</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_url</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">=</span> <span class="n">make_url</span><span class="p">(</span><span class="s2">&quot;driver://user:pass@host/database</span><span class="si">%3F</span><span class="s2">name&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span><span class="o">.</span><span class="n">database</span>
<span class="go">&#39;database%3Fname&#39;</span></pre></div>
</div>
<p>此更改也适用于字符串化部分；数据库名称中的大多数特殊字符将被 URL 转义，忽略一些如加号和斜杠的字符:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">URL</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">=</span> <span class="n">URL</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;driver&quot;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="s2">&quot;a?b=c&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<span class="go">&#39;driver:///a%3Fb%3Dc&#39;</span></pre></div>
</div>
<p>上述 URL 正确地回环到自身:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">make_url</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="n">u</span><span class="p">))</span>
<span class="go">driver:///a%3Fb%3Dc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">make_url</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="o">.</span><span class="n">database</span> <span class="o">==</span> <span class="n">u</span><span class="o">.</span><span class="n">database</span>
<span class="go">True</span></pre></div>
</div>
<p>以前，程序化应用的特殊字符不会在结果中被转义，导致 URL 不代表原始的数据库部分。下面，<cite>b=c</cite> 是查询字符串的一部分而不是数据库部分:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">URL</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">=</span> <span class="n">URL</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;driver&quot;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="s2">&quot;a?b=c&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<span class="go">&#39;driver:///a?b=c&#39;</span></pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--9-input--2" name="tab-set--9" type="radio"><label class="tab-label" for="tab-set--9-input--2">英文</label><div class="tab-content docutils container">
<p>A URL that includes URL-escaped characters in the database portion will
now parse with conversion of those escaped characters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_url</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">=</span> <span class="n">make_url</span><span class="p">(</span><span class="s2">&quot;driver://user:pass@host/database</span><span class="si">%3F</span><span class="s2">name&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span><span class="o">.</span><span class="n">database</span>
<span class="go">&#39;database?name&#39;</span></pre></div>
</div>
<p>Previously, such characters would not be unescaped:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># pre-2.1 behavior</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_url</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">=</span> <span class="n">make_url</span><span class="p">(</span><span class="s2">&quot;driver://user:pass@host/database</span><span class="si">%3F</span><span class="s2">name&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span><span class="o">.</span><span class="n">database</span>
<span class="go">&#39;database%3Fname&#39;</span></pre></div>
</div>
<p>This change also applies to the stringify side; most special characters in
the database name will be URL escaped, omitting a few such as plus signs and
slashes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">URL</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">=</span> <span class="n">URL</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;driver&quot;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="s2">&quot;a?b=c&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<span class="go">&#39;driver:///a%3Fb%3Dc&#39;</span></pre></div>
</div>
<p>Where the above URL correctly round-trips to itself:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">make_url</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="n">u</span><span class="p">))</span>
<span class="go">driver:///a%3Fb%3Dc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">make_url</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="o">.</span><span class="n">database</span> <span class="o">==</span> <span class="n">u</span><span class="o">.</span><span class="n">database</span>
<span class="go">True</span></pre></div>
</div>
<p>Whereas previously, special characters applied programmatically would not
be escaped in the result, leading to a URL that does not represent the
original database portion.  Below, <cite>b=c</cite> is part of the query string and
not the database portion:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">URL</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">=</span> <span class="n">URL</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;driver&quot;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="s2">&quot;a?b=c&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<span class="go">&#39;driver:///a?b=c&#39;</span></pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11234">#11234</a></p>
</section>
<section id="mssql-pyodbc-odbc-connect">
<span id="change-11250"></span><h2>对 mssql+pyodbc 的 odbc_connect= 处理的潜在重大更改<a class="headerlink" href="#mssql-pyodbc-odbc-connect" title="Link to this heading">¶</a></h2>
<p>Potential breaking change to odbc_connect= handling for mssql+pyodbc</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--10-input--1" name="tab-set--10" type="radio"><label class="tab-label" for="tab-set--10-input--1">中文</label><div class="tab-content docutils container">
<p>修复了一个 mssql+pyodbc 问题，其中在未引用的 <code class="docutils literal notranslate"><span class="pre">odbc_connect=</span></code> （原始 DBAPI）连接字符串中有效的加号被替换为空格。</p>
<p>之前，pyodbc 连接器总是将 odbc_connect 值传递给 unquote_plus()，即使不需要也是如此。因此，如果（未引用的）odbc_connect 值包含 <code class="docutils literal notranslate"><span class="pre">PWD=pass+word</span></code>，它将被更改为 <code class="docutils literal notranslate"><span class="pre">PWD=pass</span> <span class="pre">word</span></code>，并且登录将失败。一种解决方法是仅引用加号 — <code class="docutils literal notranslate"><span class="pre">PWD=pass%2Bword</span></code> — 然后它将被解码为 <code class="docutils literal notranslate"><span class="pre">PWD=pass+word</span></code>。</p>
<p>使用上述解决方法通过 <a class="reference internal" href="../core/engines.html#sqlalchemy.engine.URL.create" title="sqlalchemy.engine.URL.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">URL.create()</span></code></a> 在 odbc_connect 字符串的 <code class="docutils literal notranslate"><span class="pre">PWD=</span></code> 参数中指定加号的实现将不得不移除解决方法，只需传递 <code class="docutils literal notranslate"><span class="pre">PWD=</span></code> 值，像在有效的 ODBC 连接字符串中一样出现（即，如果直接使用 <code class="docutils literal notranslate"><span class="pre">pyodbc.connect()</span></code> 连接字符串，则需要相同）。</p>
</div>
<input class="tab-input" id="tab-set--10-input--2" name="tab-set--10" type="radio"><label class="tab-label" for="tab-set--10-input--2">英文</label><div class="tab-content docutils container">
<p>Fixed a mssql+pyodbc issue where valid plus signs in an already-unquoted
<code class="docutils literal notranslate"><span class="pre">odbc_connect=</span></code> (raw DBAPI) connection string were replaced with spaces.</p>
<p>Previously, the pyodbc connector would always pass the odbc_connect value
to unquote_plus(), even if it was not required. So, if the (unquoted)
odbc_connect value contained <code class="docutils literal notranslate"><span class="pre">PWD=pass+word</span></code> that would get changed to
<code class="docutils literal notranslate"><span class="pre">PWD=pass</span> <span class="pre">word</span></code>, and the login would fail. One workaround was to quote
just the plus sign — <code class="docutils literal notranslate"><span class="pre">PWD=pass%2Bword</span></code> — which would then get unquoted
to <code class="docutils literal notranslate"><span class="pre">PWD=pass+word</span></code>.</p>
<p>Implementations using the above workaround with <a class="reference internal" href="../core/engines.html#sqlalchemy.engine.URL.create" title="sqlalchemy.engine.URL.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">URL.create()</span></code></a>
to specify a plus sign in the <code class="docutils literal notranslate"><span class="pre">PWD=</span></code> argument of an odbc_connect string
will have to remove the workaround and just pass the <code class="docutils literal notranslate"><span class="pre">PWD=</span></code> value as it
would appear in a valid ODBC connection string (i.e., the same as would be
required if using the connection string directly with <code class="docutils literal notranslate"><span class="pre">pyodbc.connect()</span></code>).</p>
</div>
</div>
<p><a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11250">#11250</a></p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="changelog_21.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">2.1 Changelog</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">变更和迁移</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                <a href="../copyright.html">Copyright</a> &#169; 2007-2025, the SQLAlchemy authors and contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on 04/05/2025 04:00:26</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">SQLAlchemy 2.1 有什么新功能？</a><ul>
<li><a class="reference internal" href="#row-tuple"><code class="docutils literal notranslate"><span class="pre">Row</span></code> 现在直接表示单个列类型，无需 <code class="docutils literal notranslate"><span class="pre">Tuple</span></code></a><ul>
<li><a class="reference internal" href="#id1">限制</a></li>
</ul>
</li>
<li><a class="reference internal" href="#asynciogreenlet">Asyncio“greenlet”依赖项不再默认安装</a></li>
<li><a class="reference internal" href="#orm-back-populates">ORM 关系允许调用 back_populates</a></li>
<li><a class="reference internal" href="#orm-dict-default">ORM 映射数据类不再在 <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> 中填充隐式 <code class="docutils literal notranslate"><span class="pre">default</span></code></a><ul>
<li><a class="reference internal" href="#dict">数据类默认值通过描述符而不是 __dict__ 传递</a></li>
<li><a class="reference internal" href="#init">即使没有 init，也可以在对象上访问数据类默认值</a></li>
<li><a class="reference internal" href="#id5">相关更改</a></li>
</ul>
</li>
<li><a class="reference internal" href="#url-stringify-parse-url">URL stringify 和 parse 现在支持“数据库”部分的 URL 转义</a></li>
<li><a class="reference internal" href="#mssql-pyodbc-odbc-connect">对 mssql+pyodbc 的 odbc_connect= 处理的潜在重大更改</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=2d0eb83f"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=2f3e6152"></script>
    <script src="../_static/translations.js?v=beaddf03"></script>
    </body>
</html>