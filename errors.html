<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="索引" href="genindex.html" /><link rel="search" title="搜索" href="search.html" /><link rel="copyright" title="版权所有" href="copyright.html" /><link rel="next" title="变更和迁移" href="changelog/index.html" /><link rel="prev" title="第三方包集成问题" href="faq/thirdparty.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.08.06 -->
        <title>错误消息 - SQLAlchemy 2.1 Documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/changelog.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx_paramlinks.css" />
    <link rel="stylesheet" type="text/css" href="_static/docs.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">SQLAlchemy 2.1 Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">SQLAlchemy 2.1 Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">概述</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="tutorial/index.html">SQLAlchemy 统一教程</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of SQLAlchemy 统一教程</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorial/engine.html">建立连接 - Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial/dbapi_transactions.html">使用事务和DBAPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial/metadata.html">使用数据库元数据</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="tutorial/data.html">处理数据</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of 处理数据</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="tutorial/data_insert.html">使用 INSERT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/data_select.html">使用 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/data_update.html">使用 UPDATE 和 DELETE 语句</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial/orm_data_manipulation.html">使用 ORM 进行数据操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial/orm_related_objects.html">使用 ORM 相关对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial/further_reading.html">进一步阅读</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="orm/index.html">SQLAlchemy ORM</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of SQLAlchemy ORM</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="orm/quickstart.html">ORM 快速入门</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="orm/mapper_config.html">ORM 映射类配置</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of ORM 映射类配置</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="orm/mapping_styles.html">ORM 映射类概述</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="orm/declarative_mapping.html">使用声明式映射类</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of 使用声明式映射类</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="orm/declarative_styles.html">声明式映射风格</a></li>
<li class="toctree-l4"><a class="reference internal" href="orm/declarative_tables.html">声明式的表配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="orm/declarative_config.html">使用声明式映射器配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="orm/declarative_mixins.html">使用 Mixins 组合映射层次结构</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="orm/dataclasses.html">与dataclass和attrs的集成</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/mapped_sql_expr.html">SQL 表达式作为映射属性</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/mapped_attributes.html">更改Attribute的行为</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/composites.html">复合列类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/inheritance.html">映射类继承层次结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/nonstandard_mappings.html">非传统映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/versioning.html">配置版本计数器</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/mapping_api.html">类映射 API</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="orm/scalar_mapping.html">映射 SQL 表达式</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of 映射 SQL 表达式</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="orm/mapping_columns.html">映射表格列</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="orm/relationships.html">关系配置</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of 关系配置</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="orm/basic_relationships.html">基本关系模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/self_referential.html">邻接表关系</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/join_conditions.html">配置关系连接方式</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/large_collections.html">使用大型集合</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/collection_api.html">集合自定义和 API 详细信息</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/relationship_persistence.html">特殊关系的持久化模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/backref.html">使用旧版“backref”关系参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/relationship_api.html">关系 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="orm/queryguide/index.html">ORM 查询指南</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of ORM 查询指南</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="orm/queryguide/select.html">为 ORM 映射类编写 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/queryguide/inheritance.html">为继承映射编写 SELECT 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/queryguide/dml.html">启用 ORM 的 INSERT、UPDATE 和 DELETE 语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/queryguide/columns.html">列加载选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/queryguide/relationships.html">关系加载技术</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/queryguide/api.html">用于查询的 ORM API 功能</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/queryguide/query.html">旧式查询 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="orm/session.html">使用会话</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of 使用会话</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="orm/session_basics.html">会话基础知识</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/session_state_management.html">状态管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/cascades.html">级联</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/session_transaction.html">事务和连接管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/persistence_techniques.html">附加持久性技术</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/contextual.html">上下文/线程本地会话</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/session_events.html">使用事件跟踪查询、对象和会话更改</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/session_api.html">会话 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="orm/extending.html">事件和内部</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of 事件和内部</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="orm/events.html">ORM 事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/internals.html">ORM 内部</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/exceptions.html">ORM 异常</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="orm/extensions/index.html">ORM 扩展</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of ORM 扩展</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="orm/extensions/asyncio.html">异步 I/O (asyncio)</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/extensions/associationproxy.html">关联代理</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/extensions/automap.html">自动映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/extensions/baked.html">烘焙查询</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/extensions/declarative/index.html">声明式扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/extensions/mutable.html">突变追踪</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/extensions/orderinglist.html">排序列表</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/extensions/horizontal_shard.html">水平分片</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/extensions/hybrid.html">混合属性</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/extensions/indexable.html">Indexable</a></li>
<li class="toctree-l3"><a class="reference internal" href="orm/extensions/instrumentation.html">替代类检测</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="orm/examples.html">核心和 ORM 示例</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="core/index.html">SQLAlchemy Core</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of SQLAlchemy Core</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="core/expression_api.html">SQL 语句和表达式 API</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of SQL 语句和表达式 API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="core/sqlelement.html">列元素和表达式</a></li>
<li class="toctree-l3"><a class="reference internal" href="core/operators.html">操作符参考</a></li>
<li class="toctree-l3"><a class="reference internal" href="core/selectable.html">SELECT 和相关构造</a></li>
<li class="toctree-l3"><a class="reference internal" href="core/dml.html">插入,更新,删除</a></li>
<li class="toctree-l3"><a class="reference internal" href="core/functions.html">SQL 和 范型函数</a></li>
<li class="toctree-l3"><a class="reference internal" href="core/compiler.html">自定义 SQL 构造和编译扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="core/serializer.html">表达式序列化器扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="core/foundation.html">SQL 表达式语言基础构造</a></li>
<li class="toctree-l3"><a class="reference internal" href="core/visitors.html">访问者和遍历实用程序</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="core/schema.html">Schema 定义语言</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of Schema 定义语言</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="core/metadata.html">使用元数据描述数据库</a></li>
<li class="toctree-l3"><a class="reference internal" href="core/reflection.html">反映数据库对象</a></li>
<li class="toctree-l3"><a class="reference internal" href="core/defaults.html">列 INSERT/UPDATE 默认值</a></li>
<li class="toctree-l3"><a class="reference internal" href="core/constraints.html">定义约束和索引</a></li>
<li class="toctree-l3"><a class="reference internal" href="core/ddl.html">自定义 DDL</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="core/types.html">SQL 数据类型对象</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of SQL 数据类型对象</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="core/type_basics.html">类型层次结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="core/custom_types.html">自定义类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="core/type_api.html">基本类型 API</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="core/engines_connections.html">Engine和Connection的使用</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of Engine和Connection的使用</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="core/engines.html">Engine 配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="core/connections.html">使用Engines和Connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="core/pooling.html">连接池</a></li>
<li class="toctree-l3"><a class="reference internal" href="core/events.html">核心事件</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="core/api_basics.html">Core API 基础</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of Core API 基础</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="core/event.html">事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="core/inspection.html">运行时审查 API</a></li>
<li class="toctree-l3"><a class="reference internal" href="core/exceptions.html">Core 异常</a></li>
<li class="toctree-l3"><a class="reference internal" href="core/internals.html">Core 内部</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="dialects/index.html">Dialects</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of Dialects</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="dialects/postgresql.html">PostgreSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="dialects/mysql.html">MySQL 和 MariaDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="dialects/sqlite.html">SQLite</a></li>
<li class="toctree-l2"><a class="reference internal" href="dialects/oracle.html">Oracle</a></li>
<li class="toctree-l2"><a class="reference internal" href="dialects/mssql.html">Microsoft SQL Server</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="faq/index.html">常见问题</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of 常见问题</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="faq/installation.html">安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq/connections.html">连接 / 引擎</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq/metadata_schema.html">元数据 / Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq/sqlexpressions.html">SQL 表达式</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq/ormconfiguration.html">ORM 配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq/performance.html">性能</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq/sessions.html">会话 / 查询</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq/thirdparty.html">第三方包集成问题</a></li>
</ul>
</li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">错误消息</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="changelog/index.html">变更和迁移</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of 变更和迁移</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="changelog/migration_21.html">SQLAlchemy 2.1 有什么新功能？</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/changelog_21.html">2.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/changelog_20.html">2.0 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/changelog_14.html">1.4 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/changelog_13.html">1.3 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/changelog_12.html">1.2 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/changelog_11.html">1.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/changelog_10.html">1.0 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/changelog_09.html">0.9 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/changelog_08.html">0.8 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/changelog_07.html">0.7 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/changelog_06.html">0.6 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/changelog_05.html">0.5 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/changelog_04.html">0.4 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/changelog_03.html">0.3 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/changelog_02.html">0.2 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/changelog_01.html">0.1 Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/migration_20.html">SQLAlchemy 2.0 - Major Migration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/whatsnew_20.html">What’s New in SQLAlchemy 2.0?</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/migration_14.html">What’s New in SQLAlchemy 1.4?</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/migration_13.html">What’s New in SQLAlchemy 1.3?</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/migration_12.html">What’s New in SQLAlchemy 1.2?</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/migration_11.html">What’s New in SQLAlchemy 1.1?</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/migration_10.html">What’s New in SQLAlchemy 1.0?</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/migration_09.html">What’s New in SQLAlchemy 0.9?</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/migration_08.html">What’s New in SQLAlchemy 0.8?</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/migration_07.html">What’s New in SQLAlchemy 0.7?</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/migration_06.html">What’s New in SQLAlchemy 0.6?</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/migration_05.html">What’s new in SQLAlchemy 0.5?</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog/migration_04.html">What’s new in SQLAlchemy 0.4?</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="errors">
<span id="id1"></span><h1>错误消息<a class="headerlink" href="#errors" title="Link to this heading">¶</a></h1>
<p>Error Messages</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">中文</label><div class="tab-content docutils container">
<p>本节列出了 SQLAlchemy 抛出或发出的常见错误消息和警告的描述和背景。</p>
<p>SQLAlchemy 通常在 SQLAlchemy 特定的异常类的上下文中引发错误。有关这些类的详细信息，请参阅 <a class="reference internal" href="core/exceptions.html#core-exceptions-toplevel"><span class="std std-ref">Core 异常</span></a> 和 <a class="reference internal" href="orm/exceptions.html#orm-exceptions-toplevel"><span class="std std-ref">ORM 异常</span></a>。</p>
<p>SQLAlchemy 错误大致可以分为两类： <strong>编程时错误(programming-time error)</strong> 和 <strong>运行时错误(runtime error)</strong>。编程时错误是由于函数或方法被调用时传递了不正确的参数，或者其他配置方法（如无法解析的映射器配置）导致的错误。编程时错误通常是即时的和确定的。另一方面，运行时错误表示程序运行时响应某些任意条件（例如数据库连接耗尽或某些数据相关问题发生）而发生的失败。运行时错误更有可能出现在运行中的应用程序日志中，因为程序在响应负载和数据时遇到了这些状态。</p>
<p>由于运行时错误不容易重现，通常发生在程序运行时响应某些任意条件，因此它们更难调试，也会影响已经投入生产的程序。</p>
<p>在本节中，目标是尝试提供一些最常见的运行时错误以及编程时错误的背景信息。</p>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">英文</label><div class="tab-content docutils container">
<p>This section lists descriptions and background for common error messages
and warnings raised or emitted by SQLAlchemy.</p>
<p>SQLAlchemy normally raises errors within the context of a SQLAlchemy-specific
exception class.  For details on these classes, see
<a class="reference internal" href="core/exceptions.html#core-exceptions-toplevel"><span class="std std-ref">Core 异常</span></a> and <a class="reference internal" href="orm/exceptions.html#orm-exceptions-toplevel"><span class="std std-ref">ORM 异常</span></a>.</p>
<p>SQLAlchemy errors can roughly be separated into two categories, the
<strong>programming-time error</strong> and the <strong>runtime error</strong>.     Programming-time
errors are raised as a result of functions or methods being called with
incorrect arguments, or from other configuration-oriented methods such  as
mapper configurations that can’t be resolved.   The programming-time error is
typically immediate and deterministic.    The runtime error on the other hand
represents a failure that occurs as a program runs in response to some
condition that occurs arbitrarily, such as database connections being
exhausted or some data-related issue occurring.   Runtime errors are more
likely to be seen in the logs of a running application as the program
encounters these states in response to load and data being encountered.</p>
<p>Since runtime errors are not as easy to reproduce and often occur in response
to some arbitrary condition as the program runs, they are more difficult to
debug and also affect programs that have already been put into production.</p>
<p>Within this section, the goal is to try to provide background on some of the
most common runtime errors as well as programming time errors.</p>
</div>
</div>
<section id="id2">
<h2>连接和会话<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p>Connections and Transactions</p>
<section id="queuepool-x-y-z">
<span id="error-3o7r"></span><h3>QueuePool 大小限制 &lt;x&gt; 已达到溢出 &lt;y&gt;，连接超时，超时 &lt;z&gt;<a class="headerlink" href="#queuepool-x-y-z" title="Link to this heading">¶</a></h3>
<p>QueuePool limit of size &lt;x&gt; overflow &lt;y&gt; reached, connection timed out, timeout &lt;z&gt;</p>
<p>This is possibly the most common runtime error experienced, as it directly
involves the work load of the application surpassing a configured limit, one
which typically applies to nearly all SQLAlchemy applications.</p>
<p>The following points summarize what this error means, beginning with the
most fundamental points that most SQLAlchemy users should already be
familiar with.</p>
<ul>
<li><p><strong>The SQLAlchemy Engine object uses a pool of connections by default</strong> - What
this means is that when one makes use of a SQL database connection resource
of an <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> object, and then <a class="reference internal" href="glossary.html#term-releases"><span class="xref std std-term">releases</span></a> that resource,
the database connection itself remains connected to the database and
is returned to an internal queue where it can be used again.  Even though
the code may appear to be ending its conversation with the database, in many
cases the application will still maintain a fixed number of database connections
that persist until the application ends or the pool is explicitly disposed.</p></li>
<li><p>Because of the pool, when an application makes use of a SQL database
connection, most typically from either making use of <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Engine.connect" title="sqlalchemy.engine.Engine.connect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.connect()</span></code></a>
or when making queries using an ORM <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>, this activity
does not necessarily establish a new connection to the database at the
moment the connection object is acquired; it instead consults the
connection pool for a connection, which will often retrieve an existing
connection from the pool to be re-used.  If no connections are available,
the pool will create a new database connection, but only if the
pool has not surpassed a configured capacity.</p></li>
<li><p>The default pool used in most cases is called <a class="reference internal" href="core/pooling.html#sqlalchemy.pool.QueuePool" title="sqlalchemy.pool.QueuePool"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueuePool</span></code></a>.  When
you ask this pool to give you a connection and none are available, it
will create a new connection <strong>if the total number of connections in play
are less than a configured value</strong>.  This value is equal to the
<strong>pool size plus the max overflow</strong>.     That means if you have configured
your engine as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;mysql+mysqldb://u:p@host/db&quot;</span><span class="p">,</span> <span class="n">pool_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_overflow</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span></pre></div>
</div>
<p>The above <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> will allow <strong>at most 30 connections</strong> to be in
play at any time, not including connections that were detached from the
engine or invalidated.  If a request for a new connection arrives and
30 connections are already in use by other parts of the application,
the connection pool will block for a fixed period of time,
before timing out and raising this error message.</p>
<p>In order to allow for a higher number of connections be in use at once,
the pool can be adjusted using the
<a class="reference internal" href="core/engines.html#sqlalchemy.create_engine.params.pool_size" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.pool_size</span></code></a> and <a class="reference internal" href="core/engines.html#sqlalchemy.create_engine.params.max_overflow" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.max_overflow</span></code></a>
parameters as passed to the <a class="reference internal" href="core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a> function.      The timeout
to wait for a connection to be available is configured using the
<a class="reference internal" href="core/engines.html#sqlalchemy.create_engine.params.pool_timeout" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.pool_timeout</span></code></a> parameter.</p>
</li>
<li><p>The pool can be configured to have unlimited overflow by setting
<a class="reference internal" href="core/engines.html#sqlalchemy.create_engine.params.max_overflow" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.max_overflow</span></code></a> to the value “-1”.  With this setting,
the pool will still maintain a fixed pool of connections, however it will
never block upon a new connection being requested; it will instead unconditionally
make a new connection if none are available.</p>
<p>However, when running in this way, if the application has an issue where it
is using up all available connectivity resources, it will eventually hit the
configured limit of available connections on the database itself, which will
again return an error.  More seriously, when the application exhausts the
database of connections, it usually will have caused a great
amount of  resources to be used up before failing, and can also interfere
with other applications and database status mechanisms that rely upon being
able to connect to the database.</p>
<p>Given the above, the connection pool can be looked at as a <strong>safety valve
for connection use</strong>, providing a critical layer of protection against
a rogue application causing the entire database to become unavailable
to all other applications.   When receiving this error message, it is vastly
preferable to repair the issue using up too many connections and/or
configure the limits appropriately, rather than allowing for unlimited
overflow which does not actually solve the underlying issue.</p>
</li>
</ul>
<p>What causes an application to use up all the connections that it has available?</p>
<ul>
<li><p><strong>The application is fielding too many concurrent requests to do work based
on the configured value for the pool</strong> - This is the most straightforward
cause.  If you have
an application that runs in a thread pool that allows for 30 concurrent
threads, with one connection in use per thread, if your pool is not configured
to allow at least 30 connections checked out at once, you will get this
error once your application receives enough concurrent requests. Solution
is to raise the limits on the pool or lower the number of concurrent threads.</p></li>
<li><p><strong>The application is not returning connections to the pool</strong> - This is the
next most common reason, which is that the application is making use of the
connection pool, but the program is failing to <a class="reference internal" href="glossary.html#term-release"><span class="xref std std-term">release</span></a> these
connections and is instead leaving them open.   The connection pool as well
as the ORM <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> do have logic such that when the session and/or
connection object is garbage collected, it results in the underlying
connection resources being released, however this behavior cannot be relied
upon to release resources in a timely manner.</p>
<p>A common reason this can occur is that the application uses ORM sessions and
does not call <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session.close" title="sqlalchemy.orm.Session.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.close()</span></code></a> upon them one the work involving that
session is complete. Solution is to make sure ORM sessions if using the ORM,
or engine-bound <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> objects if using Core, are explicitly
closed at the end of the work being done, either via the appropriate
<code class="docutils literal notranslate"><span class="pre">.close()</span></code> method, or by using one of the available context managers (e.g.
“with:” statement) to properly release the resource.</p>
</li>
<li><p><strong>The application is attempting to run long-running transactions</strong> - A
database transaction is a very expensive resource, and should <strong>never be
left idle waiting for some event to occur</strong>.  If an application is waiting
for a user to push a button, or a result to come off of a long running job
queue, or is holding a persistent connection open to a browser, <strong>don’t
keep a database transaction open for the whole time</strong>.  As the application
needs to work with the database and interact with an event, open a short-lived
transaction at that point and then close it.</p></li>
<li><p><strong>The application is deadlocking</strong> - Also a common cause of this error and
more difficult to grasp, if an application is not able to complete its use
of a connection either due to an application-side or database-side deadlock,
the application can use up all the available connections which then leads to
additional requests receiving this error.   Reasons for deadlocks include:</p>
<ul class="simple">
<li><p>Using an implicit async system such as gevent or eventlet without
properly monkeypatching all socket libraries and drivers, or which
has bugs in not fully covering for all monkeypatched driver methods,
or less commonly when the async system is being used against CPU-bound
workloads and greenlets making use of database resources are simply waiting
too long to attend to them.  Neither implicit nor explicit async
programming frameworks are typically
necessary or appropriate for the vast majority of relational database
operations; if an application must use an async system for some area
of functionality, it’s best that database-oriented business methods
run within traditional threads that pass messages to the async part
of the application.</p></li>
<li><p>A database side deadlock, e.g. rows are mutually deadlocked</p></li>
<li><p>Threading errors, such as mutexes in a mutual deadlock, or calling
upon an already locked mutex in the same thread</p></li>
</ul>
</li>
</ul>
<p>Keep in mind an alternative to using pooling is to turn off pooling entirely.
See the section <a class="reference internal" href="core/pooling.html#pool-switching"><span class="std std-ref">切换池实现</span></a> for background on this.  However, note
that when this error message is occurring, it is <strong>always</strong> due to a bigger
problem in the application itself; the pool just helps to reveal the problem
sooner.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="core/pooling.html#pooling-toplevel"><span class="std std-ref">连接池</span></a></p>
<p><a class="reference internal" href="core/connections.html#connections-toplevel"><span class="std std-ref">使用Engines和Connection</span></a></p>
</div>
</section>
<section id="pool-asyncio">
<span id="error-pcls"></span><h3>Pool类不能与 asyncio 引擎一起使用（反之亦然）<a class="headerlink" href="#pool-asyncio" title="Link to this heading">¶</a></h3>
<p>Pool class cannot be used with asyncio engine (or vice versa)</p>
<p>The <a class="reference internal" href="core/pooling.html#sqlalchemy.pool.QueuePool" title="sqlalchemy.pool.QueuePool"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueuePool</span></code></a> pool class uses a <code class="docutils literal notranslate"><span class="pre">thread.Lock</span></code> object internally
and is not compatible with asyncio.  If using the <a class="reference internal" href="orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.create_async_engine" title="sqlalchemy.ext.asyncio.create_async_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_async_engine()</span></code></a>
function to create an <a class="reference internal" href="orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncEngine" title="sqlalchemy.ext.asyncio.AsyncEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncEngine</span></code></a>, the appropriate queue pool class
is <a class="reference internal" href="core/pooling.html#sqlalchemy.pool.AsyncAdaptedQueuePool" title="sqlalchemy.pool.AsyncAdaptedQueuePool"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncAdaptedQueuePool</span></code></a>, which is used automatically and does
not need to be specified.</p>
<p>In addition to <a class="reference internal" href="core/pooling.html#sqlalchemy.pool.AsyncAdaptedQueuePool" title="sqlalchemy.pool.AsyncAdaptedQueuePool"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncAdaptedQueuePool</span></code></a>, the <a class="reference internal" href="core/pooling.html#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullPool</span></code></a>
and <a class="reference internal" href="core/pooling.html#sqlalchemy.pool.StaticPool" title="sqlalchemy.pool.StaticPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">StaticPool</span></code></a> pool classes do not use locks and are also
suitable for use with async engines.</p>
<p>This error is also raised in reverse in the unlikely case that the
<a class="reference internal" href="core/pooling.html#sqlalchemy.pool.AsyncAdaptedQueuePool" title="sqlalchemy.pool.AsyncAdaptedQueuePool"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncAdaptedQueuePool</span></code></a> pool class is indicated explicitly with
the <a class="reference internal" href="core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a> function.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="core/pooling.html#pooling-toplevel"><span class="std std-ref">连接池</span></a></p>
</div>
</section>
<section id="rollback">
<span id="error-8s2b"></span><h3>无效事务回滚前无法重新连接。要继续前请先完全回滚(rollback)<a class="headerlink" href="#rollback" title="Link to this heading">¶</a></h3>
<p>Can’t reconnect until invalid transaction is rolled back.  Please rollback() fully before proceeding</p>
<p>This error condition refers to the case where a <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> was
invalidated, either due to a database disconnect detection or due to an
explicit call to <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Connection.invalidate" title="sqlalchemy.engine.Connection.invalidate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.invalidate()</span></code></a>, but there is still a
transaction present that was initiated either explicitly by the <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a>
method, or due to the connection automatically beginning a transaction as occurs
in the 2.x series of SQLAlchemy when any SQL statements are emitted.  When a connection is invalidated, any <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Transaction" title="sqlalchemy.engine.Transaction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transaction</span></code></a>
that was in progress is now in an invalid state, and must be explicitly rolled
back in order to remove it from the <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>.</p>
</section>
</section>
<section id="dbapi">
<span id="error-dbapi"></span><h2>DBAPI 错误<a class="headerlink" href="#dbapi" title="Link to this heading">¶</a></h2>
<p>DBAPI Errors</p>
<p>The Python database API, or DBAPI, is a specification for database drivers
which can be located at <a class="reference external" href="https://www.python.org/dev/peps/pep-0249/">Pep-249</a>.
This API specifies a set of exception classes that accommodate the full range
of failure modes of the database.</p>
<p>SQLAlchemy does not generate these exceptions directly.  Instead, they are
intercepted from the database driver and wrapped by the SQLAlchemy-provided
exception <a class="reference internal" href="core/exceptions.html#sqlalchemy.exc.DBAPIError" title="sqlalchemy.exc.DBAPIError"><code class="xref py py-class docutils literal notranslate"><span class="pre">DBAPIError</span></code></a>, however the messaging within the exception is
<strong>generated by the driver, not SQLAlchemy</strong>.</p>
<section id="error-rvf5">
<span id="id3"></span><h3>接口错误<a class="headerlink" href="#error-rvf5" title="Link to this heading">¶</a></h3>
<p>InterfaceError</p>
<p>Exception raised for errors that are related to the database interface rather
than the database itself.</p>
<p>This error is a <a class="reference internal" href="#error-dbapi"><span class="std std-ref">DBAPI Error</span></a> and originates from
the database driver (DBAPI), not SQLAlchemy itself.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">InterfaceError</span></code> is sometimes raised by drivers in the context
of the database connection being dropped, or not being able to connect
to the database.   For tips on how to deal with this, see the section
<a class="reference internal" href="core/pooling.html#pool-disconnects"><span class="std std-ref">处理断开连接</span></a>.</p>
</section>
<section id="error-4xp6">
<span id="id4"></span><h3>数据库错误<a class="headerlink" href="#error-4xp6" title="Link to this heading">¶</a></h3>
<p>DatabaseError</p>
<p>Exception raised for errors that are related to the database itself, and not
the interface or data being passed.</p>
<p>This error is a <a class="reference internal" href="#error-dbapi"><span class="std std-ref">DBAPI Error</span></a> and originates from
the database driver (DBAPI), not SQLAlchemy itself.</p>
</section>
<section id="error-9h9h">
<span id="id5"></span><h3>数据错误<a class="headerlink" href="#error-9h9h" title="Link to this heading">¶</a></h3>
<p>DataError</p>
<p>Exception raised for errors that are due to problems with the processed data
like division by zero, numeric value out of range, etc.</p>
<p>This error is a <a class="reference internal" href="#error-dbapi"><span class="std std-ref">DBAPI Error</span></a> and originates from
the database driver (DBAPI), not SQLAlchemy itself.</p>
</section>
<section id="error-e3q8">
<span id="id6"></span><h3>操作错误<a class="headerlink" href="#error-e3q8" title="Link to this heading">¶</a></h3>
<p>OperationalError</p>
<p>Exception raised for errors that are related to the database’s operation and
not necessarily under the control of the programmer, e.g. an unexpected
disconnect occurs, the data source name is not found, a transaction could not
be processed, a memory allocation error occurred during processing, etc.</p>
<p>This error is a <a class="reference internal" href="#error-dbapi"><span class="std std-ref">DBAPI Error</span></a> and originates from
the database driver (DBAPI), not SQLAlchemy itself.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">OperationalError</span></code> is the most common (but not the only) error class used
by drivers in the context of the database connection being dropped, or not
being able to connect to the database.   For tips on how to deal with this, see
the section <a class="reference internal" href="core/pooling.html#pool-disconnects"><span class="std std-ref">处理断开连接</span></a>.</p>
</section>
<section id="error-gkpj">
<span id="id7"></span><h3>完整性错误<a class="headerlink" href="#error-gkpj" title="Link to this heading">¶</a></h3>
<p>IntegrityError</p>
<p>Exception raised when the relational integrity of the database is affected,
e.g. a foreign key check fails.</p>
<p>This error is a <a class="reference internal" href="#error-dbapi"><span class="std std-ref">DBAPI Error</span></a> and originates from
the database driver (DBAPI), not SQLAlchemy itself.</p>
</section>
<section id="error-2j85">
<span id="id8"></span><h3>内部错误<a class="headerlink" href="#error-2j85" title="Link to this heading">¶</a></h3>
<p>InternalError</p>
<p>Exception raised when the database encounters an internal error, e.g. the
cursor is not valid anymore, the transaction is out of sync, etc.</p>
<p>This error is a <a class="reference internal" href="#error-dbapi"><span class="std std-ref">DBAPI Error</span></a> and originates from
the database driver (DBAPI), not SQLAlchemy itself.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">InternalError</span></code> is sometimes raised by drivers in the context
of the database connection being dropped, or not being able to connect
to the database.   For tips on how to deal with this, see the section
<a class="reference internal" href="core/pooling.html#pool-disconnects"><span class="std std-ref">处理断开连接</span></a>.</p>
</section>
<section id="error-f405">
<span id="id9"></span><h3>编程错误<a class="headerlink" href="#error-f405" title="Link to this heading">¶</a></h3>
<p>ProgrammingError</p>
<p>Exception raised for programming errors, e.g. table not found or already
exists, syntax error in the SQL statement, wrong number of parameters
specified, etc.</p>
<p>This error is a <a class="reference internal" href="#error-dbapi"><span class="std std-ref">DBAPI Error</span></a> and originates from
the database driver (DBAPI), not SQLAlchemy itself.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ProgrammingError</span></code> is sometimes raised by drivers in the context
of the database connection being dropped, or not being able to connect
to the database.   For tips on how to deal with this, see the section
<a class="reference internal" href="core/pooling.html#pool-disconnects"><span class="std std-ref">处理断开连接</span></a>.</p>
</section>
<section id="error-tw8g">
<span id="id10"></span><h3>不支持错误<a class="headerlink" href="#error-tw8g" title="Link to this heading">¶</a></h3>
<p>NotSupportedError</p>
<p>Exception raised in case a method or database API was used which is not
supported by the database, e.g. requesting a .rollback() on a connection that
does not support transaction or has transactions turned off.</p>
<p>This error is a <a class="reference internal" href="#error-dbapi"><span class="std std-ref">DBAPI Error</span></a> and originates from
the database driver (DBAPI), not SQLAlchemy itself.</p>
</section>
</section>
<section id="sql-expression-language">
<h2>SQL Expression Language<a class="headerlink" href="#sql-expression-language" title="Link to this heading">¶</a></h2>
<section id="caching-caveats">
<span id="error-cprf"></span><span id="id11"></span><h3>对象不会产生缓存键，性能影响<a class="headerlink" href="#caching-caveats" title="Link to this heading">¶</a></h3>
<p>Object will not produce a cache key, Performance Implications</p>
<p>SQLAlchemy as of version 1.4 includes a
<a class="reference internal" href="core/connections.html#sql-caching"><span class="std std-ref">SQL compilation caching facility</span></a> which will allow
Core and ORM SQL constructs to cache their stringified form, along with other
structural information used to fetch results from the statement, allowing the
relatively expensive string compilation process to be skipped when another
structurally equivalent construct is next used. This system
relies upon functionality that is implemented for all SQL constructs, including
objects such as  <a class="reference internal" href="core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>,
<a class="reference internal" href="core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a>, and <a class="reference internal" href="core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeEngine</span></code></a> objects, to produce a
<strong>cache key</strong> which fully represents their state to the degree that it affects
the SQL compilation process.</p>
<p>If the warnings in question refer to widely used objects such as
<a class="reference internal" href="core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> objects, and are shown to be affecting the majority of
SQL constructs being emitted (using the estimation techniques described at
<a class="reference internal" href="core/connections.html#sql-caching-logging"><span class="std std-ref">使用日志记录估计缓存性能</span></a>) such that caching is generally not enabled for an
application, this will negatively impact performance and can in some cases
effectively produce a <strong>performance degradation</strong> compared to prior SQLAlchemy
versions. The FAQ at <a class="reference internal" href="faq/performance.html#faq-new-caching"><span class="std std-ref">为什么升级到 1.4 和/或 2.x 后我的应用程序运行缓慢？</span></a> covers this in additional detail.</p>
<section id="id12">
<h4>如果有任何疑问，缓存会自行禁用<a class="headerlink" href="#id12" title="Link to this heading">¶</a></h4>
<p>Caching disables itself if there’s any doubt</p>
<p>Caching relies on being able to generate a cache key that accurately represents
the <strong>complete structure</strong> of a statement in a <strong>consistent</strong> fashion. If a particular
SQL construct (or type) does not have the appropriate directives in place which
allow it to generate a proper cache key, then caching cannot be safely enabled:</p>
<ul class="simple">
<li><p>The cache key must represent the <strong>complete structure</strong>: If the usage of two
separate instances of that construct may result in different SQL being
rendered, caching the SQL against the first instance of the element using a
cache key that does not capture the distinct differences between the first and
second elements will result in incorrect SQL being cached and rendered for the
second instance.</p></li>
<li><p>The cache key must be <strong>consistent</strong>: If a construct represents state that
changes every time, such as a literal value, producing unique SQL for every
instance of it, this construct is also not safe to cache, as repeated use of
the construct will quickly fill up the statement cache with unique SQL strings
that will likely not be used again, defeating the purpose of the cache.</p></li>
</ul>
<p>For the above two reasons, SQLAlchemy’s caching system is <strong>extremely
conservative</strong> about deciding to cache the SQL corresponding to an object.</p>
</section>
<section id="id13">
<h4>缓存的断言属性<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h4>
<p>Assertion attributes for caching</p>
<p>The warning is emitted based on the criteria below.  For further detail on
each, see the section <a class="reference internal" href="faq/performance.html#faq-new-caching"><span class="std std-ref">为什么升级到 1.4 和/或 2.x 后我的应用程序运行缓慢？</span></a>.</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="core/internals.html#sqlalchemy.engine.Dialect" title="sqlalchemy.engine.Dialect"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dialect</span></code></a> itself (i.e. the module that is specified by the
first part of the URL we pass to <a class="reference internal" href="core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>, like
<code class="docutils literal notranslate"><span class="pre">postgresql+psycopg2://</span></code>), must indicate it has been reviewed and tested
to support caching correctly, which is indicated by the
<a class="reference internal" href="core/internals.html#sqlalchemy.engine.Dialect.supports_statement_cache" title="sqlalchemy.engine.Dialect.supports_statement_cache"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Dialect.supports_statement_cache</span></code></a> attribute being set to <code class="docutils literal notranslate"><span class="pre">True</span></code>.
When using third party dialects, consult with the maintainers of the dialect
so that they may follow the <a class="reference internal" href="core/connections.html#engine-thirdparty-caching"><span class="std std-ref">steps to ensure caching may be enabled</span></a> in their dialect and publish a new release.</p></li>
<li><p>Third party or user defined types that inherit from either
<a class="reference internal" href="core/custom_types.html#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeDecorator</span></code></a> or <a class="reference internal" href="core/custom_types.html#sqlalchemy.types.UserDefinedType" title="sqlalchemy.types.UserDefinedType"><code class="xref py py-class docutils literal notranslate"><span class="pre">UserDefinedType</span></code></a> must include the
<a class="reference internal" href="core/type_api.html#sqlalchemy.types.ExternalType.cache_ok" title="sqlalchemy.types.ExternalType.cache_ok"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ExternalType.cache_ok</span></code></a> attribute in their definition, including for
all derived subclasses, following the guidelines described in the docstring
for <a class="reference internal" href="core/type_api.html#sqlalchemy.types.ExternalType.cache_ok" title="sqlalchemy.types.ExternalType.cache_ok"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ExternalType.cache_ok</span></code></a>. As before, if these datatypes are
imported from third party libraries, consult with the maintainers of that
library so that they may provide the necessary changes to their library and
publish a new release.</p></li>
<li><p>Third party or user defined SQL constructs that subclass from classes such
as <a class="reference internal" href="core/foundation.html#sqlalchemy.sql.expression.ClauseElement" title="sqlalchemy.sql.expression.ClauseElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClauseElement</span></code></a>, <a class="reference internal" href="core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>, <a class="reference internal" href="core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a>
etc, including simple subclasses as well as those which are designed to
work with the <a class="reference internal" href="core/compiler.html#sqlalchemy-ext-compiler-toplevel"><span class="std std-ref">自定义 SQL 构造和编译扩展</span></a>, should normally
include the <a class="reference internal" href="core/foundation.html#sqlalchemy.sql.traversals.HasCacheKey.inherit_cache" title="sqlalchemy.sql.traversals.HasCacheKey.inherit_cache"><code class="xref py py-attr docutils literal notranslate"><span class="pre">HasCacheKey.inherit_cache</span></code></a> attribute set to <code class="docutils literal notranslate"><span class="pre">True</span></code>
or <code class="docutils literal notranslate"><span class="pre">False</span></code> based on the design of the construct, following the guidelines
described at <a class="reference internal" href="core/compiler.html#compilerext-caching"><span class="std std-ref">Enabling Caching Support for Custom Constructs</span></a>.</p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="core/connections.html#sql-caching-logging"><span class="std std-ref">使用日志记录估计缓存性能</span></a> - background on observing cache behavior
and efficiency</p>
<p><a class="reference internal" href="faq/performance.html#faq-new-caching"><span class="std std-ref">为什么升级到 1.4 和/或 2.x 后我的应用程序运行缓慢？</span></a> - in the <a class="reference internal" href="faq/index.html#faq-toplevel"><span class="std std-ref">常见问题</span></a> section</p>
</div>
</section>
</section>
<section id="strsqlcompiler-element-type">
<span id="error-l7de"></span><h3>编译器 StrSQLCompiler 无法呈现类型为 &lt;element type&gt; 的元素<a class="headerlink" href="#strsqlcompiler-element-type" title="Link to this heading">¶</a></h3>
<p>Compiler StrSQLCompiler can’t render element of type &lt;element type&gt;</p>
<p>This error usually occurs when attempting to stringify a SQL expression
construct that includes elements which are not part of the default compilation;
in this case, the error will be against the <a class="reference internal" href="core/internals.html#sqlalchemy.sql.compiler.StrSQLCompiler" title="sqlalchemy.sql.compiler.StrSQLCompiler"><code class="xref py py-class docutils literal notranslate"><span class="pre">StrSQLCompiler</span></code></a> class.
In less common cases, it can also occur when the wrong kind of SQL expression
is used with a particular type of database backend; in those cases, other
kinds of SQL compiler classes will be named, such as <code class="docutils literal notranslate"><span class="pre">SQLCompiler</span></code> or
<code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.PGCompiler</span></code>.  The guidance below is
more specific to the “stringification” use case but describes the general
background as well.</p>
<p>Normally, a Core SQL construct or ORM <a class="reference internal" href="orm/queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object can be stringified
directly, such as when we use <code class="docutils literal notranslate"><span class="pre">print()</span></code>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">column</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
<div class='show_sql_print'><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">:</span><span class="n">x_1</span>
</div></pre></div>
</div>
<p>When the above SQL expression is stringified, the <a class="reference internal" href="core/internals.html#sqlalchemy.sql.compiler.StrSQLCompiler" title="sqlalchemy.sql.compiler.StrSQLCompiler"><code class="xref py py-class docutils literal notranslate"><span class="pre">StrSQLCompiler</span></code></a>
compiler class is used, which is a special statement compiler that is invoked
when a construct is stringified without any dialect-specific information.</p>
<p>However, there are many constructs that are specific to some particular kind
of database dialect, for which the <a class="reference internal" href="core/internals.html#sqlalchemy.sql.compiler.StrSQLCompiler" title="sqlalchemy.sql.compiler.StrSQLCompiler"><code class="xref py py-class docutils literal notranslate"><span class="pre">StrSQLCompiler</span></code></a> doesn’t know how
to turn into a string, such as the PostgreSQL
<a class="reference internal" href="dialects/postgresql.html#postgresql-insert-on-conflict"><span class="std std-ref">INSERT…ON CONFLICT (Upsert)</span></a> construct:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects.postgresql</span><span class="w"> </span><span class="kn">import</span> <span class="n">insert</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">table</span><span class="p">,</span> <span class="n">column</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_table</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="s2">&quot;my_table&quot;</span><span class="p">,</span> <span class="n">column</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">insert_stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">insert_stmt</span> <span class="o">=</span> <span class="n">insert_stmt</span><span class="o">.</span><span class="n">on_conflict_do_nothing</span><span class="p">(</span><span class="n">index_elements</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">insert_stmt</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>

<span class="x">...</span>

<span class="x">sqlalchemy.exc.UnsupportedCompilationError:</span>
<span class="x">Compiler &lt;sqlalchemy.sql.compiler.StrSQLCompiler object at 0x7f04fc17e320&gt;</span>
<span class="x">can&#39;t render element of type</span>
<span class="x">&lt;class &#39;sqlalchemy.dialects.postgresql.dml.OnConflictDoNothing&#39;&gt;</span></pre></div>
</div>
<p>In order to stringify constructs that are specific to particular backend,
the <a class="reference internal" href="core/foundation.html#sqlalchemy.sql.expression.ClauseElement.compile" title="sqlalchemy.sql.expression.ClauseElement.compile"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ClauseElement.compile()</span></code></a> method must be used, passing either an
<a class="reference internal" href="core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> or a <a class="reference internal" href="core/internals.html#sqlalchemy.engine.Dialect" title="sqlalchemy.engine.Dialect"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dialect</span></code></a> object which will invoke the correct
compiler.   Below we use a PostgreSQL dialect:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.dialects</span><span class="w"> </span><span class="kn">import</span> <span class="n">postgresql</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">insert_stmt</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">dialect</span><span class="o">=</span><span class="n">postgresql</span><span class="o">.</span><span class="n">dialect</span><span class="p">()))</span>
<div class='show_sql_print'><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">my_table</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">CONFLICT</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="k">DO</span><span class="w"> </span><span class="k">NOTHING</span>
</div></pre></div>
</div>
<p>For an ORM <a class="reference internal" href="orm/queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> object, the statement can be accessed using the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Query.statement</span></code> accessor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">statement</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">statement</span>
<span class="n">print</span><span class="p">(</span><span class="n">statement</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">dialect</span><span class="o">=</span><span class="n">postgresql</span><span class="o">.</span><span class="n">dialect</span><span class="p">()))</span></pre></div>
</div>
<p>See the FAQ link below for additional detail on direct stringification /
compilation of SQL elements.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="faq/sqlexpressions.html#faq-sql-expression-string"><span class="std std-ref">如何将 SQL 表达式呈现为字符串，可能内联绑定参数？</span></a></p>
</div>
</section>
<section id="typeerror-columnproperty-something-operator">
<h3>TypeError：’ColumnProperty’ 和 &lt;something&gt; 的实例之间不支持 &lt;operator&gt;<a class="headerlink" href="#typeerror-columnproperty-something-operator" title="Link to this heading">¶</a></h3>
<p>TypeError: &lt;operator&gt; not supported between instances of ‘ColumnProperty’ and &lt;something&gt;</p>
<p>This often occurs when attempting to use a <a class="reference internal" href="orm/mapping_api.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_property()</span></code></a> or
<a class="reference internal" href="orm/queryguide/columns.html#sqlalchemy.orm.deferred" title="sqlalchemy.orm.deferred"><code class="xref py py-func docutils literal notranslate"><span class="pre">deferred()</span></code></a> object in the context of a SQL expression, usually within
declarative such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Bar</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;bar&quot;</span>

    <span class="n">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">cprop</span> <span class="o">=</span> <span class="n">deferred</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">))</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span><span class="n">CheckConstraint</span><span class="p">(</span><span class="n">cprop</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">),)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>Above, the <code class="docutils literal notranslate"><span class="pre">cprop</span></code> attribute is used inline before it has been mapped,
however this <code class="docutils literal notranslate"><span class="pre">cprop</span></code> attribute is not a <a class="reference internal" href="core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>,
it’s a <a class="reference internal" href="orm/internals.html#sqlalchemy.orm.ColumnProperty" title="sqlalchemy.orm.ColumnProperty"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnProperty</span></code></a>, which is an interim object and therefore
does not have the full functionality of either the <a class="reference internal" href="core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> object
or the <a class="reference internal" href="orm/internals.html#sqlalchemy.orm.InstrumentedAttribute" title="sqlalchemy.orm.InstrumentedAttribute"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstrumentedAttribute</span></code></a> object that will be mapped onto the
<code class="docutils literal notranslate"><span class="pre">Bar</span></code> class once the declarative process is complete.</p>
<p>While the <a class="reference internal" href="orm/internals.html#sqlalchemy.orm.ColumnProperty" title="sqlalchemy.orm.ColumnProperty"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnProperty</span></code></a> does have a <code class="docutils literal notranslate"><span class="pre">__clause_element__()</span></code> method,
which allows it to work in some column-oriented contexts, it can’t work in an
open-ended comparison context as illustrated above, since it has no Python
<code class="docutils literal notranslate"><span class="pre">__eq__()</span></code> method that would allow it to interpret the comparison to the
number “5” as a SQL expression and not a regular Python comparison.</p>
<p>The solution is to access the <a class="reference internal" href="core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> directly using the
<a class="reference internal" href="orm/internals.html#sqlalchemy.orm.ColumnProperty.expression" title="sqlalchemy.orm.ColumnProperty.expression"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ColumnProperty.expression</span></code></a> attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Bar</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;bar&quot;</span>

    <span class="n">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">cprop</span> <span class="o">=</span> <span class="n">deferred</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">))</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span><span class="n">CheckConstraint</span><span class="p">(</span><span class="n">cprop</span><span class="o">.</span><span class="n">expression</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">),)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
</section>
<section id="x-y">
<span id="error-cd3x"></span><h3>绑定参数 &lt;x&gt; 需要一个值（在参数组 &lt;y&gt; 中）<a class="headerlink" href="#x-y" title="Link to this heading">¶</a></h3>
<p>A value is required for bind parameter &lt;x&gt; (in parameter group &lt;y&gt;)</p>
<p>This error occurs when a statement makes use of <a class="reference internal" href="core/sqlelement.html#sqlalchemy.sql.expression.bindparam" title="sqlalchemy.sql.expression.bindparam"><code class="xref py py-func docutils literal notranslate"><span class="pre">bindparam()</span></code></a> either
implicitly or explicitly and does not provide a value when the statement
is executed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">bindparam</span><span class="p">(</span><span class="s2">&quot;my_param&quot;</span><span class="p">))</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span></pre></div>
</div>
<p>Above, no value has been provided for the parameter “my_param”.  The correct
approach is to provide a value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;my_param&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span></pre></div>
</div>
<p>When the message takes the form “a value is required for bind parameter &lt;x&gt;
in parameter group &lt;y&gt;”, the message is referring to the “executemany” style
of execution.  In this case, the statement is typically an INSERT, UPDATE,
or DELETE and a list of parameters is being passed.   In this format, the
statement may be generated dynamically to include parameter positions for
every parameter given in the argument list, where it will use the
<strong>first set of parameters</strong> to determine what these should be.</p>
<p>For example, the statement below is calculated based on the first parameter
set to require the parameters, “a”, “b”, and “c” - these names determine
the final string format of the statement which will be used for each
set of parameters in the list.  As the second entry does not contain “b”,
this error is generated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span> <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span> <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">))</span>

<span class="n">e</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="n">t</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span>
    <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
    <span class="p">],</span>
<span class="p">)</span></pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">exc</span><span class="o">.</span><span class="n">StatementError</span><span class="p">:</span> <span class="p">(</span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">)</span>
<span class="n">A</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">required</span> <span class="k">for</span> <span class="n">bind</span> <span class="n">parameter</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="ow">in</span> <span class="n">parameter</span> <span class="n">group</span> <span class="mi">1</span>
<span class="p">[</span><span class="n">SQL</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;INSERT INTO t (a, b, c) VALUES (?, ?, ?)&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="n">parameters</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}]]</span></pre></div>
</div>
<p>Since “b” is required, pass it as <code class="docutils literal notranslate"><span class="pre">None</span></code> so that the INSERT may proceed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">e</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="n">t</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span>
    <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
    <span class="p">],</span>
<span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="tutorial/dbapi_transactions.html#tutorial-sending-parameters"><span class="std std-ref">发送参数</span></a></p>
</div>
</section>
<section id="from-select-from-subquery">
<span id="error-89ve"></span><h3>预期为 FROM 子句，得到 Select。要创建 FROM 子句，请使用 .subquery() 方法<a class="headerlink" href="#from-select-from-subquery" title="Link to this heading">¶</a></h3>
<p>Expected FROM clause, got Select.  To create a FROM clause, use the .subquery() method</p>
<p>This refers to a change made as of SQLAlchemy 1.4 where a SELECT statement as generated
by a function such as <a class="reference internal" href="core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a>, but also including things like unions and textual
SELECT expressions are no longer considered to be <a class="reference internal" href="core/selectable.html#sqlalchemy.sql.expression.FromClause" title="sqlalchemy.sql.expression.FromClause"><code class="xref py py-class docutils literal notranslate"><span class="pre">FromClause</span></code></a> objects and
can’t be placed directly in the FROM clause of another SELECT statement without them
being wrapped in a <a class="reference internal" href="core/selectable.html#sqlalchemy.sql.expression.Subquery" title="sqlalchemy.sql.expression.Subquery"><code class="xref py py-class docutils literal notranslate"><span class="pre">Subquery</span></code></a> first.   This is a major conceptual change in the
Core and the full rationale is discussed at <a class="reference internal" href="changelog/migration_14.html#change-4617"><span class="std std-ref">A SELECT statement is no longer implicitly considered to be a FROM clause</span></a>.</p>
<p>Given an example as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span> <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span> <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">))</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></pre></div>
</div>
<p>Above, <code class="docutils literal notranslate"><span class="pre">stmt</span></code> represents a SELECT statement.  The error is produced when we want
to use <code class="docutils literal notranslate"><span class="pre">stmt</span></code> directly as a FROM clause in another SELECT, such as if we
attempted to select from it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_stmt_1</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span></pre></div>
</div>
<p>Or if we wanted to use it in a FROM clause such as in a JOIN:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_stmt_2</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">some_table</span><span class="p">)</span><span class="o">.</span><span class="n">select_from</span><span class="p">(</span><span class="n">some_table</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stmt</span><span class="p">))</span></pre></div>
</div>
<p>In previous versions of SQLAlchemy, using a SELECT inside of another SELECT
would produce a parenthesized, unnamed subquery.   In most cases, this form of
SQL is not very useful as databases like MySQL and PostgreSQL require that
subqueries in FROM clauses have named aliases, which means using the
<a class="reference internal" href="core/selectable.html#sqlalchemy.sql.expression.SelectBase.alias" title="sqlalchemy.sql.expression.SelectBase.alias"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SelectBase.alias()</span></code></a> method or as of 1.4 using the
<a class="reference internal" href="core/selectable.html#sqlalchemy.sql.expression.SelectBase.subquery" title="sqlalchemy.sql.expression.SelectBase.subquery"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SelectBase.subquery()</span></code></a> method to produce this.   On other databases, it
is still much clearer for the subquery to have a name to resolve any ambiguity
on future references to column  names inside the subquery.</p>
<p>Beyond the above practical reasons, there are a lot of other SQLAlchemy-oriented
reasons the change is being made.  The correct form of the above two statements
therefore requires that <a class="reference internal" href="core/selectable.html#sqlalchemy.sql.expression.SelectBase.subquery" title="sqlalchemy.sql.expression.SelectBase.subquery"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SelectBase.subquery()</span></code></a> is used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subq</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">subquery</span><span class="p">()</span>

<span class="n">new_stmt_1</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">subq</span><span class="p">)</span>

<span class="n">new_stmt_2</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">some_table</span><span class="p">)</span><span class="o">.</span><span class="n">select_from</span><span class="p">(</span><span class="n">some_table</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subq</span><span class="p">))</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="changelog/migration_14.html#change-4617"><span class="std std-ref">A SELECT statement is no longer implicitly considered to be a FROM clause</span></a></p>
</div>
</section>
<section id="error-xaj1">
<span id="id14"></span><h3>正在为原始子句元素自动生成别名<a class="headerlink" href="#error-xaj1" title="Link to this heading">¶</a></h3>
<p>An alias is being generated automatically for raw clauseelement</p>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4.26 版本加入.</span></p>
</div>
<p>This deprecation warning refers to a very old and likely not well known pattern
that applies to the legacy <a class="reference internal" href="orm/queryguide/query.html#sqlalchemy.orm.Query.join" title="sqlalchemy.orm.Query.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.join()</span></code></a> method as well as the
<a class="reference internal" href="glossary.html#term-2.0-style"><span class="xref std std-term">2.0 style</span></a> <a class="reference internal" href="core/selectable.html#sqlalchemy.sql.expression.Select.join" title="sqlalchemy.sql.expression.Select.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join()</span></code></a> method, where a join can be stated
in terms of a <a class="reference internal" href="orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> but the target is the
<a class="reference internal" href="core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> or other Core selectable to which the class is mapped,
rather than an ORM entity such as a mapped class or <a class="reference internal" href="orm/queryguide/api.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a>
construct:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a1</span> <span class="o">=</span> <span class="n">Address</span><span class="o">.</span><span class="n">__table__</span>

<span class="n">q</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">)</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">email_address</span> <span class="o">==</span> <span class="s2">&quot;ed@foo.com&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="p">)</span></pre></div>
</div>
<p>The above pattern also allows an arbitrary selectable, such as
a Core <a class="reference internal" href="core/selectable.html#sqlalchemy.sql.expression.Join" title="sqlalchemy.sql.expression.Join"><code class="xref py py-class docutils literal notranslate"><span class="pre">Join</span></code></a> or <a class="reference internal" href="core/selectable.html#sqlalchemy.sql.expression.Alias" title="sqlalchemy.sql.expression.Alias"><code class="xref py py-class docutils literal notranslate"><span class="pre">Alias</span></code></a> object,
however there is no automatic adaptation of this element, meaning the
Core element would need to be referenced directly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a1</span> <span class="o">=</span> <span class="n">Address</span><span class="o">.</span><span class="n">__table__</span><span class="o">.</span><span class="n">alias</span><span class="p">()</span>

<span class="n">q</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">)</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">a1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">email_address</span> <span class="o">==</span> <span class="s2">&quot;ed@foo.com&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="p">)</span></pre></div>
</div>
<p>The correct way to specify a join target is always by using the mapped
class itself or an <a class="reference internal" href="orm/queryguide/api.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-class docutils literal notranslate"><span class="pre">aliased</span></code></a> object, in the latter case using the
<a class="reference internal" href="orm/internals.html#sqlalchemy.orm.PropComparator.of_type" title="sqlalchemy.orm.PropComparator.of_type"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PropComparator.of_type()</span></code></a> modifier to set up an alias:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># normal join to relationship entity</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">email_address</span> <span class="o">==</span> <span class="s2">&quot;ed@foo.com&quot;</span><span class="p">)</span>

<span class="c1"># name Address target explicitly, not necessary but legal</span>
<span class="n">q</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Address</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">)</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">email_address</span> <span class="o">==</span> <span class="s2">&quot;ed@foo.com&quot;</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>Join to an alias:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">aliased</span>

<span class="n">a1</span> <span class="o">=</span> <span class="n">aliased</span><span class="p">(</span><span class="n">Address</span><span class="p">)</span>

<span class="c1"># of_type() form; recommended</span>
<span class="n">q</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">a1</span><span class="p">))</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">a1</span><span class="o">.</span><span class="n">email_address</span> <span class="o">==</span> <span class="s2">&quot;ed@foo.com&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># target, onclause form</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">a1</span><span class="o">.</span><span class="n">email_address</span> <span class="o">==</span> <span class="s2">&quot;ed@foo.com&quot;</span><span class="p">)</span></pre></div>
</div>
</section>
<section id="error-xaj2">
<span id="id15"></span><h3>由于表格重叠，正在自动生成别名<a class="headerlink" href="#error-xaj2" title="Link to this heading">¶</a></h3>
<p>An alias is being generated automatically due to overlapping tables</p>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4.26 版本加入.</span></p>
</div>
<p>This warning is typically generated when querying using the
<a class="reference internal" href="core/selectable.html#sqlalchemy.sql.expression.Select.join" title="sqlalchemy.sql.expression.Select.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join()</span></code></a> method or the legacy <a class="reference internal" href="orm/queryguide/query.html#sqlalchemy.orm.Query.join" title="sqlalchemy.orm.Query.join"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.join()</span></code></a> method
with mappings that involve joined table inheritance. The issue is that when
joining between two joined inheritance models that share a common base table, a
proper SQL JOIN between the two entities cannot be formed without applying an
alias to one side or the other; SQLAlchemy applies an alias to the right side
of the join. For example given a joined inheritance mapping as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Employee</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;employee&quot;</span>
    <span class="n">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">manager_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;manager.id&quot;</span><span class="p">))</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">type</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="n">reports_to</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Manager&quot;</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="n">manager_id</span><span class="p">)</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;polymorphic_identity&quot;</span><span class="p">:</span> <span class="s2">&quot;employee&quot;</span><span class="p">,</span>
        <span class="s2">&quot;polymorphic_on&quot;</span><span class="p">:</span> <span class="n">type</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Manager</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;manager&quot;</span>
    <span class="n">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;employee.id&quot;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;polymorphic_identity&quot;</span><span class="p">:</span> <span class="s2">&quot;manager&quot;</span><span class="p">,</span>
        <span class="s2">&quot;inherit_condition&quot;</span><span class="p">:</span> <span class="n">id</span> <span class="o">==</span> <span class="n">Employee</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="p">}</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>The above mapping includes a relationship between the <code class="docutils literal notranslate"><span class="pre">Employee</span></code> and
<code class="docutils literal notranslate"><span class="pre">Manager</span></code> classes.  Since both classes make use of the “employee” database
table, from a SQL perspective this is a
<a class="reference internal" href="orm/self_referential.html#self-referential"><span class="std std-ref">self referential relationship</span></a>.  If we wanted to
query from both the <code class="docutils literal notranslate"><span class="pre">Employee</span></code> and <code class="docutils literal notranslate"><span class="pre">Manager</span></code> models using a join, at the
SQL level the “employee” table needs to be included twice in the query, which
means it must be aliased.   When we create such a join using the SQLAlchemy
ORM, we get SQL that looks like the following:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Employee</span><span class="p">,</span> <span class="n">Manager</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Employee</span><span class="o">.</span><span class="n">reports_to</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">manager_id</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
<span class="n">employee</span><span class="p">.</span><span class="k">type</span><span class="p">,</span><span class="w"> </span><span class="n">manager_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_1</span><span class="p">,</span><span class="w"> </span><span class="n">employee_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_2</span><span class="p">,</span>
<span class="n">employee_1</span><span class="p">.</span><span class="n">manager_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">manager_id_1</span><span class="p">,</span><span class="w"> </span><span class="n">employee_1</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">name_1</span><span class="p">,</span>
<span class="n">employee_1</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">type_1</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="k">JOIN</span>
<span class="p">(</span><span class="n">employee</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_1</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">manager_1</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">manager_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">employee_1</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
<span class="k">ON</span><span class="w"> </span><span class="n">manager_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">manager_id</span>
</div></pre></div>
</div>
<p>Above, the SQL selects FROM the <code class="docutils literal notranslate"><span class="pre">employee</span></code> table, representing the
<code class="docutils literal notranslate"><span class="pre">Employee</span></code> entity in the query. It then joins to a right-nested join of
<code class="docutils literal notranslate"><span class="pre">employee</span> <span class="pre">AS</span> <span class="pre">employee_1</span> <span class="pre">JOIN</span> <span class="pre">manager</span> <span class="pre">AS</span> <span class="pre">manager_1</span></code>, where the <code class="docutils literal notranslate"><span class="pre">employee</span></code>
table is stated again, except as an anonymous alias <code class="docutils literal notranslate"><span class="pre">employee_1</span></code>. This is the
‘automatic generation of an alias’ to which the warning message refers.</p>
<p>When SQLAlchemy loads ORM rows that each contain an <code class="docutils literal notranslate"><span class="pre">Employee</span></code> and a
<code class="docutils literal notranslate"><span class="pre">Manager</span></code> object, the ORM must adapt rows from what above is the
<code class="docutils literal notranslate"><span class="pre">employee_1</span></code> and <code class="docutils literal notranslate"><span class="pre">manager_1</span></code> table aliases into those of the un-aliased
<code class="docutils literal notranslate"><span class="pre">Manager</span></code> class. This process is internally complex and does not accommodate
for all API features, notably when trying to use eager loading features such as
<a class="reference internal" href="orm/queryguide/relationships.html#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> with more deeply nested queries than are shown
here.  As the pattern is unreliable for more complex scenarios and involves
implicit decisionmaking that is difficult to anticipate and follow,
the warning is emitted and this pattern may be considered a legacy feature. The
better way to write this query is to use the same patterns that apply to any
other self-referential relationship, which is to use the <a class="reference internal" href="orm/queryguide/api.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a>
construct explicitly.  For joined-inheritance and other join-oriented mappings,
it is usually desirable to add the use of the <a class="reference internal" href="orm/queryguide/api.html#sqlalchemy.orm.aliased.params.flat" title="sqlalchemy.orm.aliased"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">aliased.flat</span></code></a>
parameter, which will allow a JOIN of two or more tables to be aliased by
applying an alias to the individual tables within the join, rather than
embedding the join into a new subquery:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">aliased</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">manager_alias</span> <span class="o">=</span> <span class="n">aliased</span><span class="p">(</span><span class="n">Manager</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Employee</span><span class="p">,</span> <span class="n">manager_alias</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Employee</span><span class="o">.</span><span class="n">reports_to</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">manager_alias</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql_print'><span class="k">SELECT</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">manager_id</span><span class="p">,</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
<span class="n">employee</span><span class="p">.</span><span class="k">type</span><span class="p">,</span><span class="w"> </span><span class="n">manager_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_1</span><span class="p">,</span><span class="w"> </span><span class="n">employee_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_2</span><span class="p">,</span>
<span class="n">employee_1</span><span class="p">.</span><span class="n">manager_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">manager_id_1</span><span class="p">,</span><span class="w"> </span><span class="n">employee_1</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">name_1</span><span class="p">,</span>
<span class="n">employee_1</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">type_1</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="k">JOIN</span>
<span class="p">(</span><span class="n">employee</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">employee_1</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">manager_1</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">manager_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">employee_1</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
<span class="k">ON</span><span class="w"> </span><span class="n">manager_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">manager_id</span>
</div></pre></div>
</div>
<p>If we then wanted to use <a class="reference internal" href="orm/queryguide/relationships.html#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> to populate the
<code class="docutils literal notranslate"><span class="pre">reports_to</span></code> attribute, we refer to the alias:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="n">select</span><span class="p">(</span><span class="n">Employee</span><span class="p">)</span>
<span class="gp">... </span>    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Employee</span><span class="o">.</span><span class="n">reports_to</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">manager_alias</span><span class="p">))</span>
<span class="gp">... </span>    <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">contains_eager</span><span class="p">(</span><span class="n">Employee</span><span class="o">.</span><span class="n">reports_to</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">manager_alias</span><span class="p">)))</span>
<span class="gp">... </span><span class="p">)</span></pre></div>
</div>
<p>Without using the explicit <a class="reference internal" href="orm/queryguide/api.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a> object, in some more nested
cases the <a class="reference internal" href="orm/queryguide/relationships.html#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a> option does not have enough context to
know where to get its data from, in the case that the ORM is “auto-aliasing”
in a very nested context.  Therefore it’s best not to rely on this feature
and instead keep the SQL construction as explicit as possible.</p>
</section>
</section>
<section id="id16">
<h2>对象关系映射<a class="headerlink" href="#id16" title="Link to this heading">¶</a></h2>
<p>Object Relational Mapping</p>
<section id="illegalstatechangeerror">
<span id="error-isce"></span><h3>IllegalStateChangeError 和并发异常<a class="headerlink" href="#illegalstatechangeerror" title="Link to this heading">¶</a></h3>
<p>IllegalStateChangeError and concurrency exceptions</p>
<p>SQLAlchemy 2.0 introduced a new system described at <a class="reference internal" href="changelog/whatsnew_20.html#change-7433"><span class="std std-ref">Session raises proactively when illegal concurrent or reentrant access is detected</span></a>, which
proactively detects concurrent methods being invoked on an individual instance of
the <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>
object and by extension the <a class="reference internal" href="orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession" title="sqlalchemy.ext.asyncio.AsyncSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncSession</span></code></a> proxy object.
These concurrent access calls typically, though not exclusively, would occur
when a single instance of <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> is shared among multiple
concurrent threads without such access being synchronized, or similarly
when a single instance of <a class="reference internal" href="orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession" title="sqlalchemy.ext.asyncio.AsyncSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncSession</span></code></a> is shared among
multiple concurrent tasks (such as when using a function like <code class="docutils literal notranslate"><span class="pre">asyncio.gather()</span></code>).
These use patterns are not the appropriate use of these objects, where without
the proactive warning system SQLAlchemy implements would still otherwise produce
invalid state within the objects, producing hard-to-debug errors including
driver-level errors on the database connections themselves.</p>
<p>Instances of <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> and <a class="reference internal" href="orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession" title="sqlalchemy.ext.asyncio.AsyncSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncSession</span></code></a> are
<strong>mutable, stateful objects with no built-in synchronization</strong> of method calls,
and represent a <strong>single, ongoing database transaction</strong> upon a single database
connection at a time for a particular <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> or <a class="reference internal" href="orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncEngine" title="sqlalchemy.ext.asyncio.AsyncEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncEngine</span></code></a>
to which the object is bound (note that these objects both support being bound
to multiple engines at once, however in this case there will still be only one
connection per engine in play within the scope of a transaction).  A single
database transaction is not an appropriate target for concurrent SQL commands;
instead, an application that runs concurrent database operations should use
concurrent transactions. For these objects then it follows that the appropriate
pattern is <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> per thread, or <a class="reference internal" href="orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession" title="sqlalchemy.ext.asyncio.AsyncSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncSession</span></code></a>
per task.</p>
<p>For more background on concurrency see the section
<a class="reference internal" href="orm/session_basics.html#session-faq-threadsafe"><span class="std std-ref">会话是线程安全的吗？AsyncSession 在并发任务中共享是否安全？</span></a>.</p>
</section>
<section id="x">
<span id="error-bhk3"></span><h3>父实例 &lt;x&gt; 未绑定到会话；（延迟加载/延迟加载/刷新/等）操作无法继续<a class="headerlink" href="#x" title="Link to this heading">¶</a></h3>
<p>Parent instance &lt;x&gt; is not bound to a Session; (lazy load/deferred load/refresh/etc.) operation cannot proceed</p>
<p>This is likely the most common error message when dealing with the ORM, and it
occurs as a result of the nature of a technique the ORM makes wide use of known
as <a class="reference internal" href="glossary.html#term-lazy-loading"><span class="xref std std-term">lazy loading</span></a>.   Lazy loading is a common object-relational pattern
whereby an object that’s persisted by the ORM maintains a proxy to the database
itself, such that when various attributes upon the object are accessed, their
value may be retrieved from the database <em>lazily</em>.   The advantage to this
approach is that objects can be retrieved from the database without having
to load all of their attributes or related data at once, and instead only that
data which is requested can be delivered at that time.   The major disadvantage
is basically a mirror image of the advantage, which is that if lots of objects
are being loaded which are known to require a certain set of data in all cases,
it is wasteful to load that additional data piecemeal.</p>
<p>Another caveat of lazy loading beyond the usual efficiency concerns is that
in order for lazy loading to proceed, the object has to <strong>remain associated
with a Session</strong> in order to be able to retrieve its state.  This error message
means that an object has become de-associated with its <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> and
is being asked to lazy load data from the database.</p>
<p>The most common reason that objects become detached from their <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>
is that the session itself was closed, typically via the <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session.close" title="sqlalchemy.orm.Session.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.close()</span></code></a>
method.   The objects will then live on to be accessed further, very often
within web applications where they are delivered to a server-side templating
engine and are asked for further attributes which they cannot load.</p>
<p>Mitigation of this error is via these techniques:</p>
<ul>
<li><p><strong>Try not to have detached objects; don’t close the session prematurely</strong> - Often, applications will close
out a transaction before passing off related objects to some other system
which then fails due to this error.   Sometimes the transaction doesn’t need
to be closed so soon; an example is the web application closes out
the transaction before the view is rendered.  This is often done in the name
of “correctness”, but may be seen as a mis-application of “encapsulation”,
as this term refers to code organization, not actual actions. The template that
uses an ORM object is making use of the <a class="reference external" href="https://en.wikipedia.org/wiki/Proxy_pattern">proxy pattern</a>
which keeps database logic encapsulated from the caller.   If the
<a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> can be held open until the lifespan of the objects are done,
this is the best approach.</p></li>
<li><p><strong>Otherwise, load everything that’s needed up front</strong> - It is very often impossible to
keep the transaction open, especially in more complex applications that need
to pass objects off to other systems that can’t run in the same context
even though they’re in the same process.  In this case, the application
should prepare to deal with <a class="reference internal" href="glossary.html#term-detached"><span class="xref std std-term">detached</span></a> objects,
and should try to make appropriate use of <a class="reference internal" href="glossary.html#term-eager-loading"><span class="xref std std-term">eager loading</span></a> to ensure
that objects have what they need up front.</p></li>
<li><p><strong>And importantly, set expire_on_commit to False</strong> - When using detached objects, the
most common reason objects need to re-load data is because they were expired
from the last call to <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session.commit" title="sqlalchemy.orm.Session.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.commit()</span></code></a>.   This expiration should
not be used when dealing with detached objects; so the
<a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session.params.expire_on_commit" title="sqlalchemy.orm.Session"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.expire_on_commit</span></code></a> parameter be set to <code class="docutils literal notranslate"><span class="pre">False</span></code>.
By preventing the objects from becoming expired outside of the transaction,
the data which was loaded will remain present and will not incur additional
lazy loads when that data is accessed.</p>
<p>Note also that <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session.rollback" title="sqlalchemy.orm.Session.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.rollback()</span></code></a> method unconditionally expires
all contents in the <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> and should also be avoided in
non-error scenarios.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="orm/queryguide/relationships.html#loading-toplevel"><span class="std std-ref">关系加载技术</span></a> - detailed documentation on eager loading and other
relationship-oriented loading techniques</p>
<p><a class="reference internal" href="orm/session_basics.html#session-committing"><span class="std std-ref">提交</span></a> - background on session commit</p>
<p><a class="reference internal" href="orm/session_state_management.html#session-expire"><span class="std std-ref">刷新/过期</span></a> - background on attribute expiry</p>
</div>
</li>
</ul>
</section>
<section id="error-7s2a">
<span id="id17"></span><h3>由于刷新期间发生先前的异常，此会话的事务已被回滚<a class="headerlink" href="#error-7s2a" title="Link to this heading">¶</a></h3>
<p>This Session’s transaction has been rolled back due to a previous exception during flush</p>
<p>The flush process of the <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>, described at
<a class="reference internal" href="orm/session_basics.html#session-flushing"><span class="std std-ref">刷新</span></a>, will roll back the database transaction if an error is
encountered, in order to maintain internal consistency.  However, once this
occurs, the session’s transaction is now “inactive” and must be explicitly
rolled back by the calling application, in the same way that it would otherwise
need to be explicitly committed if a failure had not occurred.</p>
<p>This is a common error when using the ORM and typically applies to an
application that doesn’t yet have correct “framing” around its
<a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> operations. Further detail is described in the FAQ at
<a class="reference internal" href="faq/sessions.html#faq-session-rollback"><span class="std std-ref">“由于刷新期间出现先前的异常，此 Session 的事务已被回滚。”（或类似）</span></a>.</p>
</section>
<section id="relationship-delete-orphan">
<span id="error-bbf0"></span><h3>对于关系 &lt;relationship&gt;，delete-orphan 级联通常仅配置在一对多关系的“一”侧，而不是多对一或多对多关系的“多”侧。<a class="headerlink" href="#relationship-delete-orphan" title="Link to this heading">¶</a></h3>
<p>For relationship &lt;relationship&gt;, delete-orphan cascade is normally configured only on the “one” side of a one-to-many relationship, and not on the “many” side of a many-to-one or many-to-many relationship.</p>
<p>This error arises when the “delete-orphan” <a class="reference internal" href="orm/cascades.html#unitofwork-cascades"><span class="std std-ref">cascade</span></a>
is set on a many-to-one or many-to-many relationship, such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>

    <span class="n">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">bs</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
    <span class="n">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">a_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;a.id&quot;</span><span class="p">))</span>

    <span class="c1"># this will emit the error message when the mapper</span>
    <span class="c1"># configuration step occurs</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;bs&quot;</span><span class="p">,</span> <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">)</span>


<span class="n">configure_mappers</span><span class="p">()</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>Above, the “delete-orphan” setting on <code class="docutils literal notranslate"><span class="pre">B.a</span></code> indicates the intent that
when every <code class="docutils literal notranslate"><span class="pre">B</span></code> object that refers to a particular <code class="docutils literal notranslate"><span class="pre">A</span></code> is deleted, that the
<code class="docutils literal notranslate"><span class="pre">A</span></code> should then be deleted as well.   That is, it expresses that the “orphan”
which is being deleted would be an <code class="docutils literal notranslate"><span class="pre">A</span></code> object, and it becomes an “orphan”
when every <code class="docutils literal notranslate"><span class="pre">B</span></code> that refers to it is deleted.</p>
<p>The “delete-orphan” cascade model does not support this functionality.   The
“orphan” consideration is only made in terms of the deletion of a single object
which would then refer to zero or more objects that are now “orphaned” by
this single deletion, which would result in those objects being deleted as
well.  In other words, it is designed only to track the creation of “orphans”
based on the removal of one and only one “parent” object per orphan,  which is
the natural case in a one-to-many relationship where a deletion of the
object on the “one” side results in the subsequent deletion of the related
items on the “many” side.</p>
<p>The above mapping in support of this functionality would instead place the
cascade setting on the one-to-many side, which looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>

    <span class="n">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">bs</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
    <span class="n">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">a_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;a.id&quot;</span><span class="p">))</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;bs&quot;</span><span class="p">)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>Where the intent is expressed that when an <code class="docutils literal notranslate"><span class="pre">A</span></code> is deleted, all of the
<code class="docutils literal notranslate"><span class="pre">B</span></code> objects to which it refers are also deleted.</p>
<p>The error message then goes on to suggest the usage of the
<a class="reference internal" href="orm/relationship_api.html#sqlalchemy.orm.relationship.params.single_parent" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.single_parent</span></code></a> flag.    This flag may be used
to enforce that a relationship which is capable of having many objects
refer to a particular object will in fact have only <strong>one</strong> object referring
to it at a time.   It is used for legacy or other less ideal
database schemas where the foreign key relationships suggest a “many”
collection, however in practice only one object would actually refer
to a given target object at at time.  This uncommon scenario
can be demonstrated in terms of the above example as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>

    <span class="n">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">bs</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
    <span class="n">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">a_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;a.id&quot;</span><span class="p">))</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span>
        <span class="s2">&quot;A&quot;</span><span class="p">,</span>
        <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;bs&quot;</span><span class="p">,</span>
        <span class="n">single_parent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">,</span>
    <span class="p">)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>The above configuration will then install a validator which will enforce
that only one <code class="docutils literal notranslate"><span class="pre">B</span></code> may be associated with an <code class="docutils literal notranslate"><span class="pre">A</span></code> at at time, within
the scope of the <code class="docutils literal notranslate"><span class="pre">B.a</span></code> relationship:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b1</span> <span class="o">=</span> <span class="n">B</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b2</span> <span class="o">=</span> <span class="n">B</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a1</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b1</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b2</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a1</span>
<span class="go">sqlalchemy.exc.InvalidRequestError: Instance &lt;A at 0x7eff44359350&gt; is</span>
<span class="go">already associated with an instance of &lt;class &#39;__main__.B&#39;&gt; via its</span>
<span class="go">B.a attribute, and is only allowed a single parent.</span></pre></div>
</div>
<p>Note that this validator is of limited scope and will not prevent multiple
“parents” from being created via the other direction.  For example, it will
not detect the same setting in terms of <code class="docutils literal notranslate"><span class="pre">A.bs</span></code>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a1</span><span class="o">.</span><span class="n">bs</span> <span class="o">=</span> <span class="p">[</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">([</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<div class='show_sql'><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">VALUES</span>
<span class="p">()</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">(</span><span class="n">a_id</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">(</span><span class="n">a_id</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</div></pre></div>
</div>
<p>However, things will not go as expected later on, as the “delete-orphan” cascade
will continue to work in terms of a <strong>single</strong> lead object, meaning if we
delete <strong>either</strong> of the <code class="docutils literal notranslate"><span class="pre">B</span></code> objects, the <code class="docutils literal notranslate"><span class="pre">A</span></code> is deleted.   The other <code class="docutils literal notranslate"><span class="pre">B</span></code> stays
around, where the ORM will usually be smart enough to set the foreign key attribute
to NULL, but this is usually not what’s desired:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<div class='show_sql'><span class="k">UPDATE</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">a_id</span><span class="o">=?</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">(</span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
<span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
<span class="k">COMMIT</span>
</div></pre></div>
</div>
<p>For all the above examples, similar logic applies to the calculus of a
many-to-many relationship; if a many-to-many relationship sets single_parent=True
on one side, that side can use the “delete-orphan” cascade, however this is
very unlikely to be what someone actually wants as the point of a many-to-many
relationship is so that there can be many objects referring to an object
in either direction.</p>
<p>Overall, “delete-orphan” cascade is usually applied
on the “one” side of a one-to-many relationship so that it deletes objects
in the “many” side, and not the other way around.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="orm/cascades.html#unitofwork-cascades"><span class="std std-ref">级联</span></a></p>
<p><a class="reference internal" href="orm/cascades.html#cascade-delete-orphan"><span class="std std-ref">删除-孤立</span></a></p>
<p><a class="reference internal" href="#error-bbf1"><span class="std std-ref">实例 &lt;instance&gt; 已通过其 &lt;attribute&gt; 属性与 &lt;instance&gt; 的一个实例关联，并且只允许有一个父级。</span></a></p>
</div>
</section>
<section id="instance-attribute-instance">
<span id="error-bbf1"></span><h3>实例 &lt;instance&gt; 已通过其 &lt;attribute&gt; 属性与 &lt;instance&gt; 的一个实例关联，并且只允许有一个父级。<a class="headerlink" href="#instance-attribute-instance" title="Link to this heading">¶</a></h3>
<p>Instance &lt;instance&gt; is already associated with an instance of &lt;instance&gt; via its &lt;attribute&gt; attribute, and is only allowed a single parent.</p>
<p>This error is emitted when the <a class="reference internal" href="orm/relationship_api.html#sqlalchemy.orm.relationship.params.single_parent" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.single_parent</span></code></a> flag
is used, and more than one object is assigned as the “parent” of an object at
once.</p>
<p>Given the following mapping:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>

    <span class="n">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
    <span class="n">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">a_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;a.id&quot;</span><span class="p">))</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span>
        <span class="s2">&quot;A&quot;</span><span class="p">,</span>
        <span class="n">single_parent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">,</span>
    <span class="p">)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>The intent indicates that no more than a single <code class="docutils literal notranslate"><span class="pre">B</span></code> object may refer
to a particular <code class="docutils literal notranslate"><span class="pre">A</span></code> object at once:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b1</span> <span class="o">=</span> <span class="n">B</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b2</span> <span class="o">=</span> <span class="n">B</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a1</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b1</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b2</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a1</span>
<span class="go">sqlalchemy.exc.InvalidRequestError: Instance &lt;A at 0x7eff44359350&gt; is</span>
<span class="go">already associated with an instance of &lt;class &#39;__main__.B&#39;&gt; via its</span>
<span class="go">B.a attribute, and is only allowed a single parent.</span></pre></div>
</div>
<p>When this error occurs unexpectedly, it is usually because the
<a class="reference internal" href="orm/relationship_api.html#sqlalchemy.orm.relationship.params.single_parent" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.single_parent</span></code></a> flag was applied in response
to the error message described at <a class="reference internal" href="#error-bbf0"><span class="std std-ref">对于关系 &lt;relationship&gt;，delete-orphan 级联通常仅配置在一对多关系的“一”侧，而不是多对一或多对多关系的“多”侧。</span></a>, and the issue is in
fact a misunderstanding of the “delete-orphan” cascade setting.  See that
message for details.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="#error-bbf0"><span class="std std-ref">对于关系 &lt;relationship&gt;，delete-orphan 级联通常仅配置在一对多关系的“一”侧，而不是多对一或多对多关系的“多”侧。</span></a></p>
</div>
</section>
<section id="x-q-p-y">
<span id="error-qzyx"></span><h3>关系 X 将把 Q 列复制到 P 列，这与关系“Y”相冲突<a class="headerlink" href="#x-q-p-y" title="Link to this heading">¶</a></h3>
<p>relationship X will copy column Q to column P, which conflicts with relationship(s): ‘Y’</p>
<p>This warning refers to the case when two or more relationships will write data
to the same columns on flush, but the ORM does not have any means of
coordinating these relationships together. Depending on specifics, the solution
may be that two relationships need to be referenced by one another using
<a class="reference internal" href="orm/relationship_api.html#sqlalchemy.orm.relationship.params.back_populates" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.back_populates</span></code></a>, or that one or more of the
relationships should be configured with <a class="reference internal" href="orm/relationship_api.html#sqlalchemy.orm.relationship.params.viewonly" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.viewonly</span></code></a>
to prevent conflicting writes, or sometimes that the configuration is fully
intentional and should configure <a class="reference internal" href="orm/relationship_api.html#sqlalchemy.orm.relationship.params.overlaps" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.overlaps</span></code></a> to
silence each warning.</p>
<p>For the typical example that’s missing
<a class="reference internal" href="orm/relationship_api.html#sqlalchemy.orm.relationship.params.back_populates" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.back_populates</span></code></a>, given the following mapping:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Parent</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;parent&quot;</span>
    <span class="n">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">children</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Child&quot;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Child</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;child&quot;</span>
    <span class="n">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;parent.id&quot;</span><span class="p">))</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Parent&quot;</span><span class="p">)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>The above mapping will generate warnings:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>SAWarning: relationship &#39;Child.parent&#39; will copy column parent.id to column child.parent_id,
which conflicts with relationship(s): &#39;Parent.children&#39; (copies parent.id to child.parent_id).</pre></div>
</div>
<p>The relationships <code class="docutils literal notranslate"><span class="pre">Child.parent</span></code> and <code class="docutils literal notranslate"><span class="pre">Parent.children</span></code> appear to be in conflict.
The solution is to apply <a class="reference internal" href="orm/relationship_api.html#sqlalchemy.orm.relationship.params.back_populates" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.back_populates</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Parent</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;parent&quot;</span>
    <span class="n">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">children</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Child&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;parent&quot;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Child</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;child&quot;</span>
    <span class="n">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;parent.id&quot;</span><span class="p">))</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Parent&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;children&quot;</span><span class="p">)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>For more customized relationships where an “overlap” situation may be
intentional and cannot be resolved, the <a class="reference internal" href="orm/relationship_api.html#sqlalchemy.orm.relationship.params.overlaps" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.overlaps</span></code></a>
parameter may specify the names of relationships for which the warning should
not take effect. This typically occurs for two or more relationships to the
same underlying table that include custom
<a class="reference internal" href="orm/relationship_api.html#sqlalchemy.orm.relationship.params.primaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.primaryjoin</span></code></a> conditions that limit the related
items in each case:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Parent</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;parent&quot;</span>
    <span class="n">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span>
        <span class="s2">&quot;Child&quot;</span><span class="p">,</span>
        <span class="n">primaryjoin</span><span class="o">=</span><span class="s2">&quot;and_(Parent.id == Child.parent_id, Child.flag == 0)&quot;</span><span class="p">,</span>
        <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;parent&quot;</span><span class="p">,</span>
        <span class="n">overlaps</span><span class="o">=</span><span class="s2">&quot;c2, parent&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span>
        <span class="s2">&quot;Child&quot;</span><span class="p">,</span>
        <span class="n">primaryjoin</span><span class="o">=</span><span class="s2">&quot;and_(Parent.id == Child.parent_id, Child.flag == 1)&quot;</span><span class="p">,</span>
        <span class="n">overlaps</span><span class="o">=</span><span class="s2">&quot;c1, parent&quot;</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Child</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;child&quot;</span>
    <span class="n">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;parent.id&quot;</span><span class="p">))</span>

    <span class="n">flag</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>Above, the ORM will know that the overlap between <code class="docutils literal notranslate"><span class="pre">Parent.c1</span></code>,
<code class="docutils literal notranslate"><span class="pre">Parent.c2</span></code> and <code class="docutils literal notranslate"><span class="pre">Child.parent</span></code> is intentional.</p>
</section>
<section id="error-lkrp">
<span id="id18"></span><h3>对象无法转换为“持久”状态，因为此身份映射不再有效。<a class="headerlink" href="#error-lkrp" title="Link to this heading">¶</a></h3>
<p>Object cannot be converted to ‘persistent’ state, as this identity map is no longer valid.</p>
<div class="versionadded">
<p><span class="versionmodified added">在 1.4.26 版本加入.</span></p>
</div>
<p>This message was added to accommodate for the case where a
<a class="reference internal" href="core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object that would yield ORM objects is iterated after
the originating <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> has been closed, or otherwise had its
<a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session.expunge_all" title="sqlalchemy.orm.Session.expunge_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.expunge_all()</span></code></a> method called. When a <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>
expunges all objects at once, the internal <a class="reference internal" href="glossary.html#term-identity-map"><span class="xref std std-term">identity map</span></a> used by that
<a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> is replaced with a new one, and the original one
discarded. An unconsumed and unbuffered <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object will
internally maintain a reference to that now-discarded identity map. Therefore,
when the <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> is consumed, the objects that would be yielded
cannot be associated with that <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>. This arrangement is by
design as it is generally not recommended to iterate an unbuffered
<a class="reference internal" href="core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object outside of the transactional context in which it
was created:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># context manager creates new Session</span>
<span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session_obj</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">7</span><span class="p">))</span>

<span class="c1"># context manager is closed, so session_obj above is closed, identity</span>
<span class="c1"># map is replaced</span>

<span class="c1"># iterating the result object can&#39;t associate the object with the</span>
<span class="c1"># Session, raises this error.</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">first</span><span class="p">()</span></pre></div>
</div>
<p>The above situation typically will <strong>not</strong> occur when using the <code class="docutils literal notranslate"><span class="pre">asyncio</span></code>
ORM extension, as when <a class="reference internal" href="orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncSession" title="sqlalchemy.ext.asyncio.AsyncSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncSession</span></code></a> returns a sync-style
<a class="reference internal" href="core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a>, the results have been pre-buffered when the statement
was executed.  This is to allow secondary eager loaders to invoke without needing
an additional <code class="docutils literal notranslate"><span class="pre">await</span></code> call.</p>
<p>To pre-buffer results in the above situation using the regular
<a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> in the same way that the <code class="docutils literal notranslate"><span class="pre">asyncio</span></code> extension does it,
the <code class="docutils literal notranslate"><span class="pre">prebuffer_rows</span></code> execution option may be used as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># context manager creates new Session</span>
<span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session_obj</span><span class="p">:</span>
    <span class="c1"># result internally pre-fetches all objects</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">7</span><span class="p">),</span> <span class="n">execution_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;prebuffer_rows&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
    <span class="p">)</span>

<span class="c1"># context manager is closed, so session_obj above is closed, identity</span>
<span class="c1"># map is replaced</span>

<span class="c1"># pre-buffered objects are returned</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

<span class="c1"># however they are detached from the session, which has been closed</span>
<span class="k">assert</span> <span class="n">inspect</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">detached</span>
<span class="k">assert</span> <span class="n">inspect</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">session</span> <span class="ow">is</span> <span class="kc">None</span></pre></div>
</div>
<p>Above, the selected ORM objects are fully generated within the <code class="docutils literal notranslate"><span class="pre">session_obj</span></code>
block, associated with <code class="docutils literal notranslate"><span class="pre">session_obj</span></code> and buffered within the
<a class="reference internal" href="core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object for iteration. Outside the block,
<code class="docutils literal notranslate"><span class="pre">session_obj</span></code> is closed and expunges these ORM objects. Iterating the
<a class="reference internal" href="core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object will yield those ORM objects, however as their
originating <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> has expunged them, they will be delivered in
the <a class="reference internal" href="glossary.html#term-detached"><span class="xref std std-term">detached</span></a> state.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>The above reference to a “pre-buffered” vs. “un-buffered”
<a class="reference internal" href="core/connections.html#sqlalchemy.engine.Result" title="sqlalchemy.engine.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> object refers to the process by which the ORM
converts incoming raw database rows from the <a class="reference internal" href="glossary.html#term-DBAPI"><span class="xref std std-term">DBAPI</span></a> into ORM
objects.  It does not imply whether or not the underlying <code class="docutils literal notranslate"><span class="pre">cursor</span></code>
object itself, which represents pending results from the DBAPI, is itself
buffered or unbuffered, as this is essentially a lower layer of buffering.
For background on buffering of the <code class="docutils literal notranslate"><span class="pre">cursor</span></code> results itself, see the
section <a class="reference internal" href="core/connections.html#engine-stream-results"><span class="std std-ref">使用服务器端游标（又称流结果）</span></a>.</p>
</div>
</section>
<section id="error-zlpr">
<span id="id19"></span><h3>无法将类型注释解释为带注释的声明表形式<a class="headerlink" href="#error-zlpr" title="Link to this heading">¶</a></h3>
<p>Type annotation can’t be interpreted for Annotated Declarative Table form</p>
<p>SQLAlchemy 2.0 introduces a new
<a class="reference internal" href="orm/declarative_tables.html#orm-declarative-mapped-column"><span class="std std-ref">Annotated Declarative Table</span></a> declarative
system which derives ORM mapped attribute information from <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a>
annotations within class definitions at runtime. A requirement of this form is
that all ORM annotations must make use of a generic container called
<a class="reference internal" href="orm/internals.html#sqlalchemy.orm.Mapped" title="sqlalchemy.orm.Mapped"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapped</span></code></a> to be properly annotated. Legacy SQLAlchemy mappings which
include explicit <span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a> typing annotations, such as those which use the
legacy Mypy extension for typing support, may include
directives such as those for <a class="reference internal" href="orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> that don’t include this
generic.</p>
<p>To resolve, the classes may be marked with the <code class="docutils literal notranslate"><span class="pre">__allow_unmapped__</span></code> boolean
attribute until they can be fully migrated to the 2.0 syntax. See the migration
notes at <a class="reference internal" href="changelog/migration_20.html#migration-20-step-six"><span class="std std-ref">Migration to 2.0 Step Six - Add __allow_unmapped__ to explicitly typed ORM models</span></a> for an example.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="changelog/migration_20.html#migration-20-step-six"><span class="std std-ref">Migration to 2.0 Step Six - Add __allow_unmapped__ to explicitly typed ORM models</span></a> - in the <a class="reference internal" href="changelog/migration_20.html#migration-20-toplevel"><span class="std std-ref">SQLAlchemy 2.0 - Major Migration Guide</span></a> document</p>
</div>
</section>
<section id="cls-cls">
<span id="error-dcmx"></span><h3>将 &lt;cls&gt; 转换为数据类时，属性源自非数据类的超类 &lt;cls&gt;。<a class="headerlink" href="#cls-cls" title="Link to this heading">¶</a></h3>
<p>When transforming &lt;cls&gt; to a dataclass, attribute(s) originate from superclass &lt;cls&gt; which is not a dataclass.</p>
<p>This warning occurs when using the SQLAlchemy ORM Mapped Dataclasses feature
described at <a class="reference internal" href="orm/dataclasses.html#orm-declarative-native-dataclasses"><span class="std std-ref">声明式Dataclass映射</span></a> in conjunction with
any mixin class or abstract base that is not itself declared as a
dataclass, such as in the example below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">uuid4</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">String</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeclarativeBase</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapped</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">mapped_column</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">MappedAsDataclass</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Mixin</span><span class="p">:</span>
    <span class="n">create_user</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">()</span>
    <span class="n">update_user</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="p">(</span><span class="n">DeclarativeBase</span><span class="p">,</span> <span class="n">MappedAsDataclass</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">,</span> <span class="n">Mixin</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;sys_user&quot;</span>

    <span class="n">uid</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span>
        <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default_factory</span><span class="o">=</span><span class="n">uuid4</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">username</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">()</span>
    <span class="n">email</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">()</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>Above, since <code class="docutils literal notranslate"><span class="pre">Mixin</span></code> does not itself extend from <a class="reference internal" href="orm/mapping_api.html#sqlalchemy.orm.MappedAsDataclass" title="sqlalchemy.orm.MappedAsDataclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedAsDataclass</span></code></a>,
the following warning is generated:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SADeprecationWarning: When transforming &lt;class &#39;__main__.User&#39;&gt; to a
dataclass, attribute(s) &quot;create_user&quot;, &quot;update_user&quot; originates from
superclass &lt;class
&#39;__main__.Mixin&#39;&gt;, which is not a dataclass. This usage is deprecated and
will raise an error in SQLAlchemy 2.1. When declaring SQLAlchemy
Declarative Dataclasses, ensure that all mixin classes and other
superclasses which include attributes are also a subclass of
MappedAsDataclass.</pre></div>
</div>
<p>The fix is to add <a class="reference internal" href="orm/mapping_api.html#sqlalchemy.orm.MappedAsDataclass" title="sqlalchemy.orm.MappedAsDataclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedAsDataclass</span></code></a> to the signature of
<code class="docutils literal notranslate"><span class="pre">Mixin</span></code> as well:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Mixin</span><span class="p">(</span><span class="n">MappedAsDataclass</span><span class="p">):</span>
    <span class="n">create_user</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">()</span>
    <span class="n">update_user</span><span class="p">:</span> <span class="n">Mapped</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapped_column</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>Python’s <span class="target" id="index-2"></span><a class="pep reference external" href="https://peps.python.org/pep-0681/"><strong>PEP 681</strong></a> specification does not accommodate for attributes declared
on superclasses of dataclasses that are not themselves dataclasses; per the
behavior of Python dataclasses, such fields are ignored, as in the following
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">field</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">uuid4</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Mixin</span><span class="p">:</span>
    <span class="n">create_user</span><span class="p">:</span> <span class="n">int</span>
    <span class="n">update_user</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">Mixin</span><span class="p">):</span>
    <span class="n">uid</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">()))</span>
    <span class="n">username</span><span class="p">:</span> <span class="n">str</span>
    <span class="n">password</span><span class="p">:</span> <span class="n">str</span>
    <span class="n">email</span><span class="p">:</span> <span class="n">str</span></pre><div class="code-annotations-key"></div></div>
</div>
<p>Above, the <code class="docutils literal notranslate"><span class="pre">User</span></code> class will not include <code class="docutils literal notranslate"><span class="pre">create_user</span></code> in its constructor
nor will it attempt to interpret <code class="docutils literal notranslate"><span class="pre">update_user</span></code> as a dataclass attribute.
This is because <code class="docutils literal notranslate"><span class="pre">Mixin</span></code> is not a dataclass.</p>
<p>SQLAlchemy’s dataclasses feature within the 2.0 series does not honor this
behavior correctly; instead, attributes on non-dataclass mixins and
superclasses are treated as part of the final dataclass configuration.  However
type checkers such as Pyright and Mypy will not consider these fields as
part of the dataclass constructor as they are to be ignored per <span class="target" id="index-3"></span><a class="pep reference external" href="https://peps.python.org/pep-0681/"><strong>PEP 681</strong></a>.
Since their presence is ambiguous otherwise, SQLAlchemy 2.1 will require that
mixin classes which have SQLAlchemy mapped attributes within a dataclass
hierarchy have to themselves be dataclasses.</p>
</section>
<section id="classname-python">
<span id="error-dcte"></span><h3>为 &lt;classname&gt; 创建数据类时遇到 Python 数据类错误<a class="headerlink" href="#classname-python" title="Link to this heading">¶</a></h3>
<p>Python dataclasses error encountered when creating dataclass for &lt;classname&gt;</p>
<p>When using the <a class="reference internal" href="orm/mapping_api.html#sqlalchemy.orm.MappedAsDataclass" title="sqlalchemy.orm.MappedAsDataclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedAsDataclass</span></code></a> mixin class or
<a class="reference internal" href="orm/mapping_api.html#sqlalchemy.orm.registry.mapped_as_dataclass" title="sqlalchemy.orm.registry.mapped_as_dataclass"><code class="xref py py-meth docutils literal notranslate"><span class="pre">registry.mapped_as_dataclass()</span></code></a> decorator, SQLAlchemy makes use
of the actual <a class="reference external" href="https://docs.python.org/3/library/dataclasses.html">Python dataclasses</a> module that’s in the Python standard library
in order to apply dataclass behaviors to the target class.   This API has
its own error scenarios, most of which involve the construction of an
<code class="docutils literal notranslate"><span class="pre">__init__()</span></code> method on the user defined class; the order of attributes
declared on the class, as well as <a class="reference external" href="https://docs.python.org/3/library/dataclasses.html#inheritance">on superclasses</a>, determines
how the <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> method will be constructed and there are specific
rules in how the attributes are organized as well as how they should make
use of parameters such as <code class="docutils literal notranslate"><span class="pre">init=False</span></code>, <code class="docutils literal notranslate"><span class="pre">kw_only=True</span></code>, etc.   <strong>SQLAlchemy
does not control or implement these rules</strong>.  Therefore, for errors of this nature,
consult the <a class="reference external" href="https://docs.python.org/3/library/dataclasses.html">Python dataclasses</a> documentation, with special
attention to the rules applied to <a class="reference external" href="https://docs.python.org/3/library/dataclasses.html#inheritance">inheritance</a>.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="orm/dataclasses.html#orm-declarative-native-dataclasses"><span class="std std-ref">声明式Dataclass映射</span></a> - SQLAlchemy dataclasses documentation</p>
<p><a class="reference external" href="https://docs.python.org/3/library/dataclasses.html">Python dataclasses</a> - on the python.org website</p>
<p><a class="reference external" href="https://docs.python.org/3/library/dataclasses.html#inheritance">inheritance</a> - on the python.org website</p>
</div>
</section>
<section id="orm">
<span id="error-bupq"></span><h3>每行 ORM 按主键批量更新要求记录包含主键值<a class="headerlink" href="#orm" title="Link to this heading">¶</a></h3>
<p>per-row ORM Bulk Update by Primary Key requires that records contain primary key values</p>
<p>This error occurs when making use of the <a class="reference internal" href="orm/queryguide/dml.html#orm-queryguide-bulk-update"><span class="std std-ref">ORM 按主键批量 UPDATE</span></a>
feature without supplying primary key values in the given records, such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">update</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">bindparam</span><span class="p">(</span><span class="s2">&quot;u_name&quot;</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;u_name&quot;</span><span class="p">:</span> <span class="s2">&quot;spongebob&quot;</span><span class="p">,</span> <span class="s2">&quot;fullname&quot;</span><span class="p">:</span> <span class="s2">&quot;Spongebob Squarepants&quot;</span><span class="p">},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;u_name&quot;</span><span class="p">:</span> <span class="s2">&quot;patrick&quot;</span><span class="p">,</span> <span class="s2">&quot;fullname&quot;</span><span class="p">:</span> <span class="s2">&quot;Patrick Star&quot;</span><span class="p">},</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span><span class="p">)</span></pre></div>
</div>
<p>Above, the presence of a list of parameter dictionaries combined with usage of
the <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> to execute an ORM-enabled UPDATE statement will
automatically make use of ORM Bulk Update by Primary Key, which expects
parameter dictionaries to include primary key values, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">update</span><span class="p">(</span><span class="n">User</span><span class="p">),</span>
<span class="gp">... </span>    <span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;fullname&quot;</span><span class="p">:</span> <span class="s2">&quot;Spongebob Squarepants&quot;</span><span class="p">},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;fullname&quot;</span><span class="p">:</span> <span class="s2">&quot;Patrick Star&quot;</span><span class="p">},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;fullname&quot;</span><span class="p">:</span> <span class="s2">&quot;Eugene H. Krabs&quot;</span><span class="p">},</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span><span class="p">)</span></pre></div>
</div>
<p>To invoke the UPDATE statement without supplying per-record primary key values,
use <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session.connection" title="sqlalchemy.orm.Session.connection"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.connection()</span></code></a> to acquire the current <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>,
then invoke with that:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">connection</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">update</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">bindparam</span><span class="p">(</span><span class="s2">&quot;u_name&quot;</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;u_name&quot;</span><span class="p">:</span> <span class="s2">&quot;spongebob&quot;</span><span class="p">,</span> <span class="s2">&quot;fullname&quot;</span><span class="p">:</span> <span class="s2">&quot;Spongebob Squarepants&quot;</span><span class="p">},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;u_name&quot;</span><span class="p">:</span> <span class="s2">&quot;patrick&quot;</span><span class="p">,</span> <span class="s2">&quot;fullname&quot;</span><span class="p">:</span> <span class="s2">&quot;Patrick Star&quot;</span><span class="p">},</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span><span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="orm/queryguide/dml.html#orm-queryguide-bulk-update"><span class="std std-ref">ORM 按主键批量 UPDATE</span></a></p>
<p><a class="reference internal" href="orm/queryguide/dml.html#orm-queryguide-bulk-update-disabling"><span class="std std-ref">禁用具有多个参数集的 UPDATE 语句的按主键批量 ORM 更新</span></a></p>
</div>
</section>
</section>
<section id="asyncio">
<h2>AsyncIO 异常<a class="headerlink" href="#asyncio" title="Link to this heading">¶</a></h2>
<p>AsyncIO Exceptions</p>
<section id="awaitrequired">
<span id="error-xd1r"></span><h3>AwaitRequired<a class="headerlink" href="#awaitrequired" title="Link to this heading">¶</a></h3>
<p>AwaitRequired</p>
<p>The SQLAlchemy async mode requires an async driver to be used to connect to the db.
This error is usually raised when trying to use the async version of SQLAlchemy
with a non compatible <a class="reference internal" href="glossary.html#term-DBAPI"><span class="xref std std-term">DBAPI</span></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="orm/extensions/asyncio.html#asyncio-toplevel"><span class="std std-ref">异步 I/O (asyncio)</span></a></p>
</div>
</section>
<section id="missinggreenlet">
<span id="error-xd2s"></span><h3>MissingGreenlet<a class="headerlink" href="#missinggreenlet" title="Link to this heading">¶</a></h3>
<p>MissingGreenlet</p>
<p>A call to the async <a class="reference internal" href="glossary.html#term-DBAPI"><span class="xref std std-term">DBAPI</span></a> was initiated outside the greenlet spawn
context usually setup by the SQLAlchemy AsyncIO proxy classes. Usually this
error happens when an IO was attempted in an unexpected place, using a
calling pattern that does not directly provide for use of the <code class="docutils literal notranslate"><span class="pre">await</span></code> keyword.
When using the ORM this is nearly always due to the use of <a class="reference internal" href="glossary.html#term-lazy-loading"><span class="xref std std-term">lazy loading</span></a>,
which is not directly supported under asyncio without additional steps
and/or alternate loader patterns in order to use successfully.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="orm/extensions/asyncio.html#asyncio-orm-avoid-lazyloads"><span class="std std-ref">使用 AsyncSession 时防止隐式 IO</span></a> - covers most ORM scenarios where
this problem can occur and how to mitigate, including specific patterns
to use with lazy load scenarios.</p>
</div>
</section>
<section id="error-xd3s">
<span id="id20"></span><h3>无可用检查<a class="headerlink" href="#error-xd3s" title="Link to this heading">¶</a></h3>
<p>No Inspection Available</p>
<p>Using the <a class="reference internal" href="core/inspection.html#sqlalchemy.inspect" title="sqlalchemy.inspect"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect()</span></code></a> function directly on an
<a class="reference internal" href="orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncConnection" title="sqlalchemy.ext.asyncio.AsyncConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncConnection</span></code></a> or <a class="reference internal" href="orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncEngine" title="sqlalchemy.ext.asyncio.AsyncEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncEngine</span></code></a> object is
not currently supported, as there is not yet an awaitable form of the
<a class="reference internal" href="core/reflection.html#sqlalchemy.engine.reflection.Inspector" title="sqlalchemy.engine.reflection.Inspector"><code class="xref py py-class docutils literal notranslate"><span class="pre">Inspector</span></code></a> object available. Instead, the object
is used by acquiring it using the
<a class="reference internal" href="core/inspection.html#sqlalchemy.inspect" title="sqlalchemy.inspect"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect()</span></code></a> function in such a way that it refers to the underlying
<a class="reference internal" href="orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncConnection.sync_connection" title="sqlalchemy.ext.asyncio.AsyncConnection.sync_connection"><code class="xref py py-attr docutils literal notranslate"><span class="pre">AsyncConnection.sync_connection</span></code></a> attribute of the
<a class="reference internal" href="orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncConnection" title="sqlalchemy.ext.asyncio.AsyncConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncConnection</span></code></a> object; the <code class="xref py py-class docutils literal notranslate"><span class="pre">Inspector</span></code> is
then used in a “synchronous” calling style by using the
<a class="reference internal" href="orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.AsyncConnection.run_sync" title="sqlalchemy.ext.asyncio.AsyncConnection.run_sync"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AsyncConnection.run_sync()</span></code></a> method along with a custom function
that performs the desired operations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">async_main</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">sync_conn</span><span class="p">:</span> <span class="n">inspect</span><span class="p">(</span><span class="n">sync_conn</span><span class="p">)</span><span class="o">.</span><span class="n">get_table_names</span><span class="p">()</span>
        <span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="orm/extensions/asyncio.html#asyncio-inspector"><span class="std std-ref">使用检查器检查架构对象</span></a> - additional examples of using <a class="reference internal" href="core/inspection.html#sqlalchemy.inspect" title="sqlalchemy.inspect"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect()</span></code></a>
with the asyncio extension.</p>
</div>
</section>
</section>
<section id="id21">
<h2>核心异常类<a class="headerlink" href="#id21" title="Link to this heading">¶</a></h2>
<p>Core Exception Classes</p>
<p>See <a class="reference internal" href="core/exceptions.html#core-exceptions-toplevel"><span class="std std-ref">Core 异常</span></a> for Core exception classes.</p>
</section>
<section id="id22">
<h2>ORM 异常类<a class="headerlink" href="#id22" title="Link to this heading">¶</a></h2>
<p>ORM Exception Classes</p>
<p>See <a class="reference internal" href="orm/exceptions.html#orm-exceptions-toplevel"><span class="std std-ref">ORM 异常</span></a> for ORM exception classes.</p>
</section>
<section id="id23">
<h2>旧式异常<a class="headerlink" href="#id23" title="Link to this heading">¶</a></h2>
<p>Legacy Exceptions</p>
<p>Exceptions in this section are not generated by current SQLAlchemy
versions, however are provided here to suit exception message hyperlinks.</p>
<section id="sqlalchemy-2-0-some-function-something">
<span id="error-b8d9"></span><h3>SQLAlchemy 2.0 中的 &lt;some function&gt; 将不再是 &lt;something&gt;<a class="headerlink" href="#sqlalchemy-2-0-some-function-something" title="Link to this heading">¶</a></h3>
<p>The &lt;some function&gt; in SQLAlchemy 2.0 will no longer &lt;something&gt;</p>
<p>SQLAlchemy 2.0 represents a major shift for a wide variety of key
SQLAlchemy usage patterns in both the Core and ORM components.   The goal
of the 2.0 release is to make a slight readjustment in some of the most
fundamental assumptions of SQLAlchemy since its early beginnings, and
to deliver a newly streamlined usage model that is hoped to be significantly
more minimalist and consistent between the Core and ORM components, as well as
more capable.</p>
<p>Introduced at <a class="reference internal" href="changelog/migration_20.html#migration-20-toplevel"><span class="std std-ref">SQLAlchemy 2.0 - Major Migration Guide</span></a>, the SQLAlchemy 2.0 project includes
a comprehensive future compatibility system that’s integrated into the
1.4 series of SQLAlchemy, such that applications will have a clear,
unambiguous, and incremental upgrade path in order to migrate applications to
being fully 2.0 compatible.   The <code class="xref py py-class docutils literal notranslate"><span class="pre">RemovedIn20Warning</span></code> deprecation
warning is at the base of this system to provide guidance on what behaviors in
an existing codebase will need to be modified.  An overview of how to enable
this warning is at <a class="reference internal" href="changelog/migration_14.html#deprecation-20-mode"><span class="std std-ref">SQLAlchemy 2.0 Deprecations Mode</span></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="changelog/migration_20.html#migration-20-toplevel"><span class="std std-ref">SQLAlchemy 2.0 - Major Migration Guide</span></a>  - An overview of the upgrade process from
the 1.x series, as well as the current goals and progress of SQLAlchemy
2.0.</p>
<p><a class="reference internal" href="changelog/migration_14.html#deprecation-20-mode"><span class="std std-ref">SQLAlchemy 2.0 Deprecations Mode</span></a> - specific guidelines on how to use
“2.0 deprecations mode” in SQLAlchemy 1.4.</p>
</div>
</section>
<section id="backref">
<span id="error-s9r1"></span><h3>对象正沿着 backref 级联合并到会话中<a class="headerlink" href="#backref" title="Link to this heading">¶</a></h3>
<p>Object is being merged into a Session along the backref cascade</p>
<p>This message refers to the “backref cascade” behavior of SQLAlchemy,
removed in version 2.0.  This refers to the action of
an object being added into a <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> as a result of another
object that’s already present in that session being associated with it.
As this behavior has been shown to be more confusing than helpful,
the <a class="reference internal" href="orm/relationship_api.html#sqlalchemy.orm.relationship.params.cascade_backrefs" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.cascade_backrefs</span></code></a> and
<a class="reference internal" href="orm/relationship_api.html#sqlalchemy.orm.backref.params.cascade_backrefs" title="sqlalchemy.orm.backref"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">backref.cascade_backrefs</span></code></a> parameters were added, which can
be set to <code class="docutils literal notranslate"><span class="pre">False</span></code> to disable it, and in SQLAlchemy 2.0 the “cascade backrefs”
behavior has been removed entirely.</p>
<p>For older SQLAlchemy versions, to set
<a class="reference internal" href="orm/relationship_api.html#sqlalchemy.orm.relationship.params.cascade_backrefs" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.cascade_backrefs</span></code></a> to <code class="docutils literal notranslate"><span class="pre">False</span></code> on a backref that
is currently configured using the <a class="reference internal" href="orm/relationship_api.html#sqlalchemy.orm.relationship.params.backref" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.backref</span></code></a> string
parameter, the backref must be declared using the <a class="reference internal" href="orm/relationship_api.html#sqlalchemy.orm.backref" title="sqlalchemy.orm.backref"><code class="xref py py-func docutils literal notranslate"><span class="pre">backref()</span></code></a> function
first so that the <a class="reference internal" href="orm/relationship_api.html#sqlalchemy.orm.backref.params.cascade_backrefs" title="sqlalchemy.orm.backref"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">backref.cascade_backrefs</span></code></a> parameter may be
passed.</p>
<p>Alternatively, the entire “cascade backrefs” behavior can be turned off
across the board by using the <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> in “future” mode,
by passing <code class="docutils literal notranslate"><span class="pre">True</span></code> for the <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session.params.future" title="sqlalchemy.orm.Session"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.future</span></code></a> parameter.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="changelog/migration_14.html#change-5150"><span class="std std-ref">cascade_backrefs behavior deprecated for removal in 2.0</span></a> - background on the change for SQLAlchemy 2.0.</p>
</div>
</section>
<section id="select">
<span id="error-c9ae"></span><h3>select() 构造在“旧版”模式下创建；关键字参数等。<a class="headerlink" href="#select" title="Link to this heading">¶</a></h3>
<p>select() construct created in “legacy” mode; keyword arguments, etc.</p>
<p>The <a class="reference internal" href="core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> construct has been updated as of SQLAlchemy
1.4 to support the newer calling style that is standard in
SQLAlchemy 2.0.   For backwards compatibility within
the 1.4 series, the construct accepts arguments in both the “legacy” style as well
as the “new” style.</p>
<p>The “new” style features that column and table expressions are passed
positionally to the <a class="reference internal" href="core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> construct only; any other
modifiers to the object must be passed using subsequent method chaining:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># this is the way to do it going forward</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">table1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">myid</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">table1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">myid</span> <span class="o">==</span> <span class="n">table2</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">otherid</span><span class="p">)</span></pre></div>
</div>
<p>For comparison, a <a class="reference internal" href="core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> in legacy forms of SQLAlchemy,
before methods like <a class="reference internal" href="core/selectable.html#sqlalchemy.sql.expression.Select.where" title="sqlalchemy.sql.expression.Select.where"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.where()</span></code></a> were even added, would like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># this is how it was documented in original SQLAlchemy versions</span>
<span class="c1"># many years ago</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">myid</span><span class="p">],</span> <span class="n">whereclause</span><span class="o">=</span><span class="n">table1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">myid</span> <span class="o">==</span> <span class="n">table2</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">otherid</span><span class="p">)</span></pre></div>
</div>
<p>Or even that the “whereclause” would be passed positionally:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># this is also how it was documented in original SQLAlchemy versions</span>
<span class="c1"># many years ago</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">myid</span><span class="p">],</span> <span class="n">table1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">myid</span> <span class="o">==</span> <span class="n">table2</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">otherid</span><span class="p">)</span></pre></div>
</div>
<p>For some years now, the additional “whereclause” and other arguments that are
accepted have been removed from most narrative documentation, leading to a
calling style that is most familiar as the list of column arguments passed
as a list, but no further arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># this is how it&#39;s been documented since around version 1.0 or so</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">myid</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">table1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">myid</span> <span class="o">==</span> <span class="n">table2</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">otherid</span><span class="p">)</span></pre></div>
</div>
<p>The document at <a class="reference internal" href="changelog/migration_20.html#migration-20-5284"><span class="std std-ref">select() no longer accepts varied constructor arguments, columns are passed positionally</span></a> describes this change in terms
of <a class="reference internal" href="changelog/migration_20.html#migration-20-toplevel"><span class="std std-ref">2.0 Migration</span></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="changelog/migration_20.html#migration-20-5284"><span class="std std-ref">select() no longer accepts varied constructor arguments, columns are passed positionally</span></a></p>
<p><a class="reference internal" href="changelog/migration_20.html#migration-20-toplevel"><span class="std std-ref">SQLAlchemy 2.0 - Major Migration Guide</span></a></p>
</div>
</section>
<section id="future-true">
<span id="error-c9bf"></span><h3>通过旧式绑定元数据定位了一个绑定，但由于此会话上设置了 future=True，因此此绑定被忽略。<a class="headerlink" href="#future-true" title="Link to this heading">¶</a></h3>
<p>A bind was located via legacy bound metadata, but since future=True is set on this Session, this bind is ignored.</p>
<p>The concept of “bound metadata” is present up until SQLAlchemy 1.4; as
of SQLAlchemy 2.0 it’s been removed.</p>
<p>This error refers to the <a class="reference internal" href="core/metadata.html#sqlalchemy.schema.MetaData.params.bind" title="sqlalchemy.schema.MetaData"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">MetaData.bind</span></code></a> parameter on the
<a class="reference internal" href="core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a> object that in turn allows objects like the ORM
<a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> to associate a particular mapped class with an
<code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code>. In SQLAlchemy 2.0, the <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> must be
linked to each <code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code> directly. That is, instead of instantiating
the <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> or <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.sessionmaker" title="sqlalchemy.orm.sessionmaker"><code class="xref py py-class docutils literal notranslate"><span class="pre">sessionmaker</span></code></a> without any arguments,
and associating the <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> with the
<a class="reference internal" href="core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">)</span>
<span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">()</span>
<span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">metadata_obj</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span> <span class="o">...</span>


<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MyClass</span><span class="p">())</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>The <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> must instead be associated directly with the
<a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.sessionmaker" title="sqlalchemy.orm.sessionmaker"><code class="xref py py-class docutils literal notranslate"><span class="pre">sessionmaker</span></code></a> or <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>.  The
<a class="reference internal" href="core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a> object should no longer be associated with any
engine:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">)</span>
<span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span> <span class="o">...</span>


<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MyClass</span><span class="p">())</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre><div class="code-non-annotations-key"></div></div>
</div>
<p>In SQLAlchemy 1.4, this <a class="reference internal" href="glossary.html#term-2.0-style"><span class="xref std std-term">2.0 style</span></a> behavior is enabled when the
<a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session.params.future" title="sqlalchemy.orm.Session"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.future</span></code></a> flag is set on <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.sessionmaker" title="sqlalchemy.orm.sessionmaker"><code class="xref py py-class docutils literal notranslate"><span class="pre">sessionmaker</span></code></a>
or <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>.</p>
</section>
<section id="error-2afi">
<span id="id24"></span><h3>此编译对象未绑定到任何引擎或连接<a class="headerlink" href="#error-2afi" title="Link to this heading">¶</a></h3>
<p>This Compiled object is not bound to any Engine or Connection</p>
<p>This error refers to the concept of “bound metadata”, which is a legacy
SQLAlchemy pattern present only in 1.x versions. The issue occurs when one invokes
the <code class="xref py py-meth docutils literal notranslate"><span class="pre">Executable.execute()</span></code> method directly off of a Core expression object
that is not associated with any <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">metadata_obj</span><span class="p">,</span> <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">))</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>  <span class="c1"># &lt;--- raises</span></pre></div>
</div>
<p>What the logic is expecting is that the <a class="reference internal" href="core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a> object has
been <strong>bound</strong> to a <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;mysql+pymysql://user:pass@host/db&quot;</span><span class="p">)</span>
<span class="n">metadata_obj</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span></pre></div>
</div>
<p>Where above, any statement that derives from a <a class="reference internal" href="core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> which
in turn derives from that <a class="reference internal" href="core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a> will implicitly make use of
the given <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> in order to invoke the statement.</p>
<p>Note that the concept of bound metadata is <strong>not present in SQLAlchemy 2.0</strong>.
The correct way to invoke statements is via
the <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a> method of a <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span></pre></div>
</div>
<p>When using the ORM, a similar facility is available via the <a class="reference internal" href="orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="tutorial/dbapi_transactions.html#tutorial-statement-execution"><span class="std std-ref">语句执行基础知识</span></a></p>
</div>
</section>
<section id="error-8s2a">
<span id="id25"></span><h3>此连接处于非活动事务中。请完全回滚(rollback)后再继续<a class="headerlink" href="#error-8s2a" title="Link to this heading">¶</a></h3>
<p>This connection is on an inactive transaction.  Please rollback() fully before proceeding</p>
<p>This error condition was added to SQLAlchemy as of version 1.4, and does not
apply to SQLAlchemy 2.0.    The error
refers to the state where a <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> is placed into a
transaction using a method like <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Connection.begin" title="sqlalchemy.engine.Connection.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin()</span></code></a>, and then a
further “marker” transaction is created within that scope; the “marker”
transaction is then rolled back using <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Transaction.rollback" title="sqlalchemy.engine.Transaction.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Transaction.rollback()</span></code></a> or closed
using <a class="reference internal" href="core/connections.html#sqlalchemy.engine.Transaction.close" title="sqlalchemy.engine.Transaction.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Transaction.close()</span></code></a>, however the outer transaction is still
present in an “inactive” state and must be rolled back.</p>
<p>The pattern looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">transaction1</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span>

<span class="c1"># this is a &quot;sub&quot; or &quot;marker&quot; transaction, a logical nesting</span>
<span class="c1"># structure based on &quot;real&quot; transaction transaction1</span>
<span class="n">transaction2</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span>
<span class="n">transaction2</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>

<span class="c1"># transaction1 is still present and needs explicit rollback,</span>
<span class="c1"># so this will raise</span>
<span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;select 1&quot;</span><span class="p">))</span></pre></div>
</div>
<p>Above, <code class="docutils literal notranslate"><span class="pre">transaction2</span></code> is a “marker” transaction, which indicates a logical
nesting of transactions within an outer one; while the inner transaction
can roll back the whole transaction via its rollback() method, its commit()
method has no effect except to close the scope of the “marker” transaction
itself.   The call to <code class="docutils literal notranslate"><span class="pre">transaction2.rollback()</span></code> has the effect of
<strong>deactivating</strong> transaction1 which means it is essentially rolled back
at the database level, however is still present in order to accommodate
a consistent nesting pattern of transactions.</p>
<p>The correct resolution is to ensure the outer transaction is also
rolled back:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">transaction1</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span></pre></div>
</div>
<p>This pattern is not commonly used in Core.  Within the ORM, a similar issue can
occur which is the product of the ORM’s “logical” transaction structure; this
is described in the FAQ entry at <a class="reference internal" href="faq/sessions.html#faq-session-rollback"><span class="std std-ref">“由于刷新期间出现先前的异常，此 Session 的事务已被回滚。”（或类似）</span></a>.</p>
<p>The “subtransaction” pattern is removed in SQLAlchemy 2.0 so that this
particular programming pattern is no longer be available, preventing
this error message.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="changelog/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">变更和迁移</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="faq/thirdparty.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">第三方包集成问题</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                <a href="copyright.html">Copyright</a> &#169; 2007-2025, the SQLAlchemy authors and contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on 04/05/2025 04:00:26</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">错误消息</a><ul>
<li><a class="reference internal" href="#id2">连接和会话</a><ul>
<li><a class="reference internal" href="#queuepool-x-y-z">QueuePool 大小限制 &lt;x&gt; 已达到溢出 &lt;y&gt;，连接超时，超时 &lt;z&gt;</a></li>
<li><a class="reference internal" href="#pool-asyncio">Pool类不能与 asyncio 引擎一起使用（反之亦然）</a></li>
<li><a class="reference internal" href="#rollback">无效事务回滚前无法重新连接。要继续前请先完全回滚(rollback)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dbapi">DBAPI 错误</a><ul>
<li><a class="reference internal" href="#error-rvf5">接口错误</a></li>
<li><a class="reference internal" href="#error-4xp6">数据库错误</a></li>
<li><a class="reference internal" href="#error-9h9h">数据错误</a></li>
<li><a class="reference internal" href="#error-e3q8">操作错误</a></li>
<li><a class="reference internal" href="#error-gkpj">完整性错误</a></li>
<li><a class="reference internal" href="#error-2j85">内部错误</a></li>
<li><a class="reference internal" href="#error-f405">编程错误</a></li>
<li><a class="reference internal" href="#error-tw8g">不支持错误</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sql-expression-language">SQL Expression Language</a><ul>
<li><a class="reference internal" href="#caching-caveats">对象不会产生缓存键，性能影响</a><ul>
<li><a class="reference internal" href="#id12">如果有任何疑问，缓存会自行禁用</a></li>
<li><a class="reference internal" href="#id13">缓存的断言属性</a></li>
</ul>
</li>
<li><a class="reference internal" href="#strsqlcompiler-element-type">编译器 StrSQLCompiler 无法呈现类型为 &lt;element type&gt; 的元素</a></li>
<li><a class="reference internal" href="#typeerror-columnproperty-something-operator">TypeError：’ColumnProperty’ 和 &lt;something&gt; 的实例之间不支持 &lt;operator&gt;</a></li>
<li><a class="reference internal" href="#x-y">绑定参数 &lt;x&gt; 需要一个值（在参数组 &lt;y&gt; 中）</a></li>
<li><a class="reference internal" href="#from-select-from-subquery">预期为 FROM 子句，得到 Select。要创建 FROM 子句，请使用 .subquery() 方法</a></li>
<li><a class="reference internal" href="#error-xaj1">正在为原始子句元素自动生成别名</a></li>
<li><a class="reference internal" href="#error-xaj2">由于表格重叠，正在自动生成别名</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id16">对象关系映射</a><ul>
<li><a class="reference internal" href="#illegalstatechangeerror">IllegalStateChangeError 和并发异常</a></li>
<li><a class="reference internal" href="#x">父实例 &lt;x&gt; 未绑定到会话；（延迟加载/延迟加载/刷新/等）操作无法继续</a></li>
<li><a class="reference internal" href="#error-7s2a">由于刷新期间发生先前的异常，此会话的事务已被回滚</a></li>
<li><a class="reference internal" href="#relationship-delete-orphan">对于关系 &lt;relationship&gt;，delete-orphan 级联通常仅配置在一对多关系的“一”侧，而不是多对一或多对多关系的“多”侧。</a></li>
<li><a class="reference internal" href="#instance-attribute-instance">实例 &lt;instance&gt; 已通过其 &lt;attribute&gt; 属性与 &lt;instance&gt; 的一个实例关联，并且只允许有一个父级。</a></li>
<li><a class="reference internal" href="#x-q-p-y">关系 X 将把 Q 列复制到 P 列，这与关系“Y”相冲突</a></li>
<li><a class="reference internal" href="#error-lkrp">对象无法转换为“持久”状态，因为此身份映射不再有效。</a></li>
<li><a class="reference internal" href="#error-zlpr">无法将类型注释解释为带注释的声明表形式</a></li>
<li><a class="reference internal" href="#cls-cls">将 &lt;cls&gt; 转换为数据类时，属性源自非数据类的超类 &lt;cls&gt;。</a></li>
<li><a class="reference internal" href="#classname-python">为 &lt;classname&gt; 创建数据类时遇到 Python 数据类错误</a></li>
<li><a class="reference internal" href="#orm">每行 ORM 按主键批量更新要求记录包含主键值</a></li>
</ul>
</li>
<li><a class="reference internal" href="#asyncio">AsyncIO 异常</a><ul>
<li><a class="reference internal" href="#awaitrequired">AwaitRequired</a></li>
<li><a class="reference internal" href="#missinggreenlet">MissingGreenlet</a></li>
<li><a class="reference internal" href="#error-xd3s">无可用检查</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id21">核心异常类</a></li>
<li><a class="reference internal" href="#id22">ORM 异常类</a></li>
<li><a class="reference internal" href="#id23">旧式异常</a><ul>
<li><a class="reference internal" href="#sqlalchemy-2-0-some-function-something">SQLAlchemy 2.0 中的 &lt;some function&gt; 将不再是 &lt;something&gt;</a></li>
<li><a class="reference internal" href="#backref">对象正沿着 backref 级联合并到会话中</a></li>
<li><a class="reference internal" href="#select">select() 构造在“旧版”模式下创建；关键字参数等。</a></li>
<li><a class="reference internal" href="#future-true">通过旧式绑定元数据定位了一个绑定，但由于此会话上设置了 future=True，因此此绑定被忽略。</a></li>
<li><a class="reference internal" href="#error-2afi">此编译对象未绑定到任何引擎或连接</a></li>
<li><a class="reference internal" href="#error-8s2a">此连接处于非活动事务中。请完全回滚(rollback)后再继续</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/jquery.js?v=5d32c60e"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="_static/documentation_options.js?v=2d0eb83f"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="_static/tabs.js?v=3ee01567"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=2f3e6152"></script>
    <script src="_static/translations.js?v=beaddf03"></script>
    </body>
</html>